<!DOCTYPE html>
<html manifest="offline.appcache">
<head>
<meta charset="utf-8">
<title>SqueakJS</title>
<link rel="icon" type="image/png" href="squeakjs.png">
<link rel="stylesheet" href="../lib/gh-fork-ribbon.css">
<link rel="stylesheet" href="squeakjs.css">
<script src="../squeak.js"></script>
<script>
    function runSqueak(imageName) {
        sqText.style.display = "none";
        sqCanvas.style.display = "block";
        SqueakJS.runSqueak(imageName, sqCanvas,{
            fullscreen: true,
            spinner: sqSpinner,
            appName: imageName && imageName.replace(/\.image$/, ""),
        });
    }
    window.onhashchange = function() {
        window.location.reload();
    }
    window.onload = function() {
        // if we have a hash then we just run Squeak with the options provided in the url
        if (location.hash) {
            return runSqueak();
        }
        // otherwise, we generate the text to display
        var links = document.getElementsByTagName("a");
        for (var i = 0; i < links.length; i++) {
            var link = links[i],
                href = link.getAttribute("href");
            if (href[0] === "#") {
                link.innerHTML = href;
                link.onclick = (function(href) {
                    return function onclick() { window.location = href; }
                })(href);
            }
        }
        setTimeout(Squeak.fsck.bind(Squeak), 0);
        // also, enable drag-and-drop even if no image loaded yet
        // (squeak.js will replace these when an image is running)
        document.body.ondragover = function(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy';
            return false;
        };
        document.body.ondrop = function(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            var files = [].slice.call(evt.dataTransfer.files),
                todo = files.length,
                imageName = null;
            files.forEach(function(f) {
                var reader = new FileReader();
                reader.onload = function () {
                    var buffer = this.result;
                    console.log("Storing " + f.name + " (" + buffer.byteLength + " bytes)");
                    if (/.*image$/.test(f.name)) imageName = f.name;
                    Squeak.filePut(f.name, buffer, function success() {
                        if (--todo > 0) return;
                        if (!imageName) alert("SqueakJS: stored " + files.length + " files");
                        else runSqueak(imageName);
                    });
                }
                reader.onerror = function() { alert("Failed to read " + f.name); }
                reader.readAsArrayBuffer(f);
            });
            return false;
        };
    }
</script>
</head>
<body>
    <div id="sqText">
        <h1>SqueakJS</h1>
        <div class="github-fork-ribbon-wrapper right">
            <div class="github-fork-ribbon">
                <a href="https://github.com/bertfreudenberg/SqueakJS" target="_blank">Fork me on GitHub</a>
            </div>
        </div>
        SqueakJS is an HTML5 runtime engine for <a href="http://squeak.org/">Squeak</a> Smalltalk written in pure JavaScript by Bert Freudenberg.

        <h3>Run Squeak images from your local machine</h3>
        Use drag-and-drop to run a Squeak image from your machine: drop the image (perhaps together with a changes and sources file) into this page.

        <h3>Run Squeak images from the internet</h3>
        Construct a URL linking to this page and pass the image and options.
        <em>Beware that the server needs to allow script access via <a href="http://enable-cors.org/" target="_blank">CORS</a>.</em>
        <br>Here are a few examples with files I copied to my own web server:
        <ul>
        <li>Squeak 1.13 (1996) <a href="#url=http://freudenbergs.de/bert/squeakjs&files=[Squeak1.13u.image,Squeak1.13u.changes,SqueakV1.sources]&swapButtons=true">link</a></li>
        <li>Squeak 2.8 (2000) <a href="#url=http://freudenbergs.de/bert/squeakjs&files=[Squeak2.8.image,Squeak2.8.changes,SqueakV2.sources]&swapButtons=true">link</a></li>
        <li>Squeak 3.8 (2006) <a href="#url=http://freudenbergs.de/bert/squeakjs&files=[Squeak3.8.1-6747full.image,Squeak3.8.1-6747full.changes,SqueakV3.sources]&swapButtons=true">link</a></li>
        <li>Squeak 3.9 (2008) <a href="#url=http://freudenbergs.de/bert/squeakjs&files=[Squeak3.9.1-final-7075.image,Squeak3.9.1-final-7075.changes,SqueakV39.sources]&swapButtons=true">link</a></li>
        <li>Squeak 4.5 (2014) <a href="#url=http://freudenbergs.de/bert/squeakjs&files=[Squeak4.5-13680.image,Squeak4.5-13680.changes,SqueakV41.sources]">link</a></li>
        </ul>

        <h3>Use SqueakJS on your own website</h3>
        Instead of passing options by URL to this page, you can
        <a href="https://github.com/bertfreudenberg/SqueakJS">download SqueakJS</a>
        from GitHub and use it on your own website like this:
        <pre>
        &lt;html&gt;
            &lt;head&gt;
                &lt;script src=&quot;squeak.js&quot;&gt;&lt;/script&gt;
                &lt;script&gt;
                    window.onload = function() {
                        SqueakJS.runSqueak(&quot;my.image&quot;, sqCanvas, { /*put options here*/ });
                    }
                &lt;/script&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;canvas id=&quot;sqCanvas&quot;&gt;&lt;/canvas&gt;
            &lt;/body&gt;
        &lt;/html&gt;
        </pre>
        Options include display resolution, template file URLs, etc.
        For example usage take a look at the demo pages included in the GitHub repo:
        <a href="http://bertfreudenberg.github.io/SqueakJS/etoys/">Etoys</a>
        (<a href="https://github.com/bertfreudenberg/SqueakJS/tree/master/etoys" target="_blank">source</a>) or
        <a href="http://bertfreudenberg.github.io/SqueakJS/scratch/">Scratch</a>
        (<a href="https://github.com/bertfreudenberg/SqueakJS/tree/master/scratch" target="_blank">source</a>)
    </div>
    <canvas id="sqCanvas"></canvas>
    <div id="sqSpinner"><div></div></div>
</body>
</html>
