"use strict";function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,lastLookup:null,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},_newSocketHandle:function(n,t,r,i){var e=this;return{host:null,port:null,connSemaIndex:t,readSemaIndex:r,writeSemaIndex:i,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:e.Socket_Unconnected,_signalSemaphore:function(t){0>=t||e.primHandler.signalSemaphoreWithIndex(t)},_signalConnSemaphore:function(){this._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){this._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){this._signalSemaphore(this.writeSemaIndex)},_otherEndClosed:function(){this.status=e.Socket_OtherEndClosed,this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return e.needProxy.has(this._hostAndPort())},_getURL:function(e,r){var t="";if(r||this._requestNeedsProxy()){var i="object"==typeof SqueakJS&&SqueakJS.options.proxy;t+=i||"https://crossorigin.me/"}return t+=443!==this.port?"http://"+this._hostAndPort()+e:"https://"+this.host+e},_performRequest:function(){var u=new TextDecoder("utf-8").decode(this.sendBuffer),e=u.split("\r\n\r\n")[0].split("\n"),n=e[0].split(" "),t=n[0];if("GET"!==t&&"PUT"!==t&&"POST"!==t)return this._otherEndClosed(),-1;for(var s=n[1],r=null,i=1;i<e.length;i++){var a=e[i];if(a.match(/Content-Length:/i)){var l=parseInt(a.substr(16)),o=this.sendBuffer.byteLength;r=this.sendBuffer.subarray(o-l,o);break}}window.fetch?this._performFetchAPIRequest(s,t,r,e):this._performXMLHTTPRequest(s,t,r,e)},_performFetchAPIRequest:function(r,a,o,i){for(var t=this,u={},n=1;n<i.length;n++){var s=i[n].split(":");2===s.length&&(u[s[0]]=s[1].trim())}var l={method:a,headers:u,body:o,mode:"cors"};fetch(this._getURL(r),l).then(t._handleFetchAPIResponse.bind(t)).catch(function(){var n=t._getURL(r,!0);console.warn("Retrying with CORS proxy: "+n),fetch(n,l).then(function(r){console.log("Success: "+n),t._handleFetchAPIResponse(r),e.needProxy.add(t._hostAndPort())}).catch(function(){console.warn("Fetch API failed, retrying with XMLHttpRequest"),t._performXMLHTTPRequest(r,a,o,i)})})},_handleFetchAPIResponse:function(e){if(null===this.response){var t=["HTTP/1.0 ",e.status," ",e.statusText,"\r\n"];e.headers.forEach(function(e,r){t=t.concat([r,": ",e,"\r\n"])}),t.push("\r\n"),this.response=[new TextEncoder("utf-8").encode(t.join(""))]}this._readIncremental(e.body.getReader())},_readIncremental:function(t){var e=this;return t.read().then(function(r){return r.done?void(e.responseReceived=!0):(e.response.push(r.value),e._signalReadSemaphore(),e._readIncremental(t))})},_performXMLHTTPRequest:function(s,a,o,u){for(var i,r=this,n=1;n<u.length;n++){var l=u[n];if(l.match(/Content-Type:/i)){i=encodeURIComponent(l.substr(14));break}}var t=new XMLHttpRequest;t.open(a,this._getURL(s)),void 0!==i&&t.setRequestHeader("Content-type",i),t.responseType="arraybuffer",t.onload=function(){r._handleXMLHTTPResponse(this)},t.onerror=function(){var n=r._getURL(s,!0);console.warn("Retrying with CORS proxy: "+n);var i=new XMLHttpRequest;i.open(a,n),i.responseType=t.responseType,i.onload=function(){console.log("Success: "+n),r._handleXMLHTTPResponse(this),e.needProxy.add(r._hostAndPort())},i.onerror=function(){r._otherEndClosed(),console.error("Failed to download:\n"+n)},i.send(o)},t.send(o)},_handleXMLHTTPResponse:function(e){this.responseReceived=!0;var t=e.response;if(!t)return void this._otherEndClosed();var r=new TextEncoder("utf-8").encode("HTTP/1.0 "+e.status+" "+e.statusText+"\r\n"+e.getAllResponseHeaders()+"\r\n"),i=new Uint8Array(r.byteLength+t.byteLength);i.set(r,0),i.set(new Uint8Array(t),r.byteLength),this.response=[i],this._signalReadSemaphore()},connect:function(t,r){this.host=t,this.port=r,this.status=e.Socket_Connected,this._signalConnSemaphore(),this._signalWriteSemaphore()},close:function(){(this.status==e.Socket_Connected||this.status==e.Socket_OtherEndClosed||this.status==e.Socket_WaitingForConnection)&&(this.status=e.Socket_Unconnected,this._signalConnSemaphore())},destroy:function(){this.status=e.Socket_InvalidSocket},dataAvailable:function(){if(this.status==e.Socket_InvalidSocket)return!1;if(this.status==e.Socket_Connected){if(this.response&&this.response.length>0)return this._signalReadSemaphore(),!0;this.responseSentCompletly&&(this.status=e.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(t){if(null===this.response)return[];var e=this.response[0];if(e.length>t){var r=e.subarray(t);r?this.response[0]=r:this.response.shift(),e=e.subarray(0,t)}else this.response.shift();return this.responseReceived&&0===this.response.length&&(this.responseSentCompletly=!0),e},send:function(r,i,n){null!==this.sendTimeout&&window.clearTimeout(this.sendTimeout),this.lastSend=Date.now();var e=r.bytes.subarray(i,n);if(null===this.sendBuffer)this.sendBuffer=e;else{var s=this.sendBuffer.byteLength+e.byteLength,t=new Uint8Array(s);t.set(this.sendBuffer,0),t.set(e,this.sendBuffer.byteLength),this.sendBuffer=t}return this.sendTimeout=setTimeout(this._performRequest.bind(this),50),e.byteLength}}},primitiveHasSocketAccess:function(){return this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject()),!0},primitiveInitializeNetwork:function(){return this.interpreterProxy.pop(1),!0},primitiveResolverNameLookupResult:function(t){if(0!==t)return!1;var e;return null!==this.lastLookup?(e=this.primHandler.makeStString(this.lastLookup),this.lastLookup=null):e=this.interpreterProxy.nilObject(),this.interpreterProxy.popthenPush(1,e),!0},primitiveResolverStartNameLookup:function(e){return 1!==e?!1:(this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString(),this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject()),!0)},primitiveResolverStatus:function(){return this.interpreterProxy.popthenPush(1,this.Resolver_Ready),!0},primitiveSocketConnectionStatus:function(t){if(1!==t)return!1;var r=this.interpreterProxy.stackObjectValue(0).handle,e=r.status;return void 0===e&&(e=this.Socket_InvalidSocket),this.interpreterProxy.popthenPush(1,e),!0},primitiveSocketConnectToPort:function(e){if(3!==e)return!1;var t=this.interpreterProxy.stackObjectValue(2).handle;if(void 0===t)return!1;var r=this.interpreterProxy.stackObjectValue(1).bytesAsString(),i=this.interpreterProxy.stackIntegerValue(0);return t.connect(r,i),this.interpreterProxy.popthenPush(e,this.interpreterProxy.nilObject()),!0},primitiveSocketCloseConnection:function(t){if(1!==t)return!1;var e=this.interpreterProxy.stackObjectValue(0).handle;return void 0===e?!1:(e.close(),this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject()),!0)},primitiveSocketCreate3Semaphores:function(e){if(7!==e)return!1;var r=this.interpreterProxy.stackIntegerValue(0),i=this.interpreterProxy.stackIntegerValue(1),n=this.interpreterProxy.stackIntegerValue(2),s=this.interpreterProxy.stackIntegerValue(3),a=this.interpreterProxy.stackIntegerValue(5);if(a!==this.TCP_Socket_Type)return!1;var o="{SqueakJS Socket #"+ ++this.handleCounter+"}",t=this.primHandler.makeStString(o);return t.handle=this._newSocketHandle(s,n,i,r),this.interpreterProxy.popthenPush(e,t),!0},primitiveSocketDestroy:function(t){if(1!==t)return!1;var e=this.interpreterProxy.stackObjectValue(0).handle;return void 0===e?!1:(e.destroy(),this.interpreterProxy.popthenPush(1,e.status),!0)},primitiveSocketReceiveDataAvailable:function(r){if(1!==r)return!1;var e=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===e)return!1;var t=this.interpreterProxy.falseObject();return e.dataAvailable()&&(t=this.interpreterProxy.trueObject()),this.interpreterProxy.popthenPush(1,t),!0},primitiveSocketReceiveDataBufCount:function(e){if(4!==e)return!1;var t=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===t)return!1;var r=this.interpreterProxy.stackObjectValue(2),i=this.interpreterProxy.stackIntegerValue(1)-1,n=this.interpreterProxy.stackIntegerValue(0);if(i+n>r.bytes.length)return!1;var s=t.recv(n);return r.bytes.set(s,i),this.interpreterProxy.popthenPush(e,s.length),!0},primitiveSocketSendDataBufCount:function(n){if(4!==n)return!1;var t=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===t)return!1;var r=this.interpreterProxy.stackObjectValue(2),e=this.interpreterProxy.stackIntegerValue(1)-1;if(0>e)return!1;var s=this.interpreterProxy.stackIntegerValue(0),i=e+s;if(i>r.length)return!1;var a=t.send(r,e,i);return this.interpreterProxy.popthenPush(1,a),!0},primitiveSocketSendDone:function(e){return 1!==e?!1:(this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject()),!0)}}}function registerSocketPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):window.setTimeout(registerSocketPlugin,100)}function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:window.speechSynthesis,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveSpeak:function(t){var r,e;if(1===t)r=this.interpreterProxy.stackValue(0).bytesAsString();else{if(2!==t)return!1;r=this.interpreterProxy.stackValue(1).bytesAsString();var n=this.interpreterProxy.stackValue(0).bytesAsString();e=this.synth.getVoices().filter(function(e){return e.name===n})}var i=new SpeechSynthesisUtterance(r);return e&&e.length>0&&(i.voice=e[0]),this.synth.speak(i),this.interpreterProxy.pop(t),!0},primitiveRegisterSemaphore:function(e){return 1!==e?!1:(this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0),!0)},primitiveUnregisterSemaphore:function(e){return 0!==e?!1:(this.semaphoreIndex=null,!0)},primitiveGetLastRecognitionResult:function(e){if(0!==e)return!1;if(null===this.semaphoreIndex)return!1;if(null===this.voiceInput)return!1;var t=this.primHandler.makeStArray(this.voiceInput);return this.voiceInput=[],this.interpreterProxy.popthenPush(1,t),!0},primitiveStartListening:function(e){return 0!==e?!1:(this.recognition=new webkitSpeechRecognition,this.recognition.lang="en-US",this.recognition.interimResults=!0,this.recognition.onresult=this._onRecognitionResult.bind(this),this.recognition.onerror=function(e){console.log(e)},this.recognition.onend=function(){this.shouldListen&&this.recognition.start()}.bind(this),this.shouldListen=!0,this.recognition.start(),!0)},_onRecognitionResult:function(r){this.voiceInput=[];for(var i=r.resultIndex;i<r.results.length;i++){for(var e=r.results[i],n=[e.isFinal,[]],t=0;t<e.length;t++){{var s=e[t].transcript;Date.now()}n[1].push([s,e[t].confidence])}n[1].length>0&&this.voiceInput.push(n)}null!==this.semaphoreIndex&&this.voiceInput.length>0&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(e){return 0!==e?!1:(this.voiceInput=[],this.recognition.stop(),this.shouldListen=!1,!0)}}}function registerSpeechPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in window?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):window.setTimeout(registerSpeechPlugin,100)}function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveCreate:function(t){var r="{SqueakJS SSL #"+ ++this.handleCounter+"}",e=this.primHandler.makeStString(r);return e.handle=!0,this.interpreterProxy.popthenPush(t,e),!0},primitiveConnect:function(e){return 5!==e?!1:(this.interpreterProxy.popthenPush(e,0),!0)},primitiveDestroy:function(e){return 1!==e?!1:(this.interpreterProxy.popthenPush(1,1),!0)},primitiveGetIntProperty:function(e){if(2!==e)return!1;var r=this.interpreterProxy.stackObjectValue(1).handle;if(void 0===r)return!1;var t,i=this.interpreterProxy.stackIntegerValue(0);return t=i===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0,this.interpreterProxy.popthenPush(e,t),!0},primitiveGetStringProperty:function(e){if(2!==e)return!1;var r=this.interpreterProxy.stackObjectValue(1).handle;if(void 0===r)return!1;var t,i=this.interpreterProxy.stackIntegerValue(0);return t=i===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject(),this.interpreterProxy.popthenPush(e,t),!0},primitiveEncrypt:function(e){if(5!==e)return!1;var t=this.interpreterProxy.stackObjectValue(4).handle;if(void 0===t)return!1;var r=this.interpreterProxy.stackObjectValue(3),i=(this.interpreterProxy.stackIntegerValue(2)-1,this.interpreterProxy.stackIntegerValue(1)),n=this.interpreterProxy.stackObjectValue(0);return n.bytes=r.bytes,this.interpreterProxy.popthenPush(e,i),!0},primitiveDecrypt:function(e){if(5!==e)return!1;var t=this.interpreterProxy.stackObjectValue(4).handle;if(void 0===t)return!1;var r=this.interpreterProxy.stackObjectValue(3),i=(this.interpreterProxy.stackIntegerValue(2)-1,this.interpreterProxy.stackIntegerValue(1)),n=this.interpreterProxy.stackObjectValue(0);return n.bytes=r.bytes,this.interpreterProxy.popthenPush(e,i),!0}}}function registerSqueakSSL(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):window.setTimeout(registerSqueakSSL,100)}window.module=function(t){if(""===t)return window;var r=t.split("."),i=r.pop(),n=module(r.join(".")),e=n[i];return e||(n[i]=e={loaded:!1,pending:[],requires:function(t){return{toRun:function(i){function r(){i(),e.loaded=!0,e.pending.forEach(function(e){e()})}t&&!module(t).loaded?module(t).pending.push(r):r()}}}}),e},Object.extend=function(r){for(var e=1;e<arguments.length;e++)if("object"==typeof arguments[e])for(var t in arguments[e])r[t]=arguments[e][t]},Function.prototype.subclass=function(n){var e=function(){return this.initialize&&this.initialize.apply(this,arguments),this},r=function(){};r.prototype=this.prototype,e.prototype=new r;for(var t=1;t<arguments.length;t++)Object.extend(e.prototype,arguments[t]);var i=n.split("."),s=i.pop();return module(i.join("."))[s]=e,e},function(){var e=document.getElementsByTagName("script"),t=e[e.length-1],r=t.src.replace(/[^\/]*$/,"");t.src.match(/squeak\.min\.js$/)||["vm.js","jit.js","plugins/ADPCMCodecPlugin.js","plugins/B2DPlugin.js","plugins/BitBltPlugin.js","plugins/FFTPlugin.js","plugins/FloatArrayPlugin.js","plugins/GeniePlugin.js","plugins/JPEGReaderPlugin.js","plugins/KedamaPlugin.js","plugins/KedamaPlugin2.js","plugins/Klatt.js","plugins/LargeIntegers.js","plugins/Matrix2x3Plugin.js","plugins/MiscPrimitivePlugin.js","plugins/ScratchPlugin.js","plugins/SocketPlugin.js","plugins/SpeechPlugin.js","plugins/SqueakSSL.js","plugins/SoundGenerationPlugin.js","plugins/StarSqueakPlugin.js","plugins/ZipPlugin.js","lib/lz-string.js","lib/jszip.js"].forEach(function(t){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",r+t),document.getElementsByTagName("head")[0].appendChild(e)})}(),module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function y(r,l,e){function a(i){r.fullscreen=i,t.style.background=i?"black":"",e.header&&(e.header.style.display=i?"none":""),e.footer&&(e.footer.style.display=i?"none":""),e.fullscreenCheckbox&&(e.fullscreenCheckbox.checked=i),setTimeout(window.onresize,0)}var t=l.parentElement,o="fullscreenchange",n="fullscreenElement",u="fullscreenEnabled";t.requestFullscreen||[{req:t.webkitRequestFullscreen,exit:document.webkitExitFullscreen,evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:t.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:t.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(e){e.req&&(t.requestFullscreen=e.req,document.exitFullscreen=e.exit,o=e.evt,n=e.elem,u=e.enable)});var i;if(t.requestFullscreen)document.addEventListener(o,function(){a(t==document[n])}),i=function(){document[u]&&t==document[n]!=r.fullscreen&&(r.fullscreen?t.requestFullscreen():document.exitFullscreen())};else{var s=!1;i=function(){(e.header||e.footer)&&s!=r.fullscreen&&(s=r.fullscreen,a(s))}}return e.fullscreenCheckbox&&(e.fullscreenCheckbox.onclick=function(){r.fullscreen=e.fullscreenCheckbox.checked,i()}),i}function p(e){if(e.swapCheckbox){var i=t.squeakImageName||"default",r=JSON.parse(t["squeakSettings:"+i]||"{}");"swapButtons"in r&&(e.swapButtons=r.swapButtons),e.swapCheckbox.checked=e.swapButtons,e.swapCheckbox.onclick=function(){e.swapButtons=e.swapCheckbox.checked,r.swapButtons=e.swapButtons,t["squeakSettings:"+i]=JSON.stringify(r)}}}function s(e,t){var i=e.shiftKey,n=e.ctrlKey&&!e.altKey,s=e.metaKey||e.altKey&&!e.ctrlKey,r=(i?Squeak.Keyboard_Shift:0)+(n?Squeak.Keyboard_Ctrl:0)+(s?Squeak.Keyboard_Cmd:0);return t.buttons=t.buttons&~Squeak.Keyboard_All|r,r}function d(r,t,e){var i=f?r.offsetX:r.layerX,n=f?r.offsetY:r.layerY;e.cursorCanvas&&(e.cursorCanvas.style.left=i+t.offsetLeft+e.cursorOffsetX+"px",e.cursorCanvas.style.top=n+t.offsetTop+e.cursorOffsetY+"px");var s=i*t.width/t.offsetWidth|0,a=n*t.height/t.offsetHeight|0;e.mouseX=Math.max(0,Math.min(e.width,s)),e.mouseY=Math.max(0,Math.min(e.height,a))}function e(i,r,a,e,n,o){if(d(r,a,e),e.vm){var t=e.buttons&Squeak.Mouse_All;switch(i){case"mousedown":switch(r.button||0){case 0:t=Squeak.Mouse_Red;break;case 1:t=Squeak.Mouse_Yellow;break;case 2:t=Squeak.Mouse_Blue}o.swapButtons&&(t==Squeak.Mouse_Yellow?t=Squeak.Mouse_Blue:t==Squeak.Mouse_Blue&&(t=Squeak.Mouse_Yellow));break;case"mousemove":break;case"mouseup":t=0}e.buttons=t|s(r,e),n&&(n.push([Squeak.EventTypeMouse,r.timeStamp,e.mouseX,e.mouseY,e.buttons&Squeak.Mouse_All,e.buttons>>3]),e.signalInputEvent&&e.signalInputEvent()),e.idle=0,"mouseup"==i?e.runFor&&e.runFor(100):e.runNow&&e.runNow()}}function i(t,n,e,r){if(e.vm){var i=e.buttons>>3<<8|t;i===e.vm.interruptKeycode?e.vm.interruptPending=!0:r?(r.push([Squeak.EventTypeKeyboard,n,t,Squeak.EventKeyChar,e.buttons>>3,t]),e.signalInputEvent&&e.signalInputEvent()):e.keys.push(i),e.idle=0,e.runNow&&e.runNow()}}function n(i,t,n,e,r){e.vm&&r&&(d(t,n,e),r.push([Squeak.EventTypeDragDropFiles,t.timeStamp,i,e.mouseX,e.mouseY,e.buttons>>3,e.droppedFiles.length]),e.signalInputEvent&&e.signalInputEvent())}function h(t,r,e,n){e.buttons&=~Squeak.Keyboard_All,e.buttons|=Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl,e.keys=[],i(t,r,e,n)}function O(e,r,i){r[0]=e[0],r[1]=e[1]-i&Squeak.MillisecondClockMask;for(var t=2;t<e.length;t++)r[t]=e[t]}function m(a,o){function f(e){if(e.touches.length){r.x=r.y=0;for(var t=0;t<e.touches.length;t++)r.x+=e.touches[t].pageX/e.touches.length,r.y+=e.touches[t].pageY/e.touches.length}return{timeStamp:e.timeStamp,button:r.button,offsetX:r.x-a.offsetLeft,offsetY:r.y-a.offsetTop}}function m(r,i,n,s){var e=r-n,t=i-s;return Math.sqrt(e*e+t*t)}function d(e,t){return m(e.pageX,e.pageY,t.pageX,t.pageY)}function g(i,n,s,u){var e=t.cursorCanvas,r=s/a.width;a.style.left=(0|i)+"px",a.style.top=(0|n)+"px",a.style.width=(0|s)+"px",a.style.height=(0|u)+"px",e&&(e.style.left=(i+t.cursorOffsetX+t.mouseX*r|0)+"px",e.style.top=(n+t.cursorOffsetY+t.mouseY*r|0)+"px",e.style.width=(e.width*r|0)+"px",e.style.height=(e.height*r|0)+"px"),o.pixelated||(r>=3?(a.classList.add("pixelated"),e&&e.classList.add("pixelated")):(a.classList.remove("pixelated"),e&&t.cursorCanvas.classList.remove("pixelated")))}function k(e){r.dist=d(e.touches[0],e.touches[1]),r.down.x=r.x,r.down.y=r.y,r.down.dist=r.dist,r.down.left=a.offsetLeft,r.down.top=a.offsetTop,r.down.width=a.offsetWidth,r.down.height=a.offsetHeight,r.orig||(r.orig={left:r.down.left,top:r.down.top,right:r.down.left+r.down.width,bottom:r.down.top+r.down.height,width:r.down.width,height:r.down.height})}function S(e){if(!(e.touches.length<2)){r.dist=d(e.touches[0],e.touches[1]);var a=r.orig.width/r.down.width,u=r.dist/r.down.dist,t=Math.min(Math.max(u,.95*a),a*v),i=r.down.width*t,o=r.orig.height*i/r.orig.width,n=r.down.left-(r.down.x-r.down.left)*(t-1)+(r.x-r.down.x),s=r.down.top-(r.down.y-r.down.top)*(t-1)+(r.y-r.down.y);n=Math.max(Math.min(n,r.orig.left+20),r.orig.right-i-20),s=Math.max(Math.min(s,r.orig.top+20),r.orig.bottom-o-20),g(n,s,i,o)}}function b(){var t=a.offsetLeft,i=a.offsetTop,e=a.offsetWidth,n=a.offsetHeight;e=Math.min(Math.max(e,r.orig.width),r.orig.width*v),n=r.orig.height*e/r.orig.width,t=Math.max(Math.min(t,r.orig.left),r.orig.right-e),i=Math.max(Math.min(i,r.orig.top),r.orig.bottom-n),g(t,i,e,n)}function c(t){for(var e=0;e<t.dataTransfer.types.length;e++)if("Files"==t.dataTransfer.types[e])return!0;return!1}o=o||{},o.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",document.ontouchmove=function(e){e.preventDefault()},o.header&&(o.header.style.display="none"),o.footer&&(o.footer.style.display="none"));var t={context:a.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:o.cursor!==!1&&document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};p(o),o.pixelated&&(a.classList.add("pixelated"),t.cursorCanvas&&t.cursorCanvas.classList.add("pixelated"));var u=null;t.reset=function(){u=null,t.signalInputEvent=null,t.lastTick=0,t.getNextEvent=function(e,r){u=[],u.push=function(e){u.offset=Date.now()-e[1],delete u.push,u.push(e)},t.getNextEvent=function(e,r){var t=u.shift();t?O(t,e,r-u.offset):e[0]=Squeak.EventTypeNone},t.getNextEvent(e,r)}},t.reset();var l=y(t,a,o);t.fullscreenRequest=function(e,r){t.fullscreen!=e?(t.fullscreen=e,t.resizeTodo=r,t.resizeTodoTimeout=setTimeout(t.resizeDone,1e3),l()):r()},t.resizeDone=function(){clearTimeout(t.resizeTodoTimeout);var e=t.resizeTodo;e&&(t.resizeTodo=null,e())},t.clear=function(){a.width=a.width},t.showBanner=function(i,r){r=r||{};var e=t.context;e.clearRect(0,0,a.width,a.height),e.fillStyle=r.color||"#F90",e.font=r.font||"bold 48px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(i,a.width/2,a.height/2)},t.showProgress=function(u,r){r=r||{};var e=t.context,i=a.width/3|0,n=24,s=.5*a.width-i/2,o=.5*a.height+2*n;e.fillStyle=r.background||"#000",e.fillRect(s,o,i,n),e.lineWidth=2,e.strokeStyle=r.color||"#F90",e.strokeRect(s,o,i,n),e.fillStyle=r.color||"#F90",e.fillRect(s,o,i*u,n)},t.executeClipboardPaste=function(e,r){if(!t.vm)return!0;try{t.clipboardString=e,h("v".charCodeAt(0),r,t,u)}catch(i){console.error("paste error "+i)}},t.executeClipboardCopy=function(e,r){if(!t.vm)return!0;t.clipboardStringChanged=!1,h((e||"c").charCodeAt(0),r,t,u);for(var i=Date.now();!t.clipboardStringChanged&&Date.now()-i<500;)t.vm.interpret(20);if(t.clipboardStringChanged)try{return t.clipboardString}catch(n){console.error("copy error "+n)}},a.onmousedown=function(r){return l(),e("mousedown",r,a,t,u,o),r.preventDefault(),!1},a.onmouseup=function(r){e("mouseup",r,a,t,u,o),l(),r.preventDefault()},a.onmousemove=function(r){e("mousemove",r,a,t,u,o),r.preventDefault()},a.oncontextmenu=function(){return!1};var r={state:"idle",button:0,x:0,y:0,dist:0,down:{}},v=5;return a.ontouchstart=function(n){n.preventDefault();for(var i=f(n),s=0;s<n.changedTouches.length;s++)switch(r.state){case"idle":r.state="got1stFinger",r.first=i,setTimeout(function(){"got1stFinger"===r.state&&(r.state="mousing",r.button=i.button=0,e("mousemove",i,a,t,u,o),e("mousedown",i,a,t,u,o))},100);break;case"got1stFinger":r.state="got2ndFinger",k(n),setTimeout(function(){if("got2ndFinger"===r.state){var n=Math.abs(r.down.dist-r.dist)>10||m(r.down.x,r.down.y,r.x,r.y)>10;n?r.state="zooming":(r.state="mousing",r.button=i.button=2,e("mousemove",i,a,t,u,o),e("mousedown",i,a,t,u,o))}},200)}},a.ontouchmove=function(i){i.preventDefault();var n=f(i);switch(r.state){case"got1stFinger":r.state="mousing",r.button=n.button=0,e("mousemove",n,a,t,u,o),e("mousedown",n,a,t,u,o);break;case"mousing":return void e("mousemove",n,a,t,u,o);case"got2ndFinger":return void(i.touches.length>1&&(r.dist=d(i.touches[0],i.touches[1])));case"zooming":return void S(i)}},a.ontouchend=function(n){n.preventDefault(),l();for(var i=f(n),s=0;s<n.changedTouches.length;s++)switch(r.state){case"mousing":if(n.touches.length>0)break;return r.state="idle",void e("mouseup",i,a,t,u,o);case"got1stFinger":return r.state="idle",r.button=i.button=0,e("mousemove",i,a,t,u,o),e("mousedown",i,a,t,u,o),void e("mouseup",i,a,t,u,o);case"got2ndFinger":r.state="mousing",r.button=i.button=2,e("mousemove",i,a,t,u,o),e("mousedown",i,a,t,u,o);break;case"zooming":if(n.touches.length>0)break;return r.state="idle",void b(n)}},a.ontouchcancel=function(e){a.ontouchend(e)},t.cursorCanvas&&(t.cursorCanvas.style.display="block",t.cursorCanvas.style.position="absolute",t.cursorCanvas.style.cursor="none",t.cursorCanvas.style.background="transparent",t.cursorCanvas.style.pointerEvents="none",a.parentElement.appendChild(t.cursorCanvas),a.style.cursor="none"),document.onkeypress=function(e){return t.vm?/[CXVR]/.test(String.fromCharCode(e.charCode+64))?!0:(s(e,t),i(e.charCode,e.timeStamp,t,u),void e.preventDefault()):!0},document.onkeydown=function(e){if(l(),!t.vm)return!0;s(e,t);var n={8:8,9:9,13:13,27:27,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[e.keyCode];if(n)return i(n,e.timeStamp,t,u),e.preventDefault();if(e.metaKey||e.altKey&&!e.ctrlKey){var r=e.key;if(!r&&e.keyIdentifier&&"U+"==e.keyIdentifier.slice(0,2)&&(r=String.fromCharCode(parseInt(e.keyIdentifier.slice(2),16))),r&&1==r.length){if(/[CXVR]/i.test(r))return!0;var a=r.charCodeAt(0);return/[A-Z]/.test(r)&&!e.shiftKey&&(a+=32),i(a,e.timeStamp,t,u),e.preventDefault()}}},document.onkeyup=function(e){return t.vm?void s(e,t):!0},document.oncopy=function(e,i){var r=t.executeClipboardCopy(i,e.timeStamp);"string"==typeof r&&e.clipboardData.setData("Text",r),e.preventDefault()},document.oncut=function(e){return t.vm?void document.oncopy(e,"x"):!0},document.onpaste=function(e){var r=e.clipboardData.getData("Text");t.executeClipboardPaste(r,e.timeStamp),e.preventDefault()},document.ondragover=function(e){e.preventDefault(),c(e)?(e.dataTransfer.dropEffect="copy",n(Squeak.EventDragMove,e,a,t,u)):e.dataTransfer.dropEffect="none"},document.ondragenter=function(e){c(e)&&n(Squeak.EventDragEnter,e,a,t,u)},document.ondragleave=function(e){c(e)&&n(Squeak.EventDragLeave,e,a,t,u)},document.ondrop=function(e){if(e.preventDefault(),!c(e))return!1;var r,s=[].slice.call(e.dataTransfer.files),l=[],i=null;return t.droppedFiles=[],s.forEach(function(c){t.droppedFiles.push(c.name);var f=new FileReader;f.onload=function(){var f=this.result;Squeak.filePut(c.name,f),l.push(c.name),r||!/.*image$/.test(c.name)||t.vm&&!confirm("Run "+c.name+" now?\n(cancel to use as file)")||(r=f,i=c.name),l.length==s.length&&(r?(SqueakJS.appName=i.slice(0,-6),SqueakJS.runImage(r,i,t,o)):n(Squeak.EventDragDrop,e,a,t,u))},f.readAsArrayBuffer(c)}),!1},window.onresize=function(){if(!r.orig){var b=window.innerWidth,v=window.innerHeight;if(setTimeout(function(){b==window.innerWidth&&v==window.innerHeight&&t.resizeDone()},300),!(o.header&&o.footer||o.fullscreen))return t.width=a.width,void(t.height=a.height);var d=o.fullscreen||t.fullscreen,g=0,h=d?0:o.header.offsetTop+o.header.offsetHeight,e=window.innerWidth,i=d?window.innerHeight:Math.max(100,o.footer.offsetTop-h),s=0,u=0;if(o.fixedWidth){t.width=o.fixedWidth,t.height=o.fixedHeight;var l=t.width/t.height,p=e/i;p>l?s=e-Math.floor(i*l):u=i-Math.floor(e/l)}else t.width=e,t.height=i;if(a.style.left=g+Math.floor(s/2)+"px",a.style.top=h+Math.floor(u/2)+"px",a.style.width=e-s+"px",a.style.height=i-u+"px",a.width!=t.width||a.height!=t.height){var m=o.fixedWidth||!t.resizeTodo,f=m&&t.context.getImageData(0,0,a.width,a.height);a.width=t.width,a.height=t.height,f&&t.context.putImageData(f,0,0)}if(t.cursorCanvas&&o.fixedWidth){var n=t.cursorCanvas,c=a.offsetWidth/a.width;n.style.width=n.width*c+"px",n.style.height=n.height*c+"px"}}},window.onresize(),t}function g(t,r){var e=r.spinner;return e?(e.onmousedown=function(){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(t.interruptPending=!0)},e.style):null}function k(e,i,t,n){var s=0===i,o=t.lastTick-n.lastTick<500;!s||o?(e.display="none",r=0):0===r?r=t.lastTick:t.lastTick-r>1e3&&(e.display="block",a=(a+30)%360,e.webkitTransform=e.transform="rotate("+a+"deg)")}function w(e){var a=window.location.hash.slice(1),i=a&&a.split("&");if(i)for(var n=0;n<i.length;n++){var s=i[n].split("="),o=s[0],t=!0;if(s.length>1&&(t=decodeURIComponent(s.slice(1).join("=")),t.match(/^(true|false|null|[0-9"[{].*)$/)))try{t=JSON.parse(t)}catch(u){"["===t[0]&&(t=t.slice(1,-1).split(","))}e[o]=t}var r=Squeak.splitFilePath(e.root||"/").fullname;Squeak.dirCreate(r,!0),/\/$/.test(r)||(r+="/"),e.root=r,e.url&&e.files&&!e.image&&(e.image=e.url+"/"+e.files[0])}function S(e){if(e.templates){if(e.templates.constructor===Array){var r={};e.templates.forEach(function(e){r[e]=e}),e.templates=r}for(var t in e.templates)Squeak.fetchTemplateDir("/"==t[0]?t:e.root+t,e.templates[t])}}function u(e,t,r){Squeak.filePut(t.root+e.name,e.data,function(){console.log("Stored "+t.root+e.name),e.zip?l(e,t,r):r()})}function l(t,e,r){JSZip().loadAsync(t.data).then(function(n){var i=[];if(n.forEach(function(t){(e.forceDownload||!Squeak.fileExists(e.root+t))&&i.push(t)}),0===i.length)return r();var s=0;i.forEach(function(a){console.log("Inflating "+t.name+": "+a),n.file(a).async("arraybuffer").then(function(t){console.log("Expanded size of "+a+": "+t.byteLength);var n={name:a,data:t};u(n,e,function(){++s===i.length&&r()})})})})}function v(e,t,r,i){return Squeak.fileExists(t.root+e.name)?void(e.image||e.zip?Squeak.fileGet(t.root+e.name,function(i){e.data=i,e.zip?l(e,t,r):r()},function(){return Squeak.fileDelete(t.root+e.name),i()}):r()):i()}function c(t,i,r,n){i.showBanner("Downloading "+t.name);var e=new XMLHttpRequest,s=r.proxy||"";e.open("GET",s+t.url),e.responseType="arraybuffer",e.onprogress=function(e){e.lengthComputable&&i.showProgress(e.loaded/e.total)},e.onload=function(){200==this.status?(t.data=this.response,u(t,r,n)):this.onerror(this.statusText)},e.onerror=function(){if(r.proxy)return alert("Failed to download:\n"+t.url);console.warn("Retrying with CORS proxy: "+t.url);var n="https://crossorigin.me/",i=new XMLHttpRequest;i.open("GET",n+t.url),i.responseType=e.responseType,i.onprogress=e.onprogress,i.onload=e.onload,i.onerror=function(){alert("Failed to download:\n"+t.url)},i.send()},e.send()}function b(r,i,e,n){function t(){if(0===r.length)return n();var s=r.shift(),a=e.forceDownload||s.forceDownload;a?c(s,i,e,t):v(s,e,function(){t()},function(){c(s,i,e,t)})}t()}var t=window.localStorage;try{if(t["squeak-foo:"]="bar","bar"!==t["squeak-foo:"])throw Error();delete t["squeak-foo:"]}catch(F){t={}}var o,f=navigator.userAgent.match("AppleWebKit/"),a=0,r=0;SqueakJS.runImage=function(n,i,e,r){window.onbeforeunload=function(t){var e=SqueakJS.appName+" is still running";return t.returnValue=e,e},window.clearTimeout(o),e.reset(),e.clear(),e.showBanner("Loading "+SqueakJS.appName),e.showProgress(0);var s=this;window.setTimeout(function(){var a=new Squeak.Image(i);
a.readFromBuffer(n,function(){function u(){try{e.quitFlag?s.onQuit(n,e,r):n.interpret(50,function(t){"sleep"==t&&(t=200),l&&k(l,t,n,e),o=window.setTimeout(u,t)})}catch(t){console.error(t),alert(t)}}e.quitFlag=!1;var n=new Squeak.Interpreter(a,e);SqueakJS.vm=n,t.squeakImageName=i,p(r),e.clear(),e.showBanner("Starting "+SqueakJS.appName);var l=g(n,r);e.runNow=function(){window.clearTimeout(o),u()},e.runFor=function(t){var r=Date.now()+t;do e.runNow();while(Date.now()<r)},u()},function(t){e.showProgress(t)})},0)},SqueakJS.runSqueak=function(t,u,e){if(w(e),e.image?t=e.image:e.image=t,t.match(/^http:/)&&location.protocol.match(/^https/))return void(location.protocol="http");SqueakJS.options=e,SqueakJS.appName=e.appName||t.replace(/.*\//,"").replace(/\.image$/,""),S(e);var r=m(u,e),i=Squeak.splitFilePath(t).basename,s={url:t,name:i,image:!0},a=e.url||t.replace(/[^\/]*$/,""),n=[s];if(e.files&&e.files.forEach(function(e){e!==i&&n.push({url:a+e,name:e})}),e.zip){var l="string"==typeof e.zip?[e.zip]:e.zip;l.forEach(function(e){n.unshift({url:a+e,name:e,zip:!0})})}if(e.document){var o=Squeak.splitFilePath(e.document).basename;n.push({url:e.document,name:o,forceDownload:e.forceDownload!==!1}),r.documentName=e.root+o}return b(n,r,e,function(){return Squeak.fsck(),s.data?void SqueakJS.runImage(s.data,e.root+i,r,e):alert("could not find image "+i)}),r},SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0},SqueakJS.onQuit=function(r,t,e){window.onbeforeunload=null,t.vm=null,e.spinner&&(e.spinner.style.display="none"),e.onQuit?e.onQuit(r,t,e):t.showBanner(SqueakJS.appName+" stopped.")}}),window.applicationCache&&applicationCache.addEventListener("updateready",function(){var e=window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS";confirm(e+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())}),module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm;var e=window.localStorage;try{if(e["squeak-foo:"]="bar","bar"!==e["squeak-foo:"])throw Error();delete e["squeak-foo:"]}catch(t){console.warn("localStorage not available, faking"),e={}}Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.9",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(e,t){this.externalModules[e]=t}},"files",{fsck:function(u,s,r,t){if(s=s||"",t=t||{dirs:0,files:0,bytes:0,deleted:0},!r){r={};for(var d in e){var c=d.match(/squeak-file(\.lz)?:(.*)$/);c&&(r[c[2]]=!0)}if("undefined"!=typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",function(i){var e=i.openCursor();e.onsuccess=function(i){var e=i.target.result;e?(r[e.key]=!0,e.continue()):Squeak.fsck(u,s,r,t)},e.onerror=function(){console.error("fsck failed")}})}var o=Squeak.dirList(s);for(var l in o){var i=s+"/"+l,f=o[l][3];if(f){var h="squeak:"+i in e;h?(Squeak.fsck(null,i,r,t),t.dirs++):(console.log("Deleting stale directory "+i),Squeak.dirDelete(i),t.deleted++)}else r[i]?(r[i]=!1,t.files++,t.bytes+=o[l][4]):(console.log("Deleting stale file entry "+i),Squeak.fileDelete(i,!0),t.deleted++)}if(""===s){console.log("squeak fsck: "+t.dirs+" directories, "+t.files+" files, "+(t.bytes/1e6).toFixed(1)+" MBytes");var n=[],p=0;for(var i in r)p++,r[i]&&n.push(i);if(n.length>0){for(var a=0;a<n.length;a++)console.log("Deleting orphaned file "+n[a]),delete e["squeak-file:"+n[a]],delete e["squeak-file.lz:"+n[a]],t.deleted++;"undefined"!=typeof indexedDB&&this.dbTransaction("readwrite","fsck delete",function(t){for(var e=0;e<n.length;e++)t.delete(n[e])})}u&&u(t)}},dbTransaction:function(a,n,i,e){function r(){i(Squeak.dbFake()),e&&e()}function s(){var t=SqueakDB.transaction("files",a),r=t.objectStore("files");t.oncomplete=function(){e&&e()},t.onerror=function(e){console.error(e.target.error.name+": "+n)},t.onabort=function(t){console.error(t.target.error.name+": aborting "+n),i(Squeak.dbFake()),e&&e()},i(r)}if("undefined"==typeof indexedDB)return r();if(window.SqueakDB)return s();var t=indexedDB.open("squeak");return t?(t.onsuccess=function(){console.log("Opened files database."),window.SqueakDB=this.result,SqueakDB.onversionchange=function(){delete window.SqueakDB,this.close()},SqueakDB.onerror=function(e){console.error("Error accessing database: "+e.target.error.name)},s()},t.onupgradeneeded=function(e){console.log("Creating files database");var t=e.target.result;t.createObjectStore("files")},t.onerror=function(e){console.error(e.target.error.name+": cannot open files database"),console.warn("Falling back to local storage"),r()},void(t.onblocked=function(){console.log("Database upgrade needed, but was blocked."),console.warn("Falling back to local storage"),r()})):r()},dbFake:function(){return"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1e5,get:function(r){var s=SqueakDBFake.bigFiles[r];if(!s){var t=e["squeak-file:"+r];if(!t){var o=e["squeak-file.lz:"+r];o&&("object"==typeof LZString?t=LZString.decompressFromUTF16(o):console.error("LZString not loaded: cannot decompress "+r))}if(t){for(var a=new Uint8Array(t.length),i=0;i<a.length;i++)a[i]=255&t.charCodeAt(i);s=a.buffer}}var n={result:s};return setTimeout(function(){n.onsuccess&&n.onsuccess({target:n})},0),n},put:function(r,t){if(r.byteLength>SqueakDBFake.bigFileThreshold)SqueakDBFake.bigFiles[t]||console.log("File "+t+" ("+r.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[t]=r;else{var n=Squeak.bytesAsString(new Uint8Array(r));if("object"==typeof LZString){var s=LZString.compressToUTF16(n);e["squeak-file.lz:"+t]=s,delete e["squeak-file:"+t]}else e["squeak-file:"+t]=n}var i={};return setTimeout(function(){i.onsuccess&&i.onsuccess()},0),i},"delete":function(t){delete e["squeak-file:"+t],delete e["squeak-file.lz:"+t],delete SqueakDBFake.bigFiles[t];var r={};return setTimeout(function(){r.onsuccess&&r.onsuccess()},0),r},openCursor:function(){var e={};return setTimeout(function(){e.onsuccess&&e.onsuccess({target:e})},0),e}}),SqueakDBFake},fileGet:function(i,r,t){t||(t=function(e){console.log(e)});var e=this.splitFilePath(i);return e.basename?window.SqueakDBFake&&SqueakDBFake.bigFiles[e.fullname]?r(SqueakDBFake.bigFiles[e.fullname]):void this.dbTransaction("readonly","get "+i,function(n){var i=n.get(e.fullname);i.onerror=function(e){t(e.target.error.name)},i.onsuccess=function(){return void 0!==this.result?r(this.result):void Squeak.fetchTemplateFile(e.fullname,function(e){r(e)},function(){if("undefined"==typeof indexedDB)return t("file not found: "+e.fullname);var i=Squeak.dbFake().get(e.fullname);i.onerror=function(){t("file not found: "+e.fullname)},i.onsuccess=function(){r(this.result)}})}}):t("Invalid path: "+i)},filePut:function(s,n,a){var t=this.splitFilePath(s);if(!t.basename)return null;var i=this.dirList(t.dirname);if(!i)return null;var r=i[t.basename],o=this.totalSeconds();if(r){if(r[3])return null}else r=[t.basename,o,0,!1,0],i[t.basename]=r;return r[2]=o,r[4]=n.byteLength||n.length||0,e["squeak:"+t.dirname]=JSON.stringify(i),this.dbTransaction("readwrite","put "+s,function(e){e.put(n,t.fullname)},function(){a&&a()}),r},fileDelete:function(i,s){var t=this.splitFilePath(i);if(!t.basename)return!1;var r=this.dirList(t.dirname);if(!r)return!1;var n=r[t.basename];return!n||n[3]?!1:(delete r[t.basename],e["squeak:"+t.dirname]=JSON.stringify(r),s?!0:(this.dbTransaction("readwrite","delete "+i,function(e){e.delete(t.fullname)}),!0))},fileRename:function(o,u){var t=this.splitFilePath(o);if(!t.basename)return!1;var r=this.splitFilePath(u);if(!r.basename)return!1;var i=this.dirList(t.dirname);if(!i)return!1;var n=i[t.basename];if(!n||n[3])return!1;var a=t.dirname==r.dirname,s=a?i:this.dirList(r.dirname);return s?s[r.basename]?!1:(delete i[t.basename],n[0]=r.basename,s[r.basename]=n,e["squeak:"+r.dirname]=JSON.stringify(s),a||(e["squeak:"+t.dirname]=JSON.stringify(i)),this.fileGet(t.fullname,function(e){this.dbTransaction("readwrite","rename "+t.fullname+" to "+r.fullname,function(i){i.delete(t.fullname),i.put(e,r.fullname)})}.bind(this),function(e){console.log("File rename failed: "+e)}.bind(this)),!0):!1},fileExists:function(i){var e=this.splitFilePath(i);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;var r=t[e.basename];return!r||r[3]?!1:!0},dirCreate:function(n,s){var t=this.splitFilePath(n);if(!t.basename)return!1;s&&!e["squeak:"+t.dirname]&&Squeak.dirCreate(t.dirname,!0);var r=this.dirList(t.dirname);if(!r)return!1;if(r[t.basename])return!1;var i=this.totalSeconds(),a=[t.basename,i,i,!0,0];return r[t.basename]=a,e["squeak:"+t.fullname]=JSON.stringify({}),e["squeak:"+t.dirname]=JSON.stringify(r),!0},dirDelete:function(n){var t=this.splitFilePath(n);if(!t.basename)return!1;var r=this.dirList(t.dirname);if(!r)return!1;if(!r[t.basename])return!1;var i=this.dirList(t.fullname);if(!i)return!1;for(var s in i)return!1;return delete r[t.basename],e["squeak:"+t.dirname]=JSON.stringify(r),delete e["squeak:"+t.fullname],!0},dirList:function(a,o){function s(i,e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];i[r[0]]=r}}var t=this.splitFilePath(a),r=e["squeak:"+t.fullname],i=o&&e["squeak-template:"+t.fullname];if(r||i){var n={};return i&&s(n,JSON.parse(i).entries),r&&s(n,JSON.parse(r)),n}return"/"==t.fullname?{}:null},splitFilePath:function(e){"/"!==e[0]&&(e="/"+e),e=e.replace(/\/\//gi,"/");var t=e.match(/(.*)\/(.*)/),r=t[1].length?t[1]:"/",i=t[2].length?t[2]:null;return{fullname:e,dirname:r,basename:i}},flushFile:function(e){if(e.modified){var t=e.contents.buffer;t.byteLength!==e.size&&(t=new ArrayBuffer(e.size),new Uint8Array(t).set(e.contents.subarray(0,e.size))),Squeak.filePut(e.name,t),e.modified=!1}},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var e in SqueakFiles)this.flushFile(SqueakFiles[e])},closeAllFiles:function(){Squeak.flushAllFiles(),delete window.SqueakFiles},fetchTemplateDir:function(t,i){function n(r){var t=Squeak.splitFilePath(r);"/"!==t.dirname&&n(t.dirname);var r=JSON.parse(e["squeak-template:"+t.dirname]||'{"entries": {}}');if(!r.entries[t.basename]){var i=Squeak.totalSeconds();r.entries[t.basename]=[t.basename,i,i,!0,0],e["squeak-template:"+t.dirname]=JSON.stringify(r)}}function s(r,n){var i=JSON.parse(e["squeak-template:"+r]);for(var s in i.entries){var t=i.entries[s];t[3]&&Squeak.fetchTemplateDir(r+"/"+t[0],n+"/"+t[0])}}if(t=Squeak.splitFilePath(t).fullname,e["squeak-template:"+t])s(t,i);else{var a=i+"/sqindex.json",r=new XMLHttpRequest;r.open("GET",a,!0),r.onload=function(){if(200==r.status){console.log("adding template "+t),n(t);var a=JSON.parse(r.response),o={url:i,entries:{}};for(var l in a){var u=a[l];o.entries[u[0]]=u}e["squeak-template:"+t]=JSON.stringify(o),s(t,i)}else r.onerror(r.statusText)},r.onerror=function(){console.log("cannot load template index "+a)},r.send()}},fetchTemplateFile:function(t,a,n){t=Squeak.splitFilePath(t);var s=e["squeak-template:"+t.dirname];if(!s)return n();var r=JSON.parse(s).url;if(!r)return n();r+="/"+t.basename;var i=new XMLHttpRequest;i.open("get",r,!0),i.responseType="arraybuffer",i.timeout=3e4,i.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var e=this.response;console.log("Got "+e.byteLength+" bytes from "+r),Squeak.dirCreate(t.dirname,!0),Squeak.filePut(t.fullname,e),a(e)}else alert("Download failed ("+this.status+") "+r),n()},console.log("Fetching "+r),i.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioOutContext=e&&new e}return this.audioOutContext},startAudioIn:function(e,t){return this.audioInContext?(this.audioInSource.disconnect(),e(this.audioInContext,this.audioInSource)):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia({audio:!0,toString:function(){return"audio"}},function(r){var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=t&&new t,this.audioInSource=this.audioInContext.createMediaStreamSource(r),e(this.audioInContext,this.audioInSource)},function(){t("cannot access microphone")}):t("test: audio input not supported"))},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},"time",{Epoch:Date.UTC(1901,0,1)+6e4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1e3)}},"utils",{bytesAsString:function(t){for(var r=[],e=0;e<t.length;e++)r.push(String.fromCharCode(t[e]));return r.join("")}}),Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(e){this.totalMemory=1e8,this.name=e,this.gcCount=0,this.gcTenured=0,this.gcMilliseconds=0,this.allocationCount=0,this.oldSpaceCount=0,this.newSpaceCount=0,this.hasNewInstances={}},readFromBuffer:function(j,I,C){function R(){if(p){for(var e=y+(a.oldSpaceCount/20|0);p&&e>y;)p.installFromImage(r,U,Z,d,W),p=p.nextObject,y++;return C&&C(y/a.oldSpaceCount),!0}return a.specialObjectsArray=m,a.decorateKnownObjects(),a.isSpur?a.fixSkippedOops(L):(a.fixCompiledMethods(),a.fixCompactOops()),!1}function G(){R()?window.setTimeout(G,0):I&&I()}console.log("squeak: reading "+this.name+" ("+j.byteLength+" bytes)"),this.startupTime=Date.now();for(var H=new DataView(j),d=!1,i=0,e=function(){var e=H.getUint32(i,d);return i+=4,e},K=function(t,n){if(n){for(var r=[];r.length<t;)r.push(e());return r}var s=new Uint32Array(j,i,t);return i+=4*t,s},$=[6501,6502,6504,6505,6521,68e3,68002,68003,68021],o=0,k=0;;){if(d=!d,i=k,o=e(),$.indexOf(o)>=0)break;if(d||(k+=512),k>512)throw Error("bad image version")}this.version=o;var W=[6505,6521,68003,68021].indexOf(o)>=0;if(this.hasClosures=[6504,6505,6521,68002,68003,68021].indexOf(o)>=0,this.isSpur=[6521,68021].indexOf(o)>=0,o>=68e3)throw Error("64 bit images not supported yet");var Q=e(),T=e(),u=e(),M=e();this.lastHash=e(),this.savedHeaderWords=[];for(var z=0;6>z;z++)this.savedHeaderWords.push(e());var n,q=e(),r={},O=k+Q;if(i=O,this.isSpur){this.oldSpaceBytes=q-16;for(var w=i+q,B=0,E=null,P=null,b=0,L={};w>i;){for(;w-16>i;){var Y=i,F=e(),V=e(),c=V>>>24;255===c&&(c=F,F=e(),V=e());var l=B+i-8-O,S=F>>>24&31,x=4194303&F,N=4194303&V,g=K(c,10>S&&x>0);if(i+=4*(2>c?2-c:1&c),x>=32){var t=new Squeak.ObjectSpur;t.initFromImage(l,x,S,N,g),n&&(n.nextObject=t),this.oldSpaceCount++,n=t,r[u+l]=t,L[l]=b}else b+=i-Y,E?P||(P=g):E=g,r[u+l]=g}if(i!==w-16)throw Error("invalid segment");{var D=e(),A=(e(),e());e()}if(0===A){if(1241513987!==D)throw Error("Magic number at image end not found")}else{var _=4*D;w+=A,B+=_,b+=16+_,this.oldSpaceBytes+=_+A}}this.oldSpaceBytes-=b,this.firstOldObject=r[u],this.lastOldObject=t}else{for(;O+T>i;){var v=0,h=0,s=e();switch(s&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:v=s>>>2,h=e(),s=e();break;case Squeak.HeaderTypeClass:h=s-Squeak.HeaderTypeClass,s=e(),v=s>>>2&63;break;case Squeak.HeaderTypeShort:v=s>>>2&63,h=s>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}v--;var l=i-4-O,S=s>>>8&15,N=s>>>17&4095,g=K(v,5>S),t=new Squeak.Object;t.initFromImage(l,h,S,N,g),32>h&&(t.hash|=268435456),n&&(n.nextObject=t),this.oldSpaceCount++,n=t,r[u+l]=t}this.firstOldObject=r[u+4],this.lastOldObject=t,this.oldSpaceBytes=T}if(!this.isSpur){var J=r[r[M].bits[Squeak.splOb_CompactClasses]].bits,f=null;for(t=this.firstOldObject,n=null;t;)n=f,f=t.renameFromImage(r,J),n&&(n.nextObject=f),r[u+t.oop]=f,t=t.nextObject;this.firstOldObject=r[u+4],this.lastOldObject=f}var m=r[M],U=r[m.bits[Squeak.splOb_CompactClasses]].bits,Z=r[m.bits[Squeak.splOb_ClassFloat]];if(this.isSpur){var X=r[m.bits[Squeak.splOb_ClassCharacter]];this.initCharacterTable(X),U=this.spurClassTable(r,P,m),W=this.getCharacter.bind(this),this.initSpurOverrides()}var p=this.firstOldObject,y=0,a=this;if(C)window.setTimeout(G,0);else{for(;R(););I&&I()}},decorateKnownObjects:function(){var e=this.specialObjectsArray.pointers;if(e[Squeak.splOb_NilObject].isNil=!0,e[Squeak.splOb_TrueObject].isTrue=!0,e[Squeak.splOb_FalseObject].isFalse=!0,e[Squeak.splOb_ClassFloat].isFloatClass=!0,!this.isSpur){this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers;for(var t=0;t<this.compactClasses.length;t++)this.compactClasses[t].isNil||(this.compactClasses[t].isCompact=!0)}Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var e=this.firstOldObject,t=0;e;){var r=e.hash>268435455,n=!!e.sqClass.isCompact;if(r!==n){var i=0===e.snapshotSize().header;r!==i&&(t+=i?-4:4)}e.hash&=268435455,e.oop+=t,e=e.nextObject}this.oldSpaceBytes+=t}},fixCompiledMethods:function(){if(!(this.version>=6502))for(var e=this.firstOldObject,t=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];e;)e.isMethod()&&(e.sqClass=t),e=e.nextObject},fixSkippedOops:function(t){for(var e=this.firstOldObject;e;)e.oop-=t[e.oop],e=e.nextObject;if(e=this.lastOldObject,e.addr()+e.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes")}},"garbage collection",{partialGC:function(){return this.totalMemory-this.oldSpaceBytes},fullGC:function(t){this.vm.addMessage("fullGC: "+t);var r=Date.now(),e=this.markReachableObjects();return this.removeUnmarkedOldObjects(),this.appendToOldObjects(e),this.finalizeWeakReferences(),this.allocationCount+=this.newSpaceCount,this.newSpaceCount=0,this.hasNewInstances={},this.gcCount++,this.gcMilliseconds+=Date.now()-r,e.length>0?e[0]:null},markReachableObjects:function(){this.vm.storeContextRegisters();for(var i=[this.specialObjectsArray,this.vm.activeContext],s=[];i.length>0;){var e=i.pop();if(!e.mark){e.nextObject||e===this.lastOldObject||s.push(e),e.mark=!0,e.sqClass.mark||i.push(e.sqClass);var r=e.pointers;if(r){var n=e.nonWeakSize();if(this.vm.isContext(e)){n=e.contextSizeWithStack();for(var t=n;t<r.length;t++)r[t]=this.vm.nilObj}for(var t=0;n>t;t++)"object"!=typeof r[t]||r[t].mark||i.push(r[t])}}}return s.sort(function(e,t){return t.oop-e.oop})},removeUnmarkedOldObjects:function(){var n=0,r=0,e=this.firstOldObject;for(e.mark=!1;;){var t=e.nextObject;if(!t)return this.lastOldObject=e,this.oldSpaceBytes-=r,void(this.oldSpaceCount-=n);if(t.mark)e=t,e.mark=!1,e.oop-=r;else{var i=t;e.nextObject=i.nextObject,i.oop=-++this.newSpaceCount,r+=i.totalBytes(),n++}}},appendToOldObjects:function(e){for(var r=this.lastOldObject,i=0;i<e.length;i++){var t=e[i];t.mark=!1,this.oldSpaceBytes=t.setAddr(this.oldSpaceBytes),r.nextObject=t,r=t}this.lastOldObject=r,this.oldSpaceCount+=e.length,this.gcTenured+=e.length},finalizeWeakReferences:function(){for(var e=this.firstOldObject;e;){if(e.isWeak()){for(var r=e.pointers||[],n=e.sqClass.classInstSize(),s=!1,t=n;t<r.length;t++)r[t].oop<0&&(r[t]=this.vm.nilObj,s=!0);if(s&&(this.vm.pendingFinalizationSignals++,n>=2)){var i=e.pointers[Squeak.WeakFinalizerItem_list];if(i.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]){var a=i.pointers[Squeak.WeakFinalizationList_first];e.pointers[Squeak.WeakFinalizerItem_next]=a,i.pointers[Squeak.WeakFinalizationList_first]=e}}}e=e.nextObject}this.vm.pendingFinalizationSignals>0&&this.vm.forceInterruptCheck()}},"creating",{registerObject:function(e){return e.oop=-++this.newSpaceCount,this.lastHash=13849+27181*this.lastHash&4294967295,4095&this.lastHash},registerObjectSpur:function(e){return e.oop=-++this.newSpaceCount,0},instantiateClass:function(e,r,i){var t=new(e.classInstProto()),n=this.registerObject(t);return t.initInstanceOf(e,r,n,i),this.hasNewInstances[e.oop]=!0,t},clone:function(t){var e=new(t.sqClass.classInstProto()),r=this.registerObject(e);return e.initAsClone(t,r),this.hasNewInstances[e.sqClass.oop]=!0,e}},"operations",{bulkBecome:function(n,r,c,l){if(!n)return!r;var a=n.length;if(a!==r.length)return!1;this.newSpaceCount>0?this.fullGC("become"):this.vm.storeContextRegisters();for(var i={},e=0;a>e;e++){var t=n[e];if(!t.sqClass)return!1;if(i[t.oop])return!1;i[t.oop]=r[e]}if(c)for(var e=0;a>e;e++){var t=r[e];if(!t.sqClass)return!1;if(i[t.oop])return!1;i[t.oop]=n[e]}if(l)for(var e=0;a>e;e++){if(!r[e].sqClass)return!1;var f=n[e].hash;n[e].hash=r[e].hash,r[e].hash=f}for(var t=this.firstOldObject;t;){var s=i[t.sqClass.oop];s&&(t.sqClass=s);var o=t.pointers;if(o)for(var u=0;u<o.length;u++)s=i[o[u].oop],s&&(o[u]=s);t=t.nextObject}return this.vm.flushMethodCacheAfterBecome(i),!0},objectAfter:function(e){return e.nextObject||this.newSpaceCount>0&&this.fullGC("nextObject")},someInstanceOf:function(t){for(var e=this.firstOldObject;e;){if(e.sqClass===t)return e;e=e.nextObject||this.nextObjectWithGCFor(t)}return null},nextInstanceAfter:function(e){for(var t=e.sqClass;;){if(e=e.nextObject||this.nextObjectWithGCFor(t),!e)return null;if(e.sqClass===t)return e}},nextObjectWithGCFor:function(e){return 0!==this.newSpaceCount&&this.hasNewInstances[e.oop]?this.fullGC("instance of "+e.className()):null},allInstancesOf:function(t){for(var e=this.firstOldObject,r=[];e;)e.sqClass===t&&r.push(e),e=e.nextObject||this.nextObjectWithGCFor(t);return r},writeToBuffer:function(){var n=64,r=new DataView(new ArrayBuffer(n+this.oldSpaceBytes)),t=0,e=function(e){r.setUint32(t,e),t+=4};for(e(this.formatVersion()),e(n),e(this.oldSpaceBytes),e(this.firstOldObject.addr()),e(this.objectToOop(this.specialObjectsArray)),e(this.lastHash),e(52429400);n>t;)e(0);for(var i=this.firstOldObject,s=0;i;)t=i.writeTo(r,t,this),i=i.nextObject,s++;if(t!==r.byteLength)throw Error("wrong image size");if(s!==this.oldSpaceCount)throw Error("wrong object count");return r.buffer},objectToOop:function(e){if("number"==typeof e)return e<<1|1;if(e.oop<0)throw Error("temporary oop");return e.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var e=this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand],t=new Uint32Array(e.bytes.buffer,0,1);return this.formatVersion()|4278190080&t[0]},loadImageSegment:function(k,d){var f=new DataView(k.words.buffer),h=!1,I=!1,r=0,i=function(){var e=f.getUint32(r,h);return r+=4,e},b=function(e,n){if(5>n){for(var t=[];t.length<e;)t.push(i());return t}var s=new Uint32Array(f.buffer,r,e);return r+=4*e,s},u=i();if(u&!0&&(h=!0,r=0,u=i(),u&!0))return console.error("image segment format not supported"),null;for(var l=[],n={};r<f.byteLength;){var s=0,a=0,e=i();switch(e&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:s=e>>>2,a=i(),e=i();break;case Squeak.HeaderTypeClass:a=e-Squeak.HeaderTypeClass,e=i(),s=e>>>2&63;break;case Squeak.HeaderTypeShort:s=e>>>2&63,a=e>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}s--;var m=r,p=e>>>8&15,S=e>>>17&4095,g=b(s,p),o=new Squeak.Object;o.initFromImage(m,a,p,S,g),l.push(o),n[m]=o}for(var t=0;t<d.pointers.length;t++)n[2147483652+4*t]=d.pointers[t];for(var y=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,v=0,O=y.map(function(e){return n[--v]=e,v}),w=n[8]||n[12]||n[16],F=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat],t=0;t<l.length;t++){var c=l[t];c.installFromImage(n,O,F,h,I),c.oop=-++this.newSpaceCount,this.hasNewInstances[c.sqClass.oop]=!0}return w}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur,this.writeToBuffer=this.writeToBufferSpur},spurClassTable:function(n,l,c){for(var t={},r=0;4096>r;r++){var u=n[l[r]];if(1024===u.length)for(var i=0;1024>i;i++){var a=n[u[i]];if(1===a._format){var e=1024*r+i;t[e]=a}}}for(var o in Squeak)if(/^splOb_Class/.test(o)){var s=n[c.bits[Squeak[o]]];if(1===s._format){var e=s.hash;e>0&&1024>e&&(t[e]=s)}}return this.classTable=t,this.classTableIndex=1024,t},enterIntoClassTable:function(t){for(var e=this.classTableIndex,r=this.classTable;4194303>=e;){if(!r[e])return r[e]=t,t.hash=e,this.classTableIndex=e,e;e++}return console.error("class table full?"),null},initCharacterTable:function(e){e.classInstProto("Character"),this.characterClass=e,this.characterTable={}},getCharacter:function(t){var e=this.characterTable[t];return e||(e=new this.characterClass.instProto,e.initInstanceOfChar(this.characterClass,t),this.characterTable[t]=e),e},maxClassIndex:function(){var e=1024,t=this.classTable;for(var i in t){var r=t[i].hash;r>e&&(e=r)}return e},classTableBytes:function(){var e=(this.maxClassIndex()>>10)+1;return 4*(4108+1028*e)},writeFreeLists:function(t,e,r){return t.setUint32(e,167772178,r),e+=4,t.setUint32(e,536870912,r),e+=4,e+=128},writeClassTable:function(t,e,r,d){var a=(this.maxClassIndex()>>10)+1,f=48,p=136,o=4104,u=1024,c=16+4*o,m=16+4*u,h=f+p+c+8;t.setUint32(e,o,r),e+=4,t.setUint32(e,4278190080,r),e+=4,t.setUint32(e,33554448,r),e+=4,t.setUint32(e,4278190080,r),e+=4;for(var s=0;a>s;s++)t.setUint32(e,h+s*m,r),e+=4;e+=4*(o-a);for(var n=0,s=0;a>s;s++){t.setUint32(e,u,r),e+=4,t.setUint32(e,4278190080,r),e+=4,t.setUint32(e,33554448,r),e+=4,t.setUint32(e,4278190080,r),e+=4;for(var l=0;u>l;l++){var i=this.classTable[n];if(i&&i.pointers){if(!i.hash)throw Error("class without id");i.hash!==n&&n>=32&&(console.warn("freeing class index "+n+" "+i.className()),i=null)}i&&t.setUint32(e,d(i),r),e+=4,n++}}return e},writeToBufferSpur:function(){function t(t){i.setUint32(e,t,s),e+=4}function n(e){if("number"==typeof e)return e<<1|1;if(7===e._format){if(e.hash!==e.oop>>2||2!==(3&e.oop))throw Error("Bad immediate char");return e.oop}if(e.oop<0)throw Error("temporary oop");return e.oop<48?e.oop:e.oop+o}var l=64,u=16,c=136,o=c+this.classTableBytes(),i=new DataView(new ArrayBuffer(l+o+this.oldSpaceBytes+u)),s=!0,f=Date.now(),e=0;for(t(this.formatVersion()),t(l),t(o+this.oldSpaceBytes+u),t(this.firstOldObject.addr()),t(n(this.specialObjectsArray)),t(this.lastHash),this.savedHeaderWords.forEach(t),t(o+this.oldSpaceBytes+u);l>e;)t(0);var r=this.firstOldObject,a=0;for(e=r.writeTo(i,e,s,n),r=r.nextObject,a++,e=r.writeTo(i,e,s,n),r=r.nextObject,a++,e=r.writeTo(i,e,s,n),r=r.nextObject,a++,e=this.writeFreeLists(i,e,s,n),e=this.writeClassTable(i,e,s,n);r;)e=r.writeTo(i,e,s,n),r=r.nextObject,a++;if(t(1241513987),t(8388608),t(0),t(0),e!==i.byteLength)throw Error("wrong image size");if(a!==this.oldSpaceCount)throw Error("wrong object count");var h=Date.now()-f;return console.log("Wrote "+a+" objects in "+h+" ms, image size "+e+" bytes"),i.buffer}}),Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(t,e,n,s){this.sqClass=t,this.hash=n;var r=t.pointers[Squeak.Class_format],i=(r>>1&63)+(r>>10&192)-1;this._format=r>>7&15,this._format<8?6!=this._format?i+e>0&&(this.pointers=this.fillArray(i+e,s)):e>0&&(t.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(e)):e>0&&(this.bytes=new Uint8Array(e))},initAsClone:function(e,t){this.sqClass=e.sqClass,this.hash=t,this._format=e._format,e.isFloat?(this.isFloat=e.isFloat,this.float=e.float):(e.pointers&&(this.pointers=e.pointers.slice(0)),e.words&&(this.words=new Uint32Array(e.words)),e.bytes&&(this.bytes=new Uint8Array(e.bytes)))},initFromImage:function(e,t,r,i,n){this.oop=e,this.sqClass=t,this._format=r,this.hash=i,this.bits=n},classNameFromImage:function(t){var e=t[this.bits[Squeak.Class_name]];if(e&&e._format>=8&&e._format<12){var r=e.decodeBytes(e.bits.length,e.bits,0,3&e._format);return Squeak.bytesAsString(r)}return"Class"},renameFromImage:function(t,n){var r=this.sqClass<32?t[n[this.sqClass-1]]:t[this.sqClass],i=r.instProto||r.classInstProto(r.classNameFromImage(t));if(!i)return this;var e=new i;return e.oop=this.oop,e.sqClass=this.sqClass,e._format=this._format,e.hash=this.hash,e.bits=this.bits,e},installFromImage:function(r,o,u,t,s){var i=this.sqClass;this.sqClass=i>0&&32>i?r[o[i-1]]:r[i];var e=this.bits.length;if(this._format<5){if(e>0){var a=this.bits;this.pointers=this.decodePointers(e,a,r)}}else if(this._format>=12){var l=this.decodeWords(1,this.bits,t)[0],n=l>>10&255,a=this.decodeWords(n+1,this.bits,t);this.pointers=this.decodePointers(n+1,a,r),this.bytes=this.decodeBytes(e-(n+1),this.bits,n+1,3&this._format)}else if(this._format>=8)e>0&&(this.bytes=this.decodeBytes(e,this.bits,0,3&this._format));else if(this.sqClass==u){if(this.isFloat=!0,this.float=this.decodeFloat(this.bits,t,s),1.3797216632888e-310==this.float)if(/noFloatDecodeWorkaround/.test(window.location.hash));else if(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(this.bits,t,s),1.3797216632888e-310==this.float)throw Error("Cannot deoptimize decodeFloat")
}else e>0&&(this.words=this.decodeWords(e,this.bits,t));delete this.bits,this.mark=!1},decodePointers:function(r,n,s){for(var i=new Array(r),e=0;r>e;e++){var t=n[e];i[e]=1===(1&t)?t>>1:s[t]||42424242}return i},decodeWords:function(t,r,n){for(var s=new DataView(r.buffer,r.byteOffset),i=new Uint32Array(t),e=0;t>e;e++)i[e]=s.getUint32(4*e,n);return i},decodeBytes:function(i,e,n,s){var t=4*i-s,a=new Uint8Array(e.buffer,e.byteOffset+4*n,t),r=new Uint8Array(t);return r.set(a),r},decodeFloat:function(r,i,n){var e=new DataView(r.buffer,r.byteOffset);if(!i)return e.getFloat64(0,!1);if(n)return e.getFloat64(0,!0);var s=new ArrayBuffer(8),t=new DataView(s);return t.setUint32(0,e.getUint32(4)),t.setUint32(4,e.getUint32(0)),t.getFloat64(0,!0)},decodeFloatDeoptimized:function(r,i,n){var e=new DataView(r.buffer,r.byteOffset);if(!i)return e.getFloat64(0,!1);if(n)return e.getFloat64(0,!0);var s=new ArrayBuffer(8),t=new DataView(s);return function(){t.setUint32(0,e.getUint32(4)),t.setUint32(4,e.getUint32(0))}(),t.getFloat64(0,!0)},fillArray:function(r,i){for(var t=[],e=0;r>e;e++)t[e]=i;return t}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var e=this._format;return e>=8&&11>=e},isWordsOrBytes:function(){var e=this._format;return 6==e||e>=8&&11>=e},isPointers:function(){return this._format<=4},isWeak:function(){return 4===this._format},isMethod:function(){return this._format>=12},sameFormats:function(e,t){return 8>e?e===t:(12&e)===(12&t)},sameFormatAs:function(e){return this.sameFormats(this._format,e._format)},sameShapeAs:function(e){return this.sameFormatAs(e)&&this.sqClass.isCompact===e.sqClass.isCompact&&this.sqClass.classInstSize()===e.sqClass.classInstSize()},classSameShapeAs:function(e){return this.sameFormats(this.classInstFormat(),e._format)&&this.isCompact===e.sqClass.isCompact&&this.classInstSize()===e.sqClass.classInstSize()}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(s){if(!this.bytes)return"";for(var i="0123456789ABCDEF",r=[],t=0,e=this.bytes.length-1;e>=0;e--)r.push(i[this.bytes[e]>>4]),r.push(i[15&this.bytes[e]]),t=256*t+this.bytes[e];var n=s?"-":"",a=t>=9007199254740992?"≈":"";return n+"16r"+r.join("")+" ("+a+n+t+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(e){var t=this.instSize();return t>=e?this.sqClass.allInstVarNames()[e-1]:(e-t).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var t=this.float.toString();return/\./.test(t)||(t+=".0"),t}var e=this.sqClass.className();if(/ /.test(e))return"the "+e;switch(e){case"String":case"ByteString":return"'"+this.bytesAsString()+"'";case"Symbol":case"ByteSymbol":return"#"+this.bytesAsString();case"Point":return this.pointers.join("@");case"Rectangle":return this.pointers.join(" corner: ");case"Association":case"ReadOnlyVariableBinding":return this.pointers.join("->");case"LargePositiveInteger":return this.bytesAsNumberString(!1);case"LargeNegativeInteger":return this.bytesAsNumberString(!0);case"Character":var r=this.pointers?this.pointers[0]:this.hash;return"$"+String.fromCharCode(r)+" ("+r.toString()+")"}return/^[aeiou]/i.test(e)?"an"+e:"a"+e}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},nonWeakSize:function(){return this.pointers?4===this._format?this.sqClass.classInstSize():this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){var e=this._format;return e>4||2===e?0:2>e?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(t){var e=this._format;return 2>e?-1:3===e&&t.vm.isContext(this)&&!t.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>e?this.pointersSize()-this.instSize():8>e?this.wordsSize():12>e?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var t=new ArrayBuffer(8),e=new DataView(t);return e.setFloat64(0,this.float,!1),e},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null},setAddr:function(t){var e=this.snapshotSize();return this.oop=t+4*e.header,t+4*(e.header+e.body)},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(e+=this.bytes.length+3>>>2),e++;var t=e>63?2:this.sqClass.isCompact?0:1;return{header:t,body:e}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var e=this.snapshotSize();return 4*(e.header+e.body)},writeTo:function(t,e,s){this.bytes&&(this._format|=3&-this.bytes.length);var a=e,i=this.snapshotSize(),n=(15&this._format)<<8|(4095&this.hash)<<17;switch(i.header){case 2:t.setUint32(e,i.body<<2|Squeak.HeaderTypeSizeAndClass),e+=4,t.setUint32(e,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass),e+=4,t.setUint32(e,n|Squeak.HeaderTypeSizeAndClass),e+=4;break;case 1:t.setUint32(e,this.sqClass.oop|Squeak.HeaderTypeClass),e+=4,t.setUint32(e,n|i.body<<2|Squeak.HeaderTypeClass),e+=4;break;case 0:var o=s.compactClasses.indexOf(this.sqClass)+1;t.setUint32(e,n|o<<12|i.body<<2|Squeak.HeaderTypeShort),e+=4}if(this.isFloat)t.setFloat64(e,this.float),e+=8;else if(this.words)for(var r=0;r<this.words.length;r++)t.setUint32(e,this.words[r]),e+=4;else if(this.pointers)for(var r=0;r<this.pointers.length;r++)t.setUint32(e,s.objectToOop(this.pointers[r])),e+=4;if(this.bytes){for(var r=0;r<this.bytes.length;r++)t.setUint8(e++,this.bytes[r]);e+=3&-this.bytes.length}if(e!==a+this.totalBytes())throw Error("written size does not match");return e}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var e=this.pointers[Squeak.Class_format];return(e>>10&192)+(e>>1&63)-1},instVarNames:function(){var e=this.pointers.length>12?4:this.pointers.length>9?3:4;return(this.pointers[e].pointers||[]).map(function(e){return e.bytesAsString()})},allInstVarNames:function(){var e=this.superclass();return e.isNil?this.instVarNames():e.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";var e=this.pointers[Squeak.Class_name];if(e&&e.bytes)return e.bytesAsString();for(var t=5;6>=t;t++){var r=this.pointers[t];if(r&&r.pointers&&(e=r.pointers[Squeak.Class_name],e&&e.bytes))return e.bytesAsString()+" class"}return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},classInstProto:function(r){if(this.instProto)return this.instProto;var t=this.defaultInst();try{r||(r=this.className());var e=r.replace(/[^A-Za-z0-9]/g,"_");e="UndefinedObject"===e?"nil":"True"===e?"true_":"False"===e?"false_":(/^[AEIOU]/.test(e)?"an":"a")+e,t=new Function("return function "+e+"() {};")(),t.prototype=this.defaultInst().prototype}catch(i){}return Object.defineProperty(this,"instProto",{value:t}),t}},"as method",{methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>24&15},methodPrimitiveIndex:function(){var e=805306879&this.pointers[0];return e>511?(511&e)+(e>>19):e},methodClassForSuper:function(){var e=this.pointers[this.methodNumLits()];return e.pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return(131072&this.pointers[0])>0},methodAddPointers:function(e){this.pointers=e},methodTempCount:function(){return this.pointers[0]>>18&63},methodGetLiteral:function(e){return this.pointers[1+e]},methodGetSelector:function(e){return this.pointers[1+e]}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"==typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(e){if(e&&e.activeContext===this)return e.sp+1;var t=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+("number"==typeof t?t:0)}}),Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(t,e,s,a){this.sqClass=t,this.hash=s;var i=t.pointers[Squeak.Class_format],n=65535&i,r=i>>16&31;this._format=r,12>r?10>r?n+e>0&&(this.pointers=this.fillArray(n+e,a)):e>0&&(t.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(e)):e>0&&(this.bytes=new Uint8Array(e))},installFromImage:function(i,u,l,t,n){var s=this.sqClass;if(32>s)throw Error("Invalid class ID");if(this.sqClass=u[s],!this.sqClass)throw Error("Invalid class ID");var e=this.bits.length;switch(this._format){case 0:break;case 1:case 2:case 3:case 4:case 5:if(e>0){var a=this.bits;this.pointers=this.decodePointers(e,a,i,n)}break;case 10:if(this.sqClass===l){if(this.isFloat=!0,this.float=this.decodeFloat(this.bits,t,!0),1.3797216632888e-310==this.float)if(/noFloatDecodeWorkaround/.test(window.location.hash));else if(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(this.bits,t,!0),1.3797216632888e-310==this.float)throw Error("Cannot deoptimize decodeFloat")}else e>0&&(this.words=this.decodeWords(e,this.bits,t));break;case 12:case 13:throw Error("16 bit arrays not supported yet");case 16:case 17:case 18:case 19:e>0&&(this.bytes=this.decodeBytes(e,this.bits,0,3&this._format));break;case 24:case 25:case 26:case 27:var o=this.decodeWords(1,this.bits,t)[0];if(2147483648&o)throw Error("Alternate bytecode set not supported");var r=o>>1&32767,a=this.decodeWords(r+1,this.bits,t);this.pointers=this.decodePointers(r+1,a,i,n),this.bytes=this.decodeBytes(e-(r+1),this.bits,r+1,3&this._format);break;default:throw Error("Unknown object format: "+this._format)}delete this.bits,this.mark=!1},decodePointers:function(r,n,s,a){for(var i=new Array(r),t=0;r>t;t++){var e=n[t];i[t]=1===(1&e)?e>>1:2===(3&e)?a(e>>>2):s[e]||42424242}return i},initInstanceOfChar:function(t,e){this.oop=e<<2|2,this.sqClass=t,this.hash=e,this._format=7,this.mark=!0}},"accessing",{instSize:function(){return this._format<2?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(t){var e=this._format;return 2>e?-1:3===e&&t.vm.isContext(this)&&!t.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>e?this.pointersSize()-this.instSize():12>e?this.wordsSize():16>e?this.shortsSize():24>e?this.bytesSize():4*this.pointersSize()+this.bytesSize()},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(e+=this.bytes.length+3>>>2);var t=e>=255?2:0;return e+=1&e,e+=2,4>e&&(e=4),{header:t,body:e}},writeTo:function(r,e,i,a){var n=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(n+=this.bytes.length+3>>>2,this._format|=3&-this.bytes.length);var o=e,u=this._format<<24|4194303&this.sqClass.hash,s=n<<24|4194303&this.hash;if(n>=255&&(r.setUint32(e,n,i),e+=4,s=255<<24|4194303&this.hash,r.setUint32(e,s,i),e+=4),r.setUint32(e,u,i),e+=4,r.setUint32(e,s,i),e+=4,this.isFloat)r.setFloat64(e,this.float,i),e+=8;else if(this.words)for(var t=0;t<this.words.length;t++)r.setUint32(e,this.words[t],i),e+=4;else if(this.pointers)for(var t=0;t<this.pointers.length;t++)r.setUint32(e,a(this.pointers[t]),i),e+=4;if(this.bytes){for(var t=0;t<this.bytes.length;t++)r.setUint8(e++,this.bytes[t]);e+=3&-this.bytes.length}if(e+=0===n?8:4*(1&n),e!==o+this.totalBytes())throw Error("written size does not match");return e}},"testing",{isBytes:function(){var e=this._format;return e>=16&&23>=e},isPointers:function(){return this._format<=6},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var e=this._format;return 10===e||e>=16&&23>=e},isWeak:function(){return 4===this._format},isMethod:function(){return this._format>=24},sameFormats:function(e,t){return 16>e?e===t:(248&e)===(248&t)},sameShapeAs:function(e){return this.sameFormatAs(e)&&this.sqClass.classInstSize()===e.sqClass.classInstSize()},classSameShapeAs:function(e){return this.sameFormats(this.classInstFormat(),e._format)&&this.classInstSize()===e.sqClass.classInstSize()}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return 65535&this.pointers[Squeak.Class_format]}},"as method",{methodNumLits:function(){return 32767&this.pointers[0]},methodPrimitiveIndex:function(){return 0===(65536&this.pointers[0])?0:this.bytes[1]+256*this.bytes[2]}}),Object.subclass("Squeak.Interpreter","initialization",{initialize:function(e,t){console.log("squeak: initializing interpreter "+Squeak.vmVersion),this.Squeak=Squeak,this.image=e,this.image.vm=this,this.primHandler=new Squeak.Primitives(this,t),this.loadImageState(),this.hackImage(),this.initVMState(),this.loadInitialContext(),this.initCompiler(),console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers,this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers,this.nilObj=this.specialObjects[Squeak.splOb_NilObject],this.falseObj=this.specialObjects[Squeak.splOb_FalseObject],this.trueObj=this.specialObjects[Squeak.splOb_TrueObject],this.hasClosures=this.image.hasClosures,this.globals=this.findGlobals(),this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0),6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.byteCodeCount=0,this.sendCount=0,this.interruptCheckCounter=0,this.interruptCheckCounterFeedBackReset=1e3,this.interruptChecksEveryNms=3,this.nextPollTick=0,this.nextWakeupTick=0,this.lastTick=0,this.interruptKeycode=2094,this.interruptPending=!1,this.pendingFinalizationSignals=0,this.freeContexts=this.nilObj,this.freeLargeContexts=this.nilObj,this.reclaimableContextCount=0,this.nRecycledContexts=0,this.nAllocatedContexts=0,this.methodCacheSize=1024,this.methodCacheMask=this.methodCacheSize-1,this.methodCacheRandomish=0,this.methodCache=[];for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1,this.breakOutTick=0,this.breakOnMethod=null,this.breakOnNewMethod=!1,this.breakOnContextChanged=!1,this.breakOnContextReturned=null,this.messages={},this.startupTime=Date.now()},loadInitialContext:function(){var e=this.specialObjects[Squeak.splOb_SchedulerAssociation],t=e.pointers[Squeak.Assn_value],r=t.pointers[Squeak.ProcSched_activeProcess];this.activeContext=r.pointers[Squeak.Proc_suspendedContext],this.fetchContextRegisters(this.activeContext),this.reclaimableContextCount=0},findGlobals:function(){var e=this.specialObjects[Squeak.splOb_SmalltalkDictionary],t=e.sqClass.className();if("Association"===t&&(e=e.pointers[1],t=e.sqClass.className()),"SystemDictionary"===t)return e.pointers[1].pointers;if("SmalltalkImage"===t){var r=e.pointers[0],i=r.sqClass.className();if("SystemDictionary"===i)return r.pointers[1].pointers;if("Environment"===i)return r.pointers[2].pointers[1].pointers}throw Error("cannot find global dict")},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==new Function("return 42")())return console.warn("function constructor not working, disabling JIT")}catch(e){return console.warn("disabling JIT: "+e)}var t=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>t)return console.warn("Slow machine detected (loaded "+(1e3*t|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),this.compiler=new Squeak.Compiler(this)}catch(e){console.warn("Compiler "+e)}},hackImage:function(){[].forEach(function(e){var t=this.findMethod(e.method);t&&(t.pointers[0]|=e.primitive,console.warn("Hacking "+e.method))},this)}},"interpreting",{interpretOne:function(i){if(this.method.compiled){if(i){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(i);this.breakNow()}return void(this.byteCodeCount+=this.method.compiled(this))}var e,t,r=this.Squeak;if(this.byteCodeCount++,e=this.nextByte(),128>e)switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&e]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.homeContext.pointers[r.Context_tempFrameStart+(15&e)]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&e));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:return void this.push(this.method.methodGetLiteral(31&e).pointers[r.Assn_value]);case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:return void(this.receiver.pointers[7&e]=this.pop());case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:return void(this.homeContext.pointers[r.Context_tempFrameStart+(7&e)]=this.pop());case 112:return void this.push(this.receiver);case 113:return void this.push(this.trueObj);case 114:return void this.push(this.falseObj);case 115:return void this.push(this.nilObj);case 116:return void this.push(-1);case 117:return void this.push(0);case 118:return void this.push(1);case 119:return void this.push(2);case 120:return void this.doReturn(this.receiver);case 121:return void this.doReturn(this.trueObj);case 122:return void this.doReturn(this.falseObj);case 123:return void this.doReturn(this.nilObj);case 124:return void this.doReturn(this.pop());case 125:return void this.doReturn(this.pop(),this.activeContext.pointers[r.BlockContext_caller]);case 126:return void this.nono();case 127:return void this.nono()}else switch(e){case 128:return void this.extendedPush(this.nextByte());case 129:return void this.extendedStore(this.nextByte());case 130:return void this.extendedStorePop(this.nextByte());case 131:return t=this.nextByte(),void this.send(this.method.methodGetSelector(31&t),t>>5,!1);case 132:return void this.doubleExtendedDoAnything(this.nextByte());case 133:return t=this.nextByte(),void this.send(this.method.methodGetSelector(31&t),t>>5,!0);case 134:return t=this.nextByte(),void this.send(this.method.methodGetSelector(63&t),t>>6,!1);case 135:return void this.pop();case 136:return void this.push(this.top());case 137:return void this.push(this.exportThisContext());case 138:return void this.pushNewArray(this.nextByte());case 139:if(1!==this.pc)throw Error("call prim bytecode not expected here");return void(this.pc=3);case 140:return t=this.nextByte(),void this.push(this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()].pointers[t]);case 141:return t=this.nextByte(),void(this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()].pointers[t]=this.top());case 142:return t=this.nextByte(),void(this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()].pointers[t]=this.pop());case 143:return void this.pushClosureCopy();case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:return void(this.pc+=(7&e)+1);case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.jumpIfFalse((7&e)+1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:return t=this.nextByte(),this.pc+=256*((7&e)-4)+t,void(4>(7&e)&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 168:case 169:case 170:case 171:return void this.jumpIfTrue(256*(3&e)+this.nextByte());case 172:case 173:case 174:case 175:return void this.jumpIfFalse(256*(3&e)+this.nextByte());case 176:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 177:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 178:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 179:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 180:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 181:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 182:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 183:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 184:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 185:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 186:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 187:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&e));case 188:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 189:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 190:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&e));case 191:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&e));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return void(this.primHandler.quickSendOther(this.receiver,15&e)||this.sendSpecial((15&e)+16));case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:return void this.send(this.method.methodGetSelector(15&e),0,!1);case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:return void this.send(this.method.methodGetSelector(15&e),1,!1);case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:return void this.send(this.method.methodGetSelector(15&e),2,!1)}throw Error("not a bytecode: "+e)},interpret:function(r,e){if(this.frozen)return"frozen";for(this.isIdle=!1,this.breakOutOfInterpreter=!1,this.breakOutTick=this.primHandler.millisecondClockValue()+(r||500);this.breakOutOfInterpreter===!1;)this.method.compiled?this.byteCodeCount+=this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(e);var t="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;return e&&e(t),t},goIdle:function(){var e=0!==this.nextWakeupTick;this.forceInterruptCheck(),this.checkForInterrupts();var t=0!==this.nextWakeupTick;this.isIdle=t||!e,this.breakOut()},freeze:function(t){var e;this.frozen=!0,this.breakOutOfInterpreter=function(t){if(!t)throw Error("need function to restart interpreter");return e=t,"frozen"}.bind(this);var r=function(){if(this.frozen=!1,!e)throw Error("no continue function");e(0)}.bind(this);return t&&window.setTimeout(function(){t(r)},0),r},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!")},forceInterruptCheck:function(){this.interruptCheckCounter=-1e3},checkForInterrupts:function(){var e=this.primHandler.millisecondClockValue();if(e<this.lastTick&&(this.nextPollTick=e+(this.nextPollTick-this.lastTick),this.breakOutTick=e+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick&&(this.nextWakeupTick=e+(this.nextWakeupTick-this.lastTick))),this.interruptCheckCounter>-100&&(e-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+=10:this.interruptCheckCounterFeedBackReset<=1e3?this.interruptCheckCounterFeedBackReset=1e3:this.interruptCheckCounterFeedBackReset-=12),this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset,this.lastTick=e,this.interruptPending){this.interruptPending=!1;var t=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];t.isNil||this.primHandler.synchronousSignal(t)}if(0!==this.nextWakeupTick&&e>=this.nextWakeupTick){this.nextWakeupTick=0;var t=this.specialObjects[Squeak.splOb_TheTimerSemaphore];t.isNil||this.primHandler.synchronousSignal(t)}if(this.pendingFinalizationSignals>0){var t=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore];this.pendingFinalizationSignals=0,t.isNil||this.primHandler.synchronousSignal(t)}this.primHandler.semaphoresToSignal.length>0&&this.primHandler.signalExternalSemaphores(),!this.method.compiled&&this.compiler&&this.compiler.compile(this.method),e>=this.breakOutTick&&this.breakOut()},extendedPush:function(t){var e=63&t;switch(t>>6){case 0:this.push(this.receiver.pointers[e]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+e]);break;case 2:this.push(this.method.methodGetLiteral(e));break;case 3:this.push(this.method.methodGetLiteral(e).pointers[Squeak.Assn_value])}},extendedStore:function(t){var e=63&t;switch(t>>6){case 0:this.receiver.pointers[e]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+e]=this.top();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(t){var e=63&t;switch(t>>6){case 0:this.receiver.pointers[e]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+e]=this.pop();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(t){var e=this.nextByte();switch(t>>5){case 0:this.send(this.method.methodGetSelector(e),31&t,!1);break;case 1:this.send(this.method.methodGetSelector(e),31&t,!0);break;case 2:this.push(this.receiver.pointers[e]);break;case 3:this.push(this.method.methodGetLiteral(e));break;case 4:this.push(this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]);break;case 5:this.receiver.pointers[e]=this.top();break;case 6:this.receiver.pointers[e]=this.pop();break;case 7:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(t){var e=this.pop();return e.isTrue?void(this.pc+=t):void(e.isFalse||(this.push(e),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},jumpIfFalse:function(t){var e=this.pop();return e.isFalse?void(this.pc+=t):void(e.isTrue||(this.push(e),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},sendSpecial:function(e){this.send(this.specialSelectors[2*e],this.specialSelectors[2*e+1],!1)}},"closures",{pushNewArray:function(r){var n=r>127,e=127&r,i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e);if(n){for(var t=0;e>t;t++)i.pointers[t]=this.stackValue(e-t-1);this.popN(e)}this.push(i)},pushClosureCopy:function(){var i=this.nextByte(),n=15&i,e=i>>4,s=this.nextByte(),a=256*s+this.nextByte(),o=this.encodeSqueakPC(this.pc,this.method),r=this.newClosure(n,o,e);if(r.pointers[Squeak.Closure_outerContext]=this.activeContext,this.reclaimableContextCount=0,e>0){for(var t=0;e>t;t++)r.pointers[Squeak.Closure_firstCopiedValue+t]=this.stackValue(e-t-1);this.popN(e)}this.pc+=a,this.push(r)},newClosure:function(t,r,i){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],i);return e.pointers[Squeak.Closure_startpc]=r,e.pointers[Squeak.Closure_numArgs]=t,e}},"sending",{send:function(r,i,s){var n=this.stackValue(i),e=this.getClass(n);s&&(e=this.method.methodClassForSuper(),e=e.pointers[Squeak.Class_superclass]);var t=this.findSelectorInClass(r,i,e);t.primIndex&&(this.verifyAtSelector=r,this.verifyAtClass=e),this.executeNewMethod(n,t.method,t.argCount,t.primIndex,t.mClass,r)},sendAsPrimitiveFailure:function(e,t,r){this.executeNewMethod(e,t,r,0)},findSelectorInClass:function(i,n,r){var e=this.findMethodCacheEntry(i,r);if(e.method)return e;for(var a,t=r;!t.isNil;){if(a=t.pointers[Squeak.Class_mdict],a.isNil){var u=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],l=this.createActualMessage(i,n,r);return this.popNandPush(n,l),this.findSelectorInClass(u,1,t.superclass())}var s=this.lookupSelectorInDict(a,i);if(!s.isNil)return this.currentSelector=i,this.currentLookupClass=r,e.method=s,e.primIndex=s.isMethod()?s.methodPrimitiveIndex():248,e.argCount=n,e.mClass=t,e;t=t.superclass()}var o=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(i===o)throw Error("Recursive not understood error encountered");var c=this.createActualMessage(i,n,r);return this.popNandPush(n,c),this.findSelectorInClass(o,1,r)},lookupSelectorInDict:function(t,r){for(var i=t.pointersSize(),a=i-Squeak.MethodDict_selectorStart-1,e=(a&r.hash)+Squeak.MethodDict_selectorStart,n=!1;;){var s=t.pointers[e];if(s===r){var o=t.pointers[Squeak.MethodDict_array];return o.pointers[e-Squeak.MethodDict_selectorStart]}if(s.isNil)return this.nilObj;if(++e===i){if(n)return this.nilObj;e=Squeak.MethodDict_selectorStart,n=!0}}},executeNewMethod:function(o,e,r,s,i,n){if(this.sendCount++,e===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(e,i,n)),this.logSends&&console.log(this.sendCount+" "+this.printMethod(e,i,n)),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow()),!(s>0&&this.tryPrimitive(s,r,e))){var t=this.allocateOrRecycleContext(e.methodNeedsLargeFrame()),a=e.methodTempCount(),u=0,l=Squeak.Context_tempFrameStart+a-1;if(t.pointers[Squeak.Context_method]=e,t.pointers[Squeak.BlockContext_initialIP]=this.nilObj,t.pointers[Squeak.Context_sender]=this.activeContext,this.arrayCopy(this.activeContext.pointers,this.sp-r,t.pointers,Squeak.Context_tempFrameStart-1,r+1),this.arrayFill(t.pointers,Squeak.Context_tempFrameStart+r,Squeak.Context_tempFrameStart+a,this.nilObj),this.popN(r+1),this.reclaimableContextCount++,this.storeContextRegisters(),this.activeContext=t,this.homeContext=t,this.method=e,this.pc=u,this.sp=l,this.receiver=t.pointers[Squeak.Context_receiver],this.receiver!==o)throw Error("receivers don't match");
!e.compiled&&this.compiler&&this.compiler.compile(e,i,n),this.interruptCheckCounter--<=0&&this.checkForInterrupts()}},doReturn:function(r,t){if(!t){var i=this.homeContext;if(this.hasClosures)for(var n;!(n=i.pointers[Squeak.Context_closure]).isNil;)i=n.pointers[Squeak.Closure_outerContext];t=i.pointers[Squeak.Context_sender]}if(t.isNil||t.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(r);for(var e=this.activeContext.pointers[Squeak.Context_sender];e!==t;){if(e.isNil)return this.cannotReturn(r);if(this.isUnwindMarked(e))return this.aboutToReturnThrough(r,e);e=e.pointers[Squeak.Context_sender]}var s;for(e=this.activeContext;e!==t;)this.breakOnContextReturned===e&&(this.breakOnContextReturned=null,this.breakNow()),s=e.pointers[Squeak.Context_sender],e.pointers[Squeak.Context_sender]=this.nilObj,e.pointers[Squeak.Context_instructionPointer]=this.nilObj,this.reclaimableContextCount>0&&(this.reclaimableContextCount--,this.recycleIfPossible(e)),e=s;this.activeContext=e,this.fetchContextRegisters(this.activeContext),this.push(r),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(e,t){this.push(this.exportThisContext()),this.push(e),this.push(t);var r=this.specialObjects[Squeak.splOb_SelectorAboutToReturn];this.send(r,2)},cannotReturn:function(e){this.push(this.exportThisContext()),this.push(e);var t=this.specialObjects[Squeak.splOb_SelectorCannotReturn];this.send(t,1)},tryPrimitive:function(e,t,r){if(e>255&&520>e){if(e>=264)return this.popNandPush(1,this.top().pointers[e-264]),!0;switch(e){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}return this.popNandPush(1,e-261),!0}var i=this.primHandler.doPrimitive(e,t,r);return i},createActualMessage:function(i,t,n){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],t);return this.arrayCopy(this.activeContext.pointers,this.sp-t+1,r.pointers,0,t),e.pointers[Squeak.Message_selector]=i,e.pointers[Squeak.Message_arguments]=r,e.pointers.length>Squeak.Message_lookupClass&&(e.pointers[Squeak.Message_lookupClass]=n),e},primitivePerform:function(t){var i=this.stackValue(t-1),n=this.stackValue(t),r=t-1,s=this.sp-r,a=this.activeContext.pointers;this.arrayCopy(a,s+1,a,s,r),this.sp--;var e=this.findSelectorInClass(i,r,this.getClass(n));return this.executeNewMethod(n,e.method,e.argCount,e.primIndex,e.mClass,i),!0},primitivePerformWithArgs:function(e,a){var i=this.stackValue(e),o=this.stackValue(e-1),n=this.stackValue(e-2);if(n.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var u=a?this.stackValue(e-3):this.getClass(i);if(a)for(var t=this.getClass(i);t!==u;)if(t=t.pointers[Squeak.Class_superclass],t.isNil)return!1;var s=n.pointersSize(),l=this.activeContext.pointers;this.arrayCopy(n.pointers,0,l,this.sp-1,s),this.sp+=s-e;var r=this.findSelectorInClass(o,s,u);return this.executeNewMethod(i,r.method,r.argCount,r.primIndex,r.mClass,o),!0},primitiveInvokeObjectAsMethod:function(e,i){for(var r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e),t=0;e>t;t++)r.pointers[e-t-1]=this.pop();var n=this.pop(),s=this.currentSelector,a=this.specialObjects[Squeak.splOb_SelectorRunWithIn];return this.push(i),this.push(s),this.push(r),this.push(n),this.send(a,3,!1),!0},findMethodCacheEntry:function(t,i){var e;this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var n=(t.hash^i.hash)&this.methodCacheMask,r=n,s=0;4>s;s++){if(e=this.methodCache[r],e.selector===t&&e.lkupClass===i)return e;s===this.methodCacheRandomish&&(n=r),r=r+t.hash&this.methodCacheMask}return e=this.methodCache[n],e.lkupClass=i,e.selector=t,e.method=null,e},flushMethodCache:function(){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector=null,this.methodCache[e].method=null;return!0},flushMethodCacheForSelector:function(t){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector===t&&(this.methodCache[e].selector=null,this.methodCache[e].method=null);return!0},flushMethodCacheForMethod:function(t){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].method===t&&(this.methodCache[e].selector=null,this.methodCache[e].method=null);return!0},flushMethodCacheAfterBecome:function(){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(e){if(!this.isMethodContext(e))return!1;var t=e.pointers[Squeak.Context_method];return 198==t.methodPrimitiveIndex()},newActiveContext:function(e){this.storeContextRegisters(),this.activeContext=e,this.fetchContextRegisters(e)},exportThisContext:function(){return this.storeContextRegisters(),this.reclaimableContextCount=0,this.activeContext},fetchContextRegisters:function(e){var t=e.pointers[Squeak.Context_method];this.isSmallInt(t)?(this.homeContext=e.pointers[Squeak.BlockContext_home],t=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=e,this.receiver=this.homeContext.pointers[Squeak.Context_receiver],this.method=t,this.pc=this.decodeSqueakPC(e.pointers[Squeak.Context_instructionPointer],t),this.sp=this.decodeSqueakSP(e.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method),this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(e,t){return e+4*t.pointers.length+1},decodeSqueakPC:function(e,t){return e-4*t.pointers.length-1},encodeSqueakSP:function(e){return e-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(e){return e+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(e){if(this.isMethodContext(e))if(e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize)e.pointers[0]=this.freeContexts,this.freeContexts=e;else{if(e.pointersSize()!==Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize)return;e.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=e}},allocateOrRecycleContext:function(t){var e;return t?this.freeLargeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)):(e=this.freeLargeContexts,this.freeLargeContexts=e.pointers[0],this.nRecycledContexts++,e):this.freeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)):(e=this.freeContexts,this.freeContexts=e.pointers[0],this.nRecycledContexts++,e)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},popN:function(e){this.sp-=e},push:function(e){this.activeContext.pointers[++this.sp]=e},popNandPush:function(e,t){this.activeContext.pointers[this.sp-=e-1]=t},top:function(){return this.activeContext.pointers[this.sp]},stackValue:function(e){return this.activeContext.pointers[this.sp-e]},stackInteger:function(e){return this.checkSmallInt(this.stackValue(e))},stackIntOrFloat:function(n){var e=this.stackValue(n);if("number"==typeof e)return e;if(e.isFloat)return this.resultIsFloat=!0,e.float;var r=e.bytes;if(r&&4==r.length){for(var t=0,i=3;i>=0;i--)t=256*t+r[i];if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return t;if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-t}return this.success=!1,0},pop2AndPushIntResult:function(e){return this.success&&this.canBeSmallInt(e)?(this.popNandPush(2,e),!0):!1},pop2AndPushNumResult:function(e){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(e)),!0;if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return this.popNandPush(2,e),!0;if(e>=-4294967295&&4294967295>=e){var i=0>e,t=i?-e:e,s=i?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,n=this.instantiateClass(this.specialObjects[s],4),r=n.bytes;return r[0]=255&t,r[1]=t>>8&255,r[2]=t>>16&255,r[3]=t>>24&255,this.popNandPush(2,n),!0}}return!1},pop2AndPushBoolResult:function(e){return this.success?(this.popNandPush(2,e?this.trueObj:this.falseObj),!0):!1}},"numbers",{getClass:function(e){return this.isSmallInt(e)?this.specialObjects[Squeak.splOb_ClassInteger]:e.sqClass},canBeSmallInt:function(e){return e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt},isSmallInt:function(e){return"number"==typeof e},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,1)},quickDivide:function(t,e){if(0===e)return Squeak.NonSmallInt;var r=t/e|0;return r*e===t?r:Squeak.NonSmallInt},div:function(t,e){return 0===e?Squeak.NonSmallInt:Math.floor(t/e)},mod:function(t,e){return 0===e?Squeak.NonSmallInt:t-Math.floor(t/e)*e},safeShift:function(t,e){if(0>e)return-31>e?0>t?-1:0:t>>-e;if(e>31)return 0==t?0:Squeak.NonSmallInt;var r=t<<e;return r>>e===t?r:Squeak.NonSmallInt}},"utils",{isContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]?!0:e.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]?!0:!1},isMethodContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(e,t){return this.image.instantiateClass(e,t,this.nilObj)},arrayFill:function(t,r,i,n){for(var e=r;i>e;e++)t[e]=n},arrayCopy:function(t,r,i,n,s){if(t===i&&n>r)for(var e=s-1;e>=0;e--)i[n+e]=t[r+e];else for(var e=0;s>e;e++)i[n+e]=t[r+e]}},"debugging",{addMessage:function(e){return this.messages[e]?++this.messages[e]:this.messages[e]=1},warnOnce:function(e){1==this.addMessage(e)&&console.warn(e)},printMethod:function(e,t,i){if(i)return t.className()+">>"+i.bytesAsString();e||(e=this.activeContext.contextMethod());var r;if(this.allMethodsDo(function(t,i,n){return i===e?r=t.className()+">>"+n.bytesAsString():void 0}),r)return r;if(t){var n=t.pointers[Squeak.Context_receiver];return"("+n+")>>?"}return"?>>?"},allInstancesOf:function(t,r){"string"==typeof t&&(t=this.globalNamed(t));for(var i=[],e=this.image.someInstanceOf(t);e;)r?r(e):i.push(e),e=this.image.nextInstanceAfter(e);return i},globalNamed:function(e){return this.allGlobalsDo(function(t,r){return t.bytesAsString()===e?r:void 0})},allGlobalsDo:function(n){for(var r=this.globals,e=0;e<r.length;e++){var t=r[e];if(!t.isNil){var i=n(t.pointers[0],t.pointers[1]);if(i)return i}}},allMethodsDo:function(e){this.allGlobalsDo(function(l,t){if(t.pointers&&t.pointers.length>=9)for(var a=[t,t.sqClass],n=0;n<a.length;n++){var o=a[n],r=o.pointers[1];if(r.pointers&&r.pointers[1]){var s=r.pointers[1].pointers;if(s)for(var u=r.pointers,i=0;i<s.length;i++)if(e.call(this,o,s[i],u[2+i]))return!0}}})},printStack:function(e,r){"number"==typeof e&&(r=e,e=null),e||(e=this.activeContext),r||(r=100);for(var t=[],u=Math.max(r,1e6);!e.isNil&&u-->0;)t.push(e),e=e.pointers[Squeak.Context_sender];var a=200;t.length>r+a&&(e.isNil||t.push("..."),t=t.slice(0,r).concat(["..."]).concat(t.slice(-a)));for(var i=[],o=t.length;o-->0;){var e=t[o];if(e.pointers){var n="",s=e.pointers[Squeak.Context_method];"number"==typeof s?(s=e.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],n="[] in "):e.pointers[Squeak.Context_closure].isNil||(n="[] in "),i.push(n+this.printMethod(s,e)+"\n")}else i.push("...\n")}return i.join("")},findMethod:function(e){var t,i=e.split(">>")[0],r=e.split(">>")[1];return this.allMethodsDo(function(n,s,e){return r.length==e.bytesSize()&&r==e.bytesAsString()&&i==n.className()?t=s:void 0}),t},breakNow:function(e){e&&console.log("Break: "+e),this.breakOutOfInterpreter="break"},breakOn:function(e){return this.breakOnMethod=e&&this.findMethod(e)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1,this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0,this.breakOnContextReturned=null},printActiveContext:function(i){function h(t){var e=t.sqInstName?t.sqInstName():t.toString();return e=JSON.stringify(e).slice(1,-1),e.length>i-3&&(e=e.slice(0,i-3)+"..."),e}i||(i=72);for(var t=this.activeContext,a="number"==typeof t.pointers[Squeak.BlockContext_argumentCount],f=t.pointers[Squeak.Context_closure],g=!a&&!f.isNil,u=a?t.pointers[Squeak.BlockContext_home]:t,p=g?f.pointers[Squeak.Closure_numArgs]:u.pointers[Squeak.Context_method].methodTempCount(),s=this.decodeSqueakSP(0),b=u.contextSizeWithStack(this)-1,l=s+1,m=l+p-1,n="",e=s;b>=e;e++){var c=h(u.pointers[e]),r="";e==s?r="=rcvr":m>=e&&(r="=tmp"+(e-l)),n+="\nctx["+e+"]"+r+": "+c}if(a){n+="\n";for(var v=t.pointers[3],o=this.decodeSqueakSP(1),d=o+v,e=o;e<=this.sp;e++){var c=h(t.pointers[e]),r="";d>=e&&(r="=arg"+(e-o)),n+="\nblk["+e+"]"+r+": "+c}}return n},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation],n=a.pointers[Squeak.Assn_value],o=n.pointers[Squeak.ProcSched_activeProcess],r="Active: "+this.printProcess(o,!0),s=n.pointers[Squeak.ProcSched_processLists].pointers,i=s.length-1;i>=0;i--)for(var e=s[i].pointers[Squeak.LinkedList_firstLink];!e.isNil;)r+="\nRunnable: "+this.printProcess(e),e=e.pointers[Squeak.Link_nextLink];for(var u=this.specialObjects[Squeak.splOb_ClassSemaphore],t=this.image.someInstanceOf(u);t;){for(var e=t.pointers[Squeak.LinkedList_firstLink];!e.isNil;)r+="\nWaiting: "+this.printProcess(e),e=e.pointers[Squeak.Link_nextLink];t=this.image.nextInstanceAfter(t)}return r},printProcess:function(e,t){var r=e.pointers[Squeak.Proc_suspendedContext],i=e.pointers[Squeak.Proc_priority],n=this.printStack(t?null:r);return e.toString()+" at priority "+i+"\n"+n},printByteCodes:function(e,t,r,i){e||(e=this.method);var n=new Squeak.InstructionPrinter(e,this);return n.printInstructions(t,r,i)},willSendOrReturn:function(){var e=this.method.bytes[this.pc];if(e>=120&&125>=e)return!0;if(131>e||200==e)return!1;if(e>=176)return!0;if(134>=e){var t;if(132===e){if(this.method.bytes[this.pc+1]>>5>1)return!1;t=this.method.bytes[this.pc+2]}else t=this.method.bytes[this.pc+1]&(134===e?63:31);var r=this.method.methodGetLiteral(t);if("blockCopy:"!==r.bytesAsString())return!0}return!1},nextSendSelector:function(){var e=this.method.bytes[this.pc];if(131>e||200==e)return null;var t;if(e>=208)t=this.method.methodGetLiteral(15&e);else if(e>=176)t=this.specialSelectors[2*(e-176)];else if(134>=e){var r;if(132===e){if(this.method.bytes[this.pc+1]>>5>1)return null;r=this.method.bytes[this.pc+2]}else r=this.method.bytes[this.pc+1]&(134===e?63:31);t=this.method.methodGetLiteral(r)}if(t){var i=t.bytesAsString();if("blockCopy:"!==i)return i}}}),Object.subclass("Squeak.Primitives","initialization",{initialize:function(e,t){this.vm=e,this.display=t,this.display.vm=this.vm,this.oldPrims=!this.vm.image.hasClosures,this.allowAccessBeyondSP=this.oldPrims,this.deferDisplayUpdates=!1,this.semaphoresToSignal=[],this.initDisplay(),this.initAtCache(),this.initModules(),e.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initModules:function(){this.loadedModules={},this.builtinModules={JavaScriptPlugin:this.findPluginFunctions("js_","",!0),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}},this.patchModules={ScratchPlugin:this.findPluginFunctions("scratch_")},this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(t,r,s){r=r||"(initialise|shutdown|prim)";var i={},a=new RegExp("^"+t+r,"i");for(var e in this)if(a.test(e)&&"function"==typeof this[e]){var n=e;t&&(n=e[t.length].toLowerCase()+e.slice(t.length+1)),i[n]=s?e:this[e].bind(this)}return i},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(t,e){switch(this.success=!0,e){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(t,e,r){if(this.success=!0,128>t)switch(t){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,this.doBitXor());case 17:return this.popNandPushIfOK(2,this.doBitShift());case 18:return this.primitiveMakePoint(e,!1);case 19:return!1;case 20:return!1;case 21:return!1;case 22:return!1;case 23:return this.primitiveLessThanLargeIntegers();case 24:return this.primitiveGreaterThanLargeIntegers();case 25:return this.primitiveLessOrEqualLargeIntegers();case 26:return this.primitiveGreaterOrEqualLargeIntegers();case 27:return this.primitiveEqualLargeIntegers();case 28:return this.primitiveNotEqualLargeIntegers();case 29:return!1;case 30:return!1;case 31:return!1;case 32:return!1;case 33:return!1;case 34:return!1;case 35:return!1;case 36:return!1;case 37:return!1;case 38:return this.popNandPushIfOK(e+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(e+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(e+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(e+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(e+1,this.stackFloat(1)-this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(e+1,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(e+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(e+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(e+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(e+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(e+1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(e+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(e+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(e+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(e+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(e+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(e+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(e+1,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(e+1,this.objectAtPut(!1,!0,!1));case 65:return!1;case 66:return!1;case 67:return!1;case 68:return this.popNandPushIfOK(e+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(e+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(e+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(e+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(e,!1);case 73:return this.popNandPushIfOK(e+1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(e+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(e+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(e);case 77:return this.popNandPushIfOK(e+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(e+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(e);case 80:return this.popNandPushIfOK(2,this.doBlockCopy());case 81:return this.primitiveBlockValue(e);case 82:return this.primitiveBlockValueWithArgs(e);case 83:return this.vm.primitivePerform(e);case 84:return this.vm.primitivePerformWithArgs(e,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(e);case 91:return this.primitiveTestDisplayDepth(e);case 93:return this.primitiveInputSemaphore(e);case 94:return this.primitiveGetNextEvent(e);case 95:return this.primitiveInputWord(e);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",e);case 97:return this.primitiveSnapshot(e);case 99:return this.primitiveLoadImageSegment(e);case 100:return this.vm.primitivePerformWithArgs(e,!0);case 101:return this.primitiveBeCursor(e);case 102:return this.primitiveBeDisplay(e);case 103:return!1;case 104:return!1;case 105:return this.popNandPushIfOK(e+1,this.doStringReplace());case 106:return this.primitiveScreenSize(e);case 107:return this.primitiveMouseButtons(e);case 108:return this.primitiveKeyboardNext(e);case 109:return this.primitiveKeyboardPeek(e);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(e+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(e+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(e);case 114:return this.primitiveExitToDebugger(e);case 115:return this.primitiveChangeClass(e);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());case 117:return this.doNamedPrimitive(e,r);case 118:return this.primitiveDoPrimitiveWithArgs(e);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(e);case 122:return this.primitiveReverseDisplay(e);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(e);case 127:return this.primitiveShowDisplayRect(e)}else if(256>t)switch(t){case 128:return this.primitiveArrayBecome(e,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(e);case 131:return this.popNandPushIfOK(1,this.vm.image.partialGC());case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(e);case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(e+1,this.someObject());case 139:return this.popNandPushIfOK(e+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(e);case 141:return this.primitiveClipboardText(e);case 142:return this.popNandPushIfOK(e+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(e);case 145:return this.primitiveConstantFill(e);case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",e);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",e);case 148:return this.popNandPushIfOK(e+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(e);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(e);case 151:if(this.oldPrims)return this.primitiveFileClose(e);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(e);case 153:if(this.oldPrims)return this.primitiveFileOpen(e);case 154:if(this.oldPrims)return this.primitiveFileRead(e);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(e);case 156:if(this.oldPrims)return this.primitiveFileDelete(e);case 157:if(this.oldPrims)return this.primitiveFileSize(e);case 158:if(this.oldPrims)return this.primitiveFileWrite(e);case 159:if(this.oldPrims)return this.primitiveFileRename(e);break;case 160:return this.oldPrims?this.primitiveDirectoryCreate(e):this.primitiveAdoptInstance(e);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(e);break;case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(e);break;case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(e);break;case 165:case 166:return this.primitiveIntegerAtAndPut(e);case 167:return!1;case 168:return this.primitiveCopyObject(e);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(e):this.pop2andPushBoolIfOK(this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",e):this.primitiveAsCharacter(e);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",e):this.popNandPushIfOK(e+1,this.stackNonInteger(0).hash);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",e);break;case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",e):this.popNandPushIfOK(e+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",e):this.popNandPushIfOK(e+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",e):this.popNandPushIfOK(e+1,this.behaviorHash(this.stackNonInteger(0)));case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",e);break;case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",e):this.popNandPushIfOK(1,this.allInstancesOf(this.stackNonInteger(0)));case 178:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",e);break;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",e);break;case 180:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",e);break;case 181:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",e);break;case 182:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",e);break;case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",e);break;case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",e);break;case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",e):this.primitiveExitCriticalSection(e);case 186:if(this.oldPrims)break;return this.primitiveEnterCriticalSection(e);case 187:if(this.oldPrims)break;return this.primitiveTestAndSetOwnershipOfCriticalSection(e);case 188:if(this.oldPrims)break;return this.primitiveExecuteMethodArgsArray(e);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",e):this.primitiveExecuteMethod(e);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",e);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",e);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",e);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",e);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",e);
break;case 195:return!1;case 196:return!1;case 197:return!1;case 198:return!1;case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",e):this.primitiveClosureCopyWithCopiedValues(e);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",e):this.primitiveClosureValue(e);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",e):this.primitiveClosureValue(e);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",e):this.primitiveClosureValue(e);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",e):this.primitiveClosureValue(e);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",e):this.primitiveClosureValue(e);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",e):this.primitiveClosureValueWithArgs(e);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverStatus",e);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverError",e);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",e);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",e):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",e):this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",e):this.popNandPushIfOK(1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",e);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",e);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",e);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",e);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",e);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",e);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",e);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",e);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",e):this.primitiveClosureValueNoContextSwitch(e);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",e):this.primitiveClosureValueNoContextSwitch(e);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",e);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",e);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(e);case 231:return this.primitiveForceDisplayUpdate(e);case 233:return this.primitiveSetFullScreen(e);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",e);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",e);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",e);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",e);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",e);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",e);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",e):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",e):this.popNandPushIfOK(1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;return this.primitiveSignalAtUTCMicroseconds(e);case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",e);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",e);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",e);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",e);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(e,r);case 249:return this.primitiveArrayBecome(e,!1);case 254:return this.primitiveVMParameter(e)}else switch(t){case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",e);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",e);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",e);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",e);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",e);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",e);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",e);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",e);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",e);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",e);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",e);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",e);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",e);case 571:return this.primitiveUnloadModule(e);case 572:return this.primitiveListBuiltinModule(e);case 573:return this.primitiveListLoadedModule(e)}return console.error("primitive "+t+" not implemented yet"),!1},namedPrimitive:function(e,i,n){var t=""===e?this:this.loadedModules[e];void 0===t&&(t=this.loadModule(e),this.loadedModules[e]=t);var r=!1;if(t){this.interpreterProxy.argCount=n;var s=t[i];"function"==typeof s?r=t[i](n):"string"==typeof s?r=this[s](n):this.vm.warnOnce("missing primitive: "+e+"."+i)}else this.vm.warnOnce("missing module: "+e+" ("+i+")");return r===!0||r===!1?r:this.success},doNamedPrimitive:function(r,e){if(e.pointersSize()<2)return!1;var t=e.pointers[1];if(4!==t.pointersSize())return!1;this.primMethod=e;var i=t.pointers[0].bytesAsString(),n=t.pointers[1].bytesAsString();return this.namedPrimitive(i,n,r)},fakePrimitive:function(r,e,t){return this.vm.warnOnce("faking primitive: "+r),void 0===e?this.vm.popN(t):this.vm.popNandPush(t+1,this.makeStObject(e)),!0}},"modules",{loadModule:function(e){var t=Squeak.externalModules[e]||this.builtinModules[e];if(!t)return null;if(this.patchModules[e]&&this.patchModule(t,e),t.setInterpreter&&!t.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+e),null;var r=t.initialiseModule;return"function"==typeof r?t.initialiseModule():"string"==typeof r&&this[r](),this.interpreterProxy.failed()?(console.log("Module initialization failed: "+e),null):(console.log("Loaded module: "+e),t)},patchModule:function(r,i){var e=this.patchModules[i];for(var t in e)r[t]=e[t]},unloadModule:function(t){var e=this.loadedModules[t];if(!t||!e||e===this)return null;delete this.loadedModules[t];var r=e.unloadModule;return"function"==typeof r?e.unloadModule(this):"string"==typeof r&&this[r](this),console.log("Unloaded module: "+t),e},loadFunctionFrom:function(i,t){var e=""===t?this:this.loadedModules[t];if(void 0===e&&(e=this.loadModule(t),this.loadedModules[t]=e),!e)return null;var r=e[i];return"function"==typeof r?r.bind(e):"string"==typeof r?this[r].bind(this):(this.vm.warnOnce("missing primitive: "+t+"."+i),null)},primitiveUnloadModule:function(t){var e=this.stackNonInteger(0).bytesAsString();return e?(this.unloadModule(e),this.popNIfOK(t)):!1},primitiveListBuiltinModule:function(e){var t=this.stackInteger(0)-1;if(!this.success)return!1;var r=Object.keys(this.builtinModules);return this.popNandPushIfOK(e+1,this.makeStObject(r[t]))},primitiveListLoadedModule:function(i){var n=this.stackInteger(0)-1;if(!this.success)return!1;var t=[];for(var r in this.loadedModules){var e=this.loadedModules[r];if(e){var s=e.getModuleName?e.getModuleName():r;t.push(s)}}return this.popNandPushIfOK(i+1,this.makeStObject(t[n]))}},"stack access",{popNIfOK:function(e){return this.success?(this.vm.popN(e),!0):!1},pop2andPushBoolIfOK:function(e){return this.vm.success=this.success,this.vm.pop2AndPushBoolResult(e)},popNandPushIfOK:function(t,e){return this.success&&null!=e?(this.vm.popNandPush(t,e),!0):!1},popNandPushIntIfOK:function(t,e){return this.success&&this.vm.canBeSmallInt(e)?this.popNandPushIfOK(t,e):!1},popNandPushFloatIfOK:function(e,t){return this.success?this.popNandPushIfOK(e,this.makeFloat(t)):!1},stackNonInteger:function(e){return this.checkNonInteger(this.vm.stackValue(e))},stackInteger:function(e){return this.checkSmallInt(this.vm.stackValue(e))},stackPos32BitInt:function(e){return this.positive32BitValueOf(this.vm.stackValue(e))},pos32BitIntFor:function(e){if(e>=0&&e<=Squeak.MaxSmallInt)return e;for(var i=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],r=this.vm.instantiateClass(i,4),n=r.bytes,t=0;4>t;t++)n[t]=e>>>8*t&255;return r},pos64BitIntFor:function(e){if(4294967295>=e)return this.pos32BitIntFor(e);for(var r=0xffffffffff>=e?5:0xffffffffffff>=e?6:72057594037927940>=e?7:8,n=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],i=this.vm.instantiateClass(n,r),s=i.bytes,t=0;r>t;t++)s[t]=255&e,e/=256;return i},stackSigned32BitInt:function(n){var e=this.vm.stackValue(n);if("number"==typeof e)return e;if(4!==e.bytesSize())return this.success=!1,0;for(var s=e.bytes,t=0,r=0,i=1;4>r;r++,i*=256)t+=s[r]*i;return this.isA(e,Squeak.splOb_ClassLargePositiveInteger)&&2147483647>=t?t:this.isA(e,Squeak.splOb_ClassLargeNegativeInteger)&&-t>=-2147483648?-t:(this.success=!1,0)},signed32BitIntegerFor:function(e){if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return e;for(var r=0>e,n=r?-e:e,s=r?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,i=this.vm.instantiateClass(this.vm.specialObjects[s],4),a=i.bytes,t=0;4>t;t++)a[t]=n>>>8*t&255;return i},stackFloat:function(e){return this.checkFloat(this.vm.stackValue(e))},stackBoolean:function(e){return this.checkBoolean(this.vm.stackValue(e))},stackSigned53BitInt:function(s){var e=this.vm.stackValue(s);if("number"==typeof e)return e;var i=e.bytesSize();if(7>=i){for(var a=e.bytes,t=0,r=0,n=1;i>r;r++,n*=256)t+=a[r]*n;if(9007199254740992>t){if(this.isA(e,Squeak.splOb_ClassLargePositiveInteger))return t;if(this.isA(e,Squeak.splOb_ClassLargeNegativeInteger))return-t}}return this.success=!1,0}},"numbers",{doBitAnd:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e&t):0},doBitOr:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e|t):0},doBitXor:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e^t):0},doBitShift:function(){var e=this.stackPos32BitInt(1),t=this.stackInteger(0);if(!this.success)return 0;var r=this.vm.safeShift(e,t);return r>0?this.pos32BitIntFor(this.vm.safeShift(e,t)):(this.success=!1,0)},safeFDiv:function(t,e){return 0===e?(this.success=!1,1):t/e},floatAsSmallInt:function(e){var t=e>=0?Math.floor(e):Math.ceil(e);return this.ensureSmallInt(t)},frexp_exponent:function(t){if(0==t)return 0;var e=new DataView(new ArrayBuffer(8));e.setFloat64(0,t);var r=e.getUint32(0)>>>20&2047;0===r&&(e.setFloat64(0,t*Math.pow(2,64)),r=(e.getUint32(0)>>>20&2047)-64);var i=r-1022;return i},ldexp:function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):-1074>e?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},primitiveLessThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(e){return e.isFloat?e.float:"number"==typeof e?e:0},positive32BitValueOf:function(e){if("number"==typeof e)return e>=0?e:(this.success=!1,0);if(!this.isA(e,Squeak.splOb_ClassLargePositiveInteger)||4!==e.bytesSize())return this.success=!1,0;for(var n=e.bytes,r=0,t=0,i=1;4>t;t++,i*=256)r+=n[t]*i;return r},checkFloat:function(e){return e.isFloat?e.float:"number"==typeof e?e:(this.success=!1,0)},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,0)},checkNonInteger:function(e){return"number"!=typeof e?e:(this.success=!1,this.vm.nilObj)},checkBoolean:function(e){return e.isTrue?!0:e.isFalse?!1:this.success=!1},indexableSize:function(e){return"number"==typeof e?-1:e.indexableSize(this)},isA:function(e,t){return e.sqClass===this.vm.specialObjects[t]},isKindOf:function(t,r){for(var e=t.sqClass,i=this.vm.specialObjects[r];!e.isNil;){if(e===i)return!0;e=e.pointers[Squeak.Class_superclass]}return!1},isAssociation:function(e){return"number"!=typeof e&&2==e.pointersSize()},ensureSmallInt:function(e){return e===(0|e)&&this.vm.canBeSmallInt(e)?e:(this.success=!1,0)},charFromInt:function(t){var r=this.vm.specialObjects[Squeak.splOb_CharacterTable],e=r.pointers[t];if(e)return e;var i=this.vm.specialObjects[Squeak.splOb_ClassCharacter];return e=this.vm.instantiateClass(i,0),e.pointers[0]=t,e},charFromIntSpur:function(e){return this.vm.image.getCharacter(e)},charToInt:function(e){return e.pointers[0]},charToIntSpur:function(e){return e.hash},makeFloat:function(t){var r=this.vm.specialObjects[Squeak.splOb_ClassFloat],e=this.vm.instantiateClass(r,2);return e.float=t,e},makeLargeIfNeeded:function(e){return this.vm.canBeSmallInt(e)?e:this.makeLargeInt(e)},makeLargeInt:function(e){if(0>e)throw Error("negative large ints not implemented yet");if(e>4294967295)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(e)},makePointWithXandY:function(t,r){var i=this.vm.specialObjects[Squeak.splOb_ClassPoint],e=this.vm.instantiateClass(i,0);return e.pointers[Squeak.Point_x]=t,e.pointers[Squeak.Point_y]=r,e},makeStArray:function(t,i){for(var r=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t.length),e=0;e<t.length;e++)r.pointers[e]=this.makeStObject(t[e],i);return r},makeStString:function(r){for(var e=[],t=0;t<r.length;++t)e.push(255&r.charCodeAt(t));var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],e.length);return i.bytes=e,i},makeStObject:function(e,t){if(void 0===e||null===e)return this.vm.nilObj;if(e===!0)return this.vm.trueObj;if(e===!1)return this.vm.falseObj;if(e.sqClass)return e;if("number"==typeof e)return e===(0|e)?this.makeLargeIfNeeded(e):this.makeFloat(e);if(t){var r=this.vm.instantiateClass(t,0);return r.jsObject=e,r}if("string"==typeof e||"Uint8Array"===e.constructor.name)return this.makeStString(e);if("Array"===e.constructor.name)return this.makeStArray(e);throw Error("cannot make smalltalk object")},pointsTo:function(e,t){return e.pointers?e.pointers.indexOf(t)>=0:!1},asUint8Array:function(e){if("Uint8Array"===e.constructor.name)return e;if("ArrayBuffer"===e.constructor.name)return new Uint8Array(e);if("string"==typeof e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}throw Error("unknown buffer type")},filenameToSqueak:function(t){var r="/"!==t[0]?"/":"",e="/SqueakJS"+r+t;return this.emulateMac&&(e=("Macintosh HD"+e).replace(/\//g,"€").replace(/:/g,"/").replace(/€/g,":")),e},filenameFromSqueak:function(e){var t=this.emulateMac?e.replace(/^[^:]*:/,":").replace(/\//g,"€").replace(/:/g,"/").replace(/€/g,":"):e;return t=t.replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(a,o,i){var e=this.stackNonInteger(1),t=this.stackPos32BitInt(0);if(!this.success)return e;var r;if(a){if(r=this.atCache[e.hash&this.atCacheMask],r.array!==e)return this.success=!1,e}else{if(e.isFloat){var n=e.floatData();return 1==t?this.pos32BitIntFor(n.getUint32(0,!1)):2==t?this.pos32BitIntFor(n.getUint32(4,!1)):(this.success=!1,e)}r=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],e,o,i)}if(1>t||t>r.size)return this.success=!1,e;if(i)return e.pointers[t-1];if(e.isPointers())return e.pointers[t-1+r.ivarOffset];if(e.isWords())return r.convertChars?this.charFromInt(1073741823&e.words[t-1]):this.pos32BitIntFor(e.words[t-1]);if(e.isBytes())return r.convertChars?this.charFromInt(255&e.bytes[t-1]):255&e.bytes[t-1];var s=4*e.pointersSize();return 0>t-1-s?(this.success=!1,e):255&e.bytes[t-1-s]},objectAtPut:function(c,s,a){var e=this.stackNonInteger(2),r=this.stackPos32BitInt(1);if(!this.success)return e;var n;if(c){if(n=this.atPutCache[e.hash&this.atCacheMask],n.array!==e)return this.success=!1,e}else{if(e.isFloat){var l=this.stackPos32BitInt(0);if(!this.success||1!=r&&2!=r)this.success=!1;else{var o=e.floatData();o.setUint32(1==r?0:4,l,!1),e.float=o.getFloat64(0)}return this.vm.stackValue(0)}n=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],e,s,a)}if(1>r||r>n.size)return this.success=!1,e;var t=this.vm.stackValue(0);if(a)return e.pointers[r-1]=t;if(e.isPointers())return e.pointers[r-1+n.ivarOffset]=t;var i;if(e.isWords()){if(s){if(t.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,t;if(i=this.charToInt(t),"number"!=typeof i)return this.success=!1,t}else i=this.stackPos32BitInt(0);return this.success&&(e.words[r-1]=i),t}if(s){if(t.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,t;if(i=this.charToInt(t),"number"!=typeof i)return this.success=!1,t}else{if("number"!=typeof t)return this.success=!1,t;i=t}if(0>i||i>255)return this.success=!1,t;if(e.isBytes())return e.bytes[r-1]=i;var u=4*e.pointersSize();return 0>r-1-u?(this.success=!1,e):(e.bytes[r-1-u]=i,t)},objectSize:function(r){var e=this.vm.stackValue(0),t=-1;return r?e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?t=e.pointersSize():e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(t=e.bytesSize()):t=this.indexableSize(e),-1===t?(this.success=!1,-1):this.pos32BitIntFor(t)},initAtCache:function(){this.atCacheSize=32,this.atCacheMask=this.atCacheSize-1,this.atCache=[],this.atPutCache=[],this.nonCachedInfo={};for(var e=0;e<this.atCacheSize;e++)this.atCache.push({}),this.atPutCache.push({})},clearAtCache:function(){this.nonCachedInfo.array=null;for(var e=0;e<this.atCacheSize;e++)this.atCache[e].array=null,this.atPutCache[e].array=null},makeAtCacheInfo:function(r,i,e,n,s){var t,a=this.vm.verifyAtSelector===i&&this.vm.verifyAtClass===e.sqClass&&!this.vm.isContext(e);return t=a?r[e.hash&this.atCacheMask]:this.nonCachedInfo,t.array=e,t.convertChars=n,s?(t.size=e.instSize()+Math.max(0,e.indexableSize(this)),t.ivarOffset=0):(t.size=e.indexableSize(this),t.ivarOffset=e.isPointers()?e.instSize():0),t}},"basic",{instantiateClass:function(t,e){return 4*e>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,null):this.vm.instantiateClass(t,e)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(e){return this.vm.image.objectAfter(e)||0},someInstanceOf:function(t){var e=this.vm.image.someInstanceOf(t);return e?e:(this.success=!1,0)},nextInstanceAfter:function(t){var e=this.vm.image.nextInstanceAfter(t);return e?e:(this.success=!1,0)},allInstancesOf:function(r){var e=this.vm.image.allInstancesOf(r),t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],e.length);return t.pointers=e,t},identityHash:function(e){return e.hash},identityHashSpur:function(e){var t=e.hash;return t>0?t:e.hash=this.newObjectHash()},behaviorHash:function(e){var t=e.hash;return t>0?t:this.vm.image.enterIntoClassTable(e)},newObjectHash:function(){return Math.floor(1073741822*Math.random())+1},primitiveAsCharacter:function(r){var e=this.stackInteger(0);if(0>e||e>1073741823)return!1;var t=this.charFromInt(e);return t?this.popNandPushIfOK(r+1,t):!1},primitiveFullGC:function(){this.vm.image.fullGC("primitive");var e=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(e))},primitiveMakePoint:function(r,i){var e=this.vm.stackValue(1),t=this.vm.stackValue(0);return i&&(this.checkFloat(e),this.checkFloat(t),!this.success)?!1:(this.vm.popNandPush(1+r,this.makePointWithXandY(e,t)),!0)},primitiveStoreStackp:function(i){var e=this.stackNonInteger(1),t=this.stackInteger(0);if(!this.success||0>t||this.vm.decodeSqueakSP(t)>=e.pointers.length)return!1;for(var r=e.pointers[Squeak.Context_stackPointer];t>r;)e.pointers[this.vm.decodeSqueakSP(++r)]=this.vm.nilObj;return e.pointers[Squeak.Context_stackPointer]=t,this.vm.popN(i),!0},primitiveChangeClass:function(e){if(e>2)return!1;var t=this.stackNonInteger(1),r=this.stackNonInteger(0);return this.success&&t.sameShapeAs(r)?(t.sqClass=r.sqClass,this.popNIfOK(e)):!1},primitiveAdoptInstance:function(e){if(e>2)return!1;var t=this.stackNonInteger(1),r=this.stackNonInteger(0);return this.success&&t.classSameShapeAs(r)?(r.sqClass=t,this.popNIfOK(e)):!1},primitiveDoPrimitiveWithArgs:function(){var t=this.stackNonInteger(0),i=this.stackInteger(1);if(!this.success)return!1;var e=t.pointersSize(),n=this.vm.activeContext.pointersSize();if(this.vm.sp+e>=n)return!1;this.vm.popN(2);for(var r=0;e>r;r++)this.vm.push(t.pointers[r]);return this.vm.tryPrimitive(i,e)?!0:(this.vm.popN(e),this.vm.push(i),this.vm.push(t),!1)},primitiveShortAtAndPut:function(t){var n=this.stackNonInteger(t),r=this.stackInteger(t-1)-1,i=n.wordsAsInt16Array();if(!this.success||!i||0>r||r>=i.length)return!1;var e;if(2>t)e=i[r];else{if(e=this.stackInteger(0),-32768>e||e>32767)return!1;i[r]=e}return this.popNandPushIfOK(t+1,e),!0},primitiveIntegerAtAndPut:function(e){var n=this.stackNonInteger(e),t=this.stackInteger(e-1)-1,r=n.wordsAsInt32Array();if(!this.success||!r||0>t||t>=r.length)return!1;var i;if(2>e)i=this.signed32BitIntegerFor(r[t]);else{if(i=this.stackSigned32BitInt(0),!this.success)return!1;r[t]=i}return this.popNandPushIfOK(e+1,i),!0},primitiveConstantFill:function(n){var e=this.stackNonInteger(1),i=this.stackPos32BitInt(0);if(!this.success||!e.isWordsOrBytes())return!1;var t=e.words||e.bytes;if(t){if(t===e.bytes&&i>255)return!1;for(var r=0;r<t.length;r++)t[r]=i}return this.vm.popN(n),!0},primitiveNewMethod:function(r){var i=this.stackInteger(0),n=this.stackInteger(1);if(!this.success)return 0;var e=this.vm.instantiateClass(this.vm.stackValue(2),n);e.pointers=[i];for(var s=e.methodNumLits(),t=0;s>t;t++)e.pointers.push(this.vm.nilObj);return this.vm.popNandPush(1+r,e),this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=e),!0},primitiveExecuteMethodArgsArray:function(i){var e=this.stackNonInteger(0),n=this.stackNonInteger(1),s=this.vm.stackValue(2);if(!this.success||!e.isMethod()||i>4)return!1;var t=e.methodNumArgs();if(t!==n.pointersSize())return!1;this.vm.popNandPush(i+1,s);for(var r=0;t>r;r++)this.vm.push(n.pointers[r]);return this.vm.executeNewMethod(s,e,t,e.methodPrimitiveIndex(),null,null),!0},primitiveArrayBecome:function(e,t){var r=this.stackNonInteger(e),i=this.stackNonInteger(e-1),n=e>1?this.stackBoolean(e-2):!0;return this.success?(this.success=this.vm.image.bulkBecome(r.pointers,i.pointers,t,n),this.popNIfOK(e)):!1},doStringReplace:function(){var e=this.stackNonInteger(4),r=this.stackInteger(3)-1,s=this.stackInteger(2)-r,i=this.stackNonInteger(1),n=this.stackInteger(0)-1;if(!this.success)return e;if(!i.sameFormatAs(e))return this.success=!1,e;if(i.isPointers()){var a=i.pointersSize(),o=i.instSize();if(n+=o,0>n||n+s>a)return this.success=!1,e;a=e.pointersSize();var u=e.instSize();if(r+=u,0>r||r+s>a)return this.success=!1,e;for(var t=0;s>t;t++)e.pointers[r+t]=i.pointers[n+t];return e}if(i.isWords()){var a=i.wordsSize();if(0>n||n+s>a)return this.success=!1,e;if(a=e.wordsSize(),0>r||r+s>a)return this.success=!1,e;for(var t=0;s>t;t++)e.words[r+t]=i.words[n+t];return e}var a=i.bytesSize();if(0>n||n+s>a)return this.success=!1,e;if(a=e.bytesSize(),0>r||r+s>a)return this.success=!1,e;for(var t=0;s>t;t++)e.bytes[r+t]=i.bytes[n+t];return e},primitiveCopyObject:function(n){var e=this.stackNonInteger(1),r=this.stackNonInteger(0),i=e.pointersSize();if(!this.success||e.isWordsOrBytes()||e.sqClass!==r.sqClass||i!==r.pointersSize())return!1;for(var t=0;i>t;t++)e.pointers[t]=r.pointers[t];return this.vm.pop(n),!0},primitiveLoadImageSegment:function(i){var e=this.stackNonInteger(1),t=this.stackNonInteger(0);if(!e.words||!t.pointers)return!1;var r=this.vm.image.loadImageSegment(e,t);return r?this.popNandPushIfOK(i+1,r):!1}},"blocks/closures",{doBlockCopy:function(){var r=this.vm.stackValue(1),n=this.stackInteger(0),e=r;if(this.vm.isContext(e)||(this.success=!1),!this.success)return r;"number"==typeof e.pointers[Squeak.Context_method]&&(e=e.pointers[Squeak.BlockContext_home]);var s=e.pointersSize()-e.instSize(),t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],s),i=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);return t.pointers[Squeak.BlockContext_initialIP]=i,t.pointers[Squeak.Context_instructionPointer]=i,t.pointers[Squeak.Context_stackPointer]=0,t.pointers[Squeak.BlockContext_argumentCount]=n,t.pointers[Squeak.BlockContext_home]=e,t.pointers[Squeak.Context_sender]=this.vm.nilObj,t},primitiveBlockValue:function(t){var r=this.vm.stackValue(t);if(!this.isA(r,Squeak.splOb_ClassBlockContext))return!1;var e=r,i=e.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof i)return!1;if(i!=t)return!1;if(!e.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-t+1,e.pointers,Squeak.Context_tempFrameStart,t);var n=e.pointers[Squeak.BlockContext_initialIP];return e.pointers[Squeak.Context_instructionPointer]=n,e.pointers[Squeak.Context_stackPointer]=t,e.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(t+1),this.vm.newActiveContext(e),!0},primitiveBlockValueWithArgs:function(i){var e=this.vm.stackValue(1),r=this.vm.stackValue(0);if(!this.isA(e,Squeak.splOb_ClassBlockContext))return!1;if(!this.isA(r,Squeak.splOb_ClassArray))return!1;var t=e.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof t)return!1;if(t!=r.pointersSize())return!1;if(!e.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(r.pointers,0,e.pointers,Squeak.Context_tempFrameStart,t);var n=e.pointers[Squeak.BlockContext_initialIP];return e.pointers[Squeak.Context_instructionPointer]=n,e.pointers[Squeak.Context_stackPointer]=t,e.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(i+1),this.vm.newActiveContext(e),!0},primitiveClosureCopyWithCopiedValues:function(){return this.vm.breakNow("primitiveClosureCopyWithCopiedValues"),!1},primitiveClosureValue:function(e){var t=this.vm.stackValue(e),r=t.pointers[Squeak.Closure_numArgs];return e!==r?!1:this.activateNewClosureMethod(t,e)},primitiveClosureValueWithArgs:function(n){var r=this.vm.top(),e=r.pointersSize(),i=this.vm.stackValue(n),s=i.pointers[Squeak.Closure_numArgs];if(e!==s)return!1;this.vm.pop();for(var t=0;e>t;t++)this.vm.push(r.pointers[t]);return this.activateNewClosureMethod(i,e)},primitiveClosureValueNoContextSwitch:function(e){return this.primitiveClosureValue(e)},activateNewClosureMethod:function(r,i){var n=r.pointers[Squeak.Closure_outerContext],o=n.pointers[Squeak.Context_method],e=this.vm.allocateOrRecycleContext(o.methodNeedsLargeFrame()),s=r.pointers.length-Squeak.Closure_firstCopiedValue;e.pointers[Squeak.Context_sender]=this.vm.activeContext,e.pointers[Squeak.Context_instructionPointer]=r.pointers[Squeak.Closure_startpc],e.pointers[Squeak.Context_stackPointer]=i+s,e.pointers[Squeak.Context_method]=n.pointers[Squeak.Context_method],e.pointers[Squeak.Context_closure]=r,e.pointers[Squeak.Context_receiver]=n.pointers[Squeak.Context_receiver];for(var a=Squeak.Context_tempFrameStart,t=0;i>t;t++)e.pointers[a++]=this.vm.stackValue(i-t-1);for(var t=0;s>t;t++)e.pointers[a++]=r.pointers[Squeak.Closure_firstCopiedValue+t];return this.vm.popN(i+1),this.vm.newActiveContext(e),!0}},"scheduling",{primitiveResume:function(){return this.resume(this.vm.top()),!0},primitiveSuspend:function(){var e=this.vm.top();if(e===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var t=e.pointers[Squeak.Proc_myList];if(t.isNil)return!1;if(this.removeProcessFromList(e,t),!this.success)return!1;e.pointers[Squeak.Proc_myList]=this.vm.nilObj,this.vm.popNandPush(1,t)}return!0},getScheduler:function(){var e=this.vm.specialObjects[Squeak.splOb_SchedulerAssociation];return e.pointers[Squeak.Assn_value]},activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},resume:function(e){var t=this.activeProcess(),r=t.pointers[Squeak.Proc_priority],i=e.pointers[Squeak.Proc_priority];i>r?(this.putToSleep(t),this.transferTo(e)):this.putToSleep(e)},putToSleep:function(e){var t=e.pointers[Squeak.Proc_priority],r=this.getScheduler().pointers[Squeak.ProcSched_processLists],i=r.pointers[t-1];this.linkProcessToList(e,i)},transferTo:function(e){var t=this.getScheduler(),r=t.pointers[Squeak.ProcSched_activeProcess];t.pointers[Squeak.ProcSched_activeProcess]=e,r.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.newActiveContext(e.pointers[Squeak.Proc_suspendedContext]),e.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj,this.vm.reclaimableContextCount=0,this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},wakeHighestPriority:function(){var e,t=this.getScheduler().pointers[Squeak.ProcSched_processLists],r=t.pointersSize()-1;do{if(0>r)throw Error("scheduler could not find a runnable process");e=t.pointers[r--]}while(this.isEmptyList(e));return this.removeFirstLinkOfList(e)},linkProcessToList:function(t,e){if(this.isEmptyList(e))e.pointers[Squeak.LinkedList_firstLink]=t;else{var r=e.pointers[Squeak.LinkedList_lastLink];r.pointers[Squeak.Link_nextLink]=t}e.pointers[Squeak.LinkedList_lastLink]=t,t.pointers[Squeak.Proc_myList]=e},isEmptyList:function(e){return e.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(e){var t=e.pointers[Squeak.LinkedList_firstLink],r=e.pointers[Squeak.LinkedList_lastLink];if(t===r)e.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,e.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj;else{var i=t.pointers[Squeak.Link_nextLink];e.pointers[Squeak.LinkedList_firstLink]=i}return t.pointers[Squeak.Link_nextLink]=this.vm.nilObj,t},removeProcessFromList:function(e,r){var n=r.pointers[Squeak.LinkedList_firstLink],s=r.pointers[Squeak.LinkedList_lastLink];if(e===n){var t=e.pointers[Squeak.Link_nextLink];r.pointers[Squeak.LinkedList_firstLink]=t,e===s&&(r.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj)}else{for(var i=n;;){if(i.isNil)return this.success=!1;if(t=i.pointers[Squeak.Link_nextLink],t===e)break;i=t}t=e.pointers[Squeak.Link_nextLink],i.pointers[Squeak.Link_nextLink]=t,e===s&&(r.pointers[Squeak.LinkedList_lastLink]=i)}e.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(t){var e=this.vm.top();
return this.vm.specialObjects[t]=this.isA(e,Squeak.splOb_ClassSemaphore)?e:this.vm.nilObj,this.vm.stackValue(1)},primitiveWait:function(){var e=this.vm.top();if(!this.isA(e,Squeak.splOb_ClassSemaphore))return!1;var t=e.pointers[Squeak.Semaphore_excessSignals];return t>0?e.pointers[Squeak.Semaphore_excessSignals]=t-1:(this.linkProcessToList(this.activeProcess(),e),this.transferTo(this.wakeHighestPriority())),!0},primitiveSignal:function(){var e=this.vm.top();return this.isA(e,Squeak.splOb_ClassSemaphore)?(this.synchronousSignal(e),!0):!1},synchronousSignal:function(e){this.isEmptyList(e)?e.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(e))},signalAtMilliseconds:function(e,t){this.isA(e,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=e,this.vm.nextWakeupTick=t):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(e){var t=this.stackInteger(0),r=this.stackNonInteger(1);return this.success?(this.signalAtMilliseconds(r,t),this.vm.popN(e),!0):!1},primitiveSignalAtUTCMicroseconds:function(e){var t=this.stackSigned53BitInt(0),r=this.stackNonInteger(1);if(!this.success)return!1;var i=t/1e3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask;return this.signalAtMilliseconds(r,i),this.vm.popN(e),!0},signalSemaphoreWithIndex:function(e){this.semaphoresToSignal.push(e)},signalExternalSemaphores:function(){for(var t=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,r=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var i=this.semaphoresToSignal.shift(),e=t[i-1];e.sqClass==r&&this.synchronousSignal(e)}},primitiveEnterCriticalSection:function(e){if(e>1)return!1;var t=this.vm.stackValue(e),r=e?this.vm.top():this.activeProcess(),i=t.pointers[Squeak.Mutex_owner];return i.isNil?(t.pointers[Squeak.Mutex_owner]=r,this.popNandPushIfOK(e+1,this.vm.falseObj)):i===r?this.popNandPushIfOK(e+1,this.vm.trueObj):(this.popNandPushIfOK(e+1,this.vm.falseObj),this.linkProcessToList(r,t),this.transferTo(this.wakeHighestPriority())),!0},primitiveExitCriticalSection:function(){var e=this.vm.top();if(this.isEmptyList(e))e.pointers[Squeak.Mutex_owner]=this.vm.nilObj;else{var t=this.removeFirstLinkOfList(e);e.pointers[Squeak.Mutex_owner]=t,this.resume(t)}return!0},primitiveTestAndSetOwnershipOfCriticalSection:function(e){if(e>1)return!1;var t=this.vm.stackValue(e),r=e?this.vm.top():this.activeProcess(),i=t.pointers[Squeak.Mutex_owner];return i.isNil?(t.pointers[Squeak.Mutex_owner]=r,this.popNandPushIfOK(e+1,this.vm.falseObj)):i===r?this.popNandPushIfOK(e+1,this.vm.trueObj):this.popNandPushIfOK(e+1,this.vm.nilObj),!0}},"vm functions",{primitiveGetAttribute:function(t){var r=this.stackInteger(0);if(!this.success)return!1;var e;switch(r){case 0:e=this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:e=this.display.documentName||null;break;case 2:e=this.display.documentName||null;break;case 1001:e=Squeak.platformName;break;case 1002:e=Squeak.osVersion;break;case 1003:e=Squeak.platformSubtype;break;case 1004:e=Squeak.vmVersion;break;case 1005:e=Squeak.windowSystem;break;case 1006:e=Squeak.vmBuild;break;case 1007:e=Squeak.vmVersion;break;case 1009:e=Squeak.vmVersion;break;default:return!1}return this.vm.popNandPush(t+1,this.makeStObject(e)),!0},setLowSpaceThreshold:function(){var e=this.stackInteger(0);return this.success&&(this.vm.lowSpaceThreshold=e),this.vm.stackValue(1)},primitiveVMParameter:function(n){var t=44;switch(n){case 0:for(var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t),e=0;t>e;e++)i.pointers[e]=this.makeStObject(this.vmParameterAt(e+1));return this.popNandPushIfOK(1,i);case 1:var r=this.stackInteger(0);return 1>r||r>t?!1:this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(r)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(e){switch(e){case 1:return this.vm.image.oldSpaceBytes;case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return 1;case 10:return 0;case 11:return this.vm.image.gcTenured;case 22:return 0;case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:return this.vm.image.bytesLeft()}return null},primitiveImageName:function(e){return 0==e?this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name))):(this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString()),window.localStorage.squeakImageName=this.vm.image.name,!0)},primitiveSnapshot:function(){this.vm.popNandPush(1,this.vm.trueObj),this.vm.storeContextRegisters(),this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.image.fullGC("snapshot");var e=this.vm.image.writeToBuffer();return Squeak.flushAllFiles(),Squeak.filePut(this.vm.image.name,e),this.vm.popNandPush(1,this.vm.falseObj),!0},primitiveQuit:function(){return Squeak.flushAllFiles(),this.display.quitFlag=!0,this.vm.breakNow("quit"),!0},primitiveExitToDebugger:function(){return this.vm.breakNow("debugger primitive"),!0},primitiveSetGCBiasToGrow:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,e)},primitiveSetGCBiasToGrowGCLimit:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,e)}},"display",{primitiveBeCursor:function(i){if(this.display.cursorCanvas){var e=this.loadForm(this.stackNonInteger(i),!0),a=1===i?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!e)return!1;var t=this.display.cursorCanvas,n=t.getContext("2d"),s={left:0,top:0,right:e.width,bottom:e.height};t.width=e.width,t.height=e.height,1===e.depth?a?(e=this.cursorMergeMask(e,a),this.showForm(n,e,s,[0,4278190335,4294967295,4278190080])):this.showForm(n,e,s,[0,4278190080]):this.showForm(n,e,s,!0);var o=this.display.context.canvas,r=o.offsetWidth/o.width;t.style.width=(t.width*r|0)+"px",t.style.height=(t.height*r|0)+"px",this.display.cursorOffsetX=e.offsetX*r|0,this.display.cursorOffsetY=e.offsetY*r|0}return this.vm.popN(i),!0},cursorMergeMask:function(t,a){for(var s=new Uint32Array(16),e=0;16>e;e++){for(var o=t.bits[e],u=a.bits[e],i=2147483648,n=0,r=0;16>r;r++)n=n|(u&i)>>r|(o&i)>>r+1,i>>>=1;s[e]=n}return{obj:t.obj,bits:s,depth:2,width:16,height:16,offsetX:t.offsetX,offsetY:t.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(e){var t=this.vm.stackValue(0);return this.vm.specialObjects[Squeak.splOb_TheDisplay]=t,this.vm.popN(e),!0},primitiveReverseDisplay:function(){if(this.reverseDisplay=!this.reverseDisplay,this.redrawDisplay(),this.display.cursorCanvas){for(var t=this.display.cursorCanvas,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=new Uint32Array(n.data.buffer),e=0;e<r.length;e++)r[e]=16777215^r[e];i.putImageData(n,0,0)}return!0},primitiveShowDisplayRect:function(e){var t={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};return this.success?(this.redrawDisplay(t),this.vm.popN(e),!0):!1},redrawDisplay:function(t){var r=this.theDisplay(),e={left:0,top:0,right:r.width,bottom:r.height};t&&(t.left>e.left&&(e.left=t.left),t.right<e.right&&(e.right=t.right),t.top>e.top&&(e.top=t.top),t.bottom<e.bottom&&(e.bottom=t.bottom)),e.left<e.right&&e.top<e.bottom&&this.displayUpdate(r,e)},showForm:function(S,e,s,p){if(s){var o=s.left,i=s.top,h=s.right-o,f=s.bottom-i,n=S.createImageData(h,f),c=n.data;c.buffer||(c=new Uint8Array(h*f*4));var g=new Uint32Array(c.buffer);switch(e.depth){case 1:case 2:case 4:case 8:var r=p||this.swappedColors;if(!r){r=[];for(var v=0;256>v;v++){var a=this.indexedColors[v],y=(4278255360&a)+((16711680&a)>>16)+((255&a)<<16);r[v]=y}this.swappedColors=r}this.reverseDisplay&&(p?r=p.map(function(e){return 16777215^e}):(this.reversedColors||(this.reversedColors=r.map(function(e){return 16777215^e})),r=this.reversedColors));for(var w=(1<<e.depth)-1,O=32-(o%e.pixPerWord+1)*e.depth,t=0;f>t;t++){for(var d=e.pitch*i+(o/e.pixPerWord|0),l=O,m=e.bits[d],k=n.width*t,u=0;h>u;u++)g[k++]=r[m>>>l&w],(l-=e.depth)<0&&(l=32-e.depth,m=e.bits[++d]);i++}break;case 16:for(var O=o%2?0:16,t=0;f>t;t++){for(var d=e.pitch*i+(o/2|0),l=O,m=e.bits[d],k=n.width*t,u=0;h>u;u++){var b=m>>>l;g[k++]=((31744&b)>>7)+((992&b)<<6)+((31&b)<<19)+4278190080,(l-=16)<0&&(l=16,m=e.bits[++d])}i++}break;case 32:for(var F=p?0:4278190080,t=0;f>t;t++){for(var d=e.pitch*i+o,k=n.width*t,u=0;h>u;u++){var a=e.bits[d++],y=4278255360&a|(16711680&a)>>16|(255&a)<<16|F;g[k++]=y}i++}break;default:throw Error("depth not implemented")}n.data!==c&&n.data.set(c),S.putImageData(n,s.left,s.top)}},primitiveDeferDisplayUpdates:function(e){var t=this.stackBoolean(0);return this.success?(this.deferDisplayUpdates=t,this.vm.popN(e),!0):!1},primitiveForceDisplayUpdate:function(e){return this.vm.breakOut(),this.vm.popN(e),!0},primitiveScreenSize:function(t){var e=this.display,r=e.width||e.context.canvas.width,i=e.height||e.context.canvas.height;return this.popNandPushIfOK(t+1,this.makePointWithXandY(r,i))},primitiveSetFullScreen:function(t){var e=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=e)if(this.display.fullscreenRequest){var r=this.vm.freeze();this.display.fullscreenRequest(e,function(){r()})}else this.display.fullscreen=e,this.vm.breakOut();return this.vm.popN(t),!0},primitiveTestDisplayDepth:function(){var e=[1,2,4,8,16,32];return this.pop2andPushBoolIfOK(e.indexOf(this.stackInteger(0))>=0)},loadForm:function(t,i){if(t.isNil)return null;var e={obj:t,bits:t.pointers[Squeak.Form_bits].wordsOrBytes(),depth:t.pointers[Squeak.Form_depth],width:t.pointers[Squeak.Form_width],height:t.pointers[Squeak.Form_height]};if(i){var r=t.pointers[Squeak.Form_offset];e.offsetX=r.pointers?r.pointers[Squeak.Point_x]:0,e.offsetY=r.pointers?r.pointers[Squeak.Point_y]:0}return 0===e.width||0===e.height?e:e.width>0&&e.height>0?(e.msb=e.depth>0,e.msb||(e.depth=-e.depth),e.depth>0?(e.pixPerWord=32/e.depth,e.pitch=(e.width+(e.pixPerWord-1))/e.pixPerWord|0,e.bits.length!==e.pitch*e.height?null:e):null):null},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(e,t){this.deferDisplayUpdates||e!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),t)},displayUpdate:function(e,t){this.showForm(this.display.context,e,t),this.display.lastTick=this.vm.lastTick,this.display.idle=0},primitiveBeep:function(r){var t=Squeak.startAudioOut();if(t){var e=t.createOscillator();e.connect(t.destination),e.type="square",e.frequency.value=880,e.start(),e.stop(t.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");return this.popNIfOK(r)}},"input",{primitiveClipboardText:function(e){if(0===e){if("string"!=typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}else if(1===e){var t=this.vm.top();t.bytes&&(this.display.clipboardString=t.bytesAsString(),this.display.clipboardStringChanged=!0),this.vm.pop()}return!0},primitiveKeyboardNext:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(e){var t=this.display.keys.length;return this.popNandPushIfOK(e+1,t?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.buttons)),this.vm.breakOut(),this.display.idle++>20&&this.vm.goIdle(),!0},primitiveMousePoint:function(e){var t=this.ensureSmallInt(this.display.mouseX),r=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(e+1,this.makePointWithXandY(t,r))},primitiveInputSemaphore:function(){var e=this.stackInteger(0);return this.success?(this.inputEventSemaIndex=e,this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this),!0):!1},primitiveInputWord:function(){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(){this.display.idle++;var e=this.stackNonInteger(0);return this.display.getNextEvent?(this.display.getNextEvent(e.pointers,this.vm.startupTime),!0):!1}},"time",{primitiveRelinquishProcessorForMicroseconds:function(e){return this.vm.pop(e),this.vm.goIdle(),!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(e){this.vm.startupTime=Date.now()-e},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClockUTC:function(){var e=Date.now()-Squeak.EpochUTC;return this.pos64BitIntFor(1e3*e)},microsecondClockLocal:function(){var e=Date.now()-Squeak.Epoch;return this.pos64BitIntFor(1e3*e)}},"FilePlugin",{primitiveDirectoryCreate:function(t){var r=this.stackNonInteger(0);if(!this.success)return!1;var e=this.filenameFromSqueak(r.bytesAsString());if(this.success=Squeak.dirCreate(e),!this.success){var i=Squeak.splitFilePath(e);console.log("Directory not created: "+i.fullname)}return this.popNIfOK(t)},primitiveDirectoryDelete:function(e){var t=this.stackNonInteger(0);if(!this.success)return!1;var r=this.filenameFromSqueak(t.bytesAsString());return this.success=Squeak.dirDelete(r),this.popNIfOK(e)},primitiveDirectoryDelimitor:function(){var e=this.emulateMac?":":"/";return this.popNandPushIfOK(1,this.charFromInt(e.charCodeAt(0)))},primitiveDirectoryEntry:function(){return this.vm.warnOnce("Not yet implemented: primitiveDirectoryEntry"),!1},primitiveDirectoryLookup:function(s){var r=this.stackInteger(0),a=this.stackNonInteger(1);if(!this.success)return!1;var i=a.bytesAsString(),n=this.filenameFromSqueak(i),t=Squeak.dirList(n,!0);if(!t){var o=Squeak.splitFilePath(n);return console.log("Directory not found: "+o.fullname),!1}var u=Object.keys(t).sort(),e=t[u[r-1]];return"/"===i&&(1===r?(e||(e=[0,0,0,0,0]),e[0]="SqueakJS",e[3]=!0):e=null),this.popNandPushIfOK(s+1,this.makeStObject(e)),!0},primitiveDirectorySetMacTypeAndCreator:function(e){return this.popNIfOK(e)},primitiveFileAtEnd:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeStObject(e.filePos>=e.file.size)),!0):!1},primitiveFileClose:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?("string"==typeof e.file?this.fileConsoleFlush(e.file):(this.fileClose(e.file),this.vm.breakOut(),e.file=null),this.popNIfOK(t)):!1},primitiveFileDelete:function(e){var t=this.stackNonInteger(0);if(!this.success)return!1;var r=this.filenameFromSqueak(t.bytesAsString());return this.success=Squeak.fileDelete(r),this.popNIfOK(e)},primitiveFileFlush:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?("string"==typeof e.file?this.fileConsoleFlush(e.file):(Squeak.flushFile(e.file),this.vm.breakOut()),this.popNIfOK(t)):!1},primitiveFileGetPosition:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeLargeIfNeeded(e.filePos)),!0):!1},makeFileHandle:function(t,r,i){var e=this.makeStString("squeakjs:"+t);return e.file=r,e.fileWrite=i,e.filePos=0,e},primitiveFileOpen:function(r){var t=this.stackBoolean(0),i=this.stackNonInteger(1);if(!this.success)return!1;var n=this.filenameFromSqueak(i.bytesAsString()),e=this.fileOpen(n,t);if(!e)return!1;var s=this.makeFileHandle(e.name,e,t);return this.popNandPushIfOK(r+1,s),!0},primitiveFileRead:function(r){var e=this.stackInteger(0),i=this.stackInteger(1)-1,n=this.stackNonInteger(2),t=this.stackNonInteger(3);return this.success&&t.file?e?n.bytes?0>i||i+e>n.bytes.length?!1:this.fileContentsDo(t.file,function(s){if(!s.contents)return this.popNandPushIfOK(r+1,0);var o=s.contents,u=n.bytes;e=Math.min(e,s.size-t.filePos);for(var a=0;e>a;a++)u[i+a]=o[t.filePos++];this.popNandPushIfOK(r+1,e)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),!1):this.popNandPushIfOK(r+1,0):!1},primitiveFileRename:function(e){var t=this.stackNonInteger(1),r=this.stackNonInteger(0);if(!this.success)return!1;var i=this.filenameFromSqueak(t.bytesAsString()),n=this.filenameFromSqueak(r.bytesAsString());return this.success=Squeak.fileRename(i,n),this.vm.breakOut(),this.popNIfOK(e)},primitiveFileSetPosition:function(t){var r=this.stackPos32BitInt(0),e=this.stackNonInteger(1);return this.success&&e.file?(e.filePos=r,this.popNIfOK(t)):!1},primitiveFileSize:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeLargeIfNeeded(e.file.size)),!0):!1},primitiveFileStdioHandles:function(e){var t=[null,this.makeFileHandle("console.log","log",!0),this.makeFileHandle("console.error","error",!0)];return this.popNandPushIfOK(e+1,this.makeStArray(t)),!0},primitiveFileTruncate:function(r){var t=this.stackPos32BitInt(0),e=this.stackNonInteger(1);return this.success&&e.file&&e.fileWrite?(e.file.size>t&&(e.file.size=t,e.file.modified=!0,e.filePos>e.file.size&&(e.filePos=e.file.size)),this.popNIfOK(r)):!1},primitiveDisableFileAccess:function(e){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,e)},primitiveFileWrite:function(n){var t=this.stackInteger(0),r=this.stackInteger(1)-1,s=this.stackNonInteger(2),e=this.stackNonInteger(3);if(!this.success||!e.file||!e.fileWrite)return!1;if(!t)return this.popNandPushIfOK(n+1,0);var i=s.bytes||s.wordsAsUint8Array();return i?0>r||r+t>i.length?!1:"string"==typeof e.file?(this.fileConsoleWrite(e.file,i,r,t),this.popNandPushIfOK(n+1,t),!0):this.fileContentsDo(e.file,function(s){var u=i,a=s.contents||[];if(e.filePos+t>a.length){var l=0===a.length?e.filePos+t:Math.max(e.filePos+t,a.length+1e4);s.contents=new Uint8Array(l),s.contents.set(a),a=s.contents}for(var o=0;t>o;o++)a[e.filePos++]=u[r+o];e.filePos>s.size&&(s.size=e.filePos),s.modified=!0,this.popNandPushIfOK(n+1,t)}.bind(this)):!1},fileOpen:function(s,a){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});var e=Squeak.splitFilePath(s);if(!e.basename)return null;var n=Squeak.dirList(e.dirname,!0);if(!n)return null;var r=n[e.basename],i=null;if(r){var t=SqueakFiles[e.fullname];if(t)return++t.refCount,t}else{if(!a)return console.log("File not found: "+e.fullname),null;if(i=new Uint8Array,r=Squeak.filePut(e.fullname,i.buffer),!r)return console.log("Cannot create file: "+e.fullname),null}var t={name:e.fullname,size:r[4],contents:i,modified:!1,refCount:1};return SqueakFiles[t.name]=t,t},fileClose:function(e){Squeak.flushFile(e),0==--e.refCount&&delete SqueakFiles[e.name]},fileContentsDo:function(e,t){if(e.contents)t(e);else{if(e.contents===!1)return!1;this.vm.freeze(function(r){Squeak.fileGet(e.name,function(i){e.contents=this.asUint8Array(i),r(),t(e)}.bind(this),function(i){console.log("File get failed: "+i),e.contents=!1,r(),t(e)}.bind(this))}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(e,n,i,s){var a=n.subarray(i,i+s),t=this.fileConsoleBuffer[e]+Squeak.bytesAsString(a),r=t.match("([^]*)\n");r&&(console[e](r[1]),t=r[2]),this.fileConsoleBuffer[e]=t},fileConsoleFlush:function(e){var t=this.fileConsoleBuffer[e];t&&(console[e](t),this.fileConsoleBuffer[e]="")}},"DropPlugin",{primitiveDropRequestFileHandle:function(n){var e=this.stackInteger(0),t=this.display.droppedFiles||[];if(1>e||e>t.length)return!1;var r=t[e-1],i=this.fileOpen(r,!1);if(!i)return!1;var s=this.makeFileHandle(r,i,!1);return this.popNandPushIfOK(n+1,s),!0},primitiveDropRequestFileName:function(r){var e=this.stackInteger(0),t=this.display.droppedFiles||[];if(1>e||e>t.length)return!1;var i=this.makeStString(this.filenameToSqueak(t[e-1]));return this.popNandPushIfOK(r,i)}},"SoundPlugin",{snd_primitiveSoundStart:function(e){return this.snd_primitiveSoundStartWithSemaphore(e)},snd_primitiveSoundStartWithSemaphore:function(e){var t=this.stackInteger(e-1),r=this.stackInteger(e-2),i=this.stackBoolean(e-3),n=e>3?this.stackInteger(e-4):0;return this.success?(this.audioContext=Squeak.startAudioOut(),this.audioContext?(this.audioSema=n,this.audioNextTimeSlot=0,this.audioBuffersReady=[],this.audioBuffersUnused=[this.audioContext.createBuffer(i?2:1,t,r),this.audioContext.createBuffer(i?2:1,t,r)],console.log("sound: started"),this.popNIfOK(e)):(this.vm.warnOnce("could not initialize audio"),!1)):!1},snd_playNextBuffer:function(){if(this.audioContext&&0!==this.audioBuffersReady.length){var e=this.audioContext.createBufferSource();e.buffer=this.audioBuffersReady.shift(),e.connect(this.audioContext.destination),this.audioNextTimeSlot<this.audioContext.currentTime&&(this.audioNextTimeSlot>0&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=this.audioContext.currentTime),e.start(this.audioNextTimeSlot),this.audioNextTimeSlot+=e.buffer.duration,window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(e.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1e3*(this.audioNextTimeSlot-this.audioContext.currentTime)),this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(r){if(!this.audioContext)return console.log("sound: no audio context"),!1;var e=0;if(this.audioBuffersUnused.length>0){var t=this.audioBuffersUnused[0];e=t.length*t.numberOfChannels*2}return this.popNandPushIfOK(r+1,e)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;var o=this.stackInteger(2),i=this.stackNonInteger(1).wordsAsInt16Array(),u=this.stackInteger(0)-1;if(!this.success||!i)return!1;for(var t=this.audioBuffersUnused.shift(),n=t.numberOfChannels,e=0;n>e;e++)for(var l=t.getChannelData(e),s=u+e,r=0;o>r;r++)l[r]=i[s]/32768,s+=n;return this.audioBuffersReady.push(t),this.snd_playNextBuffer(),this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(n){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;for(var e=this.audioBuffersUnused.shift(),s=e.numberOfChannels,i=e.length,t=0;s>t;t++)for(var a=e.getChannelData(t),r=0;i>r;r++)a[r]=0;return this.audioBuffersReady.push(e),this.snd_playNextBuffer(),this.popNandPushIfOK(n+1,i)},snd_primitiveSoundStop:function(e){return this.audioContext&&(this.audioContext=null,this.audioBuffersReady=null,this.audioBuffersUnused=null,this.audioNextTimeSlot=0,this.audioSema=0,console.log("sound: stopped")),this.popNIfOK(e)},snd_primitiveSoundStartRecording:function(t){if(3!==t)return!1;var n=this.stackNonInteger(3),s=this.stackInteger(2),r=this.stackBoolean(1),a=this.stackInteger(0);if(!this.success)return!1;var o=this.primMethod,i=this.vm.freeze(),e=this;return Squeak.startAudioIn(function(n,u){for(console.log("sound: recording started"),e.audioInContext=n,e.audioInSource=u,e.audioInSema=a,e.audioInBuffers=[],e.audioInBufferIndex=0,e.audioInOverSample=1;s*e.audioInOverSample<e.audioInContext.sampleRate;)e.audioInOverSample*=2;for(var o=1024*e.audioInOverSample;o/e.audioInContext.sampleRate<.1;)o*=2;e.audioInProcessor=n.createScriptProcessor(o,r?2:1,r?2:1),e.audioInProcessor.onaudioprocess=function(t){e.snd_recordNextBuffer(t.inputBuffer)},e.audioInSource.connect(e.audioInProcessor),e.audioInProcessor.connect(n.destination),e.vm.popN(t),window.setTimeout(i,0)},function(r){console.warn(r),e.vm.sendAsPrimitiveFailure(n,o,t),window.setTimeout(i,0)}),!0},snd_recordNextBuffer:function(e){this.audioInContext&&(this.audioInBuffers.length>5&&this.audioInBuffers.shift(),this.audioInBuffers.push(e),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(t){if(!this.audioInContext)return!1;var e=this.audioInContext.sampleRate/this.audioInOverSample|0;return console.log("sound: actual recording rate "+e+"x"+this.audioInOverSample),this.popNandPushIfOK(t+1,e)},snd_primitiveSoundRecordSamples:function(d){var s=this.stackNonInteger(1).wordsAsInt16Array(),r=this.stackInteger(0)-1;if(!this.success)return!1;for(var c=0;r<s.length&&0!==this.audioInBuffers.length;){for(var e=this.audioInBuffers[0],t=e.numberOfChannels,u=t,o=this.audioInOverSample,m=(s.length-r)/u,p=(e.length-this.audioInBufferIndex)/o,a=Math.min(p,m),i=0;t>i;i++)for(var h=e.getChannelData(i),n=this.audioInBufferIndex,f=r+i,l=0;a>l;l++)s[f]=32768*h[n]&65535,f+=u,n+=o;c+=a*t,r+=a*t,n<e.length?this.audioInBufferIndex=n:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(d+1,c)},snd_primitiveSoundStopRecording:function(){return this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInBuffers=null,this.audioInSource=null,this.audioInProcessor=null,console.log("sound recording stopped")),!0},snd_primitiveSoundSetRecordLevel:function(){return!0}},"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(e){return this.popNandPushIfOK(e+1,this.vm.trueObj)},jpeg2_primImageHeight:function(t){var e=this.stackNonInteger(0).wordsOrBytes();if(!e)return!1;var r=e[1];return this.popNandPushIfOK(t+1,r)},jpeg2_primImageWidth:function(t){var e=this.stackNonInteger(0).wordsOrBytes();if(!e)return!1;var r=e[0];return this.popNandPushIfOK(t+1,r)},jpeg2_primJPEGCompressStructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGDecompressStructSize:function(e){return this.popNandPushIfOK(e+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(i){var e=this.stackNonInteger(2).wordsOrBytes(),t=this.stackNonInteger(1).bytes;if(!e||!t)return!1;var r=this.vm.freeze();return this.jpeg2_readImageFromBytes(t,function(i){this.jpeg2state={src:t,img:i},e[0]=i.width,e[1]=i.height,r()}.bind(this),function(){e[0]=0,e[1]=0,r()}.bind(this)),this.popNIfOK(i)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var n=this.stackNonInteger(3).bytes,e=this.stackNonInteger(2).pointers,o=this.stackBoolean(1);if(!this.success||!n||!e)return!1;var t=this.jpeg2state;if(!t||t.src!==n)return console.error("jpeg read did not match header info"),!1;var s=e[Squeak.Form_depth],r=this.jpeg2_getPixelsFromImage(t.img),i=e[Squeak.Form_bits].words;if(32===s)this.jpeg2_copyPixelsToForm32(r,i);else{if(16!==s)return!1;o?this.jpeg2_ditherPixelsToForm16(r,i):this.jpeg2_copyPixelsToForm16(r,i)}return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(){return this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet"),!1},jpeg2_readImageFromBytes:function(t,r,i){var n=new Blob([t],{type:"image/jpeg"}),e=new Image;e.onload=function(){r(e)},e.onerror=function(){console.warn("could not render JPEG"),i()},e.src=(window.URL||window.webkitURL).createObjectURL(n)},jpeg2_getPixelsFromImage:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)},jpeg2_copyPixelsToForm32:function(i,r){for(var t=i.data,e=0;e<r.length;e++){var n=t[4*e+0],s=t[4*e+1],a=t[4*e+2];r[e]=4278190080|n<<16|s<<8|a}},jpeg2_copyPixelsToForm16:function(i,o){for(var u=i.width,a=i.height,r=i.data,n=0;a>n;n++)for(var s=0;u>s;s+=2){var t=n*a+s,p=r[4*t+0]>>3,l=r[4*t+1]>>3,c=r[4*t+2]>>3,f=r[4*t+4]>>3,h=r[4*t+5]>>3,d=r[4*t+6]>>3,e=p<<10|l<<5|c;0===e&&(e=1),e=e<<16|f<<10|h<<5|d,0===(65535&e)&&(e=1|e),o[t>>1]=e}},jpeg2_ditherPixelsToForm16:function(h,y){for(var S=h.width>>1,b=h.height,s=h.data,k=[2,0,14,12,1,3,13,15],O=[10,8,6,4,9,11,5,7],a=0;b>a;a++)for(var o=0;S>o;o++){var t,r,e,n=a*b+2*o<<2,v=s[n+0],p=s[n+1],m=s[n+2],d=s[n+4],f=s[n+5],c=s[n+6],g=(3&a)<<1|1&o,l=k[g],u=O[g];t=496*v>>8,r=15&t,e=t>>4,v=r>l?e+1:e,t=496*p>>8,r=15&t,e=t>>4,p=r>l?e+1:e,t=496*m>>8,r=15&t,e=t>>4,m=r>l?e+1:e,t=496*d>>8,r=15&t,e=t>>4,d=r>u?e+1:e,t=496*f>>8,r=15&t,e=t>>4,f=r>u?e+1:e,t=496*c>>8,r=15&t,e=t>>4,c=r>u?e+1:e;var i=v<<10|p<<5|m;0===i&&(i=1),i=i<<16|d<<10|f<<5|c,0===(65535&i)&&(i=1|i),y[n>>3]=i}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(n){var t=this.stackNonInteger(0).bytesAsString();if(""==t)return!1;if(/^\/SqueakJS\//.test(t)){t=t.slice(10);var r=Squeak.splitFilePath(t),i=e["squeak-template:"+r.dirname];i&&(t=JSON.parse(i).url+"/"+r.basename)}return window.open(t,"_blank"),this.popNIfOK(n)},scratch_primitiveGetFolderPath:function(t){var r=this.stackInteger(0);if(!this.success)return!1;var e;switch(r){case 1:e="/"}return e?(this.vm.popNandPush(t+1,this.makeStString(this.filenameToSqueak(e))),!0):!1}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(l){var n=this.stackNonInteger(1),t=this.js_objectOrGlobal(n),o=this.stackNonInteger(0).pointers,u=o[0].bytesAsString(),e=o[1].pointers||[],a=!("jsObject"in n),i=null;try{var r=u.match(/([^:]*)/)[0];if(a||"new"!==r){if(!(r in t))return this.js_setError("Property not found: "+r);var s=t[r];if("function"==typeof s&&(!a||e.length>0))i=s.apply(t,this.js_fromStArray(e));else if(0==e.length)i=s;else{if(1!=e.length)return this.js_setError("Property "+r+" is not a function");t[r]=this.js_fromStObject(e[0])}}else if(0===e.length)i=new t;else{var c=[null].concat(this.js_fromStArray(e));i=new(Function.prototype.bind.apply(t,c))}}catch(f){return this.js_setError(f.message)}var h=this.makeStObject(i,n.sqClass);return this.popNandPushIfOK(l+1,h)},js_primitiveAsString:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(String(t)))},js_primitiveTypeof:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(typeof t))},js_primitiveAt:function(r){var e,t=this.stackNonInteger(1),i=this.vm.stackValue(0);try{var n=this.js_objectOrGlobal(t),s=this.js_fromStObject(i),a=n[s];e=this.makeStObject(a,t.sqClass)}catch(o){return this.js_setError(o.message)}return this.popNandPushIfOK(r+1,e)},js_primitiveAtPut:function(t){var r=this.stackNonInteger(2),i=this.vm.stackValue(1),e=this.vm.stackValue(0);try{var n=this.js_objectOrGlobal(r),s=this.js_fromStObject(i),a=this.js_fromStObject(e);n[s]=a}catch(o){return this.js_setError(o.message)}return this.popNandPushIfOK(t+1,e)},js_primitiveSqueakAsJSObject:function(e){var t=this.stackNonInteger(1),r=this.vm.stackValue(0);return this.success&&(t.jsObject=r),this.popNIfOK(e)},js_primitiveInitCallbacks:function(e){return this.js_callbackSema=this.stackInteger(0),this.js_activeCallback=null,this.popNIfOK(e)},js_primitiveGetActiveCallbackBlock:function(t){var e=this.js_activeCallback;return e?this.popNandPushIfOK(t,e.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(e){var r=this.stackNonInteger(e),t=this.js_activeCallback;if(!t)return this.js_setError("No active callback");try{var i=this.makeStArray(t.args,r);return this.popNandPushIfOK(e,i)}catch(n){return this.js_setError(n.message)}},js_primitiveReturnFromCallback:function(e){return 1!==e?!1:this.js_activeCallback?(this.js_activeCallback.result=this.vm.pop(),this.vm.breakOut(),!0):this.js_setError("No active callback")},js_primitiveGetError:function(e){var t=this.makeStObject(this.js_error);return this.js_error=null,this.popNandPushIfOK(e+1,t)},js_setError:function(e){return this.js_error=String(e),!1},js_fromStObject:function(e){if("number"==typeof e)return e;if(e.jsObject)return e.jsObject;if(e.isFloat)return e.float;if(e.isNil)return null;if(e.isTrue)return!0;if(e.isFalse)return!1;if(e.bytes||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return e.bytesAsString();if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(e.pointers||[],!0);if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(e);
throw Error("asJSArgument needed for "+e)},js_fromStArray:function(e,i){if(e.length>0&&i&&this.isAssociation(e[0]))return this.js_fromStDict(e);for(var r=[],t=0;t<e.length;t++)r.push(this.js_fromStObject(e[t]));return r},js_fromStDict:function(r){for(var i={},t=0;t<r.length;t++){var e=r[t].pointers;if(!e||2!==e.length)throw Error(e+" is not an Association");var n=this.js_fromStObject(e[0]),s=this.js_fromStObject(e[1]);i[n]=s}return i},js_fromStBlock:function(e){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var t=e.pointers[Squeak.BlockContext_argumentCount];"number"!=typeof t&&(t=e.pointers[Squeak.Closure_numArgs]);var r=this;return function(){for(var n=[],i=0;t>i;i++)n.push(arguments[i]);return new Promise(function(t,i){function s(){r.js_executeCallbackAsync(e,n,t,i)}setTimeout(s,0)})}},js_executeCallbackAsync:function(e,t,r,i){function n(){s.js_executeCallbackAsync(e,t,r,i)}var s=this;this.js_activeCallback||this.vm.frozen?setTimeout(n,0):this.js_executeCallback(e,t,r,i)},js_executeCallback:function(r,i,t,n){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:r,args:i,result:null},this.signalSemaphoreWithIndex(this.js_callbackSema),this.vm.forceInterruptCheck();for(var s=Date.now()+500;Date.now()<s&&!this.js_activeCallback.result;)this.vm.interpret();var e=this.js_activeCallback.result;if(this.js_activeCallback=null,e)try{t(this.js_fromStObject(e))}catch(a){t(e.toString())}else n(Error("SqueakJS timeout"))},js_objectOrGlobal:function(e){return"jsObject"in e?e.jsObject:window}},"Obsolete",{primitiveFloatArrayAt:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",e)},primitiveFloatArrayMulFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",e)},primitiveFloatArrayAddScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",e)},primitiveFloatArrayDivFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",e)},primitiveFloatArrayDivScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",e)},primitiveFloatArrayHash:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",e)},primitiveFloatArrayAtPut:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",e)},primitiveFloatArrayMulScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",e)},primitiveFloatArrayAddFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",e)},primitiveFloatArraySubScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",e)},primitiveFloatArraySubFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",e)},primitiveFloatArrayEqual:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",e)},primitiveFloatArrayDotProduct:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",e)},m23PrimitiveInvertRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",e)},m23PrimitiveTransformPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",e)},m23PrimitiveIsPureTranslation:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",e)},m23PrimitiveComposeMatrix:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",e)},m23PrimitiveTransformRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",e)},m23PrimitiveIsIdentity:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",e)},m23PrimitiveInvertPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",e)},primitiveDeflateBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",e)},primitiveDeflateUpdateHashTable:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",e)},primitiveUpdateGZipCrc32:function(e){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",e)},primitiveInflateDecompressBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",e)},primitiveZipSendBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",e)},primitiveFFTTransformData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",e)},primitiveFFTScaleData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",e)},primitiveFFTPermuteData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",e)},gePrimitiveMergeFillFrom:function(e){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",e)},gePrimitiveCopyBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",e)},gePrimitiveAddRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddRect",e)},gePrimitiveAddGradientFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",e)},gePrimitiveSetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",e)},gePrimitiveSetBitBltPlugin:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",e)},gePrimitiveRegisterExternalEdge:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",e)},gePrimitiveGetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",e)},gePrimitiveAddBezier:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",e)},gePrimitiveInitializeProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",e)},gePrimitiveRenderImage:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",e)},gePrimitiveGetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",e)},gePrimitiveSetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",e)},gePrimitiveAddBezierShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",e)},gePrimitiveSetEdgeTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",e)},gePrimitiveGetTimes:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",e)},gePrimitiveNextActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",e)},gePrimitiveAddBitmapFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",e)},gePrimitiveGetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",e)},gePrimitiveAbortProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",e)},gePrimitiveNextGlobalEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",e)},gePrimitiveGetFailureReason:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",e)},gePrimitiveDisplaySpanBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",e)},gePrimitiveGetCounts:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",e)},gePrimitiveChangedActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",e)},gePrimitiveRenderScanline:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",e)},gePrimitiveGetBezierStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",e)},gePrimitiveFinishedProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",e)},gePrimitiveNeedsFlush:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",e)},gePrimitiveAddLine:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddLine",e)},gePrimitiveSetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",e)},gePrimitiveNextFillEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",e)},gePrimitiveInitializeBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",e)},gePrimitiveDoProfileStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",e)},gePrimitiveAddActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",e)},gePrimitiveSetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",e)},gePrimitiveNeedsFlushPut:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",e)},gePrimitiveAddCompressedShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",e)},gePrimitiveSetColorTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",e)},gePrimitiveAddOval:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddOval",e)},gePrimitiveRegisterExternalFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",e)},gePrimitiveAddPolygon:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",e)},gePrimitiveGetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",e)}}),Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(e){this.vm=e,this.remappableOops=[],Object.defineProperty(this,"successFlag",{get:function(){return e.primHandler.success},set:function(t){e.primHandler.success=t}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(){this.successFlag=!1},success:function(e){e||(this.successFlag=!1)}},"stack access",{pop:function(e){this.vm.popN(e)},popthenPush:function(e,t){this.vm.popNandPush(e,t)},push:function(e){this.vm.push(e)},pushBool:function(e){this.vm.push(e?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(e){this.vm.push(e)},pushFloat:function(e){this.vm.push(this.floatObjectOf(e))},stackValue:function(e){return this.vm.stackValue(e)},stackIntegerValue:function(t){var e=this.vm.stackValue(t);return"number"==typeof e?e:(this.successFlag=!1,0)},stackFloatValue:function(e){this.vm.success=!0;var t=this.vm.stackIntOrFloat(e);return this.vm.success?t:(this.successFlag=!1,0)},stackObjectValue:function(t){var e=this.vm.stackValue(t);return"number"!=typeof e?e:(this.successFlag=!1,this.vm.nilObj)},stackBytes:function(t){var e=this.vm.stackValue(t);return e.bytes?e.bytes:("number"!=typeof e&&e.isBytes()||(this.successFlag=!1),[])},stackWords:function(t){var e=this.vm.stackValue(t);return e.words?e.words:("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt32Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt16Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackUint16Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])}},"object access",{isBytes:function(e){return"number"!=typeof e&&e.isBytes()},isWords:function(e){return"number"!=typeof e&&e.isWords()},isWordsOrBytes:function(e){return"number"!=typeof e&&e.isWordsOrBytes()},isPointers:function(e){return"number"!=typeof e&&e.isPointers()},isIntegerValue:function(e){return"number"==typeof e&&e>=-1073741824&&1073741823>=e},isArray:function(e){return e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(i,t){var r=i.sqClass.pointers[Squeak.Class_name].bytes;if(t.length!==r.length)return!1;for(var e=0;e<t.length;e++)if(t.charCodeAt(e)!==r[e])return!1;return!0},booleanValueOf:function(e){return e.isTrue?!0:e.isFalse?!1:(this.successFlag=!1,!1)},positive32BitValueOf:function(e){return this.vm.primHandler.positive32BitValueOf(e)},positive32BitIntegerFor:function(e){return this.vm.primHandler.pos32BitIntFor(e)},floatValueOf:function(e){return e.isFloat?e.float:(this.successFlag=!1,0)},floatObjectOf:function(e){return this.vm.primHandler.makeFloat(e)},fetchPointerofObject:function(e,t){return t.pointers[e]},fetchBytesofObject:function(t,r){var e=r.pointers[t];return e.bytes?e.bytes:e.words?e.wordsAsUint8Array():("number"!=typeof e&&e.isWordsOrBytes()||(this.successFlag=!1),[])},fetchWordsofObject:function(t,r){var e=r.pointers[t];return e.words?e.words:("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchInt32ArrayofObject:function(t,r){var e=r.pointers[t];return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchInt16ArrayofObject:function(t,r){var e=r.pointers[t];return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchUint16ArrayofObject:function(t,r){var e=r.pointers[t];return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchIntegerofObject:function(t,r){var e=r.pointers[t];return"number"==typeof e?e:(this.successFlag=!1,0)},fetchLong32ofObject:function(e,t){return t.words[e]},fetchFloatofObject:function(e,t){return this.floatValueOf(t.pointers[e])},storeIntegerofObjectwithValue:function(t,r,e){"number"==typeof e?r.pointers[t]=e:this.successFlag=!1},storePointerofObjectwithValue:function(e,t,r){t.pointers[e]=r},stObjectatput:function(e,t,r){if(e.sqClass!==this.classArray())throw Error("Array expected");return 1>t||t>=e.pointers.length?this.successFlag=!1:void(e.pointers[t]=r)}},"constant access",{isKindOfInteger:function(e){return"number"==typeof e||e.sqClass==this.classLargeNegativeInteger()||e.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{instantiateClassindexableSize:function(e,t){return this.vm.instantiateClass(e,t)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(e,t){return this.vm.primHandler.makePointWithXandY(e,t)},pushRemappableOop:function(e){this.remappableOops.push(e)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(n,e,t,r,i){if(r>e&&i>t){var s={left:e,top:t,right:r,bottom:i};this.vm.primHandler.displayDirty(n,s)}},ioLoadFunctionFrom:function(e,t){return this.vm.primHandler.loadFunctionFrom(e,t)}}),Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(e,t){this.method=e,this.vm=t}},"printing",{printInstructions:function(e,t,r){for(this.indent=e,this.highlight=t,this.highlightPC=r,this.innerIndents={},this.result="",this.scanner=new Squeak.InstructionStream(this.method,this.vm),this.oldPC=this.scanner.pc,this.endPC=0,this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(t){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent),this.result+=this.oldPC;for(var e=0;e<this.innerIndents[this.oldPC];e++)this.result+="   ";this.result+=" <";for(var e=this.oldPC;e<this.scanner.pc;e++)e>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[e]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+t+"\n",this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(e){this.print("jumpTo: "+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},jumpIf:function(t,e){this.print((t?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},methodReturnReceiver:function(){this.print("return: receiver"),this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack"),this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(e){this.print("returnConst: "+e.toString()),this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(e){this.print("popIntoBinding: "+e.assnKeyAsString())},popIntoReceiverVariable:function(e){this.print("popIntoInstVar: "+e)},popIntoTemporaryVariable:function(e){this.print("popIntoTemp: "+e)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(e){var t=e.sqInstName?e.sqInstName():e.toString();this.print("pushConst: "+t)},pushLiteralVariable:function(e){this.print("pushBinding: "+e.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(e){this.print("pushInstVar: "+e)},pushTemporaryVariable:function(e){this.print("pushTemp: "+e)},send:function(e,r,t){this.print((t?"superSend: #":"send: #")+(e.bytesAsString?e.bytesAsString():e))},storeIntoLiteralVariable:function(e){this.print("storeIntoBinding: "+e.assnKeyAsString())},storeIntoReceiverVariable:function(e){this.print("storeIntoInstVar: "+e)},storeIntoTemporaryVariable:function(e){this.print("storeIntoTemp: "+e)},pushNewArray:function(e){this.print("push: (Array new: "+e+")")},popIntoNewArray:function(e){this.print("pop: "+e+" into: (Array new: "+e+")")},pushRemoteTemp:function(e,t){this.print("push: "+e+" ofTemp: "+t)},storeIntoRemoteTemp:function(e,t){this.print("storeInto: "+e+" ofTemp: "+t)},popIntoRemoteTemp:function(e,t){this.print("popInto: "+e+" ofTemp: "+t)},pushClosureCopy:function(i,n,s){var r=this.scanner.pc,e=r+s;this.print("closure("+r+"-"+(e-1)+"): "+i+" copied, "+n+" args");for(var t=r;e>t;t++)this.innerIndents[t]=(this.innerIndents[t]||0)+1;e>this.endPC&&(this.endPC=e)},callPrimitive:function(e){this.print("primitive: "+e)}}),Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(t,e){this.vm=e,this.method=t,this.pc=0,this.specialConstants=[e.trueObj,e.falseObj,e.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(t){var i=this.method,n=i.bytes[this.pc++],r=n/16|0,e=n%16;if(0===r)return t.pushReceiverVariable(e);if(1===r)return t.pushTemporaryVariable(e);if(2===r)return t.pushConstant(i.methodGetLiteral(e));if(3===r)return t.pushConstant(i.methodGetLiteral(e+16));if(4===r)return t.pushLiteralVariable(i.methodGetLiteral(e));if(5===r)return t.pushLiteralVariable(i.methodGetLiteral(e+16));if(6===r)return 8>e?t.popIntoReceiverVariable(e):t.popIntoTemporaryVariable(e-8);if(7===r){if(0===e)return t.pushReceiver();if(8>e)return t.pushConstant(this.specialConstants[e-1]);if(8===e)return t.methodReturnReceiver();if(12>e)return t.methodReturnConstant(this.specialConstants[e-9]);if(12===e)return t.methodReturnTop();if(13===e)return t.blockReturnTop();if(e>13)throw Error("unusedBytecode")}return 8===r?this.interpretExtension(e,i,t):9===r?8>e?t.jump(e+1):t.jumpIf(!1,e-8+1):10===r?(n=this.method.bytes[this.pc++],8>e?t.jump(256*(e-4)+n):t.jumpIf(12>e,256*(3&e)+n)):11===r?t.send(this.vm.specialSelectors[2*e],this.vm.specialSelectors[2*e+1],!1):12===r?t.send(this.vm.specialSelectors[2*(e+16)],this.vm.specialSelectors[2*(e+16)+1],!1):r>12?t.send(i.methodGetLiteral(e),r-13,!1):void 0},interpretExtension:function(i,o,e){if(6>=i){var t=this.method.bytes[this.pc++];if(2>=i){var r=t/64|0,s=t%64;if(0===i){if(0===r)return e.pushReceiverVariable(s);if(1===r)return e.pushTemporaryVariable(s);if(2===r)return e.pushConstant(this.method.methodGetLiteral(s));if(3===r)return e.pushLiteralVariable(this.method.methodGetLiteral(s))}if(1===i){if(0===r)return e.storeIntoReceiverVariable(s);if(1===r)return e.storeIntoTemporaryVariable(s);if(2===r)throw Error("illegalStore");if(3===r)return e.storeIntoLiteralVariable(this.method.methodGetLiteral(s))}if(2===i){if(0===r)return e.popIntoReceiverVariable(s);if(1===r)return e.popIntoTemporaryVariable(s);if(2===r)throw Error("illegalStore");if(3===r)return e.popIntoLiteralVariable(this.method.methodGetLiteral(s))}}if(3===i)return e.send(this.method.methodGetLiteral(t%32),t/32|0,!1);if(4===i){var n=this.method.bytes[this.pc++],r=t/32|0;if(0===r)return e.send(this.method.methodGetLiteral(n),t%32,!1);if(1===r)return e.send(this.method.methodGetLiteral(n),t%32,!0);if(2===r)return e.pushReceiverVariable(n);if(3===r)return e.pushConstant(this.method.methodGetLiteral(n));if(4===r)return e.pushLiteralVariable(this.method.methodGetLiteral(n));if(5===r)return e.storeIntoReceiverVariable(n);if(6===r)return e.popIntoReceiverVariable(n);if(7===r)return e.storeIntoLiteralVariable(this.method.methodGetLiteral(n))}if(5===i)return e.send(this.method.methodGetLiteral(31&t),t>>5,!0);if(6===i)return e.send(this.method.methodGetLiteral(63&t),t>>6,!1)}if(7===i)return e.doPop();if(8===i)return e.doDup();if(9===i)return e.pushActiveContext();var t=this.method.bytes[this.pc++];if(10===i)return 128>t?e.pushNewArray(t):e.popIntoNewArray(t-128);var n=this.method.bytes[this.pc++];if(11===i)return e.callPrimitive(t+256*n);if(12===i)return e.pushRemoteTemp(t,n);if(13===i)return e.storeIntoRemoteTemp(t,n);if(14===i)return e.popIntoRemoteTemp(t,n);var a=this.method.bytes[this.pc++];return e.pushClosureCopy(t>>4,15&t,256*n+a)}})}),module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(e){this.vm=e,this.comments=!!Squeak.Compiler.comments,this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"]}},"accessing",{compile:function(e,t,r){if(e.isHot){this.singleStep=!1,this.debug=this.comments;var i=t&&t.className(),n=r&&r.bytesAsString();e.compiled=this.generate(e,i,n)}else e.isHot=!0},enableSingleStepping:function(e,r,i){if(!e.compiled||!e.compiled.canSingleStep){this.singleStep=!0,this.debug=!0;var t=this.vm.printMethod(e,r,i).split(">>");e.compiled=this.generate(e,t[0],t[1]),e.compiled.canSingleStep=!0}return!0},functionNameFor:function(t,e){if(!t||!e)return"Squeak_DOIT";if(!/[^a-zA-Z0-9:_]/.test(e))return(t+"_"+e).replace(/[: ]/g,"_");var r=e.replace(/./g,function(e){var t={"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[e];return t||"OPERATOR"});return t.replace(/[ ]/,"_")+"__"+r+"__"}},"generating",{generate:function(t,i,n){for(this.method=t,this.pc=0,this.endPC=0,this.prevPC=0,this.source=[],this.sourceLabels={},this.needsLabel={0:!0},this.needsBreak=!1,i&&n&&this.source.push("// ",i,">>",n,"\n"),this.source.push("var context = vm.activeContext,\n","    stack = context.pointers,\n","    rcvr = vm.receiver,\n","    inst = rcvr.pointers,\n","    temp = vm.homeContext.pointers,\n","    lit = vm.method.pointers,\n","    bytecodes = 0 - vm.pc;\n","while (true) switch (vm.pc) {\n"),this.done=!1;!this.done;){var e=t.bytes[this.pc++],r=0;switch(248&e){case 0:case 8:this.generatePush("inst[",15&e,"]");break;case 16:case 24:this.generatePush("temp[",6+(15&e),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(31&e),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(31&e),"].pointers[1]");break;case 96:this.generatePopInto("inst[",7&e,"]");break;case 104:this.generatePopInto("temp[",6+(7&e),"]");break;case 112:switch(e){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(e){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode")}break;case 128:case 136:this.generateExtended(e);break;case 144:this.generateJump((7&e)+1);break;case 152:this.generateJumpIf(!1,(7&e)+1);break;case 160:r=t.bytes[this.pc++],this.generateJump(256*((7&e)-4)+r);break;case 168:r=t.bytes[this.pc++],this.generateJumpIf(172>e,256*(3&e)+r);break;case 176:case 184:this.generateNumericOp(e);break;case 192:case 200:this.generateQuickPrim(e);break;case 208:case 216:this.generateSend("lit[",1+(15&e),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(15&e),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(15&e),"]",2,!1)}}var s=this.functionNameFor(i,n);return this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC'); }"),new Function("return function "+s+"(vm, singleStep) {\n"+this.source.join("")+"\n}")()):(this.debug&&this.source.push("// fall back to single-stepping\n"),this.source.push("default: bytecodes += vm.pc; vm.interpretOne(true); return bytecodes;}"),this.deleteUnneededLabels(),new Function("return function "+s+"(vm) {\n"+this.source.join("")+"\n}")())},generateExtended:function(r){var e,t;switch(r){case 128:switch(e=this.method.bytes[this.pc++],e>>6){case 0:return void this.generatePush("inst[",63&e,"]");case 1:return void this.generatePush("temp[",6+(63&e),"]");case 2:return void this.generatePush("lit[",1+(63&e),"]");case 3:return void this.generatePush("lit[",1+(63&e),"].pointers[1]")}case 129:switch(e=this.method.bytes[this.pc++],e>>6){case 0:return void this.generateStoreInto("inst[",63&e,"]");case 1:return void this.generateStoreInto("temp[",6+(63&e),"]");case 2:throw Error("illegal store into literal");case 3:return void this.generateStoreInto("lit[",1+(63&e),"].pointers[1]")}return;case 130:switch(e=this.method.bytes[this.pc++],e>>6){case 0:return void this.generatePopInto("inst[",63&e,"]");case 1:return void this.generatePopInto("temp[",6+(63&e),"]");case 2:throw Error("illegal pop into literal");case 3:return void this.generatePopInto("lit[",1+(63&e),"].pointers[1]")}case 131:return e=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&e),"]",e>>5,!1);case 132:switch(e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],e>>5){case 0:return void this.generateSend("lit[",1+t,"]",31&e,!1);case 1:return void this.generateSend("lit[",1+t,"]",31&e,!0);case 2:return void this.generatePush("inst[",t,"]");case 3:return void this.generatePush("lit[",1+t,"]");case 4:return void this.generatePush("lit[",1+t,"].pointers[1]");case 5:return void this.generateStoreInto("inst[",t,"]");case 6:return void this.generatePopInto("inst[",t,"]");case 7:return void this.generateStoreInto("lit[",1+t,"].pointers[1]")}case 133:return e=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&e),"]",e>>5,!0);case 134:return e=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(63&e),"]",e>>6,!1);case 135:return void this.generateInstruction("pop","vm.sp--");case 136:return void this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");case 137:return void this.generateInstruction("thisContext","stack[++vm.sp] = vm.exportThisContext()");case 138:e=this.method.bytes[this.pc++];var i=e>127,n=127&e;return void this.generateClosureTemps(n,i);case 139:return e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],void this.generateCallPrimitive(e+256*t);case 140:return e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],void this.generatePush("temp[",6+t,"].pointers[",e,"]");case 141:return e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],void this.generateStoreInto("temp[",6+t,"].pointers[",e,"]");case 142:return e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],void this.generatePopInto("temp[",6+t,"].pointers[",e,"]");case 143:e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++];var s=this.method.bytes[this.pc++],a=15&e,o=e>>4,u=t<<8|s;return void this.generateClosureCopy(a,o,u)}},generatePush:function(r,e,i,t,n){this.debug&&this.generateDebugCode("push"),this.generateLabel(),this.source.push("stack[++vm.sp] = ",r),void 0!==e&&(this.source.push(e,i),void 0!==t&&this.source.push(t,n)),this.source.push(";\n")},generateStoreInto:function(r,e,i,t,n){this.debug&&this.generateDebugCode("store into"),this.generateLabel(),this.source.push(r),void 0!==e&&(this.source.push(e,i),void 0!==t&&this.source.push(t,n)),this.source.push(" = stack[vm.sp];\n")},generatePopInto:function(r,e,i,t,n){this.debug&&this.generateDebugCode("pop into"),this.generateLabel(),this.source.push(r),void 0!==e&&(this.source.push(e,i),void 0!==t&&this.source.push(t,n)),this.source.push(" = stack[vm.sp--];\n")},generateReturn:function(e){this.debug&&this.generateDebugCode("return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,"); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1},generateJump:function(t){var e=this.pc+t;this.debug&&this.generateDebugCode("jump to "+e),this.generateLabel(),this.source.push("vm.pc = ",e,"; "),0>t?this.source.push("bytecodes += ",-t,"; "):this.source.push("bytecodes -= ",t,"; "),0>t&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",e,";\n","}\n"),this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return bytecodes + ",e,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[e]=!0,e>this.endPC&&(this.endPC=e)},generateJumpIf:function(t,r){var e=this.pc+r;this.debug&&this.generateDebugCode("jump if "+t+" to "+e),this.generateLabel(),this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",t,"Obj) {vm.pc = ",e,"; bytecodes -= ",r,"; "),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",e,"; else "),this.source.push("continue}\n","else if (cond !== vm.",!t,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,this.needsLabel[e]=!0,e>this.endPC&&(this.endPC=e)},generateQuickPrim:function(e){switch(this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[(15&e)+16]),this.generateLabel(),e){case 194:return this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"; }\n"),void(this.needsLabel[this.pc]=!0);case 198:return void this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");case 199:return void this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");
case 200:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) ","{vm.sendSpecial(",(15&e)+16,"); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,void(this.needsLabel[this.pc+2]=!0);case 201:case 202:case 203:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) vm.sendSpecial(",(15&e)+16,"); return bytecodes + ",this.pc,";\n"),void(this.needsLabel[this.pc]=!0)}this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,"))"," vm.sendSpecial(",(15&e)+16,");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n","if (vm.pc !== ",this.pc,") throw Error('Huh?');\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateNumericOp:function(e){switch(this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[15&e]),this.generateLabel(),this.needsLabel[this.pc]=!0,e){case 176:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 177:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 178:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 179:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 180:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 181:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 182:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 183:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 184:return void this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return bytecodes + ",this.pc,"}\n");case 185:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return bytecodes + ",this.pc,"}\n");case 186:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return bytecodes + ",this.pc,"}\n");case 187:return void this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return bytecodes + ",this.pc,"}\n");case 188:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return bytecodes + ",this.pc,"}\n");case 189:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return bytecodes + ",this.pc,"}\n");case 190:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return bytecodes + ",this.pc,"}\n");case 191:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return bytecodes + ",this.pc,"}\n")}},generateSend:function(e,t,r,i,n){this.debug&&this.generateDebugCode("send "+("lit["===e?this.method.pointers[t].bytesAsString():"...")),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.send(",e,t,r,", ",i,", ",n,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateClosureTemps:function(e,r){if(this.debug&&this.generateDebugCode("closure temps"),this.generateLabel(),this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",e,");\n"),r){for(var t=0;e>t;t++)this.source.push("array.pointers[",t,"] = stack[vm.sp - ",e-t-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(n,e,s){var r=this.pc,t=r+s;if(this.debug&&this.generateDebugCode("push closure("+r+"-"+(t-1)+"): "+e+" copied, "+n+" args"),this.generateLabel(),this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",e,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",r+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",n,";\n"),e>0){for(var i=0;e>i;i++)this.source.push("closure.pointers[",i+3,"] = stack[vm.sp - ",e-i-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",t,";\n"),this.source.push("bytecodes -= ",s,";\n"),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",t,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[r]=!0,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateCallPrimitive:function(e){if(this.debug&&this.generateDebugCode("call primitive "+e),this.generateLabel(),3!==this.pc)throw Error("call primitive bytecode not expected here")},generateLabel:function(){this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n"),this.prevPC=this.pc},generateDebugCode:function(r){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + (vm.pc = ",this.prevPC,");\n"),this.needsLabel[this.prevPC]=!0);for(var t=[],e=this.prevPC;e<this.pc;e++)t.push((this.method.bytes[e]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",t.join(" "),"> ",r,"\n"),this.needsBreak=this.singleStep},generateInstruction:function(e,t){this.debug&&this.generateDebugCode(e),this.generateLabel(),this.source.push(t,";\n")},deleteUnneededLabels:function(){for(var t in this.sourceLabels)if(!this.needsLabel[t])for(var e=0;3>e;e++)this.source[this.sourceLabels[t]+e]=""}})}),module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(t,e){return e>31?0:t<<e}function l(t,e){return e>31?0:t>>>e}function g(){return b}function v(i,s){var r,e,t;for(e=s-i,0>e&&(e=0-e),r=63,t=1;62>=t;t++)63===r&&n[t-1]>=e&&(r=t);return r}function s(o){var e,n,s;for(n=0,e=o;;){if(s=e-r,!(s>0))return n+=l(t,0-s),r-=e,t&=l(255,8-r),n;n+=u(t,s),e-=r,t=a[++i-1],r=8}}function o(c,f){var o,n,s,e;for(n=f,s=c;;){if(o=8-r,e=o-s,!(0>e))return t+=u(n,e),r+=s,self;t+=l(n,0-e),a[++i-1]=t,r=0,t=0,n&=u(1,0-e)-1,s-=o}}function m(){var o,S,f,h,d,c,p,O,w,k,g,b,l,y,u,m,v;if(o=e.stackValue(1),S=e.stackIntegerValue(0),u=e.fetchIntegerofObject(0,o),l=e.fetchIntegerofObject(1,o),w=e.fetchIntegerofObject(2,o),g=e.fetchIntegerofObject(3,o),k=e.fetchIntegerofObject(4,o),b=e.fetchIntegerofObject(5,o),t=e.fetchIntegerofObject(6,o),r=e.fetchIntegerofObject(7,o),i=e.fetchIntegerofObject(8,o),a=e.fetchBytesofObject(9,o),v=e.fetchInt16ArrayofObject(10,o),m=e.fetchIntegerofObject(12,o),O=e.fetchIntegerofObject(13,o),n=e.fetchInt16ArrayofObject(14,o),y=e.fetchInt16ArrayofObject(15,o),e.failed())return null;for(d=1;S>=d;d++)if(1===(d&b))u=s(16),u>32767&&(u-=65536),l=s(6),v[++m-1]=u;else{for(h=s(O),p=n[l],c=0,f=k;f>0;)(h&f)>0&&(c+=p),p>>>=1,f>>>=1;c+=p,(h&w)>0?u-=c:u+=c,u>32767?u=32767:-32768>u&&(u=-32768),l+=y[h&g],0>l?l=0:l>88&&(l=88),v[++m-1]=u}return e.failed()?null:(e.storeIntegerofObjectwithValue(0,o,u),e.storeIntegerofObjectwithValue(1,o,l),e.storeIntegerofObjectwithValue(6,o,t),e.storeIntegerofObjectwithValue(7,o,r),e.storeIntegerofObjectwithValue(8,o,i),e.storeIntegerofObjectwithValue(12,o,m),void e.pop(1))}function p(){var o,V,m,b,k,S,c,f,p,g,u,l,O,y,A,F,_,w,x,d,I,v,P,h,C;if(o=e.stackValue(1),V=e.stackIntegerValue(0),v=e.fetchInt16ArrayofObject(0,o),d=e.fetchInt16ArrayofObject(1,o),F=e.fetchIntegerofObject(2,o),w=e.fetchIntegerofObject(3,o),_=e.fetchIntegerofObject(4,o),x=e.fetchIntegerofObject(5,o),t=e.fetchIntegerofObject(6,o),r=e.fetchIntegerofObject(7,o),i=e.fetchIntegerofObject(8,o),a=e.fetchBytesofObject(9,o),C=e.fetchInt16ArrayofObject(10,o),P=e.fetchInt16ArrayofObject(11,o),h=e.fetchIntegerofObject(12,o),A=e.fetchIntegerofObject(13,o),n=e.fetchInt16ArrayofObject(14,o),I=e.fetchInt16ArrayofObject(15,o),e.failed())return null;for(u=v[0],l=v[1],c=d[0],f=d[1],S=1;V>=S;S++)if(1===(S&x))u=s(16),c=s(6),l=s(16),f=s(6),u>32767&&(u-=65536),l>32767&&(l-=65536),C[++h-1]=u,P[h-1]=l;else{for(b=s(A),k=s(A),O=n[c],y=n[f],p=g=0,m=_;m>0;)(b&m)>0&&(p+=O),(k&m)>0&&(g+=y),O>>>=1,y>>>=1,m>>>=1;p+=O,g+=y,(b&F)>0?u-=p:u+=p,(k&F)>0?l-=g:l+=g,u>32767?u=32767:-32768>u&&(u=-32768),l>32767?l=32767:-32768>l&&(l=-32768),c+=I[b&w],0>c?c=0:c>88&&(c=88),f+=I[k&w],0>f?f=0:f>88&&(f=88),C[++h-1]=u,P[h-1]=l}return v[0]=u,v[1]=l,d[0]=c,d[1]=f,e.failed()?null:(e.storeIntegerofObjectwithValue(6,o,t),e.storeIntegerofObjectwithValue(7,o,r),e.storeIntegerofObjectwithValue(8,o,i),e.storeIntegerofObjectwithValue(12,o,h),void e.pop(1))}function d(){var s,y,g,b,f,p,S,d,m,c,F,A,O,w,l,I,u,h,k;if(s=e.stackValue(1),y=e.stackIntegerValue(0),u=e.fetchIntegerofObject(0,s),l=e.fetchIntegerofObject(1,s),A=e.fetchIntegerofObject(2,s),O=e.fetchIntegerofObject(4,s),w=e.fetchIntegerofObject(5,s),t=e.fetchIntegerofObject(6,s),r=e.fetchIntegerofObject(7,s),i=e.fetchIntegerofObject(8,s),a=e.fetchBytesofObject(9,s),k=e.fetchInt16ArrayofObject(10,s),h=e.fetchIntegerofObject(12,s),F=e.fetchIntegerofObject(13,s),n=e.fetchInt16ArrayofObject(14,s),I=e.fetchInt16ArrayofObject(15,s),e.failed())return null;for(c=n[0],p=1;y>=p;p++)if(1===(p&w))u=k[++h-1],(S=u)<0&&(S+=65536),o(16,S),y>p&&(l=v(u,k[h])),o(6,l);else{for(m=0,f=k[++h-1]-u,0>f&&(m=A,f=0-f),b=0,d=0,g=O;g>0;)f>=c&&(b+=g,d+=c,f-=c),c>>>=1,g>>>=1;d+=c,m>0?u-=d:u+=d,u>32767?u=32767:-32768>u&&(u=-32768),l+=I[b],0>l?l=0:l>88&&(l=88),c=n[l],o(F,m|b)}return r>0&&(a[++i-1]=t),e.failed()?null:(e.storeIntegerofObjectwithValue(0,s,u),e.storeIntegerofObjectwithValue(1,s,l),e.storeIntegerofObjectwithValue(6,s,t),e.storeIntegerofObjectwithValue(7,s,r),e.storeIntegerofObjectwithValue(8,s,i),e.storeIntegerofObjectwithValue(12,s,h),void e.pop(1))}function c(){var s,o;return s=e.stackValue(1),o=e.stackIntegerValue(0),t=e.fetchIntegerofObject(6,s),r=e.fetchIntegerofObject(7,s),i=e.fetchIntegerofObject(8,s),a=e.fetchIntegerofObject(9,s),n=e.fetchIntegerofObject(14,s),e.failed()?null:(success(!1),e.failed()?null:(e.storeIntegerofObjectwithValue(6,s,t),e.storeIntegerofObjectwithValue(7,s,r),e.storeIntegerofObjectwithValue(8,s,i),void e.pop(1)))}function k(r){var t;return e=r,t=e.majorVersion()==f,t===!1?!1:t=e.minorVersion()>=h}var f=1,h=11,r=0,i=0,t=0,a=null,e=null,b="ADPCMCodecPlugin 3 November 2014 (e)",n=null;Squeak.registerExternalModule("ADPCMCodecPlugin",{primitiveDecodeStereo:p,primitiveEncodeStereo:c,setInterpreter:k,primitiveEncodeMono:d,primitiveDecodeMono:m,getModuleName:g})}),module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function st(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function d(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Uh(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function wt(e,t){return 0|Math.floor(e/t)}function zh(e,t){return e-wt(e,t)*t|0}function q(t,e){return e>31?0:t<<e}function n(t,e){return e>31?0:t>>>e}function V(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function su(e,t){return new Float32Array(e.buffer,e.byteOffset+4*t)}function L(){return t[ro]}function $n(e){return t[ro]=e}function tt(){return t[io]}function Lh(e){return t[io]=e}function Nr(r,t){var e;return e=r+A()-1&~(A()-1),e>t?t:e}function Bh(e){return t[ff]=e}function Br(t,e){return e-1&~(A()-1)}function A(){return t[no]}function _h(e){return t[no]=e}function mt(){return t[so]}function Zn(e){return t[so]=e}function b(){return t[ao]}function Fn(e){return t[ao]=e}function Ql(r){var e,t;return e=65535&r,t=r>>>16&255,(e*e>>>16)+e*t*2+(t*t<<16)>>>8}function ki(e,t){var r;return 0===e?0>t?0-t:t:0===t?0>e?0-e:e:(r=e*e+t*t,yc(r))}function yn(e){return ma(1)?(M[z()]=e,void hn(z()+1)):0}function vl(e,r,t,s){var i,n;K(e)[D]=K(e)[D]-256*t,i=et(e)[D],et(e)[D]=i+256*(r-t),n=et(e)[jt],et(e)[jt]=n+256*r,So(e,s-t)}function yu(e,t,r,s){var i,n;K(e)[D]=K(e)[D]+256*r,i=et(e)[D],et(e)[D]=i-256*(t-r),n=et(e)[jt],et(e)[jt]=n+256*t,So(e,s-r+t)}function Vh(e,i,l){var s,r,a,t,n,u,o;u=ss(e),o=os(e),s=fi(e),a=Pt(s),t=ls(e),n=ji(e),r=l-i,s>u&&(0>n?t-=r:(t+=r,U(e,i))),o+a===0&&(n>0?t-=Jt(e):(t+=Jt(e),U(e,i))),o+a>0&&(0>n?(t+=r,U(e,i)):t-=r),ni(e,t)}function P(){return t[oo]}function ot(e){return t[oo]=e}function T(){return t[uo]}function zr(e){return t[uo]=e}function au(e){return Z(e)}function ah(){var e;return kt(Ut)?(e=w,w=e+Ut,G(e,pa),nt(e,0),dt(e,Ut),e):0}function Ji(){return lu(6),W()}function df(r,s){var n,t,i,e;if(i=ll+r,!kt(i))return 0;if(t=w,w=t+i,G(t,oc),nt(t,0),dt(t,i),n=Fa(t),bi())for(e=0;r-1>=e;e++)n[e]=j(s[e]);else for(e=0;r-1>=e;e++)n[e]=s[e];return Qf(t,r),t}function ma(e){var r,t,i,n;if(!au(e))return!1;if(0!==T())for(i=T(),r=T()+e,t=1,n=T();n>=t;t++)k[--r]=k[--i];return k=V(k,e),!0}function nf(s,r,a){var t,i,e,n;if(i=Gc+r,!kt(i))return 0;if(t=w,w=t+i,a?G(t,pc):G(t,dc),nt(t,0),dt(t,i),n=Ai(t),bi())for(e=0;r-1>=e;e++)n[e]=j(s[e]);else for(e=0;r-1>=e;e++)n[e]=s[e];return qf(t,r),t}function ef(){var e;return kt(It)?(e=w,w=e+It,G(e,ka),nt(e,0),dt(e,It),e):0}function kt(e){var r,t,i,n;if(!ma(e))return!1;if(0!==z())for(i=z(),r=z()+e,t=1,n=z();n>=t;t++)M[--r]=M[--i];return M=V(M,e),!0}function Oc(e){return Z(e)}function Is(){return lu(N())}function $u(){var e;return kt(Fi)?(e=w,w=e+Fi,G(e,gc),nt(e,0),dt(e,Fi),e):0}function Qu(){var e;return kt(sr)?(e=w,w=e+sr,G(e,bc),nt(e,0),dt(e,sr),e):0}function Xu(e){return 0===(Ru(e)&gn)}function ns(e,t,r){if(t>r){if(e>t)return t;if(r>e)return r}else{if(t>e)return t;if(e>r)return r}return e}function Ni(e){return s(e,js)}function es(e,t){return a(e,js,t)}function qi(e){return s(e,qs)}function Xo(e,t){return a(e,qs,t)}function Ao(e){return s(e,Ms)}function So(e,t){return a(e,Ms,t)}function K(e){return V(Y,e+ml)}function wh(e){return s(e,Es)}function iu(e,t){return a(e,Es,t)}function Eu(e){return s(e,Rs)}function Gs(e,t){return a(e,Rs,t)}function Hc(e){return s(e,Vs)}function Qf(e,t){return a(e,Vs,t)}function fh(e){return s(e,As)}function mh(e,t){return a(e,As,t)}function pu(e){return s(e,Ps)}function El(e,t){return a(e,Ps,t)}function Gh(e){return s(e,Cs)}function af(e,t){return a(e,Cs,t)}function Kh(e){return s(e,_s)}function Rh(e,t){return a(e,_s,t)}function du(e){return s(e,Bs)}function Nh(e,t){return a(e,Bs,t)}function Gr(i,h,u,f){var d,s,t,l,c,o,a,r,e;return t=fh(i),l=Gh(i),32===t?(e=0|h[l*f+u],0!==e&&0===(4278190080&e)&&(e=4278190080|e),ou(e)):(r=Ac()[t],e=h[l*f+n(u,r)],c=q(1,t)-1,r=32-t-(u&q(1,r)-1)*t,e=n(e,r)&c,16===t?0!==e&&(s=(31&e)<<3,s+=s>>>5,o=(e>>>5&31)<<3,o+=o>>>5,a=(e>>>10&31)<<3,a+=a>>>5,d=255,e=s+(o<<8)+(a<<16)+(d<<24)):e=0===Hc(i)?0:Fa(i)[e],ou(e))}function hu(e){return s(e,xs)}function qh(e,t){return a(e,xs,t)}function Dt(e){return pt(W()-e+4)}function jr(e,t){return ht(W()-e+4,t)}function xt(e){return pt(W()-e+5)}function Vr(e,t){return ht(W()-e+5,t)}function $t(e){return pt(W()-e+0)}function Qn(e,t){return ht(W()-e+0,t)}function Ct(e){return pt(W()-e+1)}function Yn(e,t){return ht(W()-e+1,t)}function _r(e){return pt(W()-e+2)}function Pr(e,t){return ht(W()-e+2,t)}function Ar(e){return pt(W()-e+3)}function Ir(e,t){return ht(W()-e+3,t)}function Xn(n,o,u){var t,e,s,r,a,i;for(s=d(n),t=n.wordsAsInt32Array(),r=0,e=0;s-1>=e;e++){if(a=Tt(e,t),i=Fr(e,t),!(i>=0&&o>=i))return!1;r+=a}return r===u}function Ch(r){var i,n,t,s;if(!e.isWords(r))return!1;for(s=d(r),n=r.wordsAsInt32Array(),t=0;s-1>=t;t++)if(i=n[t],!E(i))return!1;return!0}function Ah(r,a){var e,i,t,n,s;for(i=d(r),n=r.wordsAsInt32Array(),t=0,e=0;i-1>=e;e++)s=Tt(e,n),t+=s;return t===a}function Ih(r,i){var t;return e.isWords(r)?(t=d(r),t!==3*i&&t!==6*i?!1:!0):!1}function Fh(i,e,n,s,a,o,r){var t;return Ih(i,e)&&Ch(r)?(t=d(r),Xn(n,t,e)&&Xn(s,t,e)&&Xn(o,t,e)&&Ah(a,e)?!0:!1):!1}function yh(e){var t;return t=Gt(e)?un(e):0,qi(e)+t<Qr()?0:I(e)-t>=it()&&Ni(e)-t>=it()?0:void yn(e)}function Xf(e){return Fu(e)?Nf(e):Hf(e)?yh(e):void yn(e)}function Nf(e){var t;return t=Gt(e)?fi(e):0,Vi(e)+t<Qr()?0:I(e)-t>=it()&&Ns(e)-t>=it()?0:void yn(e)}function Wn(){var e=[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1];return e}function Rn(){var e=[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0];return e}function Ot(e,t){return 0>e?0:e>=t?t-1:e}function di(){var e,t;for(e=n(Wi(),b()),t=n(Ur(),b())+1,0>e&&(e=0),t>St()&&(t=St());t>e;)u[e]=0,++e;zi(St()),Kr(0)}function Tn(){return t[mo]}function Et(e){return t[mo]=e}function Rt(){return t[vo]}function jn(e){return t[vo]=e}function xn(){return t[go]}function Wa(e){return t[go]=e}function Kt(){return t[bo]}function An(e){return t[bo]=e}function In(){return t[ko]}function Ia(e){return t[ko]=e}function $r(){return su(t,Pf)}function Fa(e){return V(Y,e+nl)}function Oa(e,s){var f,o,u,n,t,l,a,c,r,m,h,d,p;return u=m=$t(e),n=h=Ct(e),l=d=_r(e),a=p=Ar(e),f=Dt(e),o=xt(e),c=u+=(d-m)*s|0,r=n+=(p-h)*s|0,l+=(f-d)*s|0,a+=(o-p)*s|0,c+=(l-u)*s|0,r+=(a-n)*s|0,n=ns(n,h,r),a=ns(a,r,o),t=Ji(),i?0:(Pr(e,u),Ir(e,n),jr(e,c),Vr(e,r),Qn(t,c),Yn(t,r),Pr(t,l),Ir(t,a),jr(t,f),Vr(t,o),t)}function Sa(e){var l,c,n,s,t,o,a,u,r,d,p,f,h;return t=Ji(),i?0:(n=d=$t(e),s=p=Ct(e),o=f=_r(e),a=h=Ar(e),l=Dt(e),c=xt(e),n+=f-d>>1,s+=h-p>>1,u=o+=l-f>>1,r=a+=c-h>>1,u+=n-o>>1,r+=s-a>>1,Pr(e,n),Ir(e,s),jr(e,u),Vr(e,r),Qn(t,u),Yn(t,r),Pr(t,o),Ir(t,a),jr(t,l),Vr(t,c),t)}function ya(r,i){var e,t,n;e=K(r)[D]>>8,t=et(r)[D]>>8,e>t&&(n=e,e=t,t=n),U(r,e),t-e>i?ln(r,t-e):ln(r,i)}function yc(e){return 32>e?Wc()[e]:Math.sqrt(e)+.5|0}function kc(e,t,r){return xr||gi()?xr(e,t,r):!1}function Xl(){var t,e;for(e=0,t=w;t>e;)$f(e)&&(Q(e)>=Ri()||Xf(e)),e+=Uu(e)}function y(){return t[Co]}function Ht(e){return t[Co]=e}function bn(){return t[_o]}function Js(e){return t[_o]=e}function vn(){return t[xo]}function dl(e){return t[xo]=e}function dn(){return t[Vo]}function Du(e){return t[Vo]=e}function cn(i){var e,t,r;return e=n(Wi(),b()),e<Kt()&&(e=Kt()),t=n(Ur()+A()-1,b()),t>Rt()&&(t=Rt()),r=n(i,b()),r<In()||r>=xn()||t<Kt()||e>=Rt()?0:void kc(e,t,r)}function oi(e){return G(e,H(e)|gn)}function li(e){return G(e,H(e)&~gn)}function Pu(e){return s(e,ua)}function on(e,t){return a(e,ua,t)}function ft(e){return s(e,ca)}function J(e,t){return a(e,ca,t)}function mu(e){return s(e,la)}function an(e,t){return a(e,la,t)}function sn(){return su(t,Rf)}function gh(e){return H(e)>>>1}function I(e){return s(e,Ca)}function U(e,t){return a(e,Ca,t)}function Q(e){return s(e,_a)}function hr(e,t){return a(e,_a,t)}function Hi(e){return s(e,xa)}function ti(e,t){return a(e,xa,t)}function dr(){}function fo(n,i){var e,r,t;for(e=Yr(),r=n,t=nn();i>t;){if(e=Yr(),0!==e&&cs(e,r,t))return!0;Zr(t),r=t,t=nn()}return e=Yr(),0!==e?cs(e,r,i):!1}function jf(){return cf(Lr(),Vt(),Bt(),y())}function hf(l,f,h){var a,i,c,o,r,s,t,e;if(t=f,e=h,i=-1,1===A())for(;e>t;)r=0|l[++i],u[t]=r,++t;else for(c=L(),o=tt(),a=b();e>t;)s=n(t,a),r=0|l[++i],r=n(r&c,o),u[s]=u[s]+r,++t;e>Ur()&&Kr(e),e>Hr()&&wr(e)}function cf(e,c,b,k){var h,s,a,p,l,n,f,i,d,v,m,o,g,r,t;if(1!==A())return lf(e,c,b,k);if(h=Pa(e),!h)return null;for(a=hu(e),s=pu(e),m=1===du(e),p=c-bt(e),l=k-ai(e),f=mi(e),d=Ti(e),n=p*f+l*Si(e),i=p*d+l*Bi(e),o=c,g=b;g>o;)m&&(n=yt(n,a<<16),i=yt(i,s<<16)),r=n>>16,t=i>>16,m||(r=Ot(r,a),t=Ot(t,s)),r>=0&&t>=0&&a>r&&s>t&&(v=Gr(e,h,r,t),u[o]=v),n+=f,i+=d,++o}function lf(r,k,O,C){var P,y,g,l,o,p,h,w,S,s,v,i,m,a,I,f,F,d,c,t,e;if(g=Pa(r),!g)return null;for(o=hu(r),l=pu(r),d=1===du(r),w=k-bt(r),S=C-ai(r),v=mi(r),m=Ti(r),s=w*v+S*Si(r),i=w*m+S*Bi(r),P=A(),I=Nr(k,O),F=Br(k,O),y=b(),p=L(),h=tt(),c=k;I>c;)d&&(s=yt(s,o<<16),i=yt(i,l<<16)),t=s>>16,e=i>>16,d||(t=Ot(t,o),e=Ot(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Gr(r,g,t,e),a=n(a&p,h),f=n(c,y),u[f]=u[f]+a),s+=v,i+=m,++c;for(p=4042322160|n(L(),b()),h=b();F>c;)d&&(s=yt(s,o<<16),i=yt(i,l<<16)),t=s>>16,e=i>>16,d||(t=Ot(t,o),e=Ot(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Gr(r,g,t,e),a=n(a&p,h),f=n(c,y),u[f]=u[f]+a),s+=q(v,h),i+=q(m,h),c+=P;for(p=L(),h=tt();O>c;)d&&(s=yt(s,o<<16),i=yt(i,l<<16)),t=s>>16,e=i>>16,d||(t=Ot(t,o),e=Ot(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Gr(r,g,t,e),a=n(a&p,h),f=n(c,y),u[f]=u[f]+a),s+=v,i+=m,++c}function kr(t,i,n){var e,r;if(1!==A())return sf(t,i,n);for(e=i,r=n;r>e+4;)u[e]=t,u[e+1]=t,u[e+2]=t,u[e+3]=t,e+=4;for(;r>e;)u[e]=t,++e}function sf(l,a,i){var f,s,h,o,t,c,r,e;if(o=Nr(a,i),c=Br(a,i),f=A(),s=b(),e=a,o>e)for(r=n(l&L(),tt());o>e;)t=n(e,s),u[t]=u[t]+r,++e;if(c>e)for(h=4042322160|n(L(),b()),r=n(l&h,b());c>e;)t=n(e,s),u[t]=u[t]+r,e+=f;if(i>e)for(r=n(l&L(),tt());i>e;)t=n(e,s),u[t]=u[t]+r,++e}function mi(e){return s(e,Ba)}function rf(e,t){return a(e,Ba,t)}function Si(e){return s(e,Na)}function tf(e,t){return a(e,Na,t)}function Xc(){return Zc(Lr(),Vt(),Bt(),y())}function Zc(r,c,f,h){var n,s,o,e,i,t,l,a;for(o=Ai(r),i=Er(r),s=mi(r),n=(c-bt(r))*s+(h-ai(r))*Si(r),t=l=c,a=f;((e=n>>16)<0||e>=i)&&a>t;)++t,n+=s;if(t>l&&(0>e&&(e=0),e>=i&&(e=i-1),kr(o[e],l,t)),1===A())for(;(e=n>>16)<i&&e>=0&&a>t;)u[t]=o[e],++t,n+=s;else t=Jc(r,o,n,s,t,f);a>t&&(0>e&&(e=0),e>=i&&(e=i-1),kr(o[e],t,a))}function Jc(y,d,k,v,h,l){var g,c,o,a,i,p,s,m,e,f,r,t;for(g=A(),c=b(),f=Er(y),i=k,t=h,e=i>>16,p=Nr(h,l),m=Br(h,l),o=L(),a=tt();p>t&&f>e&&e>=0;){for(r=d[e],r=n(r&o,a);p>t&&i>>16===e;)s=n(t,c),u[s]=u[s]+r,++t,i+=v;e=i>>16}for(o=4042322160|n(L(),b()),a=b();m>t&&f>e&&e>=0;){for(r=d[e],r=n(r&o,a);m>t&&i>>16===e;)s=n(t,c),u[s]=u[s]+r,t+=g,i+=q(v,a);e=i>>16}for(o=L(),a=tt();l>t&&f>e&&e>=0;){for(r=d[e],r=n(r&o,a);l>t&&i>>16===e;)s=n(t,c),u[s]=u[s]+r,++t,i+=v;e=i>>16}return t}function it(){return t[jo]}function Kc(e){return t[jo]=e}function Ri(){return t[qo]}function Dc(e){return t[qo]=e}function Ei(){return t[Mo]}function Fc(e){return t[Mo]=e}function Qr(){return t[Bo]}function el(e){return t[Bo]=e}function Ti(e){return s(e,Ta)}function Gu(e,t){return a(e,Ta,t)}function Bi(e){return s(e,La)}function Vu(e,t){return a(e,La,t)}function bt(e){return s(e,Da)}function Th(e,t){return a(e,Da,t)}function ai(e){return s(e,Ea)}function xh(e,t){return a(e,Ea,t)}function Ph(f,l,a,m,p,h,d){var t,i,s,c,e,o,r,n;for(t=0|a[0],i=0|a[1],e=ki(t>>16,i>>16),o=l[e],s=(e-1)*(e-1),r=h,n=d,n>bt(f)&&(n=bt(f));n>r;){for(;n>r&&x(t>>16,i>>16)>=s;)u[r]=o,++r,t+=m,i+=p;for(c=x(t>>16,i>>16);s>c;)--e,o=l[e],s=(e-1)*(e-1)}return a[0]=t,a[1]=i,r}function Oh(F,h,m,k,S,y,O){var w,p,c,a,i,s,v,l,g,o,d,t,e,r,f;if(i=0|m[0],s=0|m[1],w=A(),p=b(),t=ki(i>>16,s>>16),o=(t-1)*(t-1),r=y,f=bt(F),f>O&&(f=O),v=Nr(y,f),g=Br(y,f),v>r)for(c=L(),a=tt(),e=h[t],e=n(e&c,a);v>r;){for(;v>r&&x(i>>16,s>>16)>=o;)l=n(r,p),u[l]=u[l]+e,++r,i+=k,s+=S;for(d=x(i>>16,s>>16);o>d;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}if(g>r)for(c=4042322160|n(L(),b()),a=b(),e=h[t],e=n(e&c,a);g>r;){for(;g>r&&x(i>>16,s>>16)>=o;)l=n(r,p),u[l]=u[l]+e,r+=w,i+=q(k,a),s+=q(S,a);for(d=x(i>>16,s>>16);o>d;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}if(f>r)for(c=L(),a=tt(),e=h[t],e=n(e&c,a);f>r;){for(;f>r&&x(i>>16,s>>16)>=o;)l=n(r,p),u[l]=u[l]+e,++r,i+=k,s+=S;for(d=x(i>>16,s>>16);o>d;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}return m[0]=i,m[1]=s,r}function wf(){return of(Lr(),Vt(),Bt(),y())}function of(t,c,p,v){var s,d,h,l,o,f,a,m,n,u,e,i;for(n=Ai(t),u=Er(t),d=c-bt(t),h=v-ai(t),o=mi(t),a=Ti(t),l=d*o+h*Si(t),f=d*a+h*Bi(t),e=c,i=p,m=(u-1)*(u-1);x(l>>16,f>>16)>=m&&i>e;)++e,l+=o,f+=a;e>c&&kr(n[u-1],c,e),s=r(),s[0]=l,s[1]=f,e<bt(t)&&(e=1===A()?Ph(t,n,s,o,a,e,i):Oh(t,n,s,o,a,e,i)),i>e&&(e=1===A()?Ju(t,n,s,o,a,e,i):Ku(t,n,s,o,a,e,i)),p>e&&kr(n[u-1],e,p)}function Ju(g,h,n,v,m,p,d){var r,t,a,f,s,e,l,o,i,c;for(r=0|n[0],t=0|n[1],e=ki(r>>16,t>>16),o=h[e],l=Er(g),f=(l-1)*(l-1),s=(e+1)*(e+1),a=x(r>>16,t>>16),i=p,c=d;c>i&&f>a;){for(;c>i&&x(r>>16,t>>16)<=s;)u[i]=o,++i,r+=v,t+=m;for(a=x(r>>16,t>>16);a>s;)++e,o=h[e],s=(e+1)*(e+1)}return n[0]=r,n[1]=t,i}function Ku(I,d,k,O,y,S,p){var F,g,f,o,i,a,m,c,s,v,h,l,t,w,e,r;if(i=0|k[0],a=0|k[1],F=A(),g=b(),t=ki(i>>16,a>>16),w=Er(I),h=(w-1)*(w-1),l=(t+1)*(t+1),s=x(i>>16,a>>16),r=S,m=Nr(S,p),v=Br(S,p),m>r&&h>s)for(f=L(),o=tt(),e=d[t],e=n(e&f,o);m>r&&h>s;){for(;m>r&&x(i>>16,a>>16)<=l;)c=n(r,g),u[c]=u[c]+e,++r,i+=O,a+=y;for(s=x(i>>16,a>>16);s>l;)++t,e=d[t],e=n(e&f,o),l=(t+1)*(t+1)}if(v>r&&h>s)for(f=4042322160|n(L(),b()),o=b(),e=d[t],e=n(e&f,o);v>r&&h>s;){for(;v>r&&x(i>>16,a>>16)<=l;)c=n(r,g),u[c]=u[c]+e,r+=F,i+=q(O,o),a+=q(y,o);for(s=x(i>>16,a>>16);s>l;)++t,e=d[t],e=n(e&f,o),l=(t+1)*(t+1)}if(p>r&&h>s)for(f=L(),o=tt(),e=d[t],e=n(e&f,o);p>r&&h>s;){for(;p>r&&x(i>>16,a>>16)<=l;)c=n(r,g),u[c]=u[c]+e,++r,i+=O,a+=y;for(s=x(i>>16,a>>16);s>l;)++t,e=d[t],e=n(e&f,o),l=(t+1)*(t+1)}return k[0]=i,k[1]=a,r}function vs(t,r){var e;return e=Wt(t)-Wt(r),0!==e?e>0:zt(t)>>>0<zt(r)>>>0}function cs(r,n,s){var i,t,e;if(0===r)return!1;if(t=n<Hr()?Hr():n,e=s>q(St(),b())?q(St(),b()):s,t<Ei()&&(t=Ei()),e>it()&&(e=it()),t<Wi()&&zi(t),e>Ur()&&Kr(e),e>Hr()&&wr(e),t>=e)return!1;if(vi(r))kr(r,t,e);else{if(zu(r),Hu(t),Zu(e),i=vh(r),1>=i)return!0;switch(i){case 0:case 1:dr();break;case 2:Xc();break;case 3:wf();break;case 4:case 5:jf()}}return!1}function vh(e){return(H(e)&ba)>>>8}function xi(){var e,t,r;for(r=y();X()<z();){if(e=M[X()],Q(e)>r)return!1;if(t=H(e),(t&ii)===wn)return!0;if(!Z(1))return!1;switch(t){case 0:case 1:case 2:case 3:dr();break;case 4:vf();break;case 5:yf();break;case 6:pf();break;case 7:bf()}is(e),yi(X()+1)}return!1}function Pi(){var t,r,n,e;for(r=e=it();P()<T();){if(t=n=k[P()],r=e=I(t),r>=it())return!1;if(Zr(r),Gt(t)&&Zf(t),Xu(t)&&(Jf(t),i))return!1;ot(P()+1),P()<T()&&(n=k[P()],e=I(n),e>=Ei()&&fo(r,e))}return e<it()&&fo(e,it()),!1}function Ii(){for(var t,e,r;P()<T();)if(e=k[P()],t=ft(e)-1,0===t)Ls();else{if(J(e,t),r=H(e),(r&ii)===wn)return!0;switch(r){case 0:case 1:case 2:case 3:dr();break;case 4:If();break;case 5:xf();break;case 6:Of();break;case 7:Cf()}Xs(),ot(P()+1)}return!1}function Ds(t,r){var e;for(e=0;e<_()&&(zt(e)!==t||Wt(e)!==r);)e+=N();return e>=_()?-1:e}function Rr(){return Nt()===Xt}function fu(){Sh(N())}function qu(){return Wh}function er(t,r){var e;return t===r?!0:(e=Q(t)-Q(r),0!==e?0>e:(e=I(t)-I(r),0>e))}function X(){return t[No]}function yi(e){return t[No]=e}function z(){return t[To]}function hn(e){return t[To]=e}function Er(e){return s(e,Ra)}function qf(e,t){return a(e,Ra,t)}function Ai(e){return V(Y,e+Uc)}function bi(){return 0!==tl()}function tl(){return t[Lo]}function Ci(e){return t[Lo]=e}function Bf(){return 0!==Lf()}function Lf(){return t[Do]}function _i(e){return t[Do]=e}function oa(s,a){var e,r,i,n,t;if(e=Ds(s,a),-1===e)return!1;if(0===e)return fu(),!0;if(gr(e,zt(0)),yr(e,Wt(0)),Zt(e,pi(0)),fu(),_()<=N())return!0;for(t=0,e=N();e<_();)vs(e,t)&&(t=e),e+=N();return t+N()===_()?!0:(n=zt(t),gr(t,tn()),rn(n),r=Wt(t),yr(t,Yi()),Qi(r),i=pi(t),Zt(t,$i()),en(i),!0)}function h(e,r){return t[e]=t[e]+r}function Sc(r){var e,t;for(t=I(r),e=0;e<T()&&I(k[e])<t;)++e;for(;e<T()&&I(k[e])===t&&er(k[e],r);)++e;return e}function Rc(){var e;e=$r(),e[0]=1,e[1]=0,e[2]=1,e[3]=0,e[4]=1,e[5]=0,e[6]=1,e[7]=0,Ci(0)}function Qc(){var e;e=sn(),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,_i(0)}function gi(){return Dr=e.ioLoadFunctionFrom("loadBitBltFrom",Or),xr=e.ioLoadFunctionFrom("copyBitsFromtoat",Or),!!Dr&&!!xr}function cu(){return Ys(A()),Kt()<0&&An(0),Rt()>St()&&jn(St()),Fc(q(Kt(),b())),el(q(In(),b())),Kc(q(Rt(),b())),Dc(q(xn(),b())),hn(0),zr(0),M=V(Y,w),k=V(Y,w),Xl(),i?null:0===z()?(Ht(Ri()),0):(zc(),Ht(Q(M[0])),y()<Qr()&&Ht(Qr()),zi(0),Kr(q(St(),b())-1),void di())}function is(e){var t;return ft(e)<=0?null:(t=Sc(e),void zf(e,t))}function zf(r,t){var e;if(!au(1))return null;for(e=T()-1;!(t>e);)k[e+1]=k[e],--e;k[t]=r,zr(T()+1)}function Hf(e){return(H(e)&ii)===pa}function $f(e){var t;return t=H(e),t>va?!1:0!==(H(e)&va)}function nh(e){return vi(e)||ju(e)}function vi(e){return 0!==(4278190080&e)}function E(e){return 0===e||vi(e)||Iu(e)&&nh(e)}function Fu(e){return(H(e)&ii)===ka}function Iu(e){return e>=0&&w>e}function ju(e){return 0!==(H(e)&ba)}function Gt(e){return 0!==(H(e)&vc)}function Nu(){return t[Eo]}function Lu(e){return t[Eo]=e}function Lr(){return t[Ro]}function zu(e){return t[Ro]=e}function Vt(){return t[Wo]}function Hu(e){return t[Wo]=e}function Bt(){return t[zo]}function Zu(e){return t[zo]=e}function Ns(e){return s(e,za)}function hc(e,t){return a(e,za,t)}function Vi(e){return s(e,Ka)}function Ic(e,t){return a(e,Ka,t)}function Pc(e){return s(e,Ga)}function Cc(e,t){return a(e,Ga,t)}function xc(e){return s(e,Ha)}function Bc(e,t){return a(e,Ha,t)}function Ec(e){return s(e,Ua)}function ea(e,t){return a(e,Ua,t)}function ji(e){return s(e,eo)}function $c(e,t){return a(e,eo,t)}function Jt(e){return s(e,to)}function mf(e,t){return a(e,to,t)
}function gf(e,t){return a(e,uf,t)}function ci(s,a,o,l){var e,u,t,n,r;if(e=Ji(),i)return 0;for(Qn(e,s[0]),Yn(e,s[1]),Pr(e,a[0]),Ir(e,a[1]),jr(e,o[0]),Vr(e,o[1]),r=u=Kf(e,l),t=e;u>=t;t+=6)if(n=Xi(t),n>r&&(r=n),i)return 0;return wt(r,6)}function Ff(u,c,f,h,d){var t,n,s,a,o;if(F(r(),e.fetchPointerofObject(0,u)),e.failed())return null;for(n=r()[0],a=r()[1],t=1;c-1>=t;t++){if(F(r(),e.fetchPointerofObject(t,u)),e.failed())return null;if(s=r()[0],o=r()[1],r()[0]=n,r()[1]=a,l()[0]=s,l()[1]=o,at(2),ct(h,r(),l(),d,f,0),i)return null;n=s,a=o}}function Af(s,g,d,a,o){var t,n,v,h,c,p,m,u,f;for(t=0;g-1>=t;t++){if(n=e.fetchPointerofObject(3*t,s),F(r(),n),n=e.fetchPointerofObject(3*t+1,s),F(l(),n),n=e.fetchPointerofObject(3*t+2,s),F(S(),n),e.failed())return null;if(at(3),h=r()[0],m=r()[1],c=l()[0],u=l()[1],p=S()[0],f=S()[1],h===m&&c===u||c===p&&u===f)ct(a,r(),S(),o,d,0);else{if(v=ci(r(),l(),S(),0!==a&&0!==o),i)return null;ui(a,o,d,0,v)}if(i)return null}}function _f(i,n,s){var r,t;for(r=0;s-1>=r;r++){if(t=e.fetchPointerofObject(r,i),"number"!=typeof t&&!t.isFloat)return e.primitiveFail();n[r]="number"==typeof t?t:e.floatValueOf(t)}}function Vf(e,t,i,n,r){xt(t)>=Ct(t)?(U(e,$t(t)),hr(e,Ct(t)-r),iu(e,_r(t)),Gs(e,Ar(t)-r),es(e,Dt(t)),Xo(e,xt(t)-r)):(U(e,Dt(t)),hr(e,xt(t)-r),iu(e,_r(t)),Gs(e,Ar(t)-r),es(e,$t(t)),Xo(e,Ct(t)-r)),ti(e,bn()),on(e,i),an(e,n)}function da(e){return Dr||gi()?Dr(e):!1}function Mf(n,u,k,b,g,v,m){var l,p,t,r,o,f,a,h,s,c;if(u.isNil)s=0,h=null;else{if(st(u)!==e.classBitmap())return e.primitiveFail();s=d(u),h=u.wordsAsInt32Array()}return"number"==typeof n?e.primitiveFail():e.isPointers(n)?d(n)<5?e.primitiveFail():(l=e.fetchPointerofObject(0,n),st(l)!==e.classBitmap()?e.primitiveFail():(p=d(l),a=e.fetchIntegerofObject(1,n),o=e.fetchIntegerofObject(2,n),t=e.fetchIntegerofObject(3,n),e.failed()?null:a>=0&&o>=0?32!==t&&8!==t&&16!==t&&1!==t&&2!==t&&4!==t?e.primitiveFail():0!==s&&s!==q(1,t)?e.primitiveFail():(c=wt(32,t),f=wt(a+(c-1),c),p!==f*o?e.primitiveFail():(r=df(s,h),i?null:(qh(r,a),El(r,o),mh(r,t),af(r,f),Rh(r,p),Nh(r,k),nt(r,m),ho(r,b,g,v,a,o),r))):e.primitiveFail())):e.primitiveFail()}function Pa(i){var n,t,s,r;return r=ri(i),r>d(Tr)?null:(s=e.fetchPointerofObject(r,Tr),t=e.fetchPointerofObject(0,s),n=d(t),n!==Kh(i)?null:t.wordsAsInt32Array())}function Tf(r){var t,e;return e=$r(),Ci(0),(t=Io(r,e,8))?(Ci(1),e[1]=256*e[1],e[3]=256*e[3],e[5]=256*e[5],e[7]=256*e[7],t):!1}function qa(g,e,v,p,d,h,f){var t,m,a,u,s,n,c,o;return p!==d||0!==h&&0!==f?(t=6*g,v?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+0],n=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+1],u=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+2],c=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+3],s=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+4],o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+5]):(a=0|e[t+0],n=0|e[t+1],u=0|e[t+2],c=0|e[t+3],s=0|e[t+4],o=0|e[t+5]),a===u&&n===c||u===s&&c===o?a===s&&n===o?null:(r()[0]=a,r()[1]=n,l()[0]=s,l()[1]=o,at(2),ct(h,r(),l(),f,p,d)):(r()[0]=a,r()[1]=n,l()[0]=u,l()[1]=c,S()[0]=s,S()[1]=o,at(3),m=ci(r(),l(),S(),0!==h&&0!==f),i?null:void ui(h,f,p,d,m))):null}function Df(S,v,k,b,g,m,p,y){var l,f,u,t,d,o,n,c,s,e,h,a,r;if(0===v)return 0;for(u=s=a=o=-1,f=c=h=d=1,t=e=r=n=0,l=1;v>=l;l++){if(--f<=0&&(++u,f=Tt(u,k),t=Fr(u,k),0!==t&&(t=p[t-1],t=j(t),i)))return null;if(--c<=0&&(++s,c=Tt(s,b),e=Fr(s,b),0!==e&&(e=p[e-1],e=j(e))),--h<=0&&(++a,h=Tt(a,g),r=Fr(a,g),0!==r&&(r=cr(r))),--d<=0&&(++o,d=Tt(o,m),n=Fr(o,m),0!==n&&(n=p[n-1])),qa(l-1,S,y,t,e,r,n),i)return null}}function lo(r){var t;return t=Nu(),d(r)<fn?null:(U(t,e.fetchIntegerofObject(bs,r)),hr(t,e.fetchIntegerofObject(ks,r)),ti(t,e.fetchIntegerofObject(ys,r)),J(t,e.fetchIntegerofObject(gs,r)),t)}function Uf(i){var r,t;return _i(0),t=sn(),r=Io(i,t,6),e.failed()?null:r?(_i(1),t[2]=t[2]+vn(),t[5]=t[5]+dn(),!0):!1}function ho(i,e,t,r,m,p){var a,o,l,c,f,s,h,d,n,u;t[0]=t[0]+e[0],t[1]=t[1]+e[1],r[0]=r[0]+e[0],r[1]=r[1]+e[1],At(e),At(t),At(r),a=t[0]-e[0],o=t[1]-e[1],n=r[0]-e[0],u=r[1]-e[1],l=a*a+o*o,l>0?(c=a*m*65536/l|0,f=o*m*65536/l|0):(c=0,f=0),s=n*n+u*u,s>0?(h=n*p*65536/s|0,d=u*p*65536/s|0):(h=0,d=0),Th(i,e[0]),xh(i,e[1]),rf(i,c),tf(i,f),Gu(i,h),Vu(i,d)}function po(o){var i,u,l,n,c,s,t,r,a;if(!e.isArray(o))return!1;for(Tr=o,r=0;r<=d(Tr)-1;r++){if(t=e.fetchPointerofObject(r,Tr),"number"==typeof t)return!1;if(!e.isPointers(t))return!1;if(d(t)<5)return!1;if(i=e.fetchPointerofObject(0,t),st(i)!==e.classBitmap())return!1;if(u=d(i),s=e.fetchIntegerofObject(1,t),n=e.fetchIntegerofObject(2,t),l=e.fetchIntegerofObject(3,t),e.failed())return!1;if(!(s>=0&&n>=0))return!1;if(a=wt(32,l),c=wt(s+(a-1),a),u!==c*n)return!1}return!0}function eh(r,s,a,o,u){var n,t;return st(r)!==e.classBitmap()?e.primitiveFail():(t=d(r),n=nf(r.wordsAsInt32Array(),t,u),i?null:(ho(n,s,a,o,t,t),n))}function th(e,i,n,a,o,u){var t,r,s;i[1]<=n[1]?(t=i,r=n,s=1):(t=n,r=i,s=-1),U(e,t[0]),hr(e,t[1]-a),ti(e,bn()),on(e,o),an(e,u),hc(e,r[0]),Ic(e,r[1]-a),gf(e,s)}function rh(t,n,f,h){var s,a,o,e,u,c;for(c=l()[0]-r()[0]>>1,o=l()[1]-r()[1]>>1,s=l()[0]+r()[0]>>1,a=l()[1]+r()[1]>>1,e=0;15>=e;e++){if(ih(e,c,o,s,a),at(3),u=ci(r(),l(),S(),0!==t&&0!==n),i)return null;if(ui(t,n,f,h,u),i)return null}}function ih(e,a,f,n,s){var h,t,u,c,i,o;h=Wn()[2*e+0]*a+n|0,c=Rn()[2*e+0]*f+s|0,r()[0]=h,r()[1]=c,u=Wn()[2*e+2]*a+n|0,o=Rn()[2*e+2]*f+s|0,S()[0]=u,S()[1]=o,t=Wn()[2*e+1]*a+n|0,i=Rn()[2*e+1]*f+s|0,t=2*t-(h+u>>1),i=2*i-(c+o>>1),l()[0]=t,l()[1]=i}function F(i,r){var t;return st(r)!==e.classPoint()?e.primitiveFail():(t=e.fetchPointerofObject(0,r),"number"==typeof t||t.isFloat?(i[0]="number"==typeof t?t:0|e.floatValueOf(t),t=e.fetchPointerofObject(1,r),"number"==typeof t||t.isFloat?void(i[1]="number"==typeof t?t:0|e.floatValueOf(t)):e.primitiveFail()):e.primitiveFail())}function sh(e,c,d,h,f,u){var t,a,s,n,o;for(u?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[0],n=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[1]):(a=0|e[0],n=0|e[1]),t=1;c-1>=t;t++){if(u?(s=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*t],o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*t+1]):(s=0|e[2*t],o=0|e[2*t+1]),r()[0]=a,r()[1]=n,l()[0]=s,l()[1]=o,at(2),ct(h,r(),l(),f,d,0),i)return null;a=s,n=o}}function ph(e,t,i,n){ct(e,r(),l(),t,i,n),ct(e,l(),S(),t,i,n),ct(e,S(),Cr(),t,i,n),ct(e,Cr(),r(),t,i,n)}function Oo(){var i,t,n,r;return 2!==e.methodArgumentCount()?c:0!==(t=R(e.stackValue(2)))?t:(n=e.stackObjectValue(0),i=e.stackObjectValue(1),e.failed()?f:0!==(t=Mr(e.fetchPointerofObject(nr,o)))?t:da(e.fetchPointerofObject(ds,o))?po(e.fetchPointerofObject(ps,o))?d(i)<fn?kn:d(n)<wi?sa:(r=Nt(),r===rr||r===ir||r===tr?Sn:0):aa:Qs)}function kh(t,r,n,s,a,o){var e;for(e=1;r>=e;e++)if(qa(e-1,t,o,n,0,s,a),i)return null}function Mr(t){return st(t)!==e.classBitmap()?$s:(u=t.words,Yc(d(t)-1),0)}function Io(t,i,r){return t.isNil?!1:"number"==typeof t?e.primitiveFail():d(t)!==r?e.primitiveFail():(e.isWords(t)?jh(t,i,r):_f(t,i,r),!0)}function ui(t,a,o,u,l){var e,r,s,n;for(0===t||0===a?(n=!1,s=0):(n=!0,s=Pt(t)),r=6*l;r>0;){if(e=n?$u():ah(),i)return 0;Vf(e,r,o,u,s),n&&(ku(e,a),ln(e,t),gu(e,t)),r-=6}vt()}function ct(t,s,a,n,o,u){var e,r;return 0===t||0===n?(e=ef(),r=0):(e=Qu(),r=Pt(t)),i?0:(th(e,s,a,r,o,u),void(Gt(e)&&(xu(e,n),ni(e,t),Cu(e,t))))}function jh(r,i,n){var e,t;for(t=r.wordsAsFloat32Array(),e=0;n-1>=e;e++)i[e]=t[e]}function si(r){return"number"==typeof r?Ul:e.isWords(r)?d(r)<Go?Jl:(fs(r),Eh()!==Uo?Kl:Qt()!==d(r)?Zl:nu()!==fr?Hl:(Y=V(t,nu()),M=V(Y,Mi()),k=V(M,z()),fr+Mi()+z()+T()>Qt()?gt:0)):Gl}function Eh(){return t[Ko]}function vu(e){return t[Ko]=e}function Ou(e){0===strcmp(e,Or)&&(Dr=0,xr=0)}function wu(t,r,i){var e;for(e=t;e>0&&I(k[e-1])>i;)k[e]=k[e-1],--e;k[e]=r}function Z(e){return fr+w+z()+T()+e>$()?(Ft(Tc),!1):!0}function Po(){return 0!==Au()}function Au(){return t[Ho]}function _t(e){return t[Ho]=e}function s(e,t){return Y[e+t]}function a(e,t,r){return Y[e+t]=r}function nu(){return t[Jo]}function Tu(e){return t[Jo]=e}function Mi(){return t[Zo]}function uu(e){return t[Zo]=e}function Ru(e){return s(e,On)}function ri(e){return s(e,fa)}function nt(e,t){return a(e,fa,t)}function Uu(e){return s(e,ha)}function dt(e,t){return a(e,ha,t)}function H(e){return s(e,On)&mc}function G(e,t){return a(e,On,t)}function Pt(e){return e>>1}function r(){return V(t,oh)}function l(){return V(t,uh)}function S(){return V(t,lh)}function Cr(){return V(t,ch)}function Li(){X()>=z()&&0===T()&&v(Xt),y()>=Ri()&&v(Xt)}function rl(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(v(Xt),void g(o))}function il(){var t,r,n;return p&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=O(e.stackValue(1),rr))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=lo(r))?Z(1)?(ft(t)>0&&is(t),i?e.primitiveFailFor(B):(v(lt),g(o),e.pop(1),void(p&&(h(Bn,1),h(Kn,e.ioMicroMSecs()-m))))):e.primitiveFailFor(gt):e.primitiveFailFor(kn))}function sl(){var a,u,t,s,n,h,d;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.positive32BitValueOf(e.stackValue(0)),t=e.positive32BitValueOf(e.stackValue(1)),d=e.stackObjectValue(2),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=O(e.stackValue(5),C))?e.primitiveFailFor(u):E(t)&&E(n)?(F(r(),h),F(l(),d),F(S(),a),e.failed()?e.primitiveFailFor(f):(at(3),s=ci(r(),l(),S(),!1),Z(s*Ut),i||(t=j(t),n=j(n)),i||ui(0,0,t,n,s),i?(vt(),e.primitiveFailFor(B)):e.failed()?e.primitiveFailFor(ut):(g(o),void e.pop(5)))):e.primitiveFailFor(rt))}function al(){var h,s,u,r,t,n,a,l,p;if(5!==e.methodArgumentCount())return e.primitiveFailFor(c);if(r=e.positive32BitValueOf(e.stackValue(0)),t=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),n=e.stackIntegerValue(3),a=e.stackObjectValue(4),e.failed())return e.primitiveFailFor(f);if(0!==(h=O(e.stackValue(5),C)))return e.primitiveFailFor(h);if(u=d(a),e.isWords(a)){if(l=!1,u!==3*n&&u!==6*n)return e.primitiveFailFor(f)}else{if(!e.isArray(a))return e.primitiveFailFor(f);if(u!==3*n)return e.primitiveFailFor(f);l=!0}return p=0===t||0===r?It:sr,Z(p*n)?E(r)&&E(s)?(r=j(r),s=j(s),i?e.primitiveFailFor(B):0!==r&&0!==t||0!==s?(0!==t&&(t=cr(t),1>t&&(t=1)),l?Af(a,n,s,t,r):kh(a.wordsAsInt32Array(),n,s,t,r,3*n===u),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(_t(1),g(o),void e.pop(5))):e.pop(5)):e.primitiveFailFor(rt):e.primitiveFailFor(gt)}function ol(){var n,s,a,u,h,d,p,m,t;return 7!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.stackIntegerValue(0),0>=t?e.primitiveFailFor(f):(d=e.stackObjectValue(1),s=e.stackObjectValue(2),p=e.stackObjectValue(3),m=e.booleanValueOf(e.stackValue(4)),n=e.stackObjectValue(5),h=e.stackObjectValue(6),e.failed()?e.primitiveFailFor(f):0!==(a=O(e.stackValue(7),C))?e.primitiveFailFor(a):(F(r(),p),F(l(),s),F(S(),d),e.failed()?e.primitiveFailFor(Sr):(u=Mf(h,n,m?1:0,r(),l(),S(),t-1),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(g(o),void e.popthenPush(8,e.positive32BitIntegerFor(u)))))))}function ul(){var h,n,s,a,u,t,r,p,l;return 7!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.stackObjectValue(0),a=e.stackObjectValue(1),u=e.stackObjectValue(2),l=e.stackObjectValue(3),s=e.stackObjectValue(4),t=e.stackIntegerValue(5),r=e.stackObjectValue(6),e.failed()?e.primitiveFailFor(f):0!==(h=O(e.stackValue(7),C))?e.primitiveFailFor(h):Fh(r,t,s,l,u,a,n)?Z(Math.max(Ut,It)*t)?(p=d(r)===3*t,Df(r.wordsAsInt32Array(),t,s.wordsAsInt32Array(),l.wordsAsInt32Array(),u.wordsAsInt32Array(),a.wordsAsInt32Array(),n.wordsAsInt32Array(),p),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(_t(1),g(o),void e.pop(7))):e.primitiveFailFor(gt):e.primitiveFailFor(Dl))}function cl(){var t,n,s,a,u,h,d;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(a=e.booleanValueOf(e.stackValue(0)),u=e.stackValue(1),t=e.stackValue(2),h=e.stackValue(3),d=e.stackValue(4),e.failed()?e.primitiveFailFor(f):0!==(n=O(e.stackValue(5),C))?e.primitiveFailFor(n):(F(r(),h),F(l(),t),F(S(),u),e.failed()?e.primitiveFailFor(Sr):(s=eh(d,r(),l(),S(),a),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(g(o),void e.popthenPush(6,e.positive32BitIntegerFor(s))))))}function fl(){var s,a,t,n,u;return 4!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.positive32BitValueOf(e.stackValue(0)),t=e.positive32BitValueOf(e.stackValue(1)),s=e.stackObjectValue(2),u=e.stackObjectValue(3),e.failed()?e.primitiveFailFor(f):0!==(a=O(e.stackValue(4),C))?e.primitiveFailFor(a):E(t)&&E(n)?(F(r(),u),F(l(),s),e.failed()?e.primitiveFailFor(Sr):(at(2),t=j(t),n=j(n),i?e.primitiveFailFor(B):(ct(0,r(),l(),0,t,n),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(g(o),void e.pop(4))))):e.primitiveFailFor(rt))}function hl(){var t,n,a,u,s,h;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.positive32BitValueOf(e.stackValue(0)),n=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=O(e.stackValue(5),C))?e.primitiveFailFor(u):E(t)&&E(s)?(s=j(s),t=j(t),i?e.primitiveFailFor(B):0===s&&(0===t||0>=n)?e.pop(5):Z(16*Ut)?(n=n>0&&0!==t?cr(n):0,F(r(),h),F(l(),a),e.failed()?e.primitiveFailFor(Sr):(rh(n,t,0,s),i?(vt(),e.primitiveFailFor(B)):e.failed()?e.primitiveFailFor(ut):(_t(1),g(o),void e.pop(5)))):e.primitiveFailFor(gt)):e.primitiveFailFor(rt))}function pl(){var h,s,u,t,r,n,a,l,p;if(5!==e.methodArgumentCount())return e.primitiveFailFor(c);if(t=e.positive32BitValueOf(e.stackValue(0)),r=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),n=e.stackIntegerValue(3),a=e.stackObjectValue(4),e.failed())return e.primitiveFailFor(f);if(0!==(h=O(e.stackValue(5),C)))return e.primitiveFailFor(h);if(u=d(a),e.isWords(a)){if(l=!1,u!==n&&2*n!==u)return e.primitiveFailFor(f)}else{if(!e.isArray(a))return e.primitiveFailFor(f);if(u!==n)return e.primitiveFailFor(f);l=!0}return p=0===r||0===t?It:sr,Z(p*n)?E(t)&&E(s)?(t=j(t),s=j(s),i?e.primitiveFailFor(B):0!==t&&0!==r||0!==s?(0!==r&&(r=cr(r)),l?Ff(a,n,s,r,t):sh(a.wordsAsInt32Array(),n,s,r,t,n===u),i?e.primitiveFailFor(B):e.failed()?e.primitiveFailFor(ut):(_t(1),g(o),void e.pop(5))):e.pop(5)):e.primitiveFailFor(rt):e.primitiveFail()}function gl(){var t,n,a,u,s,h;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.positive32BitValueOf(e.stackValue(0)),n=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=O(e.stackValue(5),C))?e.primitiveFailFor(u):E(t)&&E(s)?(t=j(t),s=j(s),i?e.primitiveFailFor(B):0!==s||0!==t&&0!==n?Z(4*It)?(n=n>0&&0!==t?cr(n):0,F(r(),h),F(S(),a),e.failed()?e.primitiveFailFor(Sr):(l()[0]=S()[0],l()[1]=r()[1],Cr()[0]=r()[0],Cr()[1]=S()[1],at(4),ph(n,t,0,s),e.failed()?e.primitiveFailFor(ut):(_t(1),g(o),void e.pop(5)))):e.primitiveFailFor(gt):e.pop(5)):e.primitiveFailFor(rt))}function bl(){var t,r,i;return p&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(i=O(e.stackValue(1),tr))?e.primitiveFailFor(i):(r=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=lo(r))?(0===ft(t)?Ls():(Xs(),ot(P()+1)),v(qt),g(o),e.pop(1),void(p&&(h(Nn,1),h(Un,e.ioMicroMSecs()-m)))):e.primitiveFailFor(kn))}function kl(){var o,n,s,i,u,r,a,l;if(2!==e.methodArgumentCount())return e.primitiveFailFor(c);if(n=e.stackValue(0),o=e.stackValue(1),0!==(u=si(o)))return e.primitiveFailFor(u);if(st(o)!==st(n))return e.primitiveFailFor($s);if(s=d(n)-d(o),0>s)return e.primitiveFailFor(zl);for(a=t,i=n.wordsAsInt32Array(),r=0,l=$()-1;l>=r;r++)i[r]=a[r];for(i[Mn]=$()+s,i[zn]=Qt()+s,a=V(a,$()),i=V(i,$()+s),r=0,l=Qt()-$()-1;l>=r;r++)i[r]=a[r];return 0!==(u=si(n))?e.primitiveFailFor(u):void e.pop(2)}function yl(){var t;return p&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(0),Yt))?e.primitiveFailFor(t):0!==(t=Mr(e.fetchPointerofObject(nr,o)))?e.primitiveFailFor(t):da(e.fetchPointerofObject(ds,o))?((y()&mt())===mt()&&(cn(y()),Li()),Rr()||(ot(0),Ht(y()+1),v(qt)),g(o),void(p&&(h(ar,1),h(mr,e.ioMicroMSecs()-m)))):e.primitiveFailFor(Qs)}function Sl(){var t,r;r=p,t=e.stackObjectValue(0),t=e.booleanValueOf(t),e.failed()||(p=t,e.pop(2),e.pushBool(r))}function Ol(){var t,r;return p&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(r=Rr(),g(o),e.pop(1),e.pushBool(r),void(p&&(h(Ln,1),h(Gn,e.ioMicroMSecs()-m))))}function wl(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(A()))}function Fl(){var n,i,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),!e.failed()&&e.isWords(i)&&d(i)>=4?(r=i.wordsAsInt32Array(),r[0]=r[0]+t[Oi],r[1]=r[1]+t[Vn],r[2]=r[2]+t[qn],r[3]=r[3]+t[co],void e.pop(1)):e.primitiveFailFor(f))}function Al(){var i,r,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(i=R(e.stackValue(1)))?e.primitiveFailFor(i):(t=e.stackObjectValue(0),!e.failed()&&e.isPointers(t)&&d(t)>=2?(e.pushRemappableOop(t),r=e.makePointwithxValueyValue(Kt(),In()),e.storePointerofObjectwithValue(0,e.topRemappableOop(),r),r=e.makePointwithxValueyValue(Rt(),xn()),t=e.popRemappableOop(),e.storePointerofObjectwithValue(1,t,r),void e.popthenPush(2,t)):e.primitiveFailFor(f))}function Pl(){var n,i,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),!e.failed()&&e.isWords(i)&&d(i)>=9?(r=i.wordsAsInt32Array(),r[0]=r[0]+t[Dn],r[1]=r[1]+t[Ln],r[2]=r[2]+t[lr],r[3]=r[3]+t[Bn],r[4]=r[4]+t[ur],r[5]=r[5]+t[En],r[6]=r[6]+t[ar],r[7]=r[7]+t[or],r[8]=r[8]+t[Nn],void e.pop(1)):e.primitiveFailFor(f))}function Cl(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(bn()))}function _l(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):(o=e.stackValue(0),"number"==typeof o?e.primitiveFailFor(ta):e.isPointers(o)?d(o)<hs?e.primitiveFailFor(na):0!==(t=si(e.fetchPointerofObject(ms,o)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(Gi())):e.primitiveFailFor(ra))}function Vl(){var t,r;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(r=e.makePointwithxValueyValue(vn(),dn()),void e.popthenPush(1,r))}function jl(){var n,i,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),!e.failed()&&e.isWords(i)&&d(i)>=9?(r=i.wordsAsInt32Array(),r[0]=r[0]+t[Hn],r[1]=r[1]+t[Gn],r[2]=r[2]+t[Wr],r[3]=r[3]+t[Kn],r[4]=r[4]+t[br],r[5]=r[5]+t[Jn],r[6]=r[6]+t[mr],r[7]=r[7]+t[vr],r[8]=r[8]+t[Un],void e.pop(1)):e.primitiveFailFor(f))}function ql(){var i,r;return 1!==e.methodArgumentCount()?e.primitiveFail():(r=e.stackObjectValue(0),e.failed()?null:e.isWords(r)?(i=d(r))<Go?e.primitiveFail():(fs(r),Y=V(t,fr),vu(Uo),bh(i),hi(i),v(C),Tu(fr),uu(4),G(0,ga),dt(0,4),nt(0,0),yi(0),hn(0),ot(0),zr(0),pr(0),_t(0),An(0),jn(0),Ia(0),Wa(0),Js(0),_c(),Qc(),Rc(),e.pop(2),void e.push(r)):e.primitiveFail())}function Ml(){var t;return p&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(0),C))?e.primitiveFailFor(t):0!==(t=Mr(e.fetchPointerofObject(nr,o)))?e.primitiveFailFor(t):(cu(),i?e.primitiveFailFor(B):(v(lt),e.failed()||g(o),void(p&&(h(Dn,1),h(Hn,e.ioMicroMSecs()-m)))))}function Bl(){var i,n,r,t;return p&&(m=e.ioMicroMSecs()),2!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=O(e.stackValue(2),ir))?e.primitiveFailFor(n):0!==(n=Mr(e.fetchPointerofObject(nr,o)))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),i=e.stackObjectValue(1),e.failed()||st(i)!==e.classBitmap()?e.primitiveFailFor(f):d(r)<wi?e.primitiveFailFor(sa):(t=e.fetchIntegerofObject(Os,r),ri(Lr())!==t?e.primitiveFailFor(rt):(t=e.fetchIntegerofObject(Fs,r),Vt()!==t?e.primitiveFailFor(rt):(t=e.fetchIntegerofObject(ws,r),Bt()!==t?e.primitiveFailFor(rt):d(i)<Bt()-Vt()?e.primitiveFailFor(f):e.failed()?null:(hf(i.wordsAsInt32Array(),Vt(),Bt()),v(Mt),g(o),e.pop(2),void(p&&(h(En,1),h(Jn,e.ioMicroMSecs()-m))))))))}function Nl(){var t,r;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(r=Po(),g(o),e.pop(1),void e.pushBool(r))}function Tl(){var t,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(1)))?e.primitiveFailFor(t):(r=e.booleanValueOf(e.stackValue(0)),e.failed()?e.primitiveFailFor(f):(_t(r===!0?1:0),g(o),void e.pop(1)))}function Ll(){var r,i,n,t;return p&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=wc(e.stackValue(1),qt,Xt))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=!1,Nt()!==Xt&&(t=Ii(),t?(r=k[P()],ei(r,i),v(tr)):v(lt)),e.failed()?null:(g(o),e.pop(2),e.pushBool(!t),void(p&&(h(or,1),h(vr,e.ioMicroMSecs()-m))))))}function Rl(){var t,n,r;return p&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(1),Mt))?e.primitiveFailFor(t):0!==(t=Mr(e.fetchPointerofObject(nr,o)))?e.primitiveFailFor(t):po(e.fetchPointerofObject(ps,o))?(0!==Tn()&&(0===(y()&mt())&&di(),Et(0)),n=e.stackObjectValue(0),r=Pi(),i?e.primitiveFailFor(B):(r&&yo(n),e.failed()?e.primitiveFailFor(rt):(r?v(ir):(vt(),wr(0),v(Yt)),g(o),e.pop(2),e.pushBool(!r),void(p&&(h(ur,1),h(br,e.ioMicroMSecs()-m)))))):e.primitiveFailFor(aa)}function Wl(){var r,i,n,t;return p&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=O(e.stackValue(1),lt))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),t=xi(),t&&(r=M[X()],ei(r,i),yi(X()+1)),e.failed()?e.primitiveFailFor(Yl):(t?v(rr):(v(Mt),Et(1),ot(0),vt()),g(o),e.pop(2),e.pushBool(!t),void(p&&(h(lr,1),h(Wr,e.ioMicroMSecs()-m)))))}function $l(){var t,s,a,u,l,h,r,n;return 6!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(s=O(e.stackValue(6),C))?e.primitiveFailFor(s):(n=e.positive32BitValueOf(e.stackValue(0)),r=e.positive32BitValueOf(e.stackValue(1)),h=e.stackIntegerValue(2),l=e.stackIntegerValue(3),u=e.stackIntegerValue(4),a=e.stackIntegerValue(5),e.failed()?e.primitiveFailFor(f):kt(Jr)?E(r)&&E(n)?(t=w,w=t+Jr,G(t,wn),dt(t,Jr),nt(t,a),U(t,u),hr(t,l),ti(t,h),on(t,j(r)),an(t,j(n)),i?e.primitiveFailFor(B):void(e.failed()||(g(o),e.pop(6)))):e.primitiveFailFor(rt):e.primitiveFailFor(gt))}function ec(){var r,t,i;if(1!==e.methodArgumentCount())return e.primitiveFailFor(c);if(0!==(r=O(e.stackValue(1),C)))return e.primitiveFailFor(r);if(i=e.stackIntegerValue(0),e.failed())return e.primitiveFailFor(f);for(t=0;0===t;){if(!kt(Jr))return e.primitiveFailFor(gt);t=w,w=t+Zs,G(t,ga),dt(t,Zs),nt(t,i)}e.failed()||(g(o),e.pop(2),e.pushInteger(t))}function tc(){var t;return 0!==(t=Oo())?e.primitiveFailFor(t):(Ss(),i?Zi():(fc(),void Zi()))}function rc(){var t;return 0!==(t=Oo())?e.primitiveFailFor(t):(Ss(),void Zi())}function ic(){var t,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(1),C))?e.primitiveFailFor(t):(r=e.stackIntegerValue(0),e.failed()?e.primitiveFailFor(f):(Ys(r),g(o),void e.pop(1)))}function nc(){var i,r,t,s;if(t=e.stackValue(0),!e.isBytes(t))return e.primitiveFail();if(i=Uh(t),i>=256)return e.primitiveFail();s=t.bytes,r=!1;var n=t.bytesAsString();return n!==Or&&(Or=n,r=!0),r&&!gi()?e.primitiveFail():void e.pop(1)}function sc(){var i,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(i=O(e.stackValue(1),C))?e.primitiveFailFor(i):(t=e.stackObjectValue(0),!e.failed()&&e.isPointers(t)&&d(t)>=2?(F(r(),e.fetchPointerofObject(0,t)),F(l(),e.fetchPointerofObject(1,t)),e.failed()?e.primitiveFailFor(f):(An(r()[0]),Ia(r()[1]),jn(l()[0]),Wa(l()[1]),g(o),void e.pop(1))):e.primitiveFailFor(f))}function ac(){var t,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(1),C))?e.primitiveFailFor(t):(r=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(Tf(r),e.failed()?e.primitiveFailFor(ut):(g(o),void e.pop(1))))}function uc(){var t,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(r=O(e.stackValue(1),C))?e.primitiveFailFor(r):(t=e.stackIntegerValue(0),e.failed()?e.primitiveFailFor(f):(Js(t),g(o),void e.pop(1)))}function lc(){var t,r;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=O(e.stackValue(1),C))?e.primitiveFailFor(t):(r=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(Uf(r),e.failed()?e.primitiveFailFor(f):(g(o),void e.pop(1))))}function cc(){var i,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(i=O(e.stackValue(1),C))?e.primitiveFailFor(i):(t=e.stackValue(0),st(t)!==e.classPoint()?e.primitiveFailFor(f):(F(r(),t),e.failed()?e.primitiveFailFor(f):(dl(r()[0]),Du(r()[1]),g(o),void e.pop(1))))}function fc(){for(var t;!Rr();){if(p&&(m=e.ioMicroMSecs()),t=xi(),p&&(h(lr,1),h(Wr,e.ioMicroMSecs()-m)),i)return v(lt);if(t)return v(rr),Ft(_n);if(ot(0),vt(),Et(1),p&&(m=e.ioMicroMSecs()),0!==Tn()&&0===(y()&mt())&&di(),Et(0),t=Pi(),p&&(h(ur,1),h(br,e.ioMicroMSecs()-m)),i)return v(Mt);if(t)return v(ir),Ft(Cn);if(vt(),wr(0),p&&(m=e.ioMicroMSecs()),(y()&mt())===mt()&&(cn(y()),Li()),p&&(h(ar,1),h(mr,e.ioMicroMSecs()-m)),i)return v(Yt);if(Rr())return 0;if(ot(0),Ht(y()+1),p&&(m=e.ioMicroMSecs()),t=Ii(),p&&(h(or,1),h(vr,e.ioMicroMSecs()-m)),i)return v(qt);if(t)return v(tr),Ft(Pn)}}function Ss(){var r,t;if(t=Nt(),t===C){if(cu(),i)return 0;t=lt}if(t===lt){if(p&&(m=e.ioMicroMSecs()),r=xi(),p&&(h(lr,1),h(Wr,e.ioMicroMSecs()-m)),i)return v(lt);if(r)return v(rr),Ft(_n);ot(0),vt(),Et(1),t=Mt}if(t===Mt){if(p&&(m=e.ioMicroMSecs()),0!==Tn()&&0===(y()&mt())&&di(),Et(0),r=Pi(),p&&(h(ur,1),h(br,e.ioMicroMSecs()-m)),i)return v(Mt);if(r)return v(ir),Ft(Cn);t=Yt,vt(),wr(0)}if(t===Yt){if(p&&(m=e.ioMicroMSecs()),(y()&mt())===mt()&&(cn(y()),Li()),p&&(h(ar,1),h(mr,e.ioMicroMSecs()-m)),i)return v(Yt);if(Rr())return 0;t=qt,ot(0),Ht(y()+1)}if(t===qt){if(p&&(m=e.ioMicroMSecs()),r=Ii(),p&&(h(or,1),h(vr,e.ioMicroMSecs()-m)),i)return v(qt);if(r)return v(tr),Ft(Pn);v(lt)}}function R(t){var r;return e.failed()?xl:"number"==typeof t?ta:e.isPointers(t)?d(t)<hs?na:(o=t,0!==(r=si(e.fetchPointerofObject(ms,t)))?r:(pr(0),w=Mi(),i=!1,0)):ra}function O(t,r){var e;return 0!==(e=R(t))?e:Nt()===r?0:(pr(ja),Sn)}function wc(t,r,i){var e;return 0!==(e=R(t))?e:Nt()===r?0:Nt()===i?0:(pr(ja),Sn)}function Zr(e){if(0===_())return null;for(;nn()<=e;)if(oa(Yr(),Yf()),0===_())return null}function Di(e,n,i){var f,t,c,o,l,u,s,a,h,r,d;if((h=i+1-n)<=1)return 0;if(c=e[n],l=e[i],t=er(c,l),t||(r=e[n],e[n]=e[i],e[i]=r,d=c,c=l,l=d),2>=h)return 0;if(u=n+i>>1,o=e[u],t=er(c,o),t?(t=er(o,l),t||(r=e[i],e[i]=e[u],e[u]=r,o=l)):(r=e[n],e[n]=e[u],e[u]=r,o=c),3>=h)return 0;for(s=n,a=i,f=!0;f;){for(t=!0;t;)s<=--a?(r=e[a],t=er(o,r)):t=!1;for(t=!0;t;)++s<=a?(r=e[s],t=er(r,o)):t=!1;f=a>=s,f&&(r=e[s],e[s]=e[a],e[a]=r)}Di(e,n,a),Di(e,s,i)}function Ac(){var e=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1];return e}function Ls(){var e;for(e=P(),zr(T()-1);e<T();)k[e]=k[e+1],++e}function yt(r,t){var e;for(e=r;0>e;)e+=t;for(;e>=t;)e-=t;return e}function _c(){t[Hn]=0,t[Gn]=0,t[Wr]=0,t[Kn]=0,t[br]=0,t[Jn]=0,t[mr]=0,t[vr]=0,t[Un]=0,t[Dn]=0,t[Ln]=0,t[lr]=0,t[Bn]=0,t[ur]=0,t[En]=0,t[ar]=0,t[or]=0,t[Nn]=0,t[Oi]=0,t[Vn]=0,t[qn]=0,t[co]=0}function Xs(){var e,r,t;return 0===P()?null:(e=k[P()],t=I(e),r=k[P()-1],I(r)<=t?null:void wu(P(),e,t))}function Vc(){return Lt=bu(qr)}function jc(){return Lt=Su(qr)}function qc(){return Lt=_u(qr)}function Mc(){return Lt=ls(qr)}function Ys(t){var e;t>=4&&(e=4),t>=2&&4>t&&(e=2),2>t&&(e=1),_h(e),1===e&&(Fn(0),$n(4294967295),Zn(0)),2===e&&(Fn(1),$n(4244438268),Zn(1)),4===e&&(Fn(2),$n(4042322160),Zn(3)),Lh(2*b()),Bh(b())}function Lc(r){var t;return e=r,t=e.majorVersion()==Mu,t===!1?!1:t=e.minorVersion()>=Bu}function Tt(e,t){return(0|t[e])>>>16}function Fr(e,t){return 65535&(0|t[e])}function ia(e,t,r){return Is()?(gr(0,e),yr(0,t),Zt(0,r),_()===N()?null:void(vs(0,_()-N())&&(gr(0,tn()),yr(0,Yi()),Zt(0,$i()),rn(e),Qi(t),en(r)))):null}function Wc(){var e=[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6];return e}function zc(){Di(M,0,z()-1)}function Hr(){return t[Qo]}function wr(e){return t[Qo]=e}function Ur(){return t[Yo]}function Kr(e){return t[Yo]=e}function St(){return t[$o]}function Yc(e){return t[$o]=e}function Wi(){return t[eu]}function zi(e){return t[eu]=e}function x(e,t){return e*e+t*t}function Wt(e){return pt(e+1)}function yr(e,t){return ht(e+1,t)}function N(){return 3}function pi(e){return pt(e+2)}function Zt(e,t){return ht(e+2,t)}function _(){return W()}function zt(e){return pt(e)}function gr(e,t){return ht(e,t)}function Nt(){return t[tu]}function v(e){return t[tu]=e}function pf(){return wa(M[X()],y())}function wa(e,n){var i,k,f,h,d,p,u,b,y,g,v,a,o,m,s,r,t,c,l;return!Gt(e)&&n>=qi(e)?J(e,0):(s=I(e),r=Q(e),c=wh(e),l=Eu(e),k=Ni(e),f=qi(e),i=f-r,b=2*(c-s),y=s+k-2*c,g=2*(l-r),v=r+f-2*l,a=2*i,2>a&&(a=2),o=wt(16777216,a),m=Ql(o),p=b*o,h=y*m*2,p+=h>>1,u=g*o,d=v*m*2,u+=d>>1,J(e,i),t=K(e),t[D]=256*s,t[jt]=256*r,t[Xr]=p,t[mn]=u,t[pn]=h,t[Ts]=d,void((r=Q(e))!==n&&(Va(e,n),J(e,i-(n-r)))))}function vf(){return Aa(M[X()],y())}function Aa(e,s){var i,t,n,l,a,c,r,o,u;if(!Gt(e)&&s>=Vi(e))return J(e,0);if(i=Ns(e)-I(e),t=Vi(e)-Q(e),i>=0?(o=1,r=i,n=0):(o=-1,r=0-i,n=1-t),0===t?(n=0,u=i,l=0):t>r?(u=0,l=r):(u=wt(r,t)*o,l=zh(r,t)),J(e,t),$c(e,o),mf(e,u),ea(e,n),Bc(e,l),Cc(e,t),(c=Q(e))!==s){for(a=c;s-1>=a;a++)Ui(e,a);J(e,t-(s-c))}}function bf(){return kf(M[X()],y())}function kf(e,u){var o,t,i,r,a,n,s,l,c;for(r=un(e),i=Pt(r),o=Ni(e),n=Q(e),wa(e,n),a=ft(e),t=0;5>=t;t++)et(e)[t]=K(e)[t];if(s=K(e)[Xr],0===s&&K(e)[pn],s=s>=0?1:-1,0>s?vl(e,r,i,o):yu(e,r,i,o),0===a&&(K(e)[D]=256*Ao(e)),J(e,a+r),l=0,c=0-a-i,ts(e,l),rs(e,c),l>=i&&0>c?li(e):oi(e),ya(e,r),n!==u){for(t=n;u-1>=t;t++)Ma(e,t);J(e,ft(e)-(u-n))}}function yf(){return Sf(M[X()],y())}function Sf(e,s){var i,n,t,u,c,r,l,a,o;if(t=fi(e),n=Pt(t),c=I(e),r=Q(e),Aa(e,r),u=ft(e),l=ji(e),U(e,c-n),J(e,u+t),l>0?ni(e,Jt(e)+t):(ni(e,t-Jt(e)),U(e,I(e)+Jt(e))),a=0,o=0-u-n,as(e,a),us(e,o),a>=n&&0>o?li(e):oi(e),r!==s){for(i=r;s-1>=i;i++)Qa(e,i);J(e,ft(e)-(s-r))}}function Of(){return Va(k[P()],y())}function Ki(e,a){var r,t,i,n,s;for(i=e[D],n=e[jt],r=e[Xr],t=e[mn],s=256*a;s>n&&t>=0;)i+=r+32768>>16,n+=t+32768>>16,r+=e[pn],t+=e[Ts];return e[D]=i,e[jt]=n,e[Xr]=r,e[mn]=t,i>>8}function Va(e,r){var t;t=Ki(K(e),r),U(e,t)}function If(){return Ui(k[P()],y())}function Ui(e){var t,r;r=I(e)+Jt(e),t=Ec(e)+xc(e),t>0&&(r+=ji(e),t-=Pc(e)),ea(e,t),U(e,r)}function Cf(){Ma(k[P()],y())}function Ma(e,s){var r,i,n,t;i=un(e),r=Pt(i),n=Mh(e)+1,t=Dh(e)+1,ts(e,n),rs(e,t),n>=r&&li(e),t>=0&&oi(e),0>t+r?Ki(K(e),s):K(e)[D]=256*Ao(e),Ki(et(e),s),ya(e,i)}function xf(){return Qa(k[P()],y())}function Qa(e,o){var s,i,n,a,t,r;t=ss(e)+1,r=os(e)+1,as(e,t),us(e,r),n=fi(e),i=Pt(n),t>=i&&li(e),r>=0&&oi(e),s=I(e),Ui(e,o),a=I(e),(n>=t||r+i>=0)&&Vh(e,s,a)}function Ft(e){pr(e),i=!0}function Gi(){return t[ru]}function pr(e){return t[ru]=e}function ei(r,t){return d(t)<fn?e.primitiveFail():(e.storeIntegerofObjectwithValue(Wu,t,ri(r)),e.storeIntegerofObjectwithValue(bs,t,I(r)),e.storeIntegerofObjectwithValue(ks,t,y()),e.storeIntegerofObjectwithValue(ys,t,Hi(r)),e.storeIntegerofObjectwithValue(gs,t,ft(r)),void Lu(r))}function g(){uu(w)}function yo(t){var r,i,n;return r=Lr(),i=Vt(),n=Bt(),d(t)<wi?e.primitiveFail():(e.storeIntegerofObjectwithValue(Os,t,ri(r)),e.storeIntegerofObjectwithValue(Fs,t,i),e.storeIntegerofObjectwithValue(ws,t,n),void e.storeIntegerofObjectwithValue(Yu,t,y()))}function Zi(){return e.failed()?null:(i&&Ef(e.stackObjectValue(1),e.stackObjectValue(0)),g(o),e.pop(3),void e.pushInteger(Gi()))}function Ef(r,i){var e,t;t=Gi(),t===_n&&(e=M[X()],ei(e,r),yi(X()+1)),t===Cn&&yo(i),t===Pn&&(e=k[P()],ei(e,r))}function Wf(e){var r,t,s,i,a,n;return n=Ct(e),i=xt(e),i===n?e:(t=i-n,0>t&&(t=0-t),t>255?(h(Vn,1),Sa(e)):(a=$t(e),s=Dt(e),r=s-a,0>r&&(r=0-r),r>32*t?(h(qn,1),Sa(e)):e))
}function Xi(e){var t,r,n;return n=Wf(e),n!==e?(t=Xi(e),i?0:(r=Xi(n),i?0:t>=r?t:r)):e}function Kf(r,n){var i,e,t;return i=e=t=Gf(r),n&&(e=wo(r)),e>t&&(t=e),r!==i&&n&&(e=wo(i)),e>t&&(t=e),t}function wo(e){var t,i,n,a,r,o,s;return o=$t(e),s=_r(e),a=Dt(e),i=s-o,n=a-s,i*n>=0?e:(h(Oi,1),t=n-i,r=i,0>r&&(r=0-r),0>t&&(t=0-t),Oa(e,r/t))}function Gf(e){var t,i,n,a,r,o,s;return o=Ct(e),s=Ar(e),a=xt(e),i=s-o,n=a-s,i*n>=0?e:(h(Oi,1),t=n-i,r=i,0>r&&(r=0-r),0>t&&(t=0-t),Oa(e,r/t))}function Fo(e,t,r){var i;0===_()?Is()&&(rn(e),Qi(t),en(r)):(i=oa(e,t),i||ia(e,t,r))}function Jf(t){var r,e;return Z(2*N())?(r=Hi(t)<<1,e=Pu(t),0!==e&&Fo(e,r,999999999),e=mu(t),0!==e&&Fo(e,r,999999999),void Zr(I(t))):null}function Zf(e){var n,t,r,a,i,s;switch(s=gh(e),qr=e,s){case 0:case 1:dr();break;case 2:Mc();break;case 3:jc()}switch(a=Lt,s){case 0:case 1:dr();break;case 2:qc();break;case 3:Vc()}return t=Lt,0===t?null:Z(N())?(n=(Hi(e)<<1)+1,i=I(e)+a,r=Ds(t,n),-1===r?ia(t,n,i):pi(r)<i&&Zt(r,i),void Zr(I(e))):null}function Yf(){return 0===_()?-1:Yi()}function Yr(){return 0===_()?0:tn()}function Yi(){return Wt(_()-N())}function Qi(e){return yr(_()-N(),e)}function $i(){return pi(_()-N())}function en(e){return Zt(_()-N(),e)}function tn(){return zt(_()-N())}function rn(e){return gr(_()-N(),e)}function nn(){return 0===_()?999999999:$i()}function j(s){var e,a,r,i,n,t;return 0===s||vi(s)?(r=255&s,i=s>>>8&255,n=s>>>16&255,e=s>>>24&255,bi()&&(t=$r(),a=(e*t[6]+t[7])/e,n=(n*t[0]+t[1])*a|0,i=(i*t[2]+t[3])*a|0,r=(r*t[4]+t[5])*a|0,e=e*a|0,n=Math.max(n,0),n=Math.min(n,255),i=Math.max(i,0),i=Math.min(i,255),r=Math.max(r,0),r=Math.min(r,255),e=Math.max(e,0),e=Math.min(e,255)),1>e?0:(255>e&&Po()&&Ft(Nc),r+(i<<8)+(n<<16)+(e<<24))):s}function At(e){Bf()?hh(e,e):(e[0]=(e[0]+vn())*A(),e[1]=(e[1]+dn())*A())}function hh(e,t){dh(0|e[0],0|e[1],t)}function dh(t,r,i){var e,n,s;e=sn(),n=(e[0]*t+e[1]*r+e[2])*A()|0,s=(e[3]*t+e[4]*r+e[5])*A()|0,i[0]=n,i[1]=s}function at(e){e>0&&At(r()),e>1&&At(l()),e>2&&At(S()),e>3&&At(Cr())}function cr(n){var e,t,i,s;return 0===n?0:(r()[0]=0,r()[1]=0,l()[0]=256*n,l()[1]=0,S()[0]=0,S()[1]=256*n,at(3),e=l()[0]-r()[0],t=l()[1]-r()[1],i=(0|Math.sqrt(e*e+t*t))+128>>8,e=S()[0]-r()[0],t=S()[1]-r()[1],s=(0|Math.sqrt(e*e+t*t))+128>>8,i>s&&(i=s),0===i?1:i)}function ou(s){var e,r,i,n,t;return bi()?(r=255&s,i=s>>>8&255,n=s>>>16&255,e=s>>>24&255,t=$r(),n=n*t[0]+t[1]|0,i=i*t[2]+t[3]|0,r=r*t[4]+t[5]|0,e=e*t[6]+t[7]|0,n=Math.max(n,0),n=Math.min(n,255),i=Math.max(i,0),i=Math.min(i,255),r=Math.max(r,0),r=Math.min(r,255),e=Math.max(e,0),e=Math.min(e,255),16>e?0:r+(i<<8)+(n<<16)+(e<<24)):s}function Qt(){return t[zn]}function bh(e){return t[zn]=e}function vt(){hi(Qt())}function Sh(e){hi($()+e)}function lu(e){return Oc(e)?(hi($()-e),!0):!1}function W(){return Qt()-$()}function pt(e){return t[$()+e]}function ht(e,r){return t[$()+e]=r}function $(){return t[Mn]}function hi(e){return t[Mn]=e}function Mh(e){return s(e,Ws)}function ts(e,t){return a(e,Ws,t)}function Dh(e){return s(e,zs)}function rs(e,t){return a(e,zs,t)}function un(e){return s(e,Ks)}function gu(e,t){return a(e,Ks,t)}function bu(e){return s(e,Us)}function ku(e,t){return a(e,Us,t)}function et(e){return V(Y,e+Il)}function Su(e){return s(e,Hs)}function ln(e,t){return a(e,Hs,t)}function ss(e){return s(e,Ja)}function as(e,t){return a(e,Ja,t)}function os(e){return s(e,Za)}function us(e,t){return a(e,Za,t)}function fi(e){return s(e,Xa)}function Cu(e,t){return a(e,Xa,t)}function _u(e){return s(e,Ya)}function xu(e,t){return a(e,Ya,t)}function ls(e){return s(e,$a)}function ni(e,t){return a(e,$a,t)}function fs(e){t=e.wordsAsInt32Array()}var Mu=1,Bu=11,hs=12,ds=2,ps=3,nr=1,ms=0,fn=6,Wu=0,gs=4,bs=1,ks=2,ys=3,wi=6,Os=0,ws=2,Fs=1,Yu=3,Ut=16,As=12,Ps=11,Cs=14,_s=13,xs=10,nl=18,Vs=15,js=14,qs=15,Ms=21,ll=18,Bs=16,pn=4,Ts=5,Xr=2,mn=3,ml=10,D=0,jt=1,Es=12,Rs=13,Ws=18,zs=19,Ks=20,Us=16,Fi=28,Il=22,Hs=17,Jr=10,Zs=4,gn=65536,xl=100,Sr=121,Qs=122,$s=114,kn=112,ta=101,ra=102,B=104,na=103,Dl=120,ut=119,sa=113,aa=123,zl=115,Kl=108,Ul=105,Gl=106,Hl=110,Jl=107,Zl=109,gt=111,Yl=118,rt=117,Sn=116,ua=8,la=9,ca=7,fa=2,ha=1,On=0,pa=6,oc=1024,wn=2,va=255,ga=256,ba=65280,ka=4,dc=512,pc=768,mc=65535,vc=1,gc=7,bc=5,ii=254,lt=1,Yt=5,Xt=8,Mt=3,C=0,qt=6,tr=7,rr=2,ir=4,Ca=4,_a=5,xa=6,Pn=6,ja=2,Cn=5,_n=4,Nc=3,Tc=1,Ba=6,Na=7,Ta=8,La=9,Da=4,Ea=5,Ra=10,Uc=12,Gc=12,It=16,za=14,Ka=15,Ua=13,Ga=15,Ha=14,Ja=18,Za=19,Xa=20,Ya=16,sr=21,$a=17,eo=10,to=12,uf=11,ro=51,io=50,ff=53,no=48,so=52,ao=49,oo=13,uo=14,Vn=109,co=111,Oi=108,qn=110,Mn=10,mo=69,vo=43,go=45,bo=42,ko=44,Pf=24,Bn=97,Nn=107,ar=103,Ln=93,Dn=91,En=101,or=105,ur=99,lr=95,Co=88,_o=113,xo=46,Vo=47,Rf=18,jo=37,qo=39,Mo=36,Bo=38,No=11,To=12,Lo=17,Do=16,fr=128,Eo=65,Ro=66,Wo=67,zo=68,Ko=0,Uo=1097753705,Go=256,Ho=63,Jo=8,Zo=9,oh=80,uh=82,lh=84,ch=86,zn=1,Yo=34,Qo=35,$o=33,eu=32,tu=2,ru=64,Kn=96,Un=106,mr=102,Gn=92,Hn=90,Jn=100,vr=104,br=98,Wr=94,f=3,c=5,k=null,Or="BitBltPlugin",xr=null,Lt=0,qr=0,p=0,o=0,i=0,Tr=0,m=0,M=null,e=null,Dr=null,Wh="B2DPlugin 14 November 2014 (e)",Y=null,w=0,u=null,t=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:Bl,primitiveCopyBuffer:kl,primitiveAddRect:gl,primitiveAddGradientFill:cl,primitiveSetClipRect:sc,initialiseModule:gi,primitiveSetBitBltPlugin:nc,primitiveRegisterExternalEdge:$l,primitiveGetClipRect:Al,primitiveAddBezier:sl,primitiveInitializeProcessing:Ml,primitiveRenderImage:tc,primitiveGetOffset:Vl,primitiveSetDepth:uc,primitiveAddBezierShape:al,primitiveSetEdgeTransform:lc,getModuleName:qu,primitiveGetTimes:jl,primitiveNextActiveEdgeEntry:Ll,primitiveAddBitmapFill:ol,primitiveGetDepth:Cl,primitiveAbortProcessing:rl,primitiveNextGlobalEdgeEntry:Wl,primitiveGetFailureReason:_l,primitiveDisplaySpanBuffer:yl,moduleUnloaded:Ou,primitiveGetCounts:Pl,primitiveChangedActiveEdgeEntry:bl,primitiveRenderScanline:rc,primitiveGetBezierStats:Fl,primitiveFinishedProcessing:Ol,setInterpreter:Lc,primitiveNeedsFlush:Nl,primitiveAddLine:fl,primitiveSetOffset:cc,primitiveNextFillEntry:Rl,primitiveInitializeBuffer:ql,primitiveDoProfileStats:Sl,primitiveAddActiveEdgeEntry:il,primitiveSetAALevel:ic,primitiveNeedsFlushPut:Tl,primitiveAddCompressedShape:ul,primitiveSetColorTransform:ac,primitiveAddOval:hl,primitiveRegisterExternalFill:ec,primitiveAddPolygon:pl,primitiveGetAALevel:wl})}),module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function Nr(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function W(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Zt(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function v(e,t){return 0|Math.floor(e/t)}function Cn(e,t){return e-v(e,t)*t|0}function r(t,e){return e>31?0:t<<e}function u(t,e){return e>31?0:t>>>e}function K(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function Pn(i,r){var e,n;if(16>t){for(e=i^r,n=x[t];0!==e;)0!==(e&n)&&++$,e=u(e,t);return r}return 16===t?(e=ht(i,r,5,3),$=$+(31&e)+(e>>>5&31)+(e>>>10&31),e=ht(i>>>16,r>>>16,5,3),$=$+(31&e)+(e>>>5&31)+(e>>>10&31)):(e=ht(i,r,8,3),$=$+(255&e)+(e>>>8&255)+(e>>>16&255)),r}function An(a,r){var s,e,n,i;if((C&(X|ct))!==(X|ct))return r;if(16>t){for(s=x[t]&ut,i=r,n=1;c>=n;n++)e=i&s,Et(e,qt(e)+1),i=u(i,t);return r}return 16===t?(e=mt(65535&r,5,R),Et(e,qt(e)+1),e=mt(r>>>16,5,R),Et(e,qt(e)+1)):(e=mt(r,8,R),Et(e,qt(e)+1)),r}function In(e,t){return e+t}function Fn(i,n){var s,t,r,a,e;return e=i>>>24,0===e?n:255===e?i:(s=255-e,t=(16711935&i)*e+(16711935&n)*s+16711935,r=(16711935&(i>>>8|16711680))*e+(n>>>8&16711935)*s+16711935,t=t+(t-65537>>>8&16711935)>>>8&16711935,r=r+(r-65537>>>8&16711935)>>>8&16711935,a=t|r<<8)}function wn(e,t){return Br(e,t,!1)}function Br(l,a,I){var k,e,y,n,f,s,d,S,g,b,O,o,i,w,F,m,h;if(16>t)return a;if(b=255-kt,s=a,1===c)I&&0===l||(o=(16711935&l)*kt+(16711935&a)*b+16711935,i=(l>>>8&16711935)*kt+(a>>>8&16711935)*b+16711935,o=o+(o-65537>>>8&16711935)>>>8&16711935,i=i+(i-65537>>>8&16711935)>>>8&16711935,s=o|i<<8);else for(e=x[t],w=5,k=31,h=p,m=a,f=l,n=1;c>=n;n++){if(S=f&e,!(0===(h&e)||I&&0===S)){for(O=m&e,y=0,g=1;3>=g;g++)d=(g-1)*w,F=v((u(S,d)&k)*kt+(u(O,d)&k)*b+254,255)&k,y|=r(F,d);s=s&~r(e,16*(n-1))|r(y,16*(n-1))}h=u(h,t),f=u(f,t),m=u(m,t)}return s}function Vt(r,n){var i,e,t;return i=255-(r>>>24),e=((16711935&n)*i>>>8&16711935)+(16711935&r),t=((n>>>8&16711935)*i>>>8&16711935)+(r>>>8&16711935),e=16711935&e|255*(16777472&e)>>>8,t=(16711935&t)<<8|255*(16777472&t),t|e}function On(e,t){return 0===e?t:Br(e,t,!0)}function Sn(){var F,g,t,e,k,w,c,v,l,O,y,s,p,b;for(O=h+1,y=m,p=a,t=16*(1&i),j&&(t=16-t),S=r(65535,16-t);0!==--O;){for(k=y*A+4*d,c=p*q+4*(i>>1),F=4*(3&p),b=(3&d)-1,w=o+1,l=S,t=65535===l?16:0;0!==--w;)g=_r[F+(b=b+1&3)],e=f[k>>>2],v=e>>>24,255===v?(e=pr(e,g),e=0===e?r(1,t):r(e,t),Gt(c,e,l)):0!==v&&(s=n[c>>>2],s&=~l,s=u(s,t),s=(31744&s)<<9|(992&s)<<6|((31&s)<<3|4278190080),e=Vt(e,s),e=pr(e,g),e=0===e?r(1,t):r(e,t),Gt(c,e,l)),k+=4,j?0===t&&(c+=4):0!==t&&(c+=4),t=16^t,l=~l;++y,++p}}function yn(){var r,t,s,e,l,v,c,u,p;for(v=h+1,c=m,p=a;0!==--v;){for(t=c*A+4*d,e=p*q+4*i,s=o+1;0!==--s;)if(r=f[t>>>2],l=r>>>24,255===l){for(n[e>>>2]=r,t+=4,e+=4;0!==--s&&(r=f[t>>>2])>>>24===255;)n[e>>>2]=r,t+=4,e+=4;++s}else if(0===l){for(t+=4,e+=4;0!==--s&&(r=f[t>>>2])>>>24===0;)t+=4,e+=4;++s}else u=n[e>>>2],u=Vt(r,u),n[e>>>2]=u,t+=4,e+=4;++c,++p}}function kn(){var e,s,k,w,O,p,t,F,b,l,y,g,c,v;for(O=Fr(),F=C&~Ot,y=h+1,g=m,v=a,S=8*(3&i),j&&(S=24-S),E=P^r(255,S),t=0===(1&i)?0:522133279,0===(1&a)&&(t=522133279^t);0!==--y;){for(t=522133279^t,k=g*A+4*d,p=v*q+4*(i>>2),w=o+1,e=S,l=E;0!==--w;)s=(f[k>>>2]&~t)+t,b=s>>>24,b>31&&(224>b&&(c=n[p>>>2],c&=~l,c=u(c,e),c=O[c],s=Vt(s,c)),s=Lt(s,F),s=r(s,e),Gt(p,s,l)),k+=4,j?0===e?(p+=4,e=24,l=16777215):(e-=8,l=l>>>8|4278190080):24===e?(p+=4,e=0,l=4294967040):(e+=8,l=l<<8|255),t=522133279^t;++g,++v}}function bn(e,t){return e&t}function gn(e,t){return e&~t}function vn(e,t){return~e&t}function mn(e,t){return~e&~t}function pn(t,e){return~e}function dn(e,t){return~e|t}function hn(e,t){return~e|~t}function fn(e){return~e}function cn(e,t){return~e^t}function ln(e,t){return e|t}function un(e,t){return e|~t}function on(e,t){return e^t}function an(){var e;D===z&&a>=m&&(a>m?(pt=-1,m=m+h-1,a=a+h-1):a===m&&i>d&&(H=-1,d=d+o-1,i=i+o-1,M>1&&(e=S,S=E,E=e)),l=a*q+4*v(i,c),At=q*pt-4*M*H)}function sn(){return 0}function vr(){return B>=N?(d=St,i=B,o=Y):(d=St+(N-B),o=Y-(N-B),i=N),i+o>N+_t&&(o-=i+o-(N+_t)),L>=V?(m=Xt,a=L,h=wt):(m=Xt+V-L,h=wt-(V-L),a=V),a+h>V+xt&&(h-=a+h-(V+xt)),T?null:(0>d&&(i-=d,o+=d,d=0),d+o>rt&&(o-=d+o-rt),0>m&&(a-=m,h+=m,m=0),void(m+h>it&&(h-=m+h-it)))}function jt(){return vr(),0>=o||0>=h?(y=I=O=w=0,null):Lr()?(rn(),void Ir()):e.primitiveFail()}function nn(e,t,r){B=e,L=r,St=e,Y=t-e,jt(),bt()}function rn(){var t;if(tn(),e.failed())return e.primitiveFail();if(t=si())return null;if(30===g||31===g){if(1!==e.methodArgumentCount())return e.primitiveFail();if(kt=e.stackIntegerValue(0),!(!e.failed()&&kt>=0&&255>=kt))return e.primitiveFail()}$=0,Ni(),(22===g||32===g)&&(y=I=O=w=0),H>0?(y=i,I=i+o):(y=i-o+1,I=i+1),pt>0?(O=a,w=a+h):(O=a-h+1,w=a+1)}function tn(){var t,r;if(41===g)if(yr=255,$t=16777215,dt=null,G=null,e.methodArgumentCount()>=2){if(yr=e.stackIntegerValue(e.methodArgumentCount()-2),e.failed())return e.primitiveFail();if($t=e.stackIntegerValue(e.methodArgumentCount()-1),e.failed())return e.primitiveFail();4===e.methodArgumentCount()&&(r=e.stackObjectValue(1),e.isBytes(r)&&(dt=r.bytes),t=e.stackObjectValue(0),e.isBytes(t)&&(G=t.bytes))}else{if(1!==e.methodArgumentCount())return e.primitiveFail();if($t=e.stackIntegerValue(0),e.failed())return e.primitiveFail()}}function en(){var k,b,d,m,v,O,e,c,i,o,w,I,t,y;for(O=s[g+1],e=4*H,-32===_?_=v=d=0:0>_?(v=_+32,d=r(P,0-_)):0===_?(v=0,d=P):(v=_-32,d=u(P,_)),y=~d,It?(m=P,Mt=0):m=Ut(0),w=a,I=1;h>=I;I++){if(Mt>1&&(m=Ut(w),w+=pt),zt?(o=f[F>>>2],F+=e):o=0,p=S,t=f[F>>>2],F+=e,b=K(o&y,v)|K(t&d,_),o=t,c=n[l>>>2],k=O(b&m,c),c=p&k|c&~p,n[l>>>2]=c,l+=e,p=P,3===g)if(0===_&&m===P)if(-1===H)for(i=2;M-1>=i;i++)t=f[F>>>2],F+=e,n[l>>>2]=t,l+=e;else for(i=2;M-1>=i;i++)n[l>>>2]=o,l+=e,o=f[F>>>2],F+=e;else for(i=2;M-1>=i;i++)t=f[F>>>2],F+=e,b=K(o&y,v)|K(t&d,_),o=t,n[l>>>2]=b&m,l+=e;else for(i=2;M-1>=i;i++)t=f[F>>>2],F+=e,b=K(o&y,v)|K(t&d,_),o=t,k=O(b&m,n[l>>>2]),n[l>>>2]=k,l+=e;M>1&&(p=E,t=f[F>>>2],F+=e,b=K(o&y,v)|K(t&d,_),c=n[l>>>2],k=O(b&m,c),c=p&k|c&~p,n[l>>>2]=c,l+=e),F+=Ht,l+=At}}function $i(){var t,i,o,e,r,u;for(o=s[g+1],u=1;h>=u;u++){if(i=It?P:Ut(a+u-1),p=S,e=n[l>>>2],t=o(i,e),e=p&t|e&~p,n[l>>>2]=e,l+=4,p=P,3===g)for(e=i,r=2;M-1>=r;r++)n[l>>>2]=e,l+=4;else for(r=2;M-1>=r;r++)e=n[l>>>2],t=o(i,e),n[l>>>2]=t,l+=4;M>1&&(p=E,e=n[l>>>2],t=o(i,e),e=p&t|e&~p,n[l>>>2]=e,l+=4),l+=At}}function wr(){var z,y,T,W,D,V,q,e,k,_,r,O,B,w,L,I,f,R,u,N;for(_=s[g+1],et=v(32,b),W=x[b],L=x[t],z=C&~Ot,F=m*A+4*v(d,et),N=et-(d&et-1),D=N>o?0:v(o-N,et)+1,Ht=A-4*D,k=c-(i&c-1),R=(i+o-1&c-1)+1,k>o&&(k=o),f=(d&et-1)*b,r=(i&c-1)*t,y=b,I=t,T=0,tt&&(f=32-b-f,y=0-y),j&&(r=32-t-r,I=0-I,T=32-t),O=1;h>=O;O++){B=It?P:Ut(a+O-1),Tt=f,U=r,p=S,u=k,q=M;do V=Bi(u,z,W,L,y,I),U=T,p===P?(w=_(V&B,n[l>>>2]),n[l>>>2]=p&w):(e=n[l>>>2],w=_(V&B,e&p),e=p&w|e&~p,n[l>>>2]=e),l+=4,2===q?(p=E,u=R):(p=P,u=c);while(0!==--q);F+=Ht,l+=At}}function Fr(){var e=[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295];return e}function Pt(e,t,r){return t>e?v(t-e+jr,r+1)+1:t===e?0:0-(v(e-t+jr,r+1)+1)}function sr(){var s,e,n;n=c-1,e=c-(i&n),S=j?u(P,32-e*t):r(P,32-e*t),s=(i+o-1&n)+1,E=j?r(P,32-s*t):u(P,32-s*t),e>o?(S&=E,E=0,M=1):M=v(o-e+n,c)+1,H=pt=1,l=a*q+4*v(i,c),At=q*pt-4*M*H}function Qt(t,e){return e}function pr(t,r){var e;return e=r<<8,(Yt[e+(t>>>16&255)]<<10)+(Yt[e+(t>>>8&255)]<<5)+Yt[e+(255&t)]}function Qi(l,c){var u,r,f,a,t,i,o,s,n,h;if(f=l>0?1:0===l?0:-1,h=c>0?1:0===c?0:-1,a=Math.abs(c),o=Math.abs(l),i=r=9999,t=n=-9999,o>a){for(u=o>>1,s=1;o>=s;s++)if(B+=f,(u-=a)<0&&(L+=h,u+=o),o>s){if(jt(),e.failed())return null;I>y&&w>O&&(i=Math.min(i,y),t=Math.max(t,I),r=Math.min(r,O),n=Math.max(n,w),(t-i)*(n-r)>4e3&&(y=i,I=t,O=r,w=n,bt(),i=r=9999,t=n=-9999))}}else for(u=a>>1,s=1;a>=s;s++)if(L+=h,(u-=o)<0&&(B+=f,u+=a),a>s){if(jt(),e.failed())return null;I>y&&w>O&&(i=Math.min(i,y),t=Math.max(t,I),r=Math.min(r,O),n=Math.max(n,w),(t-i)*(n-r)>4e3&&(y=i,I=t,O=r,w=n,bt(),i=r=9999,t=n=-9999))}y=i,I=t,O=r,w=n,e.storeIntegerofObjectwithValue(dr,k,B),e.storeIntegerofObjectwithValue(Cr,k,L)}function Gt(t,r,i){var e;e=n[t>>>2],e&=i,e|=r,n[t>>>2]=e}function Yi(i,n){var e,r,t,s;return e=255&i,r=ar[7&e],t=lr[e>>>3],s=r>n?t+1:t,e=i>>>8&255,r=ar[7&e],t=lr[e>>>3],s|=r>n?t+1<<5:t<<5,e=i>>>16&255,r=ar[7&e],t=lr[e>>>3],s|=r>n?t+1<<10:t<<10}function J(i,n){var t,r;return r=e.fetchPointerofObject(i,n),"number"==typeof r?r:(t=e.floatValueOf(r),t>=-2147483648&&2147483647>=t?0|t:(e.primitiveFail(),0))}function Q(i,n,s){var r,t;return t=e.fetchPointerofObject(i,n),"number"==typeof t?t:t.isNil?s:(r=e.floatValueOf(t),r>=-2147483648&&2147483647>=r?0|r:(e.primitiveFail(),0))}function Zi(r,e){return 32!==t?e:0===e?0:0!==(4278190080&e)?e:e|4278190080&r}function Ji(){return Xi}function Ut(e){return or[Cn(e,Mt)]}function Vr(e){return e.isNil?!0:0===g?!0:5===g?!0:10===g?!0:15===g?!0:!1}function Hi(){s[1]=sn,s[2]=bn,s[3]=gn,s[4]=ui,s[5]=vn,s[6]=Qt,s[7]=on,s[8]=ln,s[9]=mn,s[10]=cn,s[11]=pn,s[12]=un,s[13]=fn,s[14]=dn,s[15]=hn,s[16]=Qt,s[17]=Qt,s[18]=Qt,s[19]=In,s[20]=oi,s[21]=wi,s[22]=fi,s[23]=Pn,s[24]=An,s[25]=Fn,s[26]=ji,s[27]=qi,s[28]=mi,s[29]=pi,s[30]=di,s[31]=wn,s[32]=On,s[33]=bi,s[34]=ai,s[35]=Vt,s[36]=Vt,s[37]=Vt,s[38]=hi,s[39]=Vi,s[40]=Dr,s[41]=Zi,s[42]=ki}function Gi(){var e,t,r;for(t=0;255>=t;t++)for(e=0;15>=e;e++)r=Yi(t,e),Yt[(e<<8)+t]=r}function Ui(){return Hi(),Gi(),!0}function Ki(e,t){return e&&t?0===e[Wt]&&0===e[Dt]&&0===e[Bt]&&0===e[er]&&16711680===t[Wt]&&65280===t[Dt]&&255===t[Bt]&&4278190080===t[er]?!0:!1:!0}function zi(){var r;if(n=e.fetchPointerofObject(nt,z),ft=e.fetchIntegerofObject(hr,z),vt=e.fetchIntegerofObject(tr,z),!(ft>=0&&vt>=0))return!1;if(t=e.fetchIntegerofObject(mr,z),j=t>0,0>t&&(t=0-t),"number"==typeof n){if(!Ii(n))return!1;c=v(32,t),n=q=0}else{if(c=v(32,t),q=4*v(ft+(c-1),c),r=Zt(n),!e.isWordsOrBytes(n)||r!==q*vt)return!1;n=n.wordsOrBytes()}return!0}function Jt(e){return Pr(e,!1)}function Pr(r,i){var t;if(k=r,Sr=i,g=e.fetchIntegerofObject(zr,k),e.failed()||0>g||g>Jr-2)return!1;if(g>=16&&17>=g)return!1;if(D=e.fetchPointerofObject(Wr,k),T=Vr(D),lt=e.fetchPointerofObject(Ur,k),It=Vr(lt),z=e.fetchPointerofObject(Gr,r),!(e.isPointers(z)&&W(z)>=4))return!1;if(t=zi(),!t)return!1;if(B=Q(dr,k,0),L=Q(Cr,k,0),Y=Q(Er,k,ft),wt=Q(Kr,k,vt),e.failed())return!1;if(T)St=Xt=0;else{if(!(e.isPointers(D)&&W(D)>=4))return!1;if(t=Wi(),!t)return!1;if(t=Ri(),!t)return!1;0===(C&Ot)&&xr(),St=Q(Rr,k,0),Xt=Q(Mi,k,0)}return(t=Ei())?(N=Q(Xr,k,0),V=Q(Zr,k,0),_t=Q(Yr,k,ft),xt=Q(Qr,k,vt),e.failed()?!1:(0>N&&(_t+=N,N=0),0>V&&(xt+=V,V=0),N+_t>ft&&(_t=ft-N),V+xt>vt&&(xt=vt-V),!0)):!1}function Wi(){var t;if(f=e.fetchPointerofObject(nt,D),rt=J(hr,D),it=J(tr,D),!(rt>=0&&it>=0))return!1;if(b=e.fetchIntegerofObject(mr,D),tt=b>0,0>b&&(b=0-b),"number"==typeof f){if(!Fi(f))return!1;et=v(32,b),f=A=0}else{if(et=v(32,b),A=4*v(rt+(et-1),et),t=Zt(f),!e.isWordsOrBytes(f)||t!==A*it)return!1;f=f.wordsOrBytes()}return!0}function Ri(){var i,t,r,n;if(C=ut=R=0,st=null,ot=null,Z=null,t=e.fetchPointerofObject(Hr,k),t.isNil)return!0;if(C=X,n=!1,e.isWords(t))r=W(t),Z=t.words,n=!0;else{if(!(e.isPointers(t)&&W(t)>=3))return!1;if(st=Mr(e.fetchPointerofObject(0,t)),ot=Mr(e.fetchPointerofObject(1,t)),i=e.fetchPointerofObject(2,t),i.isNil)r=0;else{if(!e.isWords(i))return!1;r=W(i),Z=i.words}C|=Ot}return 0!==(r&r-1)?!1:(ut=r-1,R=0,512===r&&(R=3),4096===r&&(R=4),32768===r&&(R=5),0===r?(Z=null,ut=0):C|=ct,n&&xr(),Ki(st,ot)?(ot=null,st=null):C|=Or,!0)}function Mr(t){return t.isNil?null:"number"==typeof t?(e.primitiveFail(),null):e.isWords(t)&&4===W(t)?t.words:(e.primitiveFail(),null)}function Ei(){var t;if(It)return or=null,!0;if(e.isPointers(lt)&&W(lt)>=4)t=e.fetchPointerofObject(nt,lt),Mt=e.fetchIntegerofObject(tr,lt),e.isWords(t)||(It=!0);else{if(e.isPointers(lt)||!e.isWords(lt))return!1;t=lt,Mt=W(t)}return or=t.wordsOrBytes(),!0}function Rt(){return yt=e.ioLoadFunctionFrom("ioGetSurfaceFormat","SurfacePlugin"),Ft=e.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin"),Nt=e.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin"),!!yt&&!!Ft&&!!Nt}function Di(e){return Pr(e,!0)}function Lr(){var s,t,u,r,c,p,l;if(Ct=!1,0===n){if(!Ft&&!Rt())return null;if(r=Ft,s=e.fetchIntegerofObject(nt,z),0===f&&!T&&(t=e.fetchIntegerofObject(nt,D),t===s))return Sr?(l=Math.min(d,i),c=Math.max(d,i)+o,u=Math.min(m,a),p=Math.max(m,a)+h,f=r(t,function(e){A=e},l,u,c-l,p-u)):f=r(t,function(e){A=e},0,0,rt,it),n=f,q=A,Ct=!0,0!==n;n=r(s,function(e){q=e},i,a,o,h),Ct=!0}if(0===f&&!T){if(t=e.fetchIntegerofObject(nt,D),!Ft&&!Rt())return null;r=Ft,f=Sr?r(t,function(e){A=e},0,0,rt,it):r(t,function(e){A=e},d,m,o,h),Ct=!0}return 0!==n&&(0!==f||T)}function Lt(r,t){var e;return e=r,0!==(t&X)&&(0!==(t&Or)&&(e=vi(r,t),0===e&&0!==r&&(e=1)),0!==(t&ct)&&(e=Z[e&ut])),e}function Li(e){0===strcmp(e,"SurfacePlugin")&&(yt=Ft=Nt=0)}function Ar(s,a,n,o){var t,i,e;for(e=x[n],t=0,i=1;o>=i;i++)(s&e)===e&&(t|=a&e),e=r(e,n);return t}function br(i,n,o,l,s){var e,a,r,t;return t=i&s,e=n&s,r=(i^t)+(n^e),a=t&e|(t|e)&r,r^t^e|u(a,o-1)*l}function ir(s,a,n,o){var t,i,e;for(e=x[n],t=0,i=1;o>=i;i++)t|=Math.max(a&e,s&e),e=r(e,n);return t}function gt(s,a,n,o){var t,i,e;for(e=x[n],t=0,i=1;o>=i;i++)t|=Math.min(a&e,s&e),e=r(e,n);return t}function nr(a,o,e,l){var s,i,n,t;return t=x[e],s=r(t,e),i=u(((a&t)+1)*((o&t)+1)-1&s,e),1===l?i:(n=((u(a,e)&t)+1)*((u(o,e)&t)+1)-1&s,i|=n,2===l?i:(n=((u(a,2*e)&t)+1)*((u(o,2*e)&t)+1)-1&s,i|=r(n,e),3===l?i:(n=((u(a,3*e)&t)+1)*((u(o,3*e)&t)+1)-1&s,i|=r(n,2*e))))}function Ti(l,c,e,f){var t,o,i,n,a,s;for(s=x[e],o=0,n=1;f>=n;n++)i=u(l&s,(n-1)*e),t=u(c&s,(n-1)*e),32!==e&&(16===e?(i=4278190080|ur(i),t=4278190080|ur(t)):(i=4278190080|mt(i,e,32),t=4278190080|mt(t,e,32))),a=rr(i,t),32!==e&&(a=mt(a,32,e)),o|=r(a,(n-1)*e),s=r(s,e);return o}function ht(o,u,a,l){var t,n,i,s,e;for(e=x[a],n=0,s=1;l>=s;s++)i=o&e,t=u&e,n|=t>i?t-i:i-t,e=r(e,a);return n}function Ni(){sr(),T?$i():(an(),b!==t||0!==C||tt!==j?wr():(li(),en()))}function Bi(m,l,p,d,h,c){var n,e,i,t,s,o,a;if(i=f[F>>>2],a=0,e=Tt,t=U,o=m,l===(X|ct)){do n=u(i,e)&p,s=Z[n&ut],a|=r(s&d,t),t+=c,0!==(4294967264&(e+=h))&&(tt?e+=32:e-=32,i=f[(F+=4)>>>2]);while(0!==--o)}else do n=u(i,e)&p,s=Lt(n,l),a|=r(s&d,t),t+=c,0!==(4294967264&(e+=h))&&(tt?e+=32:e-=32,i=f[(F+=4)>>>2]);while(0!==--o);return Tt=e,a}function fr(t,r){var a,i,n,e,s;return 0>t||0>r||(e=t>>>14)>=rt||(s=r>>>14)>=it?0:(n=s*A+4*u(e,kr),i=f[n>>>2],Tt=qr[e&gr],a=u(i,Tt)&Tr)}function Dr(u,n){var i,s,a,o,e;if(32===t)return u===n?0:n;for(s=t,e=x[s],a=0,o=1;c>=o;o++)i=n&e,(u&e)===i&&(i=0),a|=i,e=r(e,s);return a}function qi(e,r){return Ar(~e,r,t,c)}function ji(e,r){return 0===e?r:e|Ar(~e,r,t,c)}function Vi(l,n){var s,e,i,a,o;if(1===c)return n;if(s=0,i=r(1,t)-1,a=r(i,(c-1)*t),e=32-t,s|=r(n&i,e)|u(n&a,e),2>=c)return s;for(o=2;c>>1>=o;o++)i=r(i,t),a=u(a,t),e-=2*t,s|=r(n&i,e)|u(n&a,e);return s}function xi(){var t;return t=e.stackValue(e.methodArgumentCount()),Jt(t)?(jt(),e.failed()?null:(bt(),e.failed()?null:(e.pop(e.methodArgumentCount()),22===g||32===g?(e.pop(1),e.pushInteger($)):void 0))):e.primitiveFail()}function _i(){var c,S,u,p,s,v,k,r,l,F,A,m,P,d;if(6!==e.methodArgumentCount())return e.primitiveFail();if(A=e.stackIntegerValue(0),s=e.stackObjectValue(1),l=e.stackObjectValue(2),Nr(s)!==e.classArray()||Nr(l)!==e.classArray())return e.primitiveFail();if(256!==W(l))return e.primitiveFail();if(e.failed())return null;if(v=W(s)-2,u=e.stackIntegerValue(3),m=e.stackIntegerValue(4),d=e.stackObjectValue(5),!e.isBytes(d))return e.primitiveFail();if(!(m>0&&u>0&&u<=Zt(d)))return e.primitiveFail();if(p=e.stackObjectValue(6),!Jt(p))return e.primitiveFail();if(30===g||31===g)return e.primitiveFail();for(k=0!==n&&0!==f&&T===!1&&D!==z&&(0!==C||tt!==j||b!==t),F=B,S=d.bytes,c=m;u>=c;c++){if(P=S[c-1],r=e.fetchIntegerofObject(P,l),0>r||r>v)return e.primitiveFail();if(St=e.fetchIntegerofObject(r,s),Y=e.fetchIntegerofObject(r+1,s)-St,e.failed())return null;if(vr(),o>0&&h>0&&(k?(sr(),wr(),y=i,I=i+o,O=a,w=a+h):jt()),e.failed())return null;B=B+Y+A}y=F,bt(),e.storeIntegerofObjectwithValue(dr,p,B),e.pop(6)}function Ci(){var t,r,i;return r=e.stackValue(2),i=e.stackIntegerValue(1),t=e.stackIntegerValue(0),Jt(r)?(e.failed()||(Qi(i,t),bt()),void(e.failed()||e.pop(2))):e.primitiveFail()}function Pi(){var d,t,h,i,a,n,p,l,c,f,s,o,r;return s=e.stackIntegerValue(1),o=e.stackIntegerValue(0),t=e.stackValue(2),e.failed()?null:0>s||0>o?(r=0,e.failed()?null:(e.popthenPush(3,r),null)):(t=e.stackValue(e.methodArgumentCount()),e.isPointers(t)&&W(t)>=4?(a=e.fetchPointerofObject(nt,t),e.isWordsOrBytes(a)?(Y=e.fetchIntegerofObject(hr,t),wt=e.fetchIntegerofObject(tr,t),i=e.fetchIntegerofObject(mr,t),e.failed()?null:s>=Y||o>=wt?(r=0,e.failed()?null:(e.popthenPush(3,r),null)):0>i?(e.primitiveFail(),null):(n=v(32,i),l=v(Y+(n-1),n),c=Zt(a),c!==l*wt*4?(e.primitiveFail(),null):(p=e.fetchLong32ofObject(o*l+v(s,n),a),f=u(4294967295,32-i),h=32-((s&n-1)+1)*i,d=u(p,h)&f,r=e.positive32BitIntegerFor(d),e.failed()?null:(e.popthenPush(3,r),null)))):(e.primitiveFail(),null)):(e.primitiveFail(),null))}function Ai(){var t;return t=e.stackValue(e.methodArgumentCount()),Di(t)?(ni(),e.failed()?null:(bt(),e.failed()?null:void e.pop(e.methodArgumentCount()))):e.primitiveFail()}function Ii(e){return yt||Rt()?yt(e,function(e,r,i,n){ft=e,vt=r,t=i,j=n}):!1}function Fi(e){return yt||Rt()?yt(e,function(e,t,r,i){rt=e,it=t,b=r,tt=i}):!1}function wi(n,s){var i,e;return 16>t?(e=r(1,t)-1,i=r(v(4294967295,e),t-1),br(n,s,t,e,i)):16===t?(e=31,i=1108361744,br(2147450879&n,2147450879&s,5,e,i)):(e=255,i=2155905152,br(n,s,8,e,i))}function Oi(){var y,O,e,t,g,w,c,F,l,k,b,s,p,v;for(k=h+1,b=m,p=a,e=16*(1&i),j&&(e=16-e),S=r(65535,16-e);0!==--k;){for(g=b*A+4*d,c=p*q+4*(i>>1),y=4*(3&p),v=(3&d)-1,w=o+1,l=S,e=65535===l?16:0;0!==--w;)O=_r[y+(v=v+1&3)],t=f[g>>>2],F=16777215&t,0!==F&&(s=n[c>>>2],s&=~l,s=u(s,e),s=(31744&s)<<9|(992&s)<<6|((31&s)<<3|4278190080),t=rr(t,s),t=pr(t,O),t=0===t?r(1,e):r(t,e),Gt(c,t,l)),g+=4,j?0===e&&(c+=4):0!==e&&(c+=4),e=16^e,l=~l;++b,++p}}function Si(){var r,e,s,t,p,v,l,u,c;for(v=h+1,l=m,c=a;0!==--v;){for(e=l*A+4*d,t=c*q+4*i,s=o+1;0!==--s;)if(r=f[e>>>2],p=16777215&r,0===p){for(e+=4,t+=4;0!==--s&&0===(16777215&(r=f[e>>>2]));)e+=4,t+=4;++s}else u=n[t>>>2],u=rr(r,u),n[t>>>2]=u,e+=4,t+=4;++l,++c}}function rr(v,p){var s,n,c,t,d,f,l,i,a,o,u,h,r,m,e;return r=v,0===r?p:(n=$t,a=255&yr,h=255&r,r>>>=8,c=255&r,r>>>=8,l=255&r,r>>>=8,f=255&r,255!==a&&(f=f*a>>>8,l=l*a>>>8,c=c*a>>>8,h=h*a>>>8),i=p,t=255&i,e=255&n,G&&(t=G[t],e=G[e]),u=(t*(255-h)>>>8)+(e*h>>>8),u>255&&(u=255),dt&&(u=dt[u]),i>>>=8,n>>>=8,t=255&i,e=255&n,G&&(t=G[t],e=G[e]),s=(t*(255-c)>>>8)+(e*c>>>8),s>255&&(s=255),dt&&(s=dt[s]),i>>>=8,n>>>=8,t=255&i,e=255&n,G&&(t=G[t],e=G[e]),o=(t*(255-l)>>>8)+(e*l>>>8),o>255&&(o=255),dt&&(o=dt[o]),i>>>=8,n>>>=8,d=((255&i)*(255-f)>>>8)+f,d>255&&(d=255),m=(((d<<8)+o<<8)+s<<8)+u)}function yi(){var t,e,k,F,w,g,s,I,p,l,O,b,c,y;for(w=Fr(),I=C&~Ot,O=h+1,b=m,y=a,S=8*(3&i),j&&(S=24-S),E=P^r(255,S),s=0===(1&i)?0:522133279,0===(1&a)&&(s=522133279^s);0!==--O;){for(s=522133279^s,k=b*A+4*d,g=y*q+4*(i>>2),F=o+1,t=S,l=E;0!==--F;)e=(f[k>>>2]&~s)+s,p=16777215&e,p=v((p>>>16)+(p>>>8&255)+(255&p),3),p>31&&(p>224&&(e=4294967295),c=n[g>>>2],c&=~l,c=u(c,t),c=w[c],e=rr(e,c),e=Lt(e,I),e=r(e,t),Gt(g,e,l)),k+=4,j?0===t?(g+=4,t=24,l=16777215):(t-=8,l=l>>>8|4278190080):32===t?(g+=4,t=0,l=4294967040):(t+=8,l=l<<8|255),s=522133279^s;++b,++y}}function ki(e,r){var i;return i=e,0===i?r:Ti(e,r,t,c)}function bi(m,d){var f,r,e,s,n,i,o,h,a,l;for(n=x[t],16===t?(r=5,i=31):(r=8,i=255),a=p,o=d,s=m,h=1;c>=h;h++)(a&n)>0&&(l=o&n,f=s&n,16>t?e=f===l?0:1:(e=ht(f,l,r,3),e=(e&i)+(u(e,r)&i)+(u(u(e,r),r)&i)),$+=e),a=u(a,t),s=u(s,t),o=u(o,t);return d}function ur(e){return(31&e)<<3|(992&e)<<6|(31744&e)<<9}function gi(e){return e}function mt(n,o,s){var i,a,t,e;return(i=s-o)>0?(e=r(1,o)-1,t=r(n,i),e=r(e,i),a=t&e,e=r(e,s),t=r(t,i),a+(t&e)+(r(t,i)&r(e,s))):0===i?5===o?32767&n:8===o?16777215&n:n:0===n?n:(i=o-s,e=r(1,s)-1,t=u(n,i),a=t&e,e=r(e,s),t=u(t,i),a=a+(t&e)+(u(t,i)&r(e,s)),0===a?1:a)}function vi(e){var t;return t=K(e&ot[0],st[0]),t|=K(e&ot[1],st[1]),t|=K(e&ot[2],st[2]),t|K(e&ot[3],st[3])}function mi(e,r){return 16>t?ir(e,r,t,c):16===t?ir(e,r,5,3)+(ir(e>>>16,r>>>16,5,3)<<16):ir(e,r,8,4)}function pi(e,r){return 16>t?gt(e,r,t,c):16===t?gt(e,r,5,3)+(gt(e>>>16,r>>>16,5,3)<<16):gt(e,r,8,4)}function di(i,r){var e;return e=~i,16>t?gt(e,r,t,c):16===t?gt(e,r,5,3)+(gt(e>>>16,r>>>16,5,3)<<16):gt(e,r,8,4)}function hi(e,r){return 16>t?nr(e,r,t,c):16===t?nr(e,r,5,3)+(nr(e>>>16,r>>>16,5,3)<<16):nr(e,r,8,4)}function fi(e,r){return 16>t?ht(e,r,t,c):16===t?ht(e,r,5,3)+(ht(e>>>16,r>>>16,5,3)<<16):ht(e,r,8,4)}function ci(r){var t;return e=r,t=e.majorVersion()==ei,t===!1?!1:t=e.minorVersion()>=$r}function xr(){var r,e;if(r=e=0,8>=b)return null;if(16===b&&(r=5),32===b&&(r=8),0===R){if(8>=t)return null;16===t&&(e=5),32===t&&(e=8)}else e=R;cr(r,e)}function cr(n,a){var e,t,s=[0,0,0,0],i=[0,0,0,0];return e=a-n,0===e?0:(0>=e?(t=r(1,a)-1,i[Wt]=r(t,2*n-e),i[Dt]=r(t,n-e),i[Bt]=r(t,0-e),i[er]=0):(t=r(1,n)-1,i[Wt]=r(t,2*n),i[Dt]=r(t,n),i[Bt]=t),s[Wt]=3*e,s[Dt]=2*e,s[Bt]=e,s[er]=0,st=s,ot=i,void(C|=X|Or))}function bt(){e.showDisplayBitsLeftTopRightBottom(z,y,O,I,w)}function li(){var e,r,n,s;s=c-1,r=d&s,e=i&s,H>0?(n=Math.min(o,c-e),zt=r+n>s):(n=Math.min(o,e+1),zt=0>r-n+1),_=tt?(r-e)*t:(e-r)*t,zt&&(0>_?_+=32:_-=32),F=m*A+4*v(d,v(32,b)),Ht=A*pt-4*M*H,zt&&(Ht-=4*H)}function ui(e){return e}function oi(e,t){return e-t}function ai(l,n){var s,a,e,o,r,i;if((C&(X|ct))!==(X|ct))return n;for(s=x[t],e=n,r=p,o=1;c>=o;o++)0!==(r&s)&&(i=e&s,a=16>t?i:16===t?mt(i,5,R):mt(i,8,R),Et(a,qt(a)+1)),r=u(r,t),e=u(e,t);return n}function qt(e){return Z[e&ut]}function Et(e,t){return Z[e&ut]=t}function si(){return T?!1:34!==g&&41!==g?!1:32!==b?!1:D===z?!1:41===g?32===t?(Si(),y=i,I=i+o,O=a,w=a+h,!0):16===t?(Oi(),y=i,I=i+o,O=a,w=a+h,!0):8===t?(yi(),y=i,I=i+o,O=a,w=a+h,!0):!1:8>t?!1:8===t&&0===(C&X)?!1:(32===t&&yn(),16===t&&Sn(),8===t&&kn(),y=i,I=i+o,O=a,w=a+h,!0)}function Ir(){var t,r,i,s;if(Ct){if(!Nt&&!Rt())return null;i=Nt,s=!1,t=e.fetchPointerofObject(nt,z),"number"==typeof t&&(t=t,i(t,y,O,I-y,w-O),n=q=0,s=!0),T||(r=e.fetchPointerofObject(nt,D),"number"==typeof r&&(r=r,s&&r===t||i(r,0,0,0,0),f=A=0)),Ct=!1}}function ni(){var t;return t=T,T=!0,vr(),T=t,T||0>=o||0>=h?(y=I=O=w=0,null):Lr()?(sr(),ii(),H>0?(y=i,I=i+o):(y=i-o+1,I=i+1),pt>0?(O=a,w=a+h):(O=a-h+1,w=a+1),void Ir()):e.primitiveFail()}function ii(){var nt,et,f,tt,u,K,T,X,rt,z,y,H,_,$,Q,w,G,I,A,x,F,O,it,D,v,q;if(rt=s[g+1],!(W(k)>=at+12))return e.primitiveFail();if(u=wt-1,0>=u&&(u=1),F=J(at,k),f=J(at+3,k),v=Pt(F,f,u),0>v&&(F=f-u*v),w=J(at+1,k),f=J(at+4,k),O=Pt(w,f,u),0>O&&(w=f-u*O),I=J(at+9,k),f=J(at+6,k),z=Pt(I,f,u),0>z&&(I=f-u*z),y=J(at+10,k),f=J(at+7,k),K=Pt(y,f,u),0>K&&(y=f-u*K),e.failed())return!1;if(2===e.methodArgumentCount())if(q=e.stackIntegerValue(1),A=e.stackValue(0),A.isNil){if(16>b)return e.primitiveFail()}else{if(W(A)<r(1,b))return e.primitiveFail();A=A.wordsOrBytes()}else q=1,A=e.nilObject();for(u=Y-1,0>=u&&(u=1),X=c-(i&c-1),it=(i+o-1&c-1)+1,X>o&&(X=o),V>L&&(F+=(V-L)*v,w+=(V-L)*O,I+=(V-L)*z,y+=(V-L)*K),_n(),q>1&&0===(C&Ot)&&(Z?cr(8,R):16===t&&cr(8,5)),nt=C&~Ot,j?(G=0-t,et=32-t):(G=t,et=0),H=1;h>=H;H++){x=Pt(F,I,u),d=x>=0?F:I-u*x,_=Pt(w,y,u),m=_>=0?w:y-u*_,U=j?32-((i&c-1)+1)*t:(i&c-1)*t,N>B&&(d+=(N-B)*x,m+=(N-B)*_),$=It?P:Ut(a+H-1),p=S,D=X,f=M;
do tt=1===q?ti(D,x,_,v,O,G,nt):ri(D,x,_,v,O,A,q,G),U=et,p===P?(Q=rt(tt&$,n[l>>>2]),n[l>>>2]=p&Q):(T=n[l>>>2],Q=rt(tt&$,T&p),T=p&Q|T&~p,n[l>>>2]=T),l+=4,2===f?(p=E,D=it):(p=P,D=c);while(0!==--f);F+=v,w+=O,I+=z,y+=K,l+=At}}function _n(){var e,t;for(Kt=0,t=b;1!==t;)++Kt,t>>>=1;for(Tr=x[b],kr=5-Kt,gr=r(1,kr)-1,e=0;gr>=e;e++)qr[e]=tt?32-r(e+1,Kt):r(e,Kt)}function ri(B,c,f,V,I,M,n,q){var A,y,O,j,l,P,F,_,h,e,k,o,S,u,w,s,a,i,p;_=x[t],y=0,2===n?(O=c>>1,l=f>>1,F=V>>1,h=I>>1):(O=v(c,n),l=v(f,n),F=v(V,n),h=v(I,n)),P=B;do{w=d,k=m,s=a=u=o=0,i=0,j=n;do{p=w,S=k,A=n;do e=fr(p,S),(25!==g||0!==e)&&(++i,e=16>b?M[e]:16===b?ur(e):gi(e),o+=255&e,u+=e>>>8&255,a+=e>>>16&255,s+=e>>>24),p+=O,S+=l;while(0!==--A);w+=F,k+=h}while(0!==--j);0===i||25===g&&n*n>>1>i?e=0:(4===i?(a>>>=2,u>>>=2,o>>>=2,s>>>=2):(a=v(a,i),u=v(u,i),o=v(o,i),s=v(s,i)),e=(s<<24)+(a<<16)+(u<<8)+o,0===e&&a+u+o+s>0&&(e=1),e=Lt(e,C)),y|=r(e&_,U),U+=q,d+=c,m+=f}while(0!==--P);return y}function ti(f,u,c,p,h,o,l){var n,a,i,s,e;if(s=x[t],e=0,a=f,l===(X|ct)){do n=fr(d,m),i=Z[n&ut],e|=r(i&s,U),U+=o,d+=u,m+=c;while(0!==--a)}else do n=fr(d,m),i=Lt(n,l),e|=r(i&s,U),U+=o,d+=u,m+=c;while(0!==--a);return e}var ei=1,$r=11,P=4294967295,er=3,Qr=13,Yr=12,Xr=10,Zr=11,Hr=14,Gr=0,dr=4,Cr=5,Ur=2,Kr=7,zr=3,Wr=1,Rr=8,Mi=9,at=15,Er=6,Bt=2,Or=2,ct=4,Ot=8,X=1,jr=16384,nt=0,mr=3,tr=2,hr=1,Dt=1,Jr=43,Wt=0,w=0,y=0,I=0,O=0,h=0,o=0,k=0,$=0,xt=0,_t=0,N=0,V=0,R=0,C=0,Z=null,ut=0,ot=null,st=null,g=0,yr=0,$t=0,n=0,At=0,t=0,z=0,vt=0,l=0,j=0,p=0,c=0,q=0,ft=0,B=0,L=0,Yt=new Array(4096),_r=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],ar=[0,2,4,6,8,12,14,16],lr=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],U=0,i=0,a=0,dt=null,H=0,or=0,lt=0,Mt=0,Ct=0,wt=0,e=null,Sr=0,Ft=null,S=0,E=0,x=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],Xi="BitBltPlugin 3 November 2014 (e)",M=0,It=0,T=0,s=new Array(43),zt=0,yt=null,_=0,kt=0,f=0,Ht=0,b=0,D=0,it=0,F=0,tt=0,et=0,A=0,rt=0,St=0,Xt=0,Tt=0,d=0,m=0,G=null,Nt=null,pt=0,gr=0,kr=0,qr=new Array(32),Tr=0,Kt=0,Y=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:xi,copyBits:jt,moduleUnloaded:Li,primitiveDrawLoop:Ci,primitiveDisplayString:_i,initialiseModule:Ui,loadBitBltFrom:Jt,setInterpreter:ci,primitiveWarpBits:Ai,getModuleName:Ji,primitivePixelValueAt:Pi,copyBitsFromtoat:nn})}),module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function k(e,t){return 0|Math.floor(e/t)}function v(t,e){return e>31?0:t<<e}function c(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsFloat32Array()}function A(t){return e.success(e.isWords(t)),t.words}function I(){return g}function h(h){var o;return e.success(n(h)>=6),e.failed()?!1:(l=e.fetchIntegerofObject(0,h),i=e.fetchIntegerofObject(1,h),o=e.fetchPointerofObject(2,h),d=n(o),s=c(o),o=e.fetchPointerofObject(3,h),m=n(o),u=A(o),o=e.fetchPointerofObject(4,h),a=n(o),t=c(o),o=e.fetchPointerofObject(5,h),f=n(o),r=c(o),e.success(v(1,l)===i&&(i>>2)+1===d&&i===a&&i===f&&a===f),e.failed()===!1)}function o(){var i,n,l,s,o;for(s=0,l=m;l>s;){if(i=u[s]-1,n=u[s+1]-1,!(a>i&&a>n))return e.success(!1);o=t[i],t[i]=t[n],t[n]=o,o=r[i],r[i]=r[n],r[n]=o,s+=2}}function w(){var t;return t=e.stackObjectValue(0),h(t)?(o(),void(e.failed()&&o())):null}function O(){var t;return t=e.stackObjectValue(0),h(t)?void p():null}function y(){var t,r;return t=e.booleanValueOf(e.stackValue(0)),r=e.stackObjectValue(1),h(r)?(P(t),void(e.failed()||e.pop(1))):null}function p(){var e,n;if(1>=i)return null;for(n=1/i,e=0;i-1>=e;e++)t[e]=t[e]*n,r[e]=r[e]*n}function b(r){var t;return e=r,t=e.majorVersion()==S,t===!1?!1:t=e.minorVersion()>=F}function P(t){return o(),e.failed()?(o(),null):(C(t),void(t||p()))}function C(w){var S,O,m,u,n,y,a,e,c,p,g,h,b,f,o;for(O=i>>1,m=i>>2,h=1;l>=h;h++)for(p=v(1,h),g=p>>1,S=k(i,p),c=1;g>=c;c++)for(o=(c-1)*S,m>o?(f=s[d-o-1],a=s[o]):(f=0-s[o-m],a=s[O-o]),w||(a=0-a),u=c;i>=u;)e=u+g-1,n=u-1,b=t[e]*f-r[e]*a,y=t[e]*a+r[e]*f,t[e]=t[n]-b,r[e]=r[n]-y,t[n]=t[n]+b,r[n]=r[n]+y,u+=p}var S=1,F=11,i=0,r=null,f=0,e=null,g="FFTPlugin 3 November 2014 (e)",l=0,u=null,m=0,t=null,a=0,s=null,d=0;Squeak.registerExternalModule("FFTPlugin",{primitiveFFTTransformData:y,setInterpreter:b,primitiveFFTPermuteData:w,primitiveFFTScaleData:O,getModuleName:I})}),module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function f(){return S}function r(){var i,o,r,s,n,a;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(n)),e.failed())return null;if(s=t(i),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)a[r]=a[r]+o[r];e.pop(1)}function i(){var r,s,i,n,a;if(a=e.stackFloatValue(0),i=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.failed())return null;for(s=t(i),n=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)n[r]=n[r]+a;e.pop(1)}function n(){var n,s,r,i;return r=e.stackIntegerValue(0),i=e.stackObjectValue(1),e.failed()?null:(e.success(e.isWords(i)),e.success(r>0&&r<=t(i)),e.failed()?null:(n=i.wordsAsFloat32Array(),s=n[r-1],e.pop(2),void e.pushFloat(s)))}function s(){var s,a,i,n,r;return r=e.stackValue(0),a="number"==typeof r?r:e.floatValueOf(r),i=e.stackIntegerValue(1),n=e.stackObjectValue(2),e.failed()?null:(e.success(e.isWords(n)),e.success(i>0&&i<=t(n)),e.failed()?null:(s=n.wordsAsFloat32Array(),s[i-1]=a,void(e.failed()||e.popthenPush(3,r))))}function a(){var i,a,r,n,s,o;if(i=e.stackObjectValue(0),s=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.failed())return null;if(n=t(i),e.success(n===t(s)),e.failed())return null;for(o=s.wordsAsFloat32Array(),a=i.wordsAsFloat32Array(),r=0;n-1>=r;r++)if(0===a[r])return e.primitiveFail();for(r=0;n-1>=r;r++)o[r]=o[r]/a[r];e.pop(1)}function o(){var r,a,o,i,n,s;if(s=e.stackFloatValue(0),i=e.stackObjectValue(1),e.failed())return null;if(0===s)return e.primitiveFail();if(e.success(e.isWords(i)),e.failed())return null;for(o=t(i),n=i.wordsAsFloat32Array(),a=1/s,r=0;o-1>=r;r++)n[r]=n[r]*a;e.pop(1)}function u(){var i,o,r,s,n,u,a;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(n)),e.failed())return null;if(s=t(i),e.success(s===t(n)),e.failed())return null;for(u=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),a=0,r=0;s-1>=r;r++)a+=u[r]*o[r];e.pop(2),e.pushFloat(a)}function l(){var i,a,r,s,n,o;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(n)),e.failed())return null;if(e.pop(2),s=t(i),s!==t(n))return e.pushBool(!1);for(o=n.wordsAsFloat32Array(),a=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)if(o[r]!==a[r])return e.pushBool(!1);return e.pushBool(!0)}function c(){var r,s,i,a,n;if(i=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(i)),e.failed())return null;for(s=t(i),a=i.wordsAsInt32Array(),n=0,r=0;s-1>=r;r++)n+=a[r];return e.pop(1),e.pushInteger(536870911&n)}function O(){var r,a,n,s,i;if(n=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(n)),e.failed())return null;for(a=t(n),e.success(!0),s=n.wordsAsFloat32Array(),i=0,r=0;a-1>=r;r++)i+=s[r]*s[r];i=Math.sqrt(i),e.popthenPush(1,e.floatObjectOf(i))}function h(){var i,o,r,s,n,a;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(n)),e.failed())return null;if(s=t(i),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)a[r]=a[r]*o[r];e.pop(1)}function d(){var r,s,i,n,a;if(a=e.stackFloatValue(0),i=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.failed())return null;for(s=t(i),n=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)n[r]=n[r]*a;e.pop(1)}function p(){var r,i,a,s,n;if(s=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(s)),e.failed())return null;for(a=t(s),e.success(!0),n=s.wordsAsFloat32Array(),i=0,r=0;a-1>=r;r++)i+=n[r]*n[r];if(e.success(i>0),e.failed())return null;for(i=Math.sqrt(i),r=0;a-1>=r;r++)n[r]=n[r]/i}function m(){var i,o,r,s,n,a;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(n)),e.failed())return null;if(s=t(i),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)a[r]=a[r]-o[r];e.pop(1)}function v(){var r,s,i,n,a;if(a=e.stackFloatValue(0),i=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(i)),e.failed())return null;for(s=t(i),n=i.wordsAsFloat32Array(),r=0;s-1>=r;r++)n[r]=n[r]-a;e.pop(1)}function g(){var r,s,i,a,n;if(i=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(i)),e.failed())return null;for(s=t(i),a=i.wordsAsFloat32Array(),n=0,r=0;s-1>=r;r++)n+=a[r];e.popthenPush(1,e.floatObjectOf(n))}function b(r){var t;return e=r,t=e.majorVersion()==k,t===!1?!1:t=e.minorVersion()>=y}var k=1,y=11,e=null,S="FloatArrayPlugin 3 November 2014 (e)";Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:h,primitiveEqual:l,primitiveAtPut:s,primitiveAt:n,primitiveNormalize:p,primitiveSubFloatArray:m,primitiveDivFloatArray:a,primitiveAddScalar:i,primitiveDotProduct:u,primitiveSubScalar:v,setInterpreter:b,primitiveSum:g,getModuleName:f,primitiveHashArray:c,primitiveMulScalar:d,primitiveLength:O,primitiveAddFloatArray:r,primitiveDivScalar:o})}),module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function r(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function i(r,i){var n,s,e,a,o,t;return n=r[0],a=r[1],s=i[0],o=i[1],e=s-n,t=o-a,e*e+t*t}function p(t,r){var e;return e=Math.abs(r-t),e>180&&(e=360-e),e*e>>>6}function u(){return s}function a(){return 2}function o(){return 0}function n(e){console.log(s+": "+e)}function l(){var Y,J,z,o,I,_,C,w,Q,h,H,L,b,y,G,f,S,k,K,X,u,l,B,F,s,a,d,O,Z,W,m,v,$,M,c,g,P,A,D,E,R,V,T,x,U,q,N,j,et;if(P=e.stackValue(11),A=e.stackValue(10),D=e.stackValue(9),E=e.stackValue(8),R=e.stackValue(7),V=e.stackValue(6),T=e.stackValue(5),x=e.stackValue(4),U=e.stackIntegerValue(3),q=e.stackValue(2),N=e.stackValue(1),j=e.stackValue(0),e.failed())return null;if(e.failed())return n("failed 1"),null;if(e.success(e.isWords(P)&&e.isWords(A)&&e.isWords(D)&&e.isWords(E)&&e.isWords(R)&&e.isWords(V)&&e.isWords(T)&&e.isWords(x)&&e.isWords(q)&&e.isWords(N)&&e.isWords(j)),e.failed())return n("failed 2"),null;if(e.success(e.isMemberOf(P,"PointArray")&&e.isMemberOf(A,"PointArray")),e.failed())return n("failed 3"),null;if(b=P.wordsAsInt32Array(),k=A.wordsAsInt32Array(),X=D.wordsAsInt32Array(),Q=E.wordsAsInt32Array(),G=R.wordsAsInt32Array(),H=V.wordsAsInt32Array(),$=T.wordsAsInt32Array(),Y=x.wordsAsInt32Array(),l=q.wordsAsInt32Array(),c=N.wordsAsInt32Array(),u=j.wordsAsInt32Array(),K=t(A)>>>1,O=t(D)>>>1,h=t(E)>>>1,J=t(V),L=t(q),e.success(L===t(N)&&L===t(j)&&L>h),e.failed())return n("failed 4"),null;if(e.success(t(R)>=O-1&&t(P)>>>1>=O&&J>=h-1&&K>=h&&t(T)>=O-1&&t(x)>=h-1),e.failed())return n("failed 5"),null;if(z=1&U,W=U>>>1,B=1<<29,f=z?0:W*W>>>10,l[0]=0,c[0]=0,u[0]=2,a=0-f,y=h,!(K>=y-1&&J>=y-1))return e.primitiveFail(),null;for(s=1;y>=s;s++)o=s-1,a=a+(H[o]+i(r(k,o<<1),b)>>>7)+f,c[s]=a,l[s]=a*s,u[s]=s+1;for(a=c[0]-f,d=1;O>=d;d++){for(I=d-1,F=I<<1,v=l[0],a=a+(G[I]+i(r(b,F),k)>>>7)+f,c[0]=a,l[0]=a*d,u[0]=d+1,y=h,s=1;y>=s;s++)o=s-1,_=o<<1,m=l[s],g=l[o],S=G[I]+i(r(b,F),r(k,s<<1))>>>7,0===(a=c[s])?m+=S:(m=m+a+S*u[s],S+=a),w=H[o]+i(r(k,_),r(b,d<<1))>>>7,0===(a=c[o])?g+=w:(g=g+a+w*u[o],w+=a),z?v=B:(Z=(i(r(Q,_),r(X,F))+i(r(k,_),r(b,F)))*(16+p(Y[o],$[I]))>>>11,v+=Z),m>=v&&g>=v?(C=v,a=0,M=1):g>=m?(C=m,a=S+f,M=u[s]+1):(C=g,a=w+f,M=u[o]+1),v=l[s],l[s]=Math.min(C,B),c[s]=Math.min(a,B),u[s]=M;a=c[0]}return et=C,e.failed()?null:(e.popthenPush(13,et),null)}function c(){var t;return t=1e3*a()+o(),e.failed()?null:(e.popthenPush(1,t),null)}function f(r){var t;return e=r,t=e.majorVersion()==h,t===!1?!1:t=e.minorVersion()>=d}var h=1,d=11,e=null,s="GeniePlugin v2.0 14 November 2014 (e)";Squeak.registerExternalModule("GeniePlugin",{primVersionNO:c,setInterpreter:f,primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:l,getModuleName:u})}),module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function ut(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function v(e,t){return 0|Math.floor(e/t)}function _(t,e){return e>31?0:t<<e}function ft(t,e){return e>31?0:t>>>e}function ht(e){return A(u,e)&&C(it,e)}function A(r,t){return"number"==typeof t?!1:e.isPointers(t)?n(t)<G?!1:(r[s]=e.fetchIntegerofObject(s,t),r[o]=e.fetchIntegerofObject(o,t),r[k]=e.fetchIntegerofObject(k,t),r[O]=e.fetchIntegerofObject(O,t),r[y]=e.fetchIntegerofObject(y,t),r[b]=e.fetchIntegerofObject(b,t),r[g]=e.fetchIntegerofObject(g,t),!e.failed()):!1}function C(o,s){var t,r,i,a;if("number"==typeof s)return!1;if(!e.isPointers(s))return!1;if(n(s)<G)return!1;if(t=e.fetchPointerofObject(st,s),"number"==typeof t)return!1;if(!e.isPointers(t))return!1;if(a=n(t),a>kt)return!1;for(i=0;a-1>=i;i++){if(r=e.fetchPointerofObject(i,t),"number"==typeof r)return!1;if(!e.isWords(r))return!1;if(n(r)!==p)return!1;o[i]=r.wordsAsInt32Array()}return!e.failed()}function jt(){var t,e;for(r[s]=0,r[o]=0,t=0;F-1>=t;t++)e=j(),e+=d[I],e=Math.min(e,i),d[I]=e&h,e&=i-h,e=Math.max(e,1),w[t]=4278190080+(e<<16)+(e<<8)+e}function Vt(){var e,l,c,t,p,n,m;for(r[s]=0,r[o]=0,u[s]=0,u[o]=0,a[s]=0,a[o]=0,p=0;F-1>=p;p++)m=j(),l=Ot(),l-=f,c=St(),c-=f,n=m+(ot*c>>16)+d[W],n=Math.min(n,i),n=Math.max(n,0),d[W]=n&h,n&=i-h,n=Math.max(n,1),t=m-(ct*l>>16)-(lt*c>>16)+d[I],t=Math.min(t,i),t=Math.max(t,0),d[I]=t&h,t&=i-h,t=Math.max(t,1),e=m+(at*l>>16)+d[q],e=Math.min(e,i),e=Math.max(e,0),d[q]=e&h,e&=i-h,e=Math.max(e,1),w[p]=4278190080+(n<<16)+(t<<8)+e}function _t(e){return A(a,e)&&C(H,e)}function Ct(a,o){var i,t,n,r,s;if(t=et(T,N),0>t)return e.primitiveFail();for(0!==t&&(i=P(t),t=K(i,t)),t=o[g]=o[g]+t,a[0]=t,n=1;p-1>=n;n++)a[n]=0;for(r=1;p>r;){if(t=et(M,V),0>t)return e.primitiveFail();if(s=t>>>4,t=15&t,0!==t){if(r+=s,i=P(t),t=K(i,t),0>r||r>=p)return e.primitiveFail();a[Ft[r]]=t}else{if(15!==s)return null;r+=s}++r}}function Pt(){for(var e;16>=l;){if(!(S>c))return l;if(e=x[c],++c,255===e){if(!(S>c&&0===x[c]))return--c,l;++c}m=m<<8|e,l+=8}return l}function P(e){var t;return e>l&&(Pt(),e>l)?-1:(l-=e,t=ft(m,l),m&=_(1,l)-1,t)}function At(){return xt}function It(c,v){var w,I,e,F,O,a,o,g,k,b,y,s,n,r,d,h,u,m,S,l=new Array(64);for(e=0;t-1>=e;e++){for(w=-1,O=1;t-1>=O;O++)-1===w&&0!==c[O*t+e]&&(w=O);if(-1===w)for(I=c[e]*v[0]<<2,F=0;t-1>=F;F++)l[F*t+e]=I;else h=c[2*t+e]*v[2*t+e],u=c[6*t+e]*v[6*t+e],d=(h+u)*R,s=d+u*(0-Z),n=d+h*z,h=c[e]*v[e],u=c[4*t+e]*v[4*t+e],a=h+u<<13,o=h-u<<13,g=a+n,y=a-n,k=o+s,b=o-s,a=c[7*t+e]*v[7*t+e],o=c[5*t+e]*v[5*t+e],s=c[3*t+e]*v[3*t+e],n=c[t+e]*v[t+e],d=a+n,h=o+s,u=a+s,m=o+n,S=(u+m)*U,a*=L,o*=Y,s*=$,n*=nt,d*=0-D,h*=0-Q,u*=0-X,m*=0-E,u+=S,m+=S,a=a+d+u,o=o+h+m,s=s+h+u,n=n+d+m,l[e]=g+n>>11,l[7*t+e]=g-n>>11,l[1*t+e]=k+s>>11,l[6*t+e]=k-s>>11,l[2*t+e]=b+o>>11,l[5*t+e]=b-o>>11,l[3*t+e]=y+a>>11,l[4*t+e]=y-a>>11}for(e=0;p-t>=e;e+=t)h=l[e+2],u=l[e+6],d=(h+u)*R,s=d+u*(0-Z),n=d+h*z,a=l[e]+l[e+4]<<13,o=l[e]-l[e+4]<<13,g=a+n,y=a-n,k=o+s,b=o-s,a=l[e+7],o=l[e+5],s=l[e+3],n=l[e+1],d=a+n,h=o+s,u=a+s,m=o+n,S=(u+m)*U,a*=L,o*=Y,s*=$,n*=nt,d*=0-D,h*=0-Q,u*=0-X,m*=0-E,u+=S,m+=S,a=a+d+u,o=o+h+m,s=s+h+u,n=n+d+m,r=(g+n>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e]=r,r=(g-n>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+7]=r,r=(k+s>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+1]=r,r=(k-s>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+6]=r,r=(b+o>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+2]=r,r=(b-o>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+5]=r,r=(y+a>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+3]=r,r=(y-a>>18)+f,r=Math.min(r,i),r=Math.max(r,0),c[e+4]=r}function et(s,a){var r,e,i,n,t;if(e=s[0]>>>24,e>rt)return-1;for(n=2;;){if(r=P(e),0>r)return-1;if(i=n+r-1,i>=a)return-1;if(t=s[i],0===(1056964608&t))return t;if(n=65535&t,e=t>>>24&255,e>rt)return-1}return-1}function wt(t){var r,i;return n(t)<5?!1:e.isPointers(t)?(r=e.fetchPointerofObject(0,t),"number"==typeof r?!1:e.isBytes(r)?(x=r.bytes,i=ut(r),c=e.fetchIntegerofObject(1,t),S=e.fetchIntegerofObject(2,t),m=e.fetchIntegerofObject(3,t),l=e.fetchIntegerofObject(4,t),e.failed()?!1:S>i?!1:0>c||c>=S?!1:!0):!1):!1}function Ot(){var a,r,e,t,l,c,i,n;return e=r=u[s],t=u[o],i=u[k],n=u[O],0!==i&&0!==n&&(e=v(e,i),t=v(t,n)),a=(t>>>3)*u[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=it[a][c],++r,r<8*u[b]?u[s]=r:(u[s]=0,u[o]++),l}function St(){var u,r,e,t,l,c,i,n;return e=r=a[s],t=a[o],i=a[k],n=a[O],0!==i&&0!==n&&(e=v(e,i),t=v(t,n)),u=(t>>>3)*a[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=H[u][c],++r,r<8*a[b]?a[s]=r:(a[s]=0,a[o]++),l}function j(){var u,i,e,t,l,c,n,a;return e=i=r[s],t=r[o],n=r[k],a=r[O],0!==n&&0!==a&&(e=v(e,n),t=v(t,a)),u=(t>>>3)*r[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=B[u][c],++i,i<8*r[b]?r[s]=i:(r[s]=0,r[o]++),l}function yt(){var t;return J(),4!==e.methodArgumentCount()?e.primitiveFail():(h=e.stackIntegerValue(0),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&3===n(t)?(d=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(F=n(t),w=t.wordsAsInt32Array(),t=e.stackObjectValue(3),e.failed()?null:tt(t)?(jt(),void e.pop(4)):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function qt(){var t;return J(),4!==e.methodArgumentCount()?e.primitiveFail():(h=e.stackIntegerValue(0),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&3===n(t)?(d=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(F=n(t),w=t.wordsAsInt32Array(),t=e.stackObjectValue(3),e.failed()?null:e.isPointers(t)&&3===n(t)&&tt(e.fetchPointerofObject(0,t))&&ht(e.fetchPointerofObject(1,t))&&_t(e.fetchPointerofObject(2,t))?(Vt(),void e.pop(4)):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function bt(){var s,t,i;return 5!==e.methodArgumentCount()?e.primitiveFail():(i=e.stackObjectValue(0),e.failed()?null:wt(i)?(t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)?(V=n(t),M=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(N=n(t),T=t.wordsAsInt32Array(),i=e.stackObjectValue(3),e.failed()?null:A(r,i)?(t=e.stackObjectValue(4),e.failed()?null:e.isWords(t)?n(t)!==p?e.primitiveFail():(s=t.wordsAsInt32Array(),e.failed()?null:(Ct(s,r),e.failed()?null:(mt(e.stackValue(0)),e.storeIntegerofObjectwithValue(g,e.stackValue(3),r[g]),void e.pop(5)))):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function gt(){var r,t,i;return 2!==e.methodArgumentCount()?e.primitiveFail():(t=e.stackObjectValue(0),e.failed()?null:e.isWords(t)&&n(t)===p?(i=t.wordsAsInt32Array(),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&n(t)===p?(r=t.wordsAsInt32Array(),It(r,i),void e.pop(2)):e.primitiveFail()):e.primitiveFail())}function K(e,t){return e<_(1,t-1)?e-_(1,t)+1:e}function vt(r){var t;return e=r,t=e.majorVersion()==pt,t===!1?!1:t=e.minorVersion()>=dt}function J(){}function mt(t){e.storeIntegerofObjectwithValue(1,t,c),e.storeIntegerofObjectwithValue(3,t,m),e.storeIntegerofObjectwithValue(4,t,l)}function tt(e){return A(r,e)&&C(B,e)}var pt=1,dt=11,y=5,q=2,s=0,o=1,t=8,p=64,L=2446,ct=22554,E=3196,R=4433,lt=46802,z=6270,D=7373,U=9633,ot=91881,nt=12299,at=116130,Z=15137,X=16069,Y=16819,Q=20995,$=25172,I=1,k=2,st=4,b=8,rt=16,kt=128,i=255,G=11,g=10,W=0,f=127,O=3,M=null,V=0,it=new Array(128),u=new Array(11),H=new Array(128),a=new Array(11),T=null,N=0,h=0,e=null,w=null,F=0,Ft=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],m=0,l=0,x=null,c=0,S=0,xt="JPEGReaderPlugin 3 November 2014 (e)",d=null,B=new Array(128),r=new Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:vt,primitiveIdctInt:gt,primitiveColorConvertMCU:qt,primitiveColorConvertGrayscaleMCU:yt,primitiveDecodeMCU:bt,getModuleName:At})}),module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function a(e,t){return 0|Math.floor(e/t)}function h(e,t){return e-a(e,t)*t|0}function it(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function c(t,r){var i,e;return 0===t?r>=0?90:270:(i=r/t,e=Math.atan(i),t>=0?r>=0?e/.0174532925199433:360+e/.0174532925199433:180+e/.0174532925199433)}function o(r){var e,i,t;return e=90-r,t=e/360|0,0>e&&--t,i=.0174532925199433*(e-360*t)}function rt(){var p,v,o,d,h,s,a,r,i,k,g,l,c,m,n,f,b,u;if(l=e.stackValue(0),o=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),h=e.stackIntegerValue(4),a=e.stackIntegerValue(5),s=e.stackValue(6),e.failed())return null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isBytes(l))return e.primitiveFail(),null;if(h*a!==t(s))return e.primitiveFail(),null;if(i=t(n),t(u)!==i)return e.primitiveFail(),null;if(t(o)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;for(m=n.wordsAsFloat32Array(),b=u.wordsAsFloat32Array(),v=o.words,g=l.bytes,d=s.words,r=0;i-1>=r;r++)c=0|m[r],f=0|b[r],k=g[r],0!==k&&c>=0&&f>=0&&a>c&&h>f&&(p=f*a+c,d[p]=v[r]);return e.failed()?null:void e.pop(7)}function tt(){var r,o,n,i,u,s,a;if(s=e.stackValue(0),n=e.stackValue(1),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(a=t(n),t(s)!==a)return e.primitiveFail(),null;for(o=n.wordsAsFloat32Array(),u=s.wordsAsFloat32Array(),i=0;a-1>=i;i++)r=o[i],r/=.0174532925199433,r=90-r,r>0||(r+=360),u[i]=r;return e.failed()?null:void e.pop(2)}function $(){return et}function Q(){var r,s,i,n;return i=e.stackValue(0),n=e.stackIntegerValue(1),e.failed()?null:e.isWords(i)?t(i)<n?(e.primitiveFail(),null):(s=i.wordsAsFloat32Array(),r=s[n-1],r=d(r),e.failed()?null:(e.pop(3),void e.pushFloat(r))):(e.primitiveFail(),null)}function L(){r=17,i=16807,u=2147483647,l=a(u,i),p=h(u,i)}function f(e){var n,s,o,u,t;return o=0>e?0-e:e,n=a(r,l),s=h(r,l),r=i*s-p*n,u=65535&r,t=u*(o+1)>>>16,0>e?0-t:t}function m(){var t;return t=e.stackIntegerValue(0),e.failed()?null:(r=65536&t,void e.pop(1))}function V(){var r,c,u,s,a,l,i,f,o,h,d,n;if(n=e.stackIntegerValue(0),d=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(a=t(s),h=t(o),a!==h)return e.primitiveFail(),null;if(-32>n)return e.primitiveFail(),null;if(n>8)return e.primitiveFail(),null;for(c=s.words,f=o.words,l=4278190080,i=0;a-1>=i;i++)u=c[i],r=it(u,n),r>255&&(r=255),0>r&&(r=0),f[i]=r<<24&l|d;e.pop(4)}function _(){var i,l,n,s,a,c,r,v,o,f,h,d,p,m,u;if(m=e.stackValue(0),u=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(d=m.words,h=d[0],e.failed())return null;if(p=Math.log(h),a=t(s),f=t(o),a!==f)return e.primitiveFail(),null;for(l=s.words,v=o.words,c=4278190080,r=0;a-1>=r;r++)n=l[r],i=0===n?0:255/p*Math.log(n)|0,i>255&&(i=255),v[r]=i<<24&c|u;e.pop(4)}function v(){var u,r,f,s,a,o,h,n,i,d,p,l,m,v,c;if(u=e.stackIntegerValue(0),i=e.stackIntegerValue(1),c=e.stackValue(2),l=e.stackValue(3),n=e.stackValue(4),a=e.stackValue(5),!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(a))return e.primitiveFail(),null;if(o=t(n),t(l)!==o)return e.primitiveFail(),null;if(t(c)!==o)return e.primitiveFail(),null;if(t(a)!==u*i)return e.primitiveFail(),null;for(p=l.wordsAsFloat32Array(),v=c.wordsAsFloat32Array(),h=n.words,f=a.words,r=0;u*i-1>=r;r++)f[r]=0;for(r=0;o-1>=r;r++)d=p[r],m=v[r],s=i*m+d,s>=0&&u*i>s&&(f[s]=h[r]);return e.failed()?null:void e.pop(6)}function T(){var u,r,a,l,o,i,n,c,s,f;return a=e.stackIntegerValue(0),i=e.stackIntegerValue(1),f=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),e.failed()?null:e.isWords(r)?t(r)!==a*i?(e.primitiveFail(),null):(n=0|c,s=0|f,u=r.words,n>=0&&i>n&&s>=0&&a>s?(l=s*i+n,o=u[l]):o=0,e.failed()?null:(e.pop(6),void e.pushInteger(o))):(e.primitiveFail(),null)}function g(){var f,i,o,l,r,u,n,s,c,a,h;return o=e.stackIntegerValue(0),n=e.stackIntegerValue(1),u=e.stackIntegerValue(2),h=e.stackFloatValue(3),c=e.stackFloatValue(4),i=e.stackValue(5),e.failed()?null:e.isWords(i)?t(i)!==o*n?(e.primitiveFail(),null):(s=0|c,a=0|h,r=u,r>1073741823&&(r=1073741823),0>r&&(r=0),f=i.words,s>=0&&n>s&&a>=0&&o>a&&(l=a*n+s,f[l]=r),e.failed()?null:void e.pop(6)):(e.primitiveFail(),null)}function b(){var v,f,p,s,a,d,u,r,c,l,h,o,n,m,i;if(u=e.stackValue(0),f=e.stackIntegerValue(1),a=e.stackIntegerValue(2),s=e.stackValue(3),i=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(i))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(f*a!==t(s))return e.primitiveFail(),null;if(c=t(o),t(i)!==c)return e.primitiveFail(),null;if(t(u)!==c)return e.primitiveFail(),null;for(h=o.wordsAsFloat32Array(),m=i.wordsAsFloat32Array(),d=u.words,v=s.words,r=0;c-1>=r;r++)l=0|h[r],n=0|m[r],l>=0&&n>=0&&a>l&&f>n&&(p=n*a+l,d[r]=v[p]);return e.failed()?null:void e.pop(6)}function k(){var v,d,k,l,i,o,r,y,S,O,p,m,c,g,b,f,u,h,a;return v=e.stackIntegerValue(0),g=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),d=e.stackFloatValue(4),k=e.stackFloatValue(5),b=e.stackFloatValue(6),o=e.stackValue(7),a=e.stackValue(8),u=e.stackValue(9),y=e.stackIntegerValue(10),e.failed()?null:e.isWords(u)&&e.isWords(a)&&e.isWords(o)?(c=t(u),t(a)!==c?(e.primitiveFail(),null):t(o)!==c?(e.primitiveFail(),null):(f=u.wordsAsFloat32Array(),h=a.wordsAsFloat32Array(),i=o.wordsAsFloat32Array(),l=b,r=y-1,O=f[r]+l*Math.cos(i[r]),p=h[r]-l*Math.sin(i[r]),s(r,f,i,O,k,S,m),n(r,h,i,p,d,g,v),e.failed()?null:void e.pop(11))):(e.primitiveFail(),null)}function y(){var k,d,g,o,u,r,v,i,c,h,n,p,f,m,l,a,b,s;if(n=e.stackValue(0),d=e.stackIntegerValue(1),u=e.stackIntegerValue(2),o=e.stackValue(3),s=e.stackValue(4),l=e.stackValue(5),e.failed())return null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(d*u!==t(o))return e.primitiveFail(),null;if(c=t(l),t(s)!==c)return e.primitiveFail(),null;if(i="number"==typeof n,i&&(v=n),!i){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null;if(t(n)!==c)return e.primitiveFail(),null}for(m=l.wordsAsFloat32Array(),b=s.wordsAsFloat32Array(),i||(p=n.words),k=o.words,i&&(h=v),r=0;c-1>=r;r++)f=0|m[r],a=0|b[r],f>=0&&a>=0&&u>f&&d>a&&(g=a*u+f,i||(h=p[r]),k[g]=h);return e.failed()?null:void e.pop(6)}function S(){var y,w,v,d,o,c,r,a,S,O,F,m,u,g,b,k,i,h,l,p,f;if(y=e.stackIntegerValue(0),g=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),w=e.stackFloatValue(4),v=e.stackFloatValue(5),i=e.stackValue(6),c=e.stackValue(7),f=e.stackValue(8),l=e.stackValue(9),e.failed())return null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(c))return e.primitiveFail(),null;if(i.isFloat)a=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;a=!0}if(u=t(l),t(f)!==u)return e.primitiveFail(),null;if(t(c)!==u)return e.primitiveFail(),null;if(a&&t(i)!==u)return e.primitiveFail(),null;for(h=l.wordsAsFloat32Array(),p=f.wordsAsFloat32Array(),o=c.wordsAsFloat32Array(),a?k=i.wordsAsFloat32Array():b=e.floatValueOf(i),r=0;u-1>=r;r++)d=a?k[r]:b,O=h[r]+d*Math.cos(o[r]),F=p[r]-d*Math.sin(o[r]),s(r,h,o,O,v,S,m),n(r,p,o,F,w,g,y);return e.failed()?null:void e.pop(10)}function O(){var m,f,F,w,u,p,l,O,S,y,o,I,v,g,b,k,h,i,r,n,a,s;if(o=e.stackIntegerValue(0),u=e.stackIntegerValue(1),n=e.stackIntegerValue(2),f=e.stackValue(3),g=e.stackFloatValue(4),k=e.stackFloatValue(5),b=e.stackFloatValue(6),e.failed())return null;if(!e.isWords(f))return e.primitiveFail(),null;if(t(f)!==u*n)return e.primitiveFail(),null;for(m=f.words,i=b,r=k,i=Math.max(i,0),r=Math.max(r,0),i=Math.min(i,n-1),r=Math.min(r,u-1),I=Math.max(i-o,0),F=Math.min(i+o,n-1),v=Math.max(r-o,0),w=Math.min(r+o,u-1),p=m[r*n+i],l=-1,s=v;w>=s;s++)for(y=s*n,a=I;F>=a;a++)h=m[y+a],h>p&&(l=a,O=s,p=h);return S=-1===l?d(g):c(l-i,O-r)+90|0,e.failed()?null:(e.pop(8),void e.pushFloat(S))}function w(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]+f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]+h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]+f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]+h[r];e.pop(4),e.push(i)}function F(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]+h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]+u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]+h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]+u;e.pop(4),e.push(i)}function I(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]/f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]/h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]/f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]/h[r];e.pop(4),e.push(i)}function A(){var s,l,h,o,r,d,f,p,u,n,i,c,m;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(u=t(n),e.success(u===t(i)),e.failed())return null;if(f="number"==typeof s,p=e.isMemberOf(n,"WordArray"),f&&p){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null
}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(f)for(c=n.words,d=s,m=i.words,r=0;u-1>=r;r++)m[r]=a(c[r],d);else for(c=n.words,l=e.floatValueOf(s),o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=c[r]/l;else if(f)for(h=n.wordsAsFloat32Array(),d=s,o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=h[r]/d;else for(h=n.wordsAsFloat32Array(),l=e.floatValueOf(s),o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=h[r]/l;e.pop(4),e.push(i)}function P(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]*f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]*h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]*f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]*h[r];e.pop(4),e.push(i)}function C(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]*h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]*u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]*h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]*u;e.pop(4),e.push(i)}function nt(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]-f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]-h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]-f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]-h[r];e.pop(4),e.push(i)}function x(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]-h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]-u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]-h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]-u;e.pop(4),e.push(i)}function d(r){var e,t;return t=r/.0174532925199433,e=90-t,e>0||(e+=360),e}function j(){var a,o,r,i,n,u,l,s;if(a=e.stackFloatValue(0),r=e.stackValue(1),s=e.stackIntegerValue(2),i=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(r))return e.primitiveFail(),null;if(l=t(r),!(l>=s&&i>=1&&s>=i))return e.primitiveFail(),null;if(o=r.wordsAsFloat32Array(),e.failed())return null;for(n=i;s>=n;n++)o[n-1]=f(u)*a;e.pop(5)}function q(){var a,r,i,o,n,u,l,s;if(a=e.stackFloatValue(0),n=e.stackValue(1),s=e.stackIntegerValue(2),r=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(l=t(n),!(l>=s&&r>=1&&s>=r))return e.primitiveFail(),null;if(o=n.words,e.failed())return null;for(i=r;s>=i;i++)o[i-1]=f(u)*a|0;e.pop(5)}function M(){var t,r;return t=e.stackIntegerValue(0),e.failed()?null:(r=f(t),e.failed()?null:(e.pop(2),void e.pushInteger(r)))}function B(){var r,i,t,n,s,a,o;return i=e.stackFloatValue(0),r=e.stackFloatValue(1),s=e.stackFloatValue(2),n=e.stackFloatValue(3),e.failed()?null:(a=n-r,o=s-i,t=c(a,o),t+=90,t>360&&(t-=360),e.failed()?null:(e.pop(5),void e.pushFloat(t)))}function N(){var i,n,s,a,o,t,r;return n=e.stackFloatValue(0),i=e.stackFloatValue(1),o=e.stackFloatValue(2),a=e.stackFloatValue(3),e.failed()?null:(t=i-a,r=n-o,s=Math.sqrt(t*t+r*r),e.failed()?null:(e.pop(5),void e.pushFloat(s)))}function s(i,o,n,u,r,s,a){var t,e;e=u,0>e&&(1===s&&(e+=r),2===s&&(e=0),3===s&&(e=0-e,t=n[i],n[i]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),e>=r&&(1===a&&(e-=r),2===a&&(e=r-1e-6),3===a&&(e=r-1e-6-(e-r),t=n[i],n[i]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),o[i]=e}function n(r,a,i,o,t,n,s){var e;e=o,0>e&&(1===n&&(e+=t),2===n&&(e=0),3===n&&(e=0-e,i[r]=6.283185307179586-i[r])),e>=t&&(1===s&&(e-=t),2===s&&(e=t-1e-6),3===s&&(e=t-1e-6-(e-t),i[r]=6.283185307179586-i[r])),a[r]=e}function D(){var r,l,s,n,a,c,i,u;if(i=e.stackValue(0),s=e.stackValue(1),e.failed())return null;if(!e.isWords(s))return e.primitiveFail(),null;if(u=t(s),i.isFloat)a=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;if(t(i)!==u)return e.primitiveFail(),null;a=!0}for(l=s.wordsAsFloat32Array(),a?c=i.wordsAsFloat32Array():(r=e.floatValueOf(i),r=o(r)),n=0;u-1>=n;n++)a&&(r=c[n],r=o(r)),l[n]=r;return e.failed()?null:void e.pop(2)}function E(r){var t;return e=r,t=e.majorVersion()==X,t===!1?!1:t=e.minorVersion()>=Y}function R(){var n,s,r,i;return n=e.stackFloatValue(0),r=e.stackValue(1),i=e.stackIntegerValue(2),e.failed()?null:e.isWords(r)?t(r)<i?(e.primitiveFail(),null):(s=r.wordsAsFloat32Array(),s[i-1]=o(n),e.failed()?null:void e.pop(3)):(e.primitiveFail(),null)}function W(){return!0}function z(){var n,a,r,o,u,l,c,f,h,i;return u=e.stackIntegerValue(0),o=e.stackIntegerValue(1),n=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),h=e.stackIntegerValue(5),i=e.stackValue(6),e.failed()?null:e.isWords(i)&&e.isWords(r)?(l=t(i),t(r)!==l?(e.primitiveFail(),null):(f=i.wordsAsFloat32Array(),a=r.wordsAsFloat32Array(),s(h-1,f,a,c,n,o,u),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function K(){var s,a,o,r,u,l,c,f,h,i;return s=e.stackIntegerValue(0),l=e.stackIntegerValue(1),a=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),h=e.stackIntegerValue(5),i=e.stackValue(6),e.failed()?null:e.isWords(i)&&e.isWords(r)?(u=t(i),t(r)!==u?(e.primitiveFail(),null):(f=i.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),n(h-1,f,o,c,a,l,s),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function U(){var f,c,o,i,n,p,l,v,u,h,d,r,m,a;if(v=e.stackIntegerValue(0),p=e.stackIntegerValue(1),f=e.stackFloatValue(2),r=e.stackValue(3),o=e.stackValue(4),a=e.stackValue(5),e.failed())return null;if(!e.isWords(a))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(r.isFloat)n=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;n=!0}if(u=t(a),t(o)!==u)return e.primitiveFail(),null;if(n&&t(r)!==u)return e.primitiveFail(),null;for(m=a.wordsAsFloat32Array(),c=o.wordsAsFloat32Array(),n?d=r.wordsAsFloat32Array():h=e.floatValueOf(r),i=0;u-1>=i;i++)l=n?d[i]:h,s(i,m,c,l,f,p,v);return e.failed()?null:void e.pop(6)}function G(){var v,c,p,u,i,s,l,a,f,h,d,r,m,o;if(v=e.stackIntegerValue(0),f=e.stackIntegerValue(1),c=e.stackFloatValue(2),r=e.stackValue(3),u=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(r.isFloat)s=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;s=!0}if(a=t(o),t(u)!==a)return e.primitiveFail(),null;if(s&&t(r)!==a)return e.primitiveFail(),null;for(m=o.wordsAsFloat32Array(),p=u.wordsAsFloat32Array(),s?d=r.wordsAsFloat32Array():h=e.floatValueOf(r),i=0;a-1>=i;i++)l=s?d[i]:h,n(i,m,p,l,c,f,v);return e.failed()?null:void e.pop(6)}function H(){var r,s,g,a,p,n,d,h,u,y,o,i,m,v,f,b,k,l;if(o=e.stackValue(0),l=e.stackValue(1),f=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(i=t(o),0>i)return e.primitiveFail(),null;if(t(f)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==i)return e.primitiveFail(),null;if(t(n)!==i)return e.primitiveFail(),null}for(y=o.wordsAsFloat32Array(),v=f.wordsAsFloat32Array(),k=l.wordsAsFloat32Array(),s&&(g=a.wordsAsFloat32Array(),p=n.wordsAsFloat32Array()),s||(d=e.floatValueOf(a),h=e.floatValueOf(n)),r=0;i-1>=r;r++)s&&(d=g[r],h=p[r]),m=d-v[r],b=h-k[r],u=c(m,b),u+=90,u>360&&(u-=360),y[r]=u;return e.failed()?null:(e.pop(6),void e.push(o))}function J(){var r,s,v,a,p,n,f,c,b,o,i,h,m,u,d,g,l;if(o=e.stackValue(0),l=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(i=t(o),0>i)return e.primitiveFail(),null;if(t(u)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==i)return e.primitiveFail(),null;if(t(n)!==i)return e.primitiveFail(),null}for(b=o.wordsAsFloat32Array(),m=u.wordsAsFloat32Array(),g=l.wordsAsFloat32Array(),s&&(v=a.wordsAsFloat32Array(),p=n.wordsAsFloat32Array()),s||(f=e.floatValueOf(a),c=e.floatValueOf(n)),r=0;i-1>=r;r++)s&&(f=v[r],c=p[r]),h=f-m[r],d=c-g[r],b[r]=Math.sqrt(h*h+d*d);return e.failed()?null:(e.pop(6),void e.push(o))}function Z(){var k,v,h,d,b,o,u,g,i,s,r,n,p,m,f,l,a,c;if(c=e.stackIntegerValue(0),l=e.stackIntegerValue(1),u=e.stackIntegerValue(2),i=e.stackIntegerValue(3),h=e.stackValue(4),s=e.stackValue(5),e.failed())return null;if(p=t(s),b=t(h),i*u!==p)return e.primitiveFail(),null;if(p*l*c!==b)return e.primitiveFail(),null;for(g=s.words,v=h.words,r=0,n=0,d=0,f=0;u-1>=f;f++){for(a=0;c-1>=a;a++){for(m=0;i-1>=m;m++)for(k=g[r],++r,o=0;l-1>=o;o++)v[d]=k,++d;r=n}n+=i,r=n}e.pop(6)}var X=1,Y=11,e=null,r=0,et="KedamaPlugin 3 November 2014 (e)",i=0,u=0,l=0,p=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:_,vectorGetDistanceTo:J,getScalarHeading:Q,shutdownModule:W,primitiveAddScalar:F,primSetPixelsAtXY:y,turtleScalarSetX:z,primPixelAtXY:T,primUpHill:O,primScalarForward:k,primitiveDivArrays:I,getModuleName:$,primitiveSubArrays:nt,scalarGetAngleTo:B,randomRange:M,setInterpreter:E,kedamaSetRandomSeed:m,drawTurtlesInArray:rt,turtleScalarSetY:K,randomIntoIntegerArray:q,getHeadingArrayInto:tt,makeTurtlesMap:v,setHeadingArrayFrom:D,turtlesSetX:U,setScalarHeading:R,makeMask:V,primitiveDivScalar:A,primitiveSubScalar:x,primPixelsAtXY:b,vectorGetAngleTo:H,primitiveMulArrays:P,primPixelAtXYPut:g,zoomBitmap:Z,initialiseModule:L,primitiveAddArrays:w,scalarGetDistanceTo:N,turtlesSetY:G,randomIntoFloatArray:j,primTurtlesForward:S,primitiveMulScalar:C})}),module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function n(e,t){return 0|Math.floor(e/t)}function a(e,t){return e-n(e,t)*t|0}function At(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function c(t,r){var i,e;return 0===t?r>=0?90:270:(i=r/t,e=Math.atan(i),t>=0?r>=0?e/.0174532925199433:360+e/.0174532925199433:180+e/.0174532925199433)}function l(r){var e,i,t;return e=90-r,t=e/360|0,0>e&&--t,i=.0174532925199433*(e-360*t)}function It(){var p,v,o,d,h,s,a,r,i,k,g,l,c,m,n,f,b,u;if(l=e.stackValue(0),o=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),h=e.stackIntegerValue(4),a=e.stackIntegerValue(5),s=e.stackValue(6),e.failed())return null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isBytes(l))return e.primitiveFail(),null;if(h*a!==t(s))return e.primitiveFail(),null;if(i=t(n),t(u)!==i)return e.primitiveFail(),null;if(t(o)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;for(m=n.wordsAsFloat32Array(),b=u.wordsAsFloat32Array(),v=o.words,g=l.bytes,d=s.words,r=0;i-1>=r;r++)c=0|m[r],f=0|b[r],k=g[r],0!==k&&c>=0&&f>=0&&a>c&&h>f&&(p=f*a+c,d[p]=v[r]);return e.failed()?null:void e.pop(7)}function Ft(){var r,o,n,i,u,s,a;if(s=e.stackValue(0),n=e.stackValue(1),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(a=t(n),t(s)!==a)return e.primitiveFail(),null;for(o=n.wordsAsFloat32Array(),u=s.wordsAsFloat32Array(),i=0;a-1>=i;i++)r=o[i],r/=.0174532925199433,r=90-r,r>0||(r+=360),u[i]=r;return e.failed()?null:void e.pop(2)}function Ot(){return wt}function St(){var r,s,i,n;return i=e.stackValue(0),n=e.stackIntegerValue(1),e.failed()?null:e.isWords(i)?t(i)<n?(e.primitiveFail(),null):(s=i.wordsAsFloat32Array(),r=s[n-1],r=d(r),e.failed()?null:(e.pop(3),void e.pushFloat(r))):(e.primitiveFail(),null)}function ot(){r=17,o=16807,u=2147483647,h=n(u,o),p=a(u,o)}function f(e){var i,s,u,l,t;return u=0>e?0-e:e,i=n(r,h),s=a(r,h),r=o*s-p*i,l=65535&r,t=l*(u+1)>>>16,0>e?0-t:t}function at(){var t;return t=e.stackIntegerValue(0),e.failed()?null:(r=65536&t,void e.pop(1))}function et(){var r,c,u,s,a,l,i,f,o,h,d,n;if(n=e.stackIntegerValue(0),d=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(a=t(s),h=t(o),a!==h)return e.primitiveFail(),null;if(-32>n)return e.primitiveFail(),null;if(n>8)return e.primitiveFail(),null;for(c=s.words,f=o.words,l=4278190080,i=0;a-1>=i;i++)u=c[i],r=At(u,n),r>255&&(r=255),0>r&&(r=0),f[i]=r<<24&l|d;e.pop(4)}function R(){var i,l,n,s,a,c,r,v,o,f,h,d,p,m,u;if(m=e.stackValue(0),u=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(d=m.words,h=d[0],e.failed())return null;if(p=Math.log(h),a=t(s),f=t(o),a!==f)return e.primitiveFail(),null;for(l=s.words,v=o.words,c=4278190080,r=0;a-1>=r;r++)n=l[r],i=0===n?0:255/p*Math.log(n)|0,i>255&&(i=255),v[r]=i<<24&c|u;e.pop(4)}function v(){var u,r,f,s,a,o,h,n,i,d,p,l,m,v,c;if(u=e.stackIntegerValue(0),i=e.stackIntegerValue(1),c=e.stackValue(2),l=e.stackValue(3),n=e.stackValue(4),a=e.stackValue(5),!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(a))return e.primitiveFail(),null;if(o=t(n),t(l)!==o)return e.primitiveFail(),null;if(t(c)!==o)return e.primitiveFail(),null;if(t(a)!==u*i)return e.primitiveFail(),null;for(p=l.wordsAsFloat32Array(),v=c.wordsAsFloat32Array(),h=n.words,f=a.words,r=0;u*i-1>=r;r++)f[r]=0;for(r=0;o-1>=r;r++)d=p[r],m=v[r],s=i*m+d,s>=0&&u*i>s&&(f[s]=h[r]);return e.failed()?null:void e.pop(6)}function J(){var u,r,a,l,o,i,n,c,s,f;return a=e.stackIntegerValue(0),i=e.stackIntegerValue(1),f=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),e.failed()?null:e.isWords(r)?t(r)!==a*i?(e.primitiveFail(),null):(n=0|c,s=0|f,u=r.words,n>=0&&i>n&&s>=0&&a>s?(l=s*i+n,o=u[l]):o=0,e.failed()?null:(e.pop(6),void e.pushInteger(o))):(e.primitiveFail(),null)}function g(){var f,i,o,l,r,u,n,s,c,a,h;return o=e.stackIntegerValue(0),n=e.stackIntegerValue(1),u=e.stackIntegerValue(2),h=e.stackFloatValue(3),c=e.stackFloatValue(4),i=e.stackValue(5),e.failed()?null:e.isWords(i)?t(i)!==o*n?(e.primitiveFail(),null):(s=0|c,a=0|h,r=u,r>1073741823&&(r=1073741823),0>r&&(r=0),f=i.words,s>=0&&n>s&&a>=0&&o>a&&(l=a*n+s,f[l]=r),e.failed()?null:void e.pop(6)):(e.primitiveFail(),null)}function b(){var v,f,p,s,a,d,u,r,c,l,h,o,n,m,i;if(u=e.stackValue(0),f=e.stackIntegerValue(1),a=e.stackIntegerValue(2),s=e.stackValue(3),i=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(i))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(f*a!==t(s))return e.primitiveFail(),null;if(c=t(o),t(i)!==c)return e.primitiveFail(),null;if(t(u)!==c)return e.primitiveFail(),null;for(h=o.wordsAsFloat32Array(),m=i.wordsAsFloat32Array(),d=u.words,v=s.words,r=0;c-1>=r;r++)l=0|h[r],n=0|m[r],l>=0&&n>=0&&a>l&&f>n&&(p=n*a+l,d[r]=v[p]);return e.failed()?null:void e.pop(6)}function k(){var v,d,k,l,n,o,r,y,S,O,p,m,c,g,b,f,u,h,a;return v=e.stackIntegerValue(0),g=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),d=e.stackFloatValue(4),k=e.stackFloatValue(5),b=e.stackFloatValue(6),o=e.stackValue(7),a=e.stackValue(8),u=e.stackValue(9),y=e.stackIntegerValue(10),e.failed()?null:e.isWords(u)&&e.isWords(a)&&e.isWords(o)?(c=t(u),t(a)!==c?(e.primitiveFail(),null):t(o)!==c?(e.primitiveFail(),null):(f=u.wordsAsFloat32Array(),h=a.wordsAsFloat32Array(),n=o.wordsAsFloat32Array(),l=b,r=y-1,O=f[r]+l*Math.cos(n[r]),p=h[r]-l*Math.sin(n[r]),s(r,f,n,O,k,S,m),i(r,h,n,p,d,g,v),e.failed()?null:void e.pop(11))):(e.primitiveFail(),null)}function y(){var s,p,f,h,a,O,S,r,F,g,m,k,d,n,v,i,b,c,y,u,o,w,l;if(i=e.stackValue(0),p=e.stackIntegerValue(1),a=e.stackIntegerValue(2),h=e.stackValue(3),l=e.stackValue(4),u=e.stackValue(5),d=e.stackValue(6),e.failed())return null;if(!e.isBytes(d))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(h))return e.primitiveFail(),null;if(p*a!==t(h))return e.primitiveFail(),null;if(n=t(u),t(d)!==n)return e.primitiveFail(),null;if(t(l)!==n)return e.primitiveFail(),null;if(k=d.bytes,y=u.wordsAsFloat32Array(),w=l.wordsAsFloat32Array(),g="number"==typeof i)F=i,v=F;else{if(t(i)!==n)return e.primitiveFail(),null;m=e.isMemberOf(i,"WordArray"),m?b=i.words:O=i.wordsAsFloat32Array()}for(s=h.words,r=0;n-1>=r;r++)1===k[r]&&(c=0|y[r],o=0|w[r],c>=0&&o>=0&&a>c&&p>o&&(f=o*a+c,g?s[f]=v:m?s[f]=b[r]:(S=O[r],s[f]=S)));return e.failed()?null:void e.pop(7)}function S(){var b,I,v,p,o,h,r,u,O,w,F,A,l,g,n,k,y,S,a,d,c,m,f;if(b=e.stackIntegerValue(0),k=e.stackIntegerValue(1),g=e.stackIntegerValue(2),O=e.stackIntegerValue(3),I=e.stackFloatValue(4),v=e.stackFloatValue(5),a=e.stackValue(6),h=e.stackValue(7),f=e.stackValue(8),c=e.stackValue(9),l=e.stackValue(10),e.failed())return null;if(!e.isBytes(l))return e.primitiveFail(),null;if(!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(h))return e.primitiveFail(),null;if(a.isFloat)u=!1;else{if(!e.isWords(a))return e.primitiveFail(),null;u=!0}if(n=t(c),t(f)!==n)return e.primitiveFail(),null;if(t(h)!==n)return e.primitiveFail(),null;if(t(l)!==n)return e.primitiveFail(),null;if(u&&t(a)!==n)return e.primitiveFail(),null;for(A=l.bytes,d=c.wordsAsFloat32Array(),m=f.wordsAsFloat32Array(),o=h.wordsAsFloat32Array(),u?S=a.wordsAsFloat32Array():y=e.floatValueOf(a),r=0;n-1>=r;r++)1===A[r]&&(p=u?S[r]:y,w=d[r]+p*Math.cos(o[r]),F=m[r]-p*Math.sin(o[r]),s(r,d,o,w,v,O,g),i(r,m,o,F,I,k,b));return e.failed()?null:void e.pop(11)}function O(){var m,f,F,w,u,p,l,O,S,y,o,I,v,g,b,k,h,i,r,n,a,s;if(o=e.stackIntegerValue(0),u=e.stackIntegerValue(1),n=e.stackIntegerValue(2),f=e.stackValue(3),g=e.stackFloatValue(4),k=e.stackFloatValue(5),b=e.stackFloatValue(6),e.failed())return null;if(!e.isWords(f))return e.primitiveFail(),null;if(t(f)!==u*n)return e.primitiveFail(),null;for(m=f.words,i=b,r=k,i=Math.max(i,0),r=Math.max(r,0),i=Math.min(i,n-1),r=Math.min(r,u-1),I=Math.max(i-o,0),F=Math.min(i+o,n-1),v=Math.max(r-o,0),w=Math.min(r+o,u-1),p=m[r*n+i],l=-1,s=v;w>=s;s++)for(y=s*n,a=I;F>=a;a++)h=m[y+a],h>p&&(l=a,O=s,p=h);return S=-1===l?d(g):c(l-i,O-r)+90|0,e.failed()?null:(e.pop(8),void e.pushFloat(S))}function w(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]+f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]+h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]+f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]+h[r];e.pop(4),e.push(i)}function F(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]+h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]+u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]+h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]+u;e.pop(4),e.push(i)}function I(){var r,s,a,o,l,i,u,n;if(i=e.stackObjectValue(0),n=e.stackValue(1),e.failed())return null;if(e.success(e.isBytes(n)),e.success(e.isBytes(i)),e.failed())return null;if(a=t(n),o=t(i),e.failed())return null;for(s=a,a>o&&(s=o),l=i.bytes,u=n.bytes,r=0;s-1>=r;r++)u[r]=u[r]+l[r]===2;e.pop(1)}function A(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]/f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]/h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]/f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]/h[r];e.pop(4),e.push(i)}function P(){var a,l,h,o,r,d,f,p,u,s,i,c,m;if(i=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(u=t(s),e.success(u===t(i)),e.failed())return null;if(f="number"==typeof a,p=e.isMemberOf(s,"WordArray"),f&&p){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(f)for(c=s.words,d=a,m=i.words,r=0;u-1>=r;r++)m[r]=n(c[r],d);else for(c=s.words,l=e.floatValueOf(a),o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=c[r]/l;else if(f)for(h=s.wordsAsFloat32Array(),d=a,o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=h[r]/d;else for(h=s.wordsAsFloat32Array(),l=e.floatValueOf(a),o=i.wordsAsFloat32Array(),r=0;u-1>=r;r++)o[r]=h[r]/l;e.pop(4),e.push(i)}function C(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]===f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]===u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]===f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]===u[r];e.pop(4),e.push(a)}function _(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]===f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]===u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]===f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]===u;e.pop(4),e.push(n)}function x(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]>=f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]>=u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]>=f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]>=u[r];e.pop(4),e.push(a)}function V(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]>=f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]>=u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]>=f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]>=u;e.pop(4),e.push(n)}function j(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]>f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]>u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]>f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]>u[r];e.pop(4),e.push(a)}function q(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]>f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]>u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]>f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]>u;e.pop(4),e.push(n)}function M(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]<=f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]<=u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]<=f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]<=u[r];e.pop(4),e.push(a)}function B(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]<=f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]<=u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]<=f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]<=u;e.pop(4),e.push(n)}function N(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]<f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]<u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]<f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]<u[r];e.pop(4),e.push(a)}function T(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]<f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]<u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]<f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]<u;e.pop(4),e.push(n)}function L(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;
if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]*f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]*h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]*f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]*h[r];e.pop(4),e.push(i)}function D(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]*h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]*u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]*h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]*u;e.pop(4),e.push(i)}function E(){var i,n,u,l,r,h,d,o,s,a,f,c;if(a=e.stackObjectValue(0),i=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(i)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(i),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(i,"WordArray"),d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]!==f[r];else for(c=s.words,u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=c[r]!==u[r];else if(h)for(l=s.wordsAsFloat32Array(),f=i.words,n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]!==f[r];else for(l=s.wordsAsFloat32Array(),u=i.wordsAsFloat32Array(),n=a.bytes,r=0;o-1>=r;r++)n[r]=l[r]!==u[r];e.pop(4),e.push(a)}function Pt(){var a,i,u,l,r,f,h,d,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,d=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]!==f;else for(c=s.words,u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=c[r]!==u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]!==f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),i=n.bytes,r=0;o-1>=r;r++)i[r]=l[r]!==u;e.pop(4),e.push(n)}function W(){var r,s,n,i;if(i=e.stackValue(0),e.failed())return null;if(e.success(e.isBytes(i)),e.failed())return null;if(s=t(i),e.failed())return null;for(n=i.bytes,r=0;s-1>=r;r++)n[r]=0===n[r]?1:0}function z(){var r,s,a,o,l,i,u,n;if(i=e.stackObjectValue(0),n=e.stackValue(1),e.failed())return null;if(e.success(e.isBytes(n)),e.success(e.isBytes(i)),e.failed())return null;if(a=t(n),o=t(i),e.failed())return null;for(s=a,a>o&&(s=o),l=i.bytes,u=n.bytes,r=0;s-1>=r;r++)u[r]=u[r]+l[r]>0;e.pop(1)}function K(){var r,o,s,a,u,i,l,n;if(i=e.stackValue(0),a=e.stackObjectValue(1),e.failed())return null;if(u=e.isIntegerValue(i)?i:e.booleanValueOf(i),n=e.fetchPointerofObject(1,a),s=e.fetchPointerofObject(0,a),e.failed())return null;if(!e.isBytes(s))return e.primitiveFail(),null;if(!e.isBytes(n))return e.primitiveFail(),null;for(l=n.bytes,o=s.bytes,r=0;r<=t(n)-1;r++)1===o[r]&&(l[r]=u);e.pop(1)}function U(){var r,o,s,a,i,u,n;if(i=e.stackIntegerValue(0),a=e.stackObjectValue(1),e.failed())return null;if(i=4278190080|i,n=e.fetchPointerofObject(1,a),s=e.fetchPointerofObject(0,a),e.failed())return null;if(!e.isBytes(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;for(u=n.words,o=s.bytes,r=0;r<=t(n)-1;r++)1===o[r]&&(u[r]=i);e.pop(1)}function G(){var r,a,n,s,o,u,i;if(o=e.stackFloatValue(0),s=e.stackObjectValue(1),e.failed())return null;if(i=e.fetchPointerofObject(1,s),n=e.fetchPointerofObject(0,s),e.failed())return null;if(!e.isBytes(n))return e.primitiveFail(),null;if(!e.isWords(i))return e.primitiveFail(),null;for(u=i.wordsAsFloat32Array(),a=n.bytes,r=0;r<=t(i)-1;r++)1===a[r]&&(u[r]=o);e.pop(1)}function H(){var r,a,n,s,o,u,i;if(o=e.stackValue(0),s=e.stackObjectValue(1),e.failed())return null;if(i=e.fetchPointerofObject(1,s),n=e.fetchPointerofObject(0,s),e.failed())return null;if(!e.isBytes(n))return e.primitiveFail(),null;if(!e.isPointers(i))return e.primitiveFail(),null;for(u=i.wordsAsInt32Array(),a=n.bytes,r=0;r<=t(i)-1;r++)1===a[r]&&(u[r]=o);e.pop(1)}function m(){var i,p,a,h,l,o,s,m,c,r,n,d,u,f;if(s=e.stackIntegerValue(0),o=e.stackObjectValue(1),n=e.stackIntegerValue(2),r=e.stackIntegerValue(3),l=e.stackObjectValue(4),e.failed())return null;if(u=e.fetchPointerofObject(1,l),a=e.fetchPointerofObject(0,l),e.failed())return null;if(!e.isBytes(a))return e.primitiveFail(),null;if(!e.isBytes(u)||!e.isBytes(o))return e.primitiveFail(),null;if(d=u.bytes,p=a.bytes,m=o.bytes,f=t(u),h=t(a),c=t(o),r>n)return e.primitiveFail(),null;if(1>r)return e.primitiveFail(),null;if(r>f)return e.primitiveFail(),null;if(r>h)return e.primitiveFail(),null;if(n>f)return e.primitiveFail(),null;if(n>h)return e.primitiveFail(),null;if(1>s)return e.primitiveFail(),null;if(s>c)return e.primitiveFail(),null;if(n-r+1>c-s+1)return e.primitiveFail(),null;for(i=r-1;n-1>=i;i++)1===p[i]&&(d[i]=m[s+i-r]);e.pop(4)}function Z(){var p,f,y,r,u,m,b,l,g,n,o,d,v,i,a,c,h,s,k;if(o=e.stackIntegerValue(0),n=e.stackObjectValue(1),a=e.stackIntegerValue(2),i=e.stackIntegerValue(3),g=e.stackObjectValue(4),e.failed())return null;if(s=e.fetchPointerofObject(1,g),m=e.fetchPointerofObject(0,g),e.failed())return null;if(!e.isBytes(m))return e.primitiveFail(),null;if(!(e.isWords(s)&&e.isWords(n)||e.isPointers(s)&&e.isPointers(n)))return e.primitiveFail(),null;if(u=m.bytes,k=t(s),b=t(m),v=t(n),i>a)return e.primitiveFail(),null;if(1>i)return e.primitiveFail(),null;if(i>k)return e.primitiveFail(),null;if(i>b)return e.primitiveFail(),null;if(a>k)return e.primitiveFail(),null;if(a>b)return e.primitiveFail(),null;if(1>o)return e.primitiveFail(),null;if(o>v)return e.primitiveFail(),null;if(a-i+1>v-o+1)return e.primitiveFail(),null;if(c=e.isMemberOf(s,"KedamaFloatArray"),l=e.isMemberOf(n,"KedamaFloatArray"),c&&l)for(f=s.wordsAsFloat32Array(),p=n.wordsAsFloat32Array(),r=i-1;a-1>=r;r++)1===u[r]&&(f[r]=p[o+r-i]);if(c&&!l)for(f=s.wordsAsFloat32Array(),d=n.words,r=i-1;a-1>=r;r++)1===u[r]&&(f[r]=d[o+r-i]);if(!c&&l)for(h=s.words,p=n.wordsAsFloat32Array(),r=i-1;a-1>=r;r++)1===u[r]&&(y=p[o+r-i]>>>0,h[r]=y);if(!c&&!l)for(h=s.words,d=n.words,r=i-1;a-1>=r;r++)1===u[r]&&(h[r]=d[o+r-i]);e.pop(4)}function X(){var s,l,f,i,v,m,c,r,p,k,u,o,n,h,d,y,b,g,S;if(n=e.stackObjectValue(0),s=e.stackObjectValue(1),o=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(o)),e.success(e.isWords(n)),e.failed())return null;if(u=t(s),e.success(u===t(o)),e.success(u===t(n)),e.failed())return null;if(p=e.isMemberOf(s,"WordArray"),k=e.isMemberOf(o,"WordArray"),p&&k){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(n,"KedamaFloatArray"))return e.primitiveFail(),null;if(k)if(p)for(g=o.words,b=s.words,S=n.words,r=0;u-1>=r;r++)d=g[r],h=b[r],y=a(d,h),S[r]=y;else for(g=o.words,v=s.wordsAsFloat32Array(),c=n.wordsAsFloat32Array(),r=0;u-1>=r;r++)d=g[r],l=v[r],i=d/l,i=Math.floor(i),c[r]=d-i*l;else if(p)for(m=o.wordsAsFloat32Array(),b=s.words,c=n.wordsAsFloat32Array(),r=0;u-1>=r;r++)f=m[r],h=b[r],i=f/h,i=Math.floor(i),c[r]=f-i*h;else for(m=o.wordsAsFloat32Array(),v=s.wordsAsFloat32Array(),c=n.wordsAsFloat32Array(),r=0;u-1>=r;r++)f=m[r],l=v[r],i=f/l,i=Math.floor(i),c[r]=f-i*l;e.pop(4),e.push(n)}function Y(){var o,c,u,i,p,l,r,h,d,g,f,s,n,v,m,b;if(n=e.stackObjectValue(0),o=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(n)),e.failed())return null;if(f=t(s),e.success(f===t(n)),e.failed())return null;if(d="number"==typeof o,g=e.isMemberOf(s,"WordArray"),d&&g){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(n,"KedamaFloatArray"))return e.primitiveFail(),null;if(g)if(d)for(m=s.words,h=o,b=n.words,r=0;f-1>=r;r++)b[r]=a(m[r],h);else for(m=s.words,c=e.floatValueOf(o),l=n.wordsAsFloat32Array(),r=0;f-1>=r;r++)v=m[r],i=v/c,i=Math.floor(i),l[r]=v-i*c;else if(d)for(p=s.wordsAsFloat32Array(),h=o,l=n.wordsAsFloat32Array(),r=0;f-1>=r;r++)u=p[r],i=u/h,i=Math.floor(i),l[r]=u-i*h;else for(p=s.wordsAsFloat32Array(),c=e.floatValueOf(o),l=n.wordsAsFloat32Array(),r=0;f-1>=r;r++)u=p[r],i=u/c,i=Math.floor(i),l[r]=u-i*c;e.pop(4),e.push(n)}function Q(){var n,h,c,o,r,l,d,a,s,i,f,u,p;if(i=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(i)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(i)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),d=e.isMemberOf(s,"WordArray"),l&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(l)for(u=s.words,f=n.words,p=i.words,r=0;a-1>=r;r++)p[r]=u[r]-f[r];else for(u=s.words,h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=u[r]-h[r];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]-f[r];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r=0;a-1>=r;r++)o[r]=c[r]-h[r];e.pop(4),e.push(i)}function $(){var s,u,f,a,r,h,c,d,o,n,i,l,p;if(i=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(i)),e.failed())return null;if(o=t(n),e.success(o===t(i)),e.failed())return null;if(c="number"==typeof s,d=e.isMemberOf(n,"WordArray"),c&&d){if(!e.isMemberOf(i,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(i,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(c)for(l=n.words,h=s,p=i.words,r=0;o-1>=r;r++)p[r]=l[r]-h;else for(l=n.words,u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=l[r]-u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]-h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=i.wordsAsFloat32Array(),r=0;o-1>=r;r++)a[r]=f[r]-u;e.pop(4),e.push(i)}function d(r){var e,t;return t=r/.0174532925199433,e=90-t,e>0||(e+=360),e}function tt(){var a,o,r,i,n,u,l,s;if(a=e.stackFloatValue(0),r=e.stackValue(1),s=e.stackIntegerValue(2),i=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(r))return e.primitiveFail(),null;if(l=t(r),!(l>=s&&i>=1&&s>=i))return e.primitiveFail(),null;if(o=r.wordsAsFloat32Array(),e.failed())return null;for(n=i;s>=n;n++)o[n-1]=f(u)*a;e.pop(5)}function rt(){var a,r,i,o,n,u,l,s;if(a=e.stackFloatValue(0),n=e.stackValue(1),s=e.stackIntegerValue(2),r=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(l=t(n),!(l>=s&&r>=1&&s>=r))return e.primitiveFail(),null;if(o=n.words,e.failed())return null;for(i=r;s>=i;i++)o[i-1]=f(u)*a|0;e.pop(5)}function it(){var t,r;return t=e.stackIntegerValue(0),e.failed()?null:(r=f(t),e.failed()?null:(e.pop(2),void e.pushInteger(r)))}function nt(){var r,i,t,n,s,a,o;return i=e.stackFloatValue(0),r=e.stackFloatValue(1),s=e.stackFloatValue(2),n=e.stackFloatValue(3),e.failed()?null:(a=n-r,o=s-i,t=c(a,o),t+=90,t>360&&(t-=360),e.failed()?null:(e.pop(5),void e.pushFloat(t)))}function st(){var i,n,s,a,o,t,r;return n=e.stackFloatValue(0),i=e.stackFloatValue(1),o=e.stackFloatValue(2),a=e.stackFloatValue(3),e.failed()?null:(t=i-a,r=n-o,s=Math.sqrt(t*t+r*r),e.failed()?null:(e.pop(5),void e.pushFloat(s)))}function s(i,o,n,u,r,s,a){var t,e;e=u,0>e&&(1===s&&(e+=r),2===s&&(e=0),3===s&&(e=0-e,t=n[i],n[i]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),e>=r&&(1===a&&(e-=r),2===a&&(e=r-1e-6),3===a&&(e=r-1e-6-(e-r),t=n[i],n[i]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),o[i]=e}function i(r,a,i,o,t,n,s){var e;e=o,0>e&&(1===n&&(e+=t),2===n&&(e=0),3===n&&(e=0-e,i[r]=6.283185307179586-i[r])),e>=t&&(1===s&&(e-=t),2===s&&(e=t-1e-6),3===s&&(e=t-1e-6-(e-t),i[r]=6.283185307179586-i[r])),a[r]=e}function ut(){var r,c,s,i,a,f,o,h,n,u;if(n=e.stackValue(0),s=e.stackValue(1),o=e.stackValue(2),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(u=t(s),n.isFloat)a=!1;else{if(!e.isWords(n))return e.primitiveFail(),null;if(t(n)!==u)return e.primitiveFail(),null;a=!0}for(f=o.bytes,c=s.wordsAsFloat32Array(),a?h=n.wordsAsFloat32Array():(r=e.floatValueOf(n),r=l(r)),i=0;u-1>=i;i++)1===f[i]&&(a&&(r=h[i],r=l(r)),c[i]=r);return e.failed()?null:void e.pop(3)}function lt(r){var t;return e=r,t=e.majorVersion()==kt,t===!1?!1:t=e.minorVersion()>=yt}function ct(){var n,s,r,i;return n=e.stackFloatValue(0),r=e.stackValue(1),i=e.stackIntegerValue(2),e.failed()?null:e.isWords(r)?t(r)<i?(e.primitiveFail(),null):(s=r.wordsAsFloat32Array(),s[i-1]=l(n),e.failed()?null:void e.pop(3)):(e.primitiveFail(),null)}function ft(){return!0}function ht(){var n,a,r,o,u,l,c,f,h,i;return u=e.stackIntegerValue(0),o=e.stackIntegerValue(1),n=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),h=e.stackIntegerValue(5),i=e.stackValue(6),e.failed()?null:e.isWords(i)&&e.isWords(r)?(l=t(i),t(r)!==l?(e.primitiveFail(),null):(f=i.wordsAsFloat32Array(),a=r.wordsAsFloat32Array(),s(h-1,f,a,c,n,o,u),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function dt(){var s,a,o,r,u,l,c,f,h,n;return s=e.stackIntegerValue(0),l=e.stackIntegerValue(1),a=e.stackFloatValue(2),c=e.stackFloatValue(3),r=e.stackValue(4),h=e.stackIntegerValue(5),n=e.stackValue(6),e.failed()?null:e.isWords(n)&&e.isWords(r)?(u=t(n),t(r)!==u?(e.primitiveFail(),null):(f=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i(h-1,f,o,c,a,l,s),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function pt(){var y,h,l,i,n,c,p,g,m,o,d,a,f,v,r,b,k,u;if(d=e.stackIntegerValue(0),p=e.stackIntegerValue(1),y=e.stackFloatValue(2),r=e.stackValue(3),l=e.stackValue(4),u=e.stackValue(5),o=e.stackValue(6),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(r.isFloat)n=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;n=!0,c=e.isMemberOf(r,"WordArray")}if(a=t(u),t(o)!==a)return e.primitiveFail(),null;if(t(l)!==a)return e.primitiveFail(),null;if(n&&t(r)!==a)return e.primitiveFail(),null;for(m=o.bytes,k=u.wordsAsFloat32Array(),h=l.wordsAsFloat32Array(),n?c?b=r.words:v=r.wordsAsFloat32Array():f=e.floatValueOf(r),i=0;a-1>=i;i++)1===m[i]&&(g=n?c?b[i]:v[i]:f,s(i,k,h,g,y,p,d));return e.failed()?null:void e.pop(7)}function mt(){var y,h,g,u,n,s,c,d,m,o,a,p,f,v,r,b,k,l;if(y=e.stackIntegerValue(0),p=e.stackIntegerValue(1),h=e.stackFloatValue(2),r=e.stackValue(3),u=e.stackValue(4),l=e.stackValue(5),o=e.stackValue(6),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(r.isFloat)s=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;s=!0,c=e.isMemberOf(r,"WordArray")}if(a=t(l),t(o)!==a)return e.primitiveFail(),null;if(t(u)!==a)return e.primitiveFail(),null;if(s&&t(r)!==a)return e.primitiveFail(),null;for(m=o.bytes,k=l.wordsAsFloat32Array(),g=u.wordsAsFloat32Array(),s?c?b=r.words:v=r.wordsAsFloat32Array():f=e.floatValueOf(r),n=0;a-1>=n;n++)1===m[n]&&(d=s?c?b[n]:v[n]:f,i(n,k,g,d,h,p,y));return e.failed()?null:void e.pop(7)}function vt(){var r,s,g,a,p,n,d,h,u,y,o,i,m,v,f,b,k,l;if(o=e.stackValue(0),l=e.stackValue(1),f=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(i=t(o),0>i)return e.primitiveFail(),null;if(t(f)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==i)return e.primitiveFail(),null;if(t(n)!==i)return e.primitiveFail(),null}for(y=o.wordsAsFloat32Array(),v=f.wordsAsFloat32Array(),k=l.wordsAsFloat32Array(),s&&(g=a.wordsAsFloat32Array(),p=n.wordsAsFloat32Array()),s||(d=e.floatValueOf(a),h=e.floatValueOf(n)),r=0;i-1>=r;r++)s&&(d=g[r],h=p[r]),m=d-v[r],b=h-k[r],u=c(m,b),u+=90,u>360&&(u-=360),y[r]=u;return e.failed()?null:(e.pop(6),void e.push(o))}function gt(){var r,s,v,a,p,n,f,c,b,o,i,h,m,u,d,g,l;if(o=e.stackValue(0),l=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(i=t(o),0>i)return e.primitiveFail(),null;if(t(u)!==i)return e.primitiveFail(),null;if(t(l)!==i)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==i)return e.primitiveFail(),null;if(t(n)!==i)return e.primitiveFail(),null}for(b=o.wordsAsFloat32Array(),m=u.wordsAsFloat32Array(),g=l.wordsAsFloat32Array(),s&&(v=a.wordsAsFloat32Array(),p=n.wordsAsFloat32Array()),s||(f=e.floatValueOf(a),c=e.floatValueOf(n)),r=0;i-1>=r;r++)s&&(f=v[r],c=p[r]),h=f-m[r],d=c-g[r],b[r]=Math.sqrt(h*h+d*d);return e.failed()?null:(e.pop(6),void e.push(o))}function bt(){var k,v,h,d,b,o,u,g,i,s,r,n,p,m,f,l,a,c;if(c=e.stackIntegerValue(0),l=e.stackIntegerValue(1),u=e.stackIntegerValue(2),i=e.stackIntegerValue(3),h=e.stackValue(4),s=e.stackValue(5),e.failed())return null;if(p=t(s),b=t(h),i*u!==p)return e.primitiveFail(),null;if(p*l*c!==b)return e.primitiveFail(),null;for(g=s.words,v=h.words,r=0,n=0,d=0,f=0;u-1>=f;f++){for(a=0;c-1>=a;a++){for(m=0;i-1>=m;m++)for(k=g[r],++r,o=0;l-1>=o;o++)v[d]=k,++d;r=n}n+=i,r=n}e.pop(6)}var kt=1,yt=11,e=null,r=0,wt="KedamaPlugin2 13 November 2014 (e)",o=0,u=0,h=0,p=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:w,getModuleName:Ot,primitiveMulArrays:L,drawTurtlesInArray:It,primitiveGTScalar:q,setScalarHeading:ct,primitiveSubScalar:$,turtleScalarSetY:dt,vectorGetAngleTo:vt,primitiveRemArrays:X,primitiveLTArrays:N,primitiveAddScalar:F,primPixelsAtXY:b,primitiveMulScalar:D,primSetPixelsAtXY:y,setHeadingArrayFrom:ut,primPixelAtXYPut:g,makeMaskLog:R,primitiveLTScalar:T,scalarGetAngleTo:nt,primitiveOrByteArray:z,primitiveLEArrays:M,primitiveRemScalar:Y,getHeadingArrayInto:Ft,turtlesSetX:pt,primitivePredicateReplaceBytes:m,primitiveDivArrays:A,makeMask:et,primitiveLEScalar:B,kedamaSetRandomSeed:at,randomIntoIntegerArray:rt,setInterpreter:lt,primitivePredicateAtAllPutColor:U,makeTurtlesMap:v,randomIntoFloatArray:tt,primUpHill:O,shutdownModule:ft,primitiveDivScalar:P,primitiveGEArrays:x,primitiveNotByteArray:W,randomRange:it,initialiseModule:ot,getScalarHeading:St,primPixelAtXY:J,primitivePredicateAtAllPutNumber:G,primitiveEQArrays:C,primitiveNEArrays:E,primScalarForward:k,vectorGetDistanceTo:gt,turtlesSetY:mt,turtleScalarSetX:ht,primTurtlesForward:S,primitiveGEScalar:V,primitiveAndByteArray:I,primitivePredicateReplaceWords:Z,primitiveGTArrays:j,primitivePredicateAtAllPutObject:H,primitiveEQScalar:_,primitivePredicateAtAllPutBoolean:K,zoomBitmap:bt,primitiveNEScalar:Pt,scalarGetDistanceTo:st,primitiveSubArrays:Q})}),module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function At(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Et(e,t){return 0|Math.floor(e/t)}function B(e,t){return e-Et(e,t)*t|0}function Nr(){0!==B(v,2)&&(i*=1-t[M],i>0&&(i=0))}function Br(){var r,i,n,s,e;e=F/f,r=Math.sin(2*h*12.7*e),i=Math.sin(2*h*7.1*e),n=Math.sin(2*h*4.7*e),s=2*t[Lt]*t[b]/100*(r+i+n),l+=s}function Mr(){0===B(v,2)?l+=t[M]*t[b]*(1-t[P]):l-=t[M]*t[b]*(1-t[P])}function qr(){l+=(w()-32767)*t[Nt]/32768*t[b]}function jr(){i+=(w()-32767)*t[fr]/32768*i,i>0&&(i=0)}function E(s,a,o){var e,i,t,r,n;i=(0-h)/f*o,n=Math.exp(i),r=0-n*n,i=2*h/f*a,t=n*Math.cos(i)*2,e=1-t-r,e=1/e,t=(0-t)*e,r=(0-r)*e,x(s,e),W(s,t),K(s,r)}function It(e,t){var r,i;return r=V(e)*t+R(e)*(i=Z(e))+z(e)*Ot(e),Ft(e,i),yt(e,t),r}function Vr(t){var e;return s>0?(e=It(X,t),e=r(Q,e),e=It(U,e),e=r(H,e),s>=8&&(e=r($,e)),s>=7&&(e=r(et,e)),s>=6&&(e=r(rt,e)),s>=5&&(e=r(at,e)),s>=4&&(e=r(ft,e)),s>=3&&(e=r(pt,e)),s>=2&&(e=r(kt,e)),s>=1&&(e=r(_t,e)),e):0}function Vt(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsFloat32Array()}function xr(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsInt16Array()}function _r(){return Or}function Cr(){var e;return 0===a?0:(k>d?(e=S*i+O*p,p=i,i=e):(e=_*i-C,i=e),d>=a&&(d=0,wr()),++d,e)}function n(e){return 32.767*Math.pow(2,(e-87)/6)}function Pr(t){var r;return e.success(22===At(t)),e.failed()?!1:(r=e.fetchPointerofObject(0,t),u=Vt(r),l=e.fetchFloatofObject(2,t),a=e.fetchIntegerofObject(3,t),d=e.fetchIntegerofObject(4,t),k=e.fetchIntegerofObject(5,t),m=e.fetchIntegerofObject(6,t),S=e.fetchFloatofObject(7,t),O=e.fetchFloatofObject(8,t),i=e.fetchFloatofObject(9,t),p=e.fetchFloatofObject(10,t),_=e.fetchFloatofObject(11,t),C=e.fetchFloatofObject(12,t),I=e.fetchFloatofObject(13,t),D=e.fetchFloatofObject(14,t),y=e.fetchFloatofObject(15,t),v=e.fetchIntegerofObject(16,t),F=e.fetchIntegerofObject(17,t),A=e.fetchIntegerofObject(18,t),s=e.fetchIntegerofObject(19,t),q=e.fetchIntegerofObject(20,t),f=e.fetchIntegerofObject(21,t),e.failed()===!1)}function w(){return A=1309*A+13849&65535}function Ar(){var r,e,t,n;for(e=0,t=i,n=p,r=1;k>=r;r++)e=S*t+O*n,n=t,t=e;0!==e&&(i=i/e*1e4)}function Ir(e){return r(bt,e)-r(dt,e)+r(ct,e)-r(it,e)+r(tt,e)}function Fr(e){return r(St,e)+r(vt,e)+r(ht,e)+r(ut,e)+r(Y,e)+r(G,e)}function wr(){t[b]>0?(mr(),v=B(v+1,65535)):(a=1,m=a)}function Sr(){var r,i,n,t,s;return r=Vt(e.stackValue(2)),i=xr(n=e.stackValue(1)),s=e.stackIntegerValue(0),e.failed()?null:(t=e.stackObjectValue(3),Pr(t)?(e.success(2*At(n)>=q),e.failed()?null:(vr(r,i,s),kr(t)?void e.pop(3):null)):null)}function g(e,r,i,n,s){var t;return t=Math.exp(e*r),t*((s*(e*e+1)+e)*n-i)+1}function c(r,a,o){var s,e,i,n,t;e=(0-h)/f*o,t=Math.exp(e),n=0-t*t,e=2*h/f*a,i=t*Math.cos(e)*2,s=1-i-n,x(r,s),W(r,i),K(r,n)}function o(e,t,r,i){c(e,t,r),x(e,V(e)*i)}function r(e,i){var t,r;return t=V(e)*i+R(e)*(r=Z(e))+z(e)*Ot(e),Ft(e,r),yt(e,t),t}function V(e){return u[5*e-5]}function x(e,t){u[5*e-5]=t}function R(e){return u[5*e-4]}function W(e,t){u[5*e-4]=t}function z(e){return u[5*e-3]}function K(e,t){u[5*e-3]=t}function Z(e){return u[5*e-2]}function yt(e,t){u[5*e-2]=t}function Ot(e){return u[5*e-1]}function Ft(e,t){u[5*e-1]=t}function yr(w,k,y){var v,u,s,l,e,c,t,r,m,f,g,b,o,n,d;o=a*w|0,f=o/a,m=y,t=k,0>=t?u=1:(c=(1-f)/t,u=1-c/(Math.exp(c)-1)),e=h*(m+1),v=Math.cos(e),b=Math.sin(e),g=t/f*e*u,d=pr(e,v,b,g),n=e/o,r=Math.exp(d*n),S=2*Math.cos(n)*r,O=0-r*r,p=0,i=r*Math.sin(n),s=Math.exp(-1/(t*a)),l=Math.pow(s,a-o),_=s,C=(1-s)*l/(1-l),Ar()}function kr(w){var c,n,s,o,u,t,f,h,g,b,r;return e.pushRemappableOop(w),e.pushRemappableOop(e.floatObjectOf(l)),e.pushRemappableOop(e.floatObjectOf(S)),e.pushRemappableOop(e.floatObjectOf(O)),e.pushRemappableOop(e.floatObjectOf(i)),e.pushRemappableOop(e.floatObjectOf(p)),e.pushRemappableOop(e.floatObjectOf(_)),e.pushRemappableOop(e.floatObjectOf(C)),e.pushRemappableOop(e.floatObjectOf(I)),e.pushRemappableOop(e.floatObjectOf(D)),f=e.floatObjectOf(y),g=e.popRemappableOop(),u=e.popRemappableOop(),o=e.popRemappableOop(),s=e.popRemappableOop(),r=e.popRemappableOop(),b=e.popRemappableOop(),n=e.popRemappableOop(),c=e.popRemappableOop(),h=e.popRemappableOop(),t=e.popRemappableOop(),e.failed()?!1:(e.storePointerofObjectwithValue(2,t,h),e.storeIntegerofObjectwithValue(3,t,a),e.storeIntegerofObjectwithValue(4,t,d),e.storeIntegerofObjectwithValue(5,t,k),e.storeIntegerofObjectwithValue(6,t,m),e.storePointerofObjectwithValue(7,t,c),e.storePointerofObjectwithValue(8,t,n),e.storePointerofObjectwithValue(9,t,b),e.storePointerofObjectwithValue(10,t,r),e.storePointerofObjectwithValue(11,t,s),e.storePointerofObjectwithValue(12,t,o),e.storePointerofObjectwithValue(13,t,u),e.storePointerofObjectwithValue(14,t,g),e.storePointerofObjectwithValue(15,t,f),e.storeIntegerofObjectwithValue(16,t,v),e.storeIntegerofObjectwithValue(17,t,F),e.storeIntegerofObjectwithValue(18,t,A),e.failed()===!1)}function br(g){var h,i,a,u,l,e,d,p,m,v,r;t=g,v=.6*n(t[Qt]),r=.6*n(t[Xt]),h=.4*n(t[lr]),a=.15*n(t[or]),l=.06*n(t[sr]),d=.04*n(t[ir]),i=.15*n(t[qt]),u=.06*n(t[ar]),e=.04*n(t[nr]),p=.022*n(t[er]),m=.03*n(t[$t]),s>=8&&(f>=16e3?c($,7500,600):s=6),s>=7&&(f>=16e3?c(et,6500,500):s=6),s>=6&&c(rt,t[Ct],t[Kt]),s>=5&&c(at,t[Pt],t[Gt]),c(ft,t[L],t[lt]),c(pt,t[T],t[ot]),c(kt,t[N],t[st]),c(_t,t[wt],t[nt]),c(Q,t[xt],t[mt]),c(H,t[jt],t[gt]),E(X,t[Tt],t[Wt]),E(U,t[ur],t[Rt]),o(Y,t[xt],t[mt],v),o(G,t[jt],t[gt],r),o(St,t[wt],t[nt],h),o(vt,t[N],t[st],a),o(ht,t[T],t[ot],l),o(ut,t[L],t[lt],d),o(bt,t[N],t[Zt],i),o(dt,t[T],t[Jt],u),o(ct,t[L],t[Ht],e),o(it,t[Pt],t[Ut],p),o(tt,t[Ct],t[zt],m)}function gr(r){var t;return e=r,t=e.majorVersion()==dr,t===!1?!1:t=e.minorVersion()>=cr}function vr(N,B,M){var A,V,S,_,C,P,p,b,h,i,e,c,v,u,s,x,g,a,O;for(br(N),l>0?(O=n(t[j]-7),v=n(t[j]),g=.1*n(t[hr])):O=v=g=0,C=.25*n(t[Mt]),V=.05*n(t[Yt]),_=.05*n(t[Tr]),p=t[Bt]-3,0>=p&&(p=57),A=n(p),o(J,0,f,A),i=y,h=M,x=q+M-1;x>=h;)i=(w()-32768)/4,i+=.75*y,y=i,d>m&&(i=.5*i),P=C*i,a=Cr(),D=a,k>d&&(a+=g*(w()-32768)/4),b=O*a,c=v*a,S=V*i,b+=S,c+=S,e=Vr(b),u=c,e+=Fr(u),u=P+c-I,I=c,e=Ir(u)-e,e=_*u-e,e=r(J,e),s=e*A|0,-32768>s&&(s=-32768),s>32767&&(s=32767),B[h-1]=s,++h,++F}function mr(){l=t[b],Br(),qr(),Mr(),0>l&&(l=0),a=f/l|0,m=a,t[j]>0&&(m>>=1),k=a*t[P]|0,yr(t[P],t[tr],t[rr]),jr(),Nr()}function pr(n,s,a,o){var i,r,l,u,t,e,c;if(u=g(0,n,s,a,o),u>0)for(t=0,e=1,i=u,r=g(e,n,s,a,o);r>0;)t=e,i=r,e=2*e,r=g(e,n,s,a,o);else for(t=-1,e=0,i=g(t,n,s,a,o),r=u;0>i;)e=t,r=i,t=2*t,i=g(t,n,s,a,o);for(;e-t>Dt;)c=(e+t)/2,l=g(c,n,s,a,o),l>0?(t=c,i=l):(e=c,r=l);return(e+t)/2}var dr=1,cr=11,lr=46,qt=34,or=47,ar=35,sr=48,nr=36,ir=49,er=37,$t=38,Qt=45,Yt=9,Xt=50,nt=13,st=17,Zt=40,ot=19,Jt=41,lt=21,Ht=42,Gt=23,Ut=43,Kt=25,zt=44,mt=27,Wt=29,gt=31,Rt=33,Tr=39,M=4,Dt=1e-4,b=0,wt=12,N=16,T=18,L=20,Pt=22,Ct=24,Lt=1,xt=26,Tt=28,Mt=10,jt=30,ur=32,Bt=51,Nt=2,h=3.141592653589793,_t=12,St=3,kt=13,bt=7,vt=4,pt=14,dt=8,ht=5,ft=15,ct=9,ut=6,at=16,it=10,rt=17,tt=11,et=18,$=19,tr=7,rr=8,Q=20,Y=1,X=21,P=6,J=24,H=22,G=2,U=23,fr=3,hr=11,j=5,S=0,O=0,_=0,C=0,s=0,t=null,I=0,e=null,Or="Klatt 3 November 2014 (e)",y=0,m=0,k=0,d=0,v=0,l=0,u=null,F=0,q=0,f=0,A=0,a=0,D=0,i=0,p=0;Squeak.registerExternalModule("Klatt",{setInterpreter:gr,primitiveSynthesizeFrameIntoStartingAt:Sr,getModuleName:_r})}),module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function s(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function r(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function w(e,t){return 0|Math.floor(e/t)}function c(e,t){return e-w(e,t)*t|0}function m(t,e){return e>31?0:t<<e}function u(t,e){return e>31?0:t>>>e}function St(v,o,d){var a,h,t,l,f,r,s,p,n;if(1>o||1>d)return e.primitiveFail();if(t=v,s=Math.min(d,Ot(t)),o>s)return!1;if(r=(o-1>>3)+1,a=(s-1>>3)+1,f=c(o-1,8),l=7-c(s-1,8),r===a)return p=m(255,f)&u(255,l),h=i(t,r),0!==(h&p);if(0!==u(i(t,r),f))return!0;for(n=r+1;a-1>=n;n++)if(0!==i(t,n))return!0;return 0!==(255&m(i(t,a),l))?!0:!1}function v(t,i){var n,o,a;return a=e.instantiateClassindexableSize(s(t),i),n=r(t),o=i>n?n:i,j(t.bytes,a.bytes,o),a}function I(r,n){var s,i,t;return"number"==typeof r?(i=r,s=0>i?e.classLargeNegativeInteger():e.classLargePositiveInteger(),t=e.instantiateClassindexableSize(s,n),kt(i,t)):t=v(r,n),t}function kt(t,n){var r,e,i;for(r=n.bytes,e=1,i=k(t);i>=e;e++)r[e-1]=o(t,e)}function bt(a,i,n,o,s){var e,r,t;for(t=0,r=i-1,e=0;r>=e;e++)t=(t>>>8)+a[e]+n[e],s[e]=255&t;for(r=o-1,e=i;r>=e;e++)t=(t>>>8)+n[e],s[e]=255&t;return t>>>8}function _(i,n,s){var t,r,e;for(e=s-1;e>=0;){if((r=n[e])!==(t=i[e]))return t>r?1:-1;--e}return 0}function j(r,i,n){var t,e;for(t=n-1,e=0;t>=e;e++)i[e]=r[e];return 0}function mt(p,g,o,I,F,y){var m,a,s,f,t,n,O,b,k,i,d,r,e,u,S,h,l,v;for(u=g-1,S=y,l=p[u-1],f=1===u?0:p[u-2],d=1;S>=d;d++){if(r=I+1-d,o[r-1]===l)a=255;else for(h=o[r-1],h=(h<<8)+o[r-2],v=c(h,l),a=w(h,l),b=a*f,n=b>>>8,t=255&b,O=3>r?0:o[r-3];;){if(n>v||v===n&&t>O?(--a,f>t?(--n,t=t+256-f):t-=f,k=n>=l):k=!1,!k)break;n-=l}for(i=r-u,s=0,e=1;g>=e;e++)n=p[e-1]*(a>>>8),t=p[e-1]*(255&a),m=o[i-1]-s-(255&t),o[i-1]=255&m,m>>=8,s=n+(t>>>8)-m,++i;if(s>0)for(--a,i=r-u,s=0,e=1;g>=e;e++)s=(s>>>8)+o[i-1]+p[e-1],o[i-1]=255&s,++i;F[y-d]=a}return 0}function b(r,i){var t,e;for(e=i;0===(t=r[e-1]);)if(0===--e)return 0;return F(t)+8*(e-1)}function k(e){return 256>e&&e>-256?1:65536>e&&e>-65536?2:16777216>e&&e>-16777216?3:4}function W(h,o,d,i,l){var s,t,a,e,r,f,n;for(s=h>>3,r=c(h,8),n=s-1,e=0;n>=e;e++)i[e]=0;if(0===r)return S(i,s,l-1,o,0);for(f=8-r,t=0,n=d-1,e=0;n>=e;e++)a=o[e],i[e+s]=255&(t|m(a,r)),t=u(a,f);return 0!==t&&(i[l-1]=t),0}function R(m,u,p,l,n,c,f,i){var t,r,o,s,h,d,a,e;for(d=u-1,h=l-1,s=c-1,o=0,r=0;d>=r;r++){for(e=i[0]+m[r]*p[0],a=e*f&255,e+=a*n[0],t=1;h>=t;t++)e=(e>>>8)+i[t]+m[r]*p[t]+a*n[t],i[t-1]=255&e;for(t=l;s>=t;t++)e=(e>>>8)+i[t]+a*n[t],i[t-1]=255&e;e=(e>>>8)+o,i[s]=255&e,o=e>>>8}for(r=u;s>=r;r++){for(e=i[0],a=e*f&255,e+=a*n[0],t=1;s>=t;t++)e=(e>>>8)+i[t]+a*n[t],i[t-1]=255&e;e=(e>>>8)+o,i[s]=255&e,o=e>>>8}if(0!==o||1!==_(n,i,c))for(e=0,r=0;s>=r;r++)e=e+i[r]-n[r],i[r]=255&e,e>>=8}function E(l,a,f,u,s){var e,i,o,n,t,c,r,h;if(1===a&&0===l[0])return 0;if(1===u&&0===f[0])return 0;for(h=a-1,c=u-1,t=0;h>=t;t++)if(0!==(o=l[t])){for(r=t,n=0,i=0;c>=i;i++)e=f[i],e=e*o+n+s[r],n=e>>>8,s[r]=255&e,++r;s[r]=n}return 0}function o(r,t){return 1>t&&e.primitiveFail(),t>4?0:0>r?255&u(0-r,8*(t-1)):255&u(r,8*(t-1))}function D(a,o,s,n,u,i){var t,r;if(r=s-1,a===P){for(t=0;r>=t;t++)i[t]=o[t]&n[t];for(r=u-1,t=s;r>=t;t++)i[t]=0;return 0}if(a===O){for(t=0;r>=t;t++)i[t]=o[t]|n[t];for(r=u-1,t=s;r>=t;t++)i[t]=n[t];return 0}if(a===A){for(t=0;r>=t;t++)i[t]=o[t]^n[t];for(r=u-1,t=s;r>=t;t++)i[t]=n[t];return 0}return e.primitiveFail()}function S(t,e,r,i,n){return function(){for(var a=r-e+1,s=0;a>s;s++)t[s+e]=i[s+n];return 0}()}function L(d,a,p,o,l){var t,i,r,n,e,f,h,s;if(i=d>>3,e=c(d,8),0===e)return S(o,0,l-1,a,i);for(f=8-e,r=u(a[i],e),s=i+1,h=p-1,t=s;h>=t;t++)n=a[t],o[t-s]=255&(r|m(n,f)),r=u(n,e);return 0!==r&&(o[l-1]=r),0}function rt(s,r,i,a,n){var e,t;for(t=0,e=0;r-1>=e;e++)t=t+i[e]-s[e],n[e]=255&t,t>>=8;for(e=r;a-1>=e;e++)t+=i[e],n[e]=255&t,t>>=8}function F(r){var e,t;return e=r,t=0,65536>e||(e>>>=16,t+=16),256>e||(e>>>=8,t+=8),16>e||(e>>>=4,t+=4),4>e||(e>>>=2,t+=2),2>e||(e>>>=1,++t),t+e}function t(u){var i,n,s,t,a,r;for(r=u,a=0>r?e.classLargeNegativeInteger():e.classLargePositiveInteger(),i=k(r),n=e.instantiateClassindexableSize(a,i),s=n.bytes,t=1;i>=t;t++)s[t-1]=o(r,t);return n}function h(t,o){var i,n,a,u;return n=r(t),0===(u=b(t.bytes,n))?0:(i=u+o+7>>3,a=e.instantiateClassindexableSize(s(t),i),W(o,t.bytes,n,a.bytes,i),a)}function p(t,o,l){var r,u,i,n,a;return a=b(t.bytes,l),u=a+7>>3,n=a-o,0>=n?e.instantiateClassindexableSize(s(t),0):(i=n+7>>3,r=e.instantiateClassindexableSize(s(t),i),L(o,t.bytes,u,r.bytes,i),r)}function C(n,l){var i,h,d,u,p,c,t,a,o,f;return a=r(n),o=r(l),p=s(n),o>=a?(u=n,h=a,f=l,t=o):(u=l,h=o,f=n,t=a),i=e.instantiateClassindexableSize(p,t),d=bt(u.bytes,h,f.bytes,t,i.bytes),d>0&&(c=e.instantiateClassindexableSize(p,t+1),j(i.bytes,c.bytes,t),i=c,i.bytes[t]=d),i}function d(n,a,v){var d,h,o,i,u,p,c,f,m;if("number"==typeof n){if(0>n)return e.primitiveFail();o=t(n)}else{if(s(n)===e.classLargeNegativeInteger())return e.primitiveFail();o=n}if("number"==typeof a){if(0>a)return e.primitiveFail();
i=t(a)}else{if(s(a)===e.classLargeNegativeInteger())return e.primitiveFail();i=a}return c=r(o),f=r(i),f>c?(d=c,h=o,u=f,p=i):(d=f,h=i,u=c,p=o),m=e.instantiateClassindexableSize(e.classLargePositiveInteger(),u),D(v,h.bytes,d,p.bytes,u,m.bytes),e.failed()?0:l(m)}function x(i,n){var t,e;return e=r(i),t=r(n),t!==e?t>e?-1:1:_(i.bytes,n.bytes,e)}function V(m,c,g){var v,i,t,s,o,l,f,d,u;return u=r(m),d=r(c),v=g?e.classLargeNegativeInteger():e.classLargePositiveInteger(),f=u-d+1,0>=f?(i=e.instantiateClassindexableSize(e.classArray(),2),e.stObjectatput(i,1,0),e.stObjectatput(i,2,m),i):(l=8-F(n(c,d)),s=h(c,l),s=I(s,a(s)+1),t=h(m,l),a(t)===u&&(t=I(t,u+1)),o=e.instantiateClassindexableSize(v,f),mt(s.bytes,a(s),t.bytes,a(t),o.bytes,a(o)),t=p(t,l,a(s)-1),i=e.instantiateClassindexableSize(e.classArray(),2),e.stObjectatput(i,1,o),e.stObjectatput(i,2,t),i)}function a(e){return"number"==typeof e?k(e):r(e)}function T(o,u,c,i){var n,t,s,a;return s=r(o),a=r(u),t=r(c),t>=s&&t>=a&&i>=0&&255>=i?(n=e.instantiateClassindexableSize(e.classLargePositiveInteger(),t),R(o.bytes,s,u.bytes,a,c.bytes,t,i,n.bytes),l(n)):e.primitiveFail()}function M(c,a,d){var u,h,t,o,s,l,n,i;return i=r(c),n=r(a),n>=i?(o=c,t=i,u=a,s=n):(o=a,t=n,u=c,s=i),h=d?e.classLargeNegativeInteger():e.classLargePositiveInteger(),l=e.instantiateClassindexableSize(h,s+t),E(o.bytes,t,u.bytes,s,l.bytes),f(l)}function i(e,t){return t>r(e)?0:n(e,t)}function q(a,o){var m,p,u,h,v,c,d,t,n,f;if(d=s(a)===e.classLargeNegativeInteger(),t=r(a),n=r(o),t===n){for(;t>1&&i(a,t)===i(o,t);)--t;n=t}return n>t||t===n&&i(a,t)<i(o,t)?(p=o,c=n,h=a,m=t,f=d===!1):(p=a,c=t,h=o,m=n,f=d),v=c,u=e.instantiateClassindexableSize(f?e.classLargeNegativeInteger():e.classLargePositiveInteger(),v),rt(h.bytes,m,p.bytes,c,u.bytes),f?y(u):l(u)}function g(){return yt}function Ot(e){return b(e.bytes,r(e))}function B(r){var i,u,t,l,c;if("number"==typeof r)return!0;if(u=a(r),0===u)return!1;if(0===n(r,u))return!1;if(t=4,u>t)return!0;if(t>u)return!1;if(s(r)===e.classLargePositiveInteger())return c=1073741823,n(r,t)>o(c,t);if(l=-1073741824,n(r,t)<o(l,t))return!1;for(i=1;t>=i;i++)if(n(r,i)!==o(l,i))return!0;return!1}function f(t){return s(t)===e.classLargePositiveInteger()?l(t):y(t)}function y(t){var r,e,s,u,c,l;for(e=c=a(t);0!==e&&0===n(t,e);)--e;if(0===e)return 0;if(s=4,s>=e){if(u=-1073741824,s>e||i(t,s)<o(u,s)){for(l=0,r=e;r>=1;r+=-1)l=256*l-n(t,r);return l}for(r=1;s>=r;r++)if(i(t,r)!==o(u,r))return c>e?v(t,e):t;return u}return c>e?v(t,e):t}function l(t){var r,e,s,u,l;for(e=l=a(t);0!==e&&0===n(t,e);)--e;if(0===e)return 0;if(s=4,s>=e&&i(t,s)<=o(1073741823,s)){for(u=0,r=e;r>=1;r+=-1)u=256*u+n(t,r);return u}return l>e?v(t,e):t}function z(){var r,i,n,s,a;return n=e.stackIntegerValue(1),s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.failed()?null:(i="number"==typeof r?t(r):r,a=St(i,n,s)?e.trueObject():e.falseObject(),e.failed()?null:(e.popthenPush(3,a),null))}function K(){var r,i;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.failed()?null:"number"==typeof r?(i=t(r),e.failed()?null:(e.popthenPush(2,i),null)):e.failed()?null:(e.popthenPush(2,r),null)}function U(){var t;return t=e.trueObject(),e.failed()?null:(e.popthenPush(1,t),null)}function G(){var o,i,n,s,a;return e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),s=e.stackIntegerValue(0),e.failed()?null:(i="number"==typeof n?t(n):n,s>=0?(a=h(i,s),e.failed()?null:(e.popthenPush(3,a),null)):(o=0-s,a=f(p(i,o,r(i))),e.failed()?null:(e.popthenPush(3,a),null)))}function H(){var n,r,s,i,a;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,a=C(n,s),e.failed()?null:(e.popthenPush(2,a),null))}function J(){var n,s,r,i,a;return e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,a=C(n,s),e.failed()?null:(e.popthenPush(3,a),null))}function Z(){var t,r,i;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(i=d(t,r,P),e.failed()?null:(e.popthenPush(2,i),null))}function X(){var t,r,i,n;return e.success(e.isKindOfInteger(e.stackValue(2))),t=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),i=e.stackIntegerValue(0),e.failed()?null:(n=d(t,r,i),e.failed()?null:(e.popthenPush(4,n),null))}function Y(){var t,r,i;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(i=d(t,r,O),e.failed()?null:(e.popthenPush(2,i),null))}function Q(){var i,o,n,s,a;return s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),e.failed()?null:(i="number"==typeof n?t(n):n,s>=0?(a=h(i,s),e.failed()?null:(e.popthenPush(2,a),null)):(o=0-s,a=f(p(i,o,r(i))),e.failed()?null:(e.popthenPush(2,a),null)))}function $(){var i,o,n,s,a;return s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),e.failed()?null:(i="number"==typeof n?t(n):n,s>=0?(a=h(i,s),e.failed()?null:(e.popthenPush(2,a),null)):(o=0-s,a=f(p(i,o,r(i))),e.failed()?null:(e.popthenPush(2,a),null)))}function et(){var t,r,i;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(i=d(t,r,A),e.failed()?null:(e.popthenPush(2,i),null))}function tt(){var n,i,s,r,t;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.failed()?null:"number"==typeof i?"number"==typeof r?(n=i)>(s=r)?(t=1,e.failed()?null:(e.popthenPush(2,t),null)):s>n?(t=-1,e.failed()?null:(e.popthenPush(2,t),null)):(t=0,e.failed()?null:(e.popthenPush(2,t),null)):(t=-1,e.failed()?null:(e.popthenPush(2,t),null)):"number"==typeof r?(t=1,e.failed()?null:(e.popthenPush(2,t),null)):(t=x(i,r),e.failed()?null:(e.popthenPush(2,t),null))}function N(){var n,s,i,r,t;return e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.failed()?null:"number"==typeof i?"number"==typeof r?(n=i)>(s=r)?(t=1,e.failed()?null:(e.popthenPush(3,t),null)):s>n?(t=-1,e.failed()?null:(e.popthenPush(3,t),null)):(t=0,e.failed()?null:(e.popthenPush(3,t),null)):(t=-1,e.failed()?null:(e.popthenPush(3,t),null)):"number"==typeof r?(t=1,e.failed()?null:(e.popthenPush(3,t),null)):(t=x(i,r),e.failed()?null:(e.popthenPush(3,t),null))}function it(){var s,i,n,r,a,o;if(e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.failed())return null;if(!B(i))return e.primitiveFail(),null;if(!B(r))return e.primitiveFail(),null;if(s="number"==typeof i?t(i):i,"number"==typeof r){if(0===r)return e.primitiveFail(),null;n=t(r)}else n=r;return o=V(s,n,a),e.failed()?null:(e.popthenPush(3,o),null)}function nt(){var s,n,i,r,a,o;if(e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.failed())return null;if(s="number"==typeof i?t(i):i,"number"==typeof r){if(0===r)return e.primitiveFail(),null;n=t(r)}else n=r;return o=V(s,n,a),e.failed()?null:(e.popthenPush(4,o),null)}function st(){var n,r,s,i,a,o;return e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,o=M(n,s,a),e.failed()?null:(e.popthenPush(3,o),null))}function at(){var n,s,r,i,a,o;return e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,o=M(n,s,a),e.failed()?null:(e.popthenPush(4,o),null))}function ot(){var n,r,s,i,a;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,a=q(n,s),e.failed()?null:(e.popthenPush(2,a),null))}function ut(){var n,s,r,i,a;return e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.failed()?null:(n="number"==typeof r?t(r):r,s="number"==typeof i?t(i):i,a=q(n,s),e.failed()?null:(e.popthenPush(3,a),null))}function lt(){var n,r,t,i;for(r=strlen(g()),i=e.instantiateClassindexableSize(e.classString(),r),n=i.bytes,t=0;r-1>=t;t++)n[t]=g()[t];return e.failed()?null:(e.popthenPush(1,i),null)}function ct(){var s,a,r,o,i,n,u,l;return e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),u=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(3))),r=e.stackValue(3),e.failed()?null:(s="number"==typeof r?t(r):r,a="number"==typeof i?t(i):i,o="number"==typeof n?t(n):n,l=T(s,a,o,u),e.failed()?null:(e.popthenPush(4,l),null))}function ft(){var t,r;return e.success(e.isKindOfInteger(e.stackValue(0))),t=e.stackValue(0),e.failed()?null:"number"==typeof t?e.failed()?null:(e.popthenPush(2,t),null):(r=f(t),e.failed()?null:(e.popthenPush(2,r),null))}function ht(){var t,r;return e.success(e.stackValue(0).sqClass===e.classLargeNegativeInteger()),t=e.stackValue(0),e.failed()?null:(r=y(t),e.failed()?null:(e.popthenPush(1,r),null))}function dt(){var t,r;return e.success(e.stackValue(0).sqClass===e.classLargePositiveInteger()),t=e.stackValue(0),e.failed()?null:(r=l(t),e.failed()?null:(e.popthenPush(1,r),null))}function pt(r){var t;return e=r,t=e.majorVersion()==vt,t===!1?!1:t=e.minorVersion()>=gt}function n(e,t){var r;return(r=e.bytes)[t-1]}var vt=1,gt=11,P=0,e=null,yt="LargeIntegers v1.5 (e)",O=1,A=2;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:J,primDigitBitShiftMagnitude:$,primGetModuleName:lt,primDigitBitLogicWithOp:X,primCheckIfCModuleExists:U,primDigitCompare:tt,primDigitMultiplyNegative:st,primDigitBitShift:Q,primNormalizePositive:dt,primDigitSubtractWith:ut,_primDigitBitShift:G,primDigitMultiplyWithNegative:at,primDigitSubtract:ot,primDigitDivNegative:it,primNormalizeNegative:ht,primDigitBitOr:Y,primMontgomeryTimesModulo:ct,primDigitBitAnd:Z,primDigitDivWithNegative:nt,setInterpreter:pt,primNormalize:ft,primDigitBitXor:et,primDigitCompareWith:N,primDigitAdd:H,getModuleName:g,primAsLargeInteger:K,primAnyBitFromTo:z})}),module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function v(){return I}function s(t){return e.failed()?null:e.isWords(t)&&6===f(t)?t.wordsAsFloat32Array():(e.primitiveFail(),null)}function a(s){var r,t;return e.failed()?null:u(s)!==e.classPoint()?e.primitiveFail():(t=e.fetchPointerofObject(0,s),r="number"==typeof t,r||t.isFloat?(n=r?t:e.floatValueOf(t),t=e.fetchPointerofObject(1,s),r="number"==typeof t,r||t.isFloat?void(i=r?t:e.floatValueOf(t)):e.primitiveFail()):e.primitiveFail())}function g(e,t,r){var i,n,s,a,o,u;i=e[0]*t[0]+e[1]*t[3],n=e[0]*t[1]+e[1]*t[4],s=e[0]*t[2]+e[1]*t[5]+e[2],a=e[3]*t[0]+e[4]*t[3],o=e[3]*t[1]+e[4]*t[4],u=e[3]*t[2]+e[4]*t[5]+e[5],r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=o,r[5]=u}function l(s){var a,l,c,o,u;return o=n-s[2],u=i-s[5],a=s[0]*s[4]-s[1]*s[3],0===a?e.primitiveFail():(a=1/a,l=o*s[4]-s[1]*u,c=s[0]*u-o*s[3],t=l*a,void(r=c*a))}function c(e){t=n*e[0]+i*e[1]+e[2],r=n*e[3]+i*e[4]+e[5]}function o(e){return e>=-1073741824&&1073741823>=t}function S(){var t,r,i,n;return i=s(n=e.stackObjectValue(0)),r=s(e.stackObjectValue(1)),t=s(e.stackObjectValue(2)),e.failed()?null:(g(t,r,i),void e.popthenPush(3,n))}function O(){var t;return a(e.stackObjectValue(0)),t=s(e.stackObjectValue(1)),e.failed()?null:(l(t),void(e.failed()||d(2)))}function w(){var S,b,g,v,p,o,d,c,k,y,m;return g=e.stackObjectValue(0),m=e.stackObjectValue(1),v=s(e.stackObjectValue(2)),e.failed()?null:u(m)!==u(g)?e.primitiveFail():e.isPointers(m)?2!==f(m)?e.primitiveFail():(a(e.fetchPointerofObject(0,m)),e.failed()?null:(k=n,y=i,l(v),d=p=t,c=o=r,a(e.fetchPointerofObject(1,m)),e.failed()?null:(S=n,b=i,l(v),d=Math.min(d,t),p=Math.max(p,t),c=Math.min(c,r),o=Math.max(o,r),n=S,i=y,l(v),d=Math.min(d,t),p=Math.max(p,t),c=Math.min(c,r),o=Math.max(o,r),n=k,i=b,l(v),d=Math.min(d,t),p=Math.max(p,t),c=Math.min(c,r),o=Math.max(o,r),e.failed()||(g=h(g,d,c,p,o)),void(e.failed()||e.popthenPush(3,g))))):e.primitiveFail()}function F(){var t;return t=s(e.stackObjectValue(0)),e.failed()?null:(e.pop(1),void e.pushBool(1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]))}function A(){var t;return t=s(e.stackObjectValue(0)),e.failed()?null:(e.pop(1),void e.pushBool(1===t[0]&&0===t[1]&&0===t[3]&&1===t[4]))}function p(){var t;return a(e.stackObjectValue(0)),t=s(e.stackObjectValue(1)),e.failed()?null:(c(t),void d(2))}function m(){var S,b,g,v,p,o,d,l,k,y,m;return g=e.stackObjectValue(0),m=e.stackObjectValue(1),v=s(e.stackObjectValue(2)),e.failed()?null:u(m)!==u(g)?e.primitiveFail():e.isPointers(m)?2!==f(m)?e.primitiveFail():(a(e.fetchPointerofObject(0,m)),e.failed()?null:(k=n,y=i,c(v),d=p=t,l=o=r,a(e.fetchPointerofObject(1,m)),e.failed()?null:(S=n,b=i,c(v),d=Math.min(d,t),p=Math.max(p,t),l=Math.min(l,r),o=Math.max(o,r),n=S,i=y,c(v),d=Math.min(d,t),p=Math.max(p,t),l=Math.min(l,r),o=Math.max(o,r),n=k,i=b,c(v),d=Math.min(d,t),p=Math.max(p,t),l=Math.min(l,r),o=Math.max(o,r),g=h(g,d,l,p,o),void(e.failed()||e.popthenPush(3,g))))):e.primitiveFail()}function d(i){return t+=.5,r+=.5,o(t)&&o(r)?void e.popthenPush(i,e.makePointwithxValueyValue(0|t,0|r)):e.primitiveFail()}function h(d,l,h,f,c){var u,i,a,s,n,r,t;return s=l+.5,o(s)?(i=f+.5,o(i)?(n=h+.5,o(n)?(a=c+.5,o(a)?(e.pushRemappableOop(d),r=e.makePointwithxValueyValue(0|s,0|n),e.pushRemappableOop(r),u=e.makePointwithxValueyValue(0|i,0|a),r=e.popRemappableOop(),t=e.popRemappableOop(),e.storePointerofObjectwithValue(0,t,r),e.storePointerofObjectwithValue(1,t,u),t):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()}function b(r){var t;return e=r,t=e.majorVersion()==k,t===!1?!1:t=e.minorVersion()>=y}var k=1,y=11,e=null,n=0,i=0,t=0,r=0,I="Matrix2x3Plugin 3 November 2014 (e)";Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:O,primitiveInvertRectInto:w,primitiveIsIdentity:F,primitiveComposeMatrix:S,setInterpreter:b,primitiveTransformRectInto:m,primitiveIsPureTranslation:A,getModuleName:v,primitiveTransformPoint:p})}),module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function b(e,t){return 0|Math.floor(e/t)}function c(e,t){return e-b(e,t)*t|0}function n(t,e){return e>31?0:t>>>e}function r(r,i,t){var e;for(e=0;3>=e;e++)i[t+e-1]=255&n(r,8*(3-e));return t+4}function t(t,i,e){return 223>=t?(i[e-1]=t,e+1):7935>=t?(i[e-1]=(t>>8)+224,i[e]=c(t,256),e+2):(i[e-1]=255,r(t,i,e+1))}function s(){return k}function a(){var l,n,s,a,o,u,t,r,i;if(l=e.stackValue(3),n=e.stackBytes(2),s=e.stackBytes(1),a=e.stackBytes(0),e.failed())return null;for(r=n.length,i=s.length,t=1;t<=Math.min(r,i);t++)if(o=a[n[t-1]],u=a[s[t-1]],o!==u)return u>o?e.failed()?null:(e.popthenPush(4,1),null):e.failed()?null:(e.popthenPush(4,3),null);return r===i?e.failed()?null:(e.popthenPush(4,2),null):i>r?e.failed()?null:(e.popthenPush(4,1),null):e.failed()?null:(e.popthenPush(4,3),null)}function o(){var d,u,a,h,i,n,s,l,f,c,o;if(d=e.stackValue(2),u=e.stackInt32Array(1),a=e.stackBytes(0),e.failed())return null;for(c=u.length,i=t(c,a,1),s=1;c>=s;){for(o=u[s-1],l=255&o,h=(o>>>8&255)===l&&(o>>>16&255)===l&&(o>>>24&255)===l,n=s;c>n&&o===u[n];)++n;if(n>s)h?(i=t(4*(n-s+1)+1,a,i),a[i-1]=l,++i):(i=t(4*(n-s+1)+2,a,i),i=r(o,a,i)),s=n+1;else if(h)i=t(5,a,i),a[i-1]=l,++i,++s;else{for(;c>n&&u[n-1]!==u[n];)++n;for(n===c&&++n,i=t(4*(n-s)+3,a,i),f=s;n-1>=f;f++)i=r(u[f-1],a,i);s=n}}return e.failed()?null:(e.popthenPush(3,i-1),null)}function u(){var a,i,n,t,s,r;if(a=e.stackValue(2),i=e.stackBytes(1),n=e.stackUint16Array(0),e.failed())return null;for(s=i.length,t=1;s>=t;t++)r=i[t-1],n[t-1]=r>127?r-256<<8:r<<8;return e.failed()?null:void e.pop(2)}function l(){var p,o,a,h,n,l,r,f,i,t,s,c,u,d;if(p=e.stackValue(3),o=e.stackInt32Array(2),a=e.stackBytes(1),h=e.stackIntegerValue(0),e.failed())return null;for(i=h,f=a.length,s=1,d=o.length+1;f>=i;){if(n=a[i-1],++i,!(223>=n))if(254>=n)n=256*(n-224)+a[i-1],++i;else for(n=0,t=1;4>=t;t++)n=(n<<8)+a[i-1],++i;if(u=n>>>2,s+u>d)return e.primitiveFail(),null;if(l=3&n,1===l)for(r=a[i-1],++i,r|=r<<8,r|=r<<16,t=1;u>=t;t++)o[s-1]=r,++s;if(2===l){for(r=0,t=1;4>=t;t++)r=r<<8|a[i-1],++i;for(t=1;u>=t;t++)o[s-1]=r,++s}if(3===l)for(c=1;u>=c;c++){for(r=0,t=1;4>=t;t++)r=r<<8|a[i-1],++i;o[s-1]=r,++s}}return e.failed()?null:void e.pop(3)}function i(){var a,r,i,s,t,n;if(a=e.stackValue(3),r=e.stackBytes(2),i=e.stackBytes(1),s=e.stackIntegerValue(0),e.failed())return null;if(256!==i.length)return e.failed()?null:(e.popthenPush(4,0),null);for(t=s,n=r.length;n>=t&&0===i[r[t-1]];)++t;return t>n?e.failed()?null:(e.popthenPush(4,0),null):e.failed()?null:(e.popthenPush(4,t),null)}function f(){var o,t,n,a,s,r,i;if(o=e.stackValue(4),t=e.stackBytes(3),n=e.stackBytes(2),a=e.stackIntegerValue(1),s=e.stackBytes(0),e.failed())return null;if(0===t.length)return e.failed()?null:(e.popthenPush(5,0),null);for(i=a;i<=n.length-t.length+1;i++)for(r=1;s[n[i+r-1-1]]===s[t[r-1]];){if(r===t.length)return e.failed()?null:(e.popthenPush(5,i),null);++r}return e.failed()?null:(e.popthenPush(5,0),null)}function h(){var a,i,r,n,t,s;if(a=e.stackValue(3),i=e.stackIntegerValue(2),r=e.stackBytes(1),n=e.stackIntegerValue(0),e.failed())return null;for(s=r.length,t=n;s>=t;t++)if(r[t-1]===i)return e.failed()?null:(e.popthenPush(4,t),null);return e.failed()?null:(e.popthenPush(4,0),null)}function d(){var o,i,s,a,t,n,r;if(o=e.stackValue(2),i=e.stackBytes(1),s=e.stackIntegerValue(0),e.failed())return null;for(a=i.length,t=268435455&s,r=1;a>=r;r++)t+=i[r-1],n=16383&t,t=9741*n+16384*(9741*(t>>>14)+101*n&16383)&268435455;return e.failed()?null:(e.popthenPush(3,t),null)}function p(){var a,r,i,n,s,t;if(a=e.stackValue(4),r=e.stackBytes(3),i=e.stackIntegerValue(2),n=e.stackIntegerValue(1),s=e.stackBytes(0),e.failed())return null;for(t=i;n>=t;t++)r[t-1]=s[r[t-1]];return e.failed()?null:void e.pop(4)}function m(r){var t;return e=r,t=e.majorVersion()==v,t===!1?!1:t=e.minorVersion()>=g}var v=1,g=11,e=null,k="MiscPrimitivePlugin 3 November 2014 (e)";Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:u,primitiveCompareString:a,primitiveTranslateStringWithTable:p,primitiveStringHash:d,primitiveCompressToByteArray:o,primitiveFindSubstring:f,primitiveIndexOfAsciiInString:h,setInterpreter:m,primitiveDecompressFromByteArray:l,getModuleName:s,primitiveFindFirstInString:i})}),module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function i(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function t(e,t){return 0|Math.floor(e/t)}function n(e,r){return e-t(e,r)*r|0}function s(d,h,f,c,u){var l,i,r,e,a,o,s;return i=t(f,60),l=n(f,60),e=(1e3-c)*u,a=(1e3-t(c*l,60))*u,o=(1e3-t(c*(60-l),60))*u,s=t(1e3*u,3922),e=t(e,3922),a=t(a,3922),o=t(o,3922),0===i&&(r=(s<<16)+(o<<8)+e),1===i&&(r=(a<<16)+(s<<8)+e),2===i&&(r=(e<<16)+(s<<8)+o),3===i&&(r=(e<<16)+(a<<8)+s),4===i&&(r=(o<<16)+(e<<8)+s),5===i&&(r=(s<<16)+(e<<8)+a),0===r&&(r=1),d[h]=r,0}function l(t){return e.success(e.isWordsOrBytes(t)),e.failed()?0:t.wordsAsFloat64Array()}function r(t){return e.success(e.isWords(t)),e.failed()?0:t.words}function p(){return P}function a(i,n,a,o,s){var r,e;return e=s-o,0===e?0:(r=i===s?t(60*(n-a),e):n===s?120+t(60*(a-i),e):240+t(60*(i-n),e),0>r?r+360:r)}function o(e,t,r){var s,i,a,o,n;return 0===e?t:0===t?e:(i=1024-r,o=i*(e>>>16&255)+r*(t>>>16&255)>>10,a=i*(e>>>8&255)+r*(t>>>8&255)>>10,s=i*(255&e)+r*(255&t)>>10,n=(o<<16)+(a<<8)+s,0===n&&(n=1),n)}function u(l,c,h,u,f){var a,i,s,t,r,e,n;return t=c>>>10,-1>t||t>=u?0:(e=h>>>10,-1>e||e>=f?0:(r=1023&c,-1===t&&(t=0,r=0),t===u-1&&(r=0),n=1023&h,-1===e&&(e=0,n=0),e===f-1&&(n=0),i=e*u+t,s=16777215&l[i],r>0&&(s=o(s,16777215&l[i+1],r)),0===n?s:(i=(e+1)*u+t,a=16777215&l[i],r>0&&(a=o(a,16777215&l[i+1],r)),o(s,a,n))))}function c(){var f,c,l,h,k,b,m,n,y,d,g,u,v,p,o,a,s;if(m=e.stackValue(2),d=e.stackValue(1),o=e.stackIntegerValue(0),b=r(m),y=r(d),p=i(m),e.success(i(d)===p),e.failed())return null;for(k=t(p,o),s=1;k-2>=s;s++)for(a=1;o-2>=a;a++){for(n=v=h=f=0,l=-1;1>=l;l++)for(c=-1;1>=c;c++)u=16777215&b[(s+l)*o+(a+c)],0!==u&&(v+=u>>>16&255,h+=u>>>8&255,f+=255&u,++n);g=0===n?0:(t(v,n)<<16)+(t(h,n)<<8)+t(f,n),y[s*o+a]=g}return e.pop(3),0}function f(){var l,u,c,b,f,S,v,n,o,g,d,h,p,k,y,m;if(v=e.stackValue(2),d=e.stackValue(1),y=e.stackIntegerValue(0),S=r(v),m=i(v),g=r(d),e.success(i(d)===m),e.failed())return null;for(f=0;m-1>=f;f++)h=16777215&S[f],0!==h&&(p=h>>>16&255,c=h>>>8&255,l=255&h,n=o=p,c>n&&(n=c),l>n&&(n=l),o>c&&(o=c),o>l&&(o=l),b=a(p,c,l,o,n),k=0===n?0:t(1e3*(n-o),n),u=t(1e3*n,255),u+=10*y,u>1e3&&(u=1e3),0>u&&(u=0),s(g,f,b,k,u));return e.pop(3),0}function h(){var l,d,s,c,o,u,n,f,a,h,r,p=0,m=0;if(a=e.stackValue(2),s=e.stackValue(1),c=e.stackIntegerValue(0),e.success(e.isWords(a)),e.success(e.isWords(s)),l=t(2*i(a),c),h=2*i(s),e.success(h>=l),e.failed())return null;for(f=a.wordsAsInt16Array(),d=s.wordsAsInt16Array(),o=1;l>=o;o++){for(n=0,u=1;c>=u;u++)r=f[p++],0>r&&(r=0-r),r>n&&(n=r);d[m++]=n}return e.pop(3),0}function d(){var v,l,f,n,m,c,h,u,o,d,p,a,s,i,t;if(h=e.stackValue(7),u=e.stackIntegerValue(6),c=e.stackIntegerValue(5),p=e.stackValue(4),a=e.stackIntegerValue(3),d=e.stackIntegerValue(2),l=e.stackIntegerValue(1),f=e.stackIntegerValue(0),m=r(h),o=r(p),e.success(a>l+2*u),e.success(d>f+2*c),e.failed())return null;for(t=0;c-1>=t;t++)for(v=(f+2*t)*a+l,i=0;u-1>=i;i++)s=m[i+t*u],n=v+2*i,o[n]=s,o[n+1]=s,o[n+a]=s,o[n+a+1]=s;return e.pop(8),0}function C(){var o,t,n,u,l,r,s,a=0,c=0;if(r=e.stackValue(2),t=e.stackValue(1),u=e.booleanValueOf(e.stackValue(0)),e.success(e.isWords(r)),e.success(e.isWords(t)),s=i(r),e.success(i(t)>=s>>1),e.failed())return null;for(l=r.wordsAsInt16Array(),o=t.wordsAsInt16Array(),u&&a++,n=1;s>=n;n++)o[c++]=l[a],a+=2;return e.pop(3),0}function m(){var v,c,a,f,h,o,w,m,O,g,F,S,p,y,k,b,d,n,l,s;if(m=e.stackValue(3),g=e.stackValue(2),n=e.stackIntegerValue(1),S=e.stackIntegerValue(0),w=r(m),O=r(g),d=i(m),e.success(i(g)===d),e.failed())return null;for(o=t(d,n),c=n>>1,a=o>>1,o=t(d,n),c=n>>1,a=o>>1,y=S/100,l=0;n-1>=l;l++)for(s=0;o-1>=s;s++)f=(l-c)/c,h=(s-a)/a,p=Math.pow(Math.sqrt(f*f+h*h),y),1>=p?(v=Math.atan2(h,f),k=1024*(c+p*Math.cos(v)*c)|0,b=1024*(a+p*Math.sin(v)*a)|0):(k=1024*l,b=1024*s),F=u(w,k,b,n,o),O[s*n+l]=F;return e.pop(4),0}function v(){var n,f,g,c,h,d,u,l,y,o,S,k,v,t,s,i,p,m,b,a;if(l=r(e.stackValue(11)),o=e.stackIntegerValue(10),y=e.stackIntegerValue(9),S=r(e.stackValue(8)),v=e.stackIntegerValue(7),k=e.stackIntegerValue(6),p=e.stackIntegerValue(5),m=e.stackIntegerValue(4),h=e.stackIntegerValue(3),d=e.stackIntegerValue(2),c=e.stackIntegerValue(1),f=e.stackIntegerValue(0),e.success(p>=0&&m>=0),e.success(o>=p+2*c),e.success(y>=m+2*f),e.success(h>=0&&d>=0),e.success(v>=h+c),e.success(k>=d+f),e.failed())return null;for(a=0;f-1>=a;a++)for(i=o*(m+2*a)+p,g=v*(d+a)+h,b=0;c-1>=b;b++)t=l[i],s=16711680&t,u=65280&t,n=255&t,t=l[i+1],s+=16711680&t,u+=65280&t,n+=255&t,t=l[i+o],s+=16711680&t,u+=65280&t,n+=255&t,t=l[i+o+1],s+=16711680&t,u+=65280&t,n+=255&t,S[g]=s>>>2&16711680|(u>>>2&65280|n>>>2),i+=2,++g;return e.pop(12),0}function g(){var S,i,p,n,s,a,y,m,k,u,O,b,d,f,h,g,c,l,o,v,t;if(m=r(e.stackValue(11)),u=e.stackIntegerValue(10),k=e.stackIntegerValue(9),O=r(e.stackValue(8)),d=e.stackIntegerValue(7),b=e.stackIntegerValue(6),l=e.stackIntegerValue(5),o=e.stackIntegerValue(4),s=e.stackIntegerValue(3),a=e.stackIntegerValue(2),n=e.stackIntegerValue(1),i=e.stackIntegerValue(0),e.success(l>=0&&o>=0),e.success(u>=l+2*n),e.success(k>=o+2*i),e.success(s>=0&&a>=0),e.success(d>=s+n),e.success(b>=a+i),e.failed())return null;for(t=0;i-1>=t;t++)for(c=u*(o+2*t)+l,p=d*(a+t)+s,v=0;n-1>=v;v++)f=m[c],h=m[c+u+1],g=(16711680&f)+(16711680&h)>>>1&16711680,y=(65280&f)+(65280&h)>>>1&65280,S=(255&f)+(255&h)>>>1,O[p]=g|(y|S),c+=2,++p;return e.pop(12),0}function b(){var f,d,l,m,h,O,g,o,u,y,v,p,k,c,S,b;if(g=e.stackValue(2),v=e.stackValue(1),S=e.stackIntegerValue(0),O=r(g),b=i(g),y=r(v),e.success(i(v)===b),e.failed())return null;for(h=0;b-1>=h;h++)p=16777215&O[h],0!==p&&(k=p>>>16&255,l=p>>>8&255,f=255&p,o=u=k,l>o&&(o=l),f>o&&(o=f),u>l&&(u=l),u>f&&(u=f),d=t(1e3*o,255),c=0===o?0:t(1e3*(o-u),o),110>d&&(d=110,c=1e3),90>c&&(c=90),m=110===d||90===c?0:a(k,l,f,u,o),m=n(m+S+36e7,360),s(y,h,m,c,d));return e.pop(3),0}function k(){var a,n,o,l,s,c,f;return n=e.stackValue(3),s=e.stackIntegerValue(2),c=e.stackIntegerValue(1),f=e.stackIntegerValue(0),a=r(n),l=i(n),e.failed()?null:(o=u(a,c,f,s,t(l,s)),e.pop(5),e.pushInteger(o),0)}function y(){var l,b,c,k,f,S,v,n,u,g,d,h,p,o,y,m;if(v=e.stackValue(2),d=e.stackValue(1),y=e.stackIntegerValue(0),S=r(v),m=i(v),g=r(d),e.success(i(d)===m),e.failed())return null;for(f=0;m-1>=f;f++)h=16777215&S[f],2>h||(p=h>>>16&255,c=h>>>8&255,l=255&h,n=u=p,c>n&&(n=c),l>n&&(n=l),u>c&&(u=c),u>l&&(u=l),b=t(1e3*n,255),o=0===n?0:t(1e3*(n-u),n),o>0&&(k=a(p,c,l,u,n),o+=10*y,o>1e3&&(o=1e3),0>o&&(o=0),s(g,f,k,o,b)));return e.pop(3),0}function S(){var m,y,I,h,o,c,A,S,F,f,p,w,O,s,u,a,l,n,d,k,b,g,v,P,C;if(I=e.stackValue(5),h=e.stackIntegerValue(4),y=e.stackIntegerValue(3),F=e.stackValue(2),p=e.stackIntegerValue(1),S=e.stackIntegerValue(0),e.success(i(I)===h*y),e.success(i(F)===p*S),m=r(I),A=r(F),e.failed())return null;for(o=c=0,P=t(1024*h,p),C=t(1024*y,S),O=0;S-1>=O;O++){for(o=0,w=0;p-1>=w;w++)k=(1024-(1023&o))*(1024-(1023&c)),b=(1023&o)*(1024-(1023&c)),g=(1024-(1023&o))*(1023&c),v=(1023&o)*(1023&c),n=(c>>>10)*h+(o>>>10),s=m[n],u=h-1>o>>>10?m[n+1]:s,y-1>c>>>10&&(n+=h),a=m[n],l=h-1>o>>>10?m[n+1]:a,d=0,0===s&&(s=u,d+=k),0===u&&(u=s,d+=b),0===a&&(a=l,d+=g),0===l&&(l=a,d+=v),0===s&&(s=a,u=l),0===a&&(a=s,l=u),f=0,5e5>d&&(n=k*(s>>>16&255)+b*(u>>>16&255)+g*(a>>>16&255)+v*(l>>>16&255),f=(n>>>20&255)<<16,n=k*(s>>>8&255)+b*(u>>>8&255)+g*(a>>>8&255)+v*(l>>>8&255),f|=(n>>>20&255)<<8,n=k*(255&s)+b*(255&u)+g*(255&a)+v*(255&l),f|=n>>>20&255,0===f&&(f=1)),A[O*p+w]=f,o+=P;c+=C}return e.pop(6),0}function O(){var N,a,V,M,u,L,S,A,y,v,O,g,I,b,k,d,f,F,x,c,w,q,_,P,T,m,j,C,p,B,o,h,s,D,E;if(x=e.stackValue(5),_=e.stackValue(4),s=e.stackIntegerValue(3),F=r(x),q=r(_),V=i(x),j=e.stackIntegerValue(2),N=e.stackValue(1),M=e.stackValue(0),a=l(N),u=l(M),e.success(i(_)===V),e.failed())return null;for(d=t(V,s),p=Math.random(),L=n(p,j)-1,C=0;L/2-1>=C;C++)for(p=Math.random(),D=n(p,s),p=Math.random(),E=n(p,d),p=Math.random(),T=n(p,8),b=-4;4>=b;b++)for(k=-4;4>=k;k++)A=b*b+k*k,25>A&&A>0&&(y=D+b|0,O=E+k|0,y>0&&O>0&&d>O&&s>y&&(a[O*s+y]=T*(1-A/25)));for(I=1;s-2>=I;I++)for(S=1;d-2>=S;S++)o=S*s+I,a[o]=(u[o+1]+u[o-1]+u[o+s]+u[o-s]+u[o-1-s]/2+u[o-1+s]/2+u[o+1-s]/2+u[o+1+s]/2)/4-a[o],a[o]=.9*a[o];for(m=0;s*d>=m;m++)B=u[m],u[m]=a[m],a[m]=B;for(c=0;d-1>=c;c++)for(f=0;s-1>=f;f++)f>1&&s-1>f&&c>1&&d-1>c?(h=c*s+f,v=64*(a[h]-a[h-1]+(a[h+1]-a[h])),g=(a[h]-a[h-s]+(a[h+s]-a[h]))/64,2>v&&(v=-2),v>2&&(v=2),2>g&&(g=-2),g>2&&(g=2),w=(c+g)*s+(f+v)|0,P=s*d>w&&w>=0?F[w]:F[f+c*s]):P=F[f+c*s],q[f+c*s]=P;return e.pop(6),0}function w(){var O,s,n,w,g,C,c,f,y,m,P,v,_,b,I,h,F,p,d,S,k,A,a,l,o;if(v=e.stackValue(3),b=e.stackValue(2),a=e.stackIntegerValue(1),C=e.stackIntegerValue(0),P=r(v),_=r(b),k=i(v),e.success(i(b)===k),e.failed())return null;for(m=t(k,a),s=a>>1,n=m>>1,n>s?(h=s,p=n/s,d=1):(h=n,p=1,d=s>n?s/n:1),A=-3.141592653589793*C/180,F=h*h,l=0;a-1>=l;l++)for(o=0;m-1>=o;o++)c=p*(l-s),f=d*(o-n),g=c*c+f*f,F>g&&(y=1-Math.sqrt(g)/h,O=A*y*y,S=Math.sin(O),w=Math.cos(O),I=u(P,1024*((w*c-S*f)/p+s)|0,1024*((S*c+w*f)/d+n)|0,a,m),_[a*o+l]=I);return e.pop(4),0}function F(r){var t;return e=r,t=e.majorVersion()==I,t===!1?!1:t=e.minorVersion()>=A}var I=1,A=11,e=null,P="ScratchPlugin 3 November 2014 (e)";Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:h,getModuleName:p,primitiveFisheye:m,primitiveWaterRipples1:O,primitiveHalfSizeDiagonal:g,primitiveScale:S,primitiveDoubleSize:d,setInterpreter:F,primitiveWhirl:w,primitiveBlur:c,primitiveBrightnessShift:f,primitiveHalfSizeAverage:v,primitiveSaturationShift:y,primitiveHueShift:b,primitiveInterpolate:k,primitiveExtractChannel:C})}),registerSocketPlugin(),module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(e,t){return 0|Math.floor(e/t)}function t(e,t){return e-u(e,t)*t|0}function h(){return v}function m(){var i,o,p,g,m,f,u,s,r,l,h,a,n,c,v,d,b,k,y;if(i=e.stackValue(3),o=e.stackInt16Array(2),p=e.stackIntegerValue(1),g=e.stackIntegerValue(0),k=e.fetchInt32ArrayofObject(7,i),y=e.fetchInt32ArrayofObject(8,i),b=e.fetchIntegerofObject(9,i),c=e.fetchIntegerofObject(10,i),n=e.fetchIntegerofObject(11,i),v=e.fetchInt16ArrayofObject(12,i),d=e.fetchInt16ArrayofObject(13,i),e.failed())return null;for(l=p;p+g-1>=l;l++){for(m=f=0,a=1;b>=a;a++)u=n-k[a-1],1>u&&(u+=c),h=y[a-1],m+=h*v[u-1],f+=h*d[u-1];s=2*l-1,r=o[s-1]+(m>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),o[s-1]=r,v[n-1]=r,++s,r=o[s-1]+(f>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),o[s-1]=r,d[n-1]=r,n=t(n,c)+1}return e.failed()?null:(e.storeIntegerofObjectwithValue(11,i,n),void e.pop(3))}function n(){var r,g,c,O,y,k,I,l,w,F,i,d,f,p,m,n,v,o,b,a,s,h,u,S;if(r=e.stackValue(5),g=e.stackIntegerValue(4),c=e.stackInt16Array(3),O=e.stackIntegerValue(2),y=e.stackIntegerValue(1),k=e.stackIntegerValue(0),a=e.fetchIntegerofObject(3,r),s=e.fetchIntegerofObject(4,r),h=e.fetchIntegerofObject(5,r),p=e.fetchIntegerofObject(7,r),S=e.fetchInt16ArrayofObject(8,r),u=e.fetchIntegerofObject(9,r),n=e.fetchIntegerofObject(10,r),v=e.fetchIntegerofObject(11,r),m=e.fetchIntegerofObject(14,r),o=e.fetchIntegerofObject(15,r),b=e.fetchIntegerofObject(16,r),e.failed())return null;for(I=0!==m&&0!==b,w=O+g-1,f=O;w>=f;f++)d=a*S[n>>15]>>15,I?(F=m*S[o>>15],o=t(o+b,u),0>o&&(o+=u),n=t(n+v+F,u),0>n&&(n+=u)):n=t(n+v,u),y>0&&(l=2*f-1,i=c[l-1]+(d*y>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),c[l-1]=i),k>0&&(l=2*f,i=c[l-1]+(d*k>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),c[l-1]=i),0!==s&&(a+=s,(s>0&&a>=h||0>s&&h>=a)&&(a=h,s=0));return p-=g,e.failed()?null:(e.storeIntegerofObjectwithValue(3,r,a),e.storeIntegerofObjectwithValue(4,r,s),e.storeIntegerofObjectwithValue(7,r,p),e.storeIntegerofObjectwithValue(10,r,n),e.storeIntegerofObjectwithValue(15,r,o),void e.pop(5))}function s(){var t,F,c,k,m,g,S,O,u,V,j,x,h,v,w,i,s,A,l,I,d,_,P,y,o,C,b,n,a,p;if(t=e.stackValue(5),F=e.stackIntegerValue(4),c=e.stackInt16Array(3),k=e.stackIntegerValue(2),m=e.stackIntegerValue(1),g=e.stackIntegerValue(0),n=e.fetchIntegerofObject(3,t),a=e.fetchIntegerofObject(4,t),p=e.fetchIntegerofObject(5,t),l=e.fetchIntegerofObject(7,t),P=e.fetchIntegerofObject(8,t),d=e.fetchInt16ArrayofObject(10,t),y=e.fetchInt16ArrayofObject(11,t),I=e.fetchIntegerofObject(16,t),_=e.fetchIntegerofObject(17,t),b=e.fetchIntegerofObject(18,t),o=e.fetchIntegerofObject(19,t),C=e.fetchIntegerofObject(20,t),e.failed())return null;for(V=d!==y,S=m*n>>15,O=g*n>>15,u=2*k-1,j=k+F-1,A=k;j>=A;A++){if(s=(o+=C)>>9,s>_&&l>P&&(s=(o-=b)>>9),(v=s+1)>I){if(s>I)return l=0,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,n),e.storeIntegerofObjectwithValue(4,t,a),e.storeIntegerofObjectwithValue(7,t,l),e.storeIntegerofObjectwithValue(19,t,o),e.popthenPush(6,null),null);v=0===b?s:(o-b>>9)+1
}h=o&f,w=x=d[s-1]*(r-h)+d[v-1]*h>>9,V&&(w=y[s-1]*(r-h)+y[v-1]*h>>9),m>0&&(i=c[u-1]+(S*x>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),c[u-1]=i),++u,g>0&&(i=c[u-1]+(O*w>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),c[u-1]=i),++u,0!==a&&(n+=a,(a>0&&n>=p||0>a&&p>=n)&&(n=p,a=0),S=m*n>>15,O=g*n>>15)}return l-=F,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,n),e.storeIntegerofObjectwithValue(4,t,a),e.storeIntegerofObjectwithValue(7,t,l),e.storeIntegerofObjectwithValue(19,t,o),void e.pop(5))}function a(){var t,m,u,S,p,y,k,a,O,r,g,i,o,l,v,f,h,w,b,s,n,c;if(t=e.stackValue(5),m=e.stackIntegerValue(4),u=e.stackInt16Array(3),S=e.stackIntegerValue(2),p=e.stackIntegerValue(1),y=e.stackIntegerValue(0),s=e.fetchIntegerofObject(3,t),n=e.fetchIntegerofObject(4,t),c=e.fetchIntegerofObject(5,t),v=e.fetchIntegerofObject(7,t),f=e.fetchInt16ArrayofObject(8,t),h=e.fetchIntegerofObject(9,t),w=e.fetchIntegerofObject(10,t),b=e.fetchIntegerofObject(11,t),e.failed())return null;for(O=S+m-1,o=i=h,l=S;O>=l;l++)i=o+w,i>=b&&(i=d+(i-b)),k=f[(o>>15)-1]+f[(i>>15)-1]>>1,f[(o>>15)-1]=k,g=k*s>>15,o=i,p>0&&(a=2*l-1,r=u[a-1]+(g*p>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),u[a-1]=r),y>0&&(a=2*l,r=u[a-1]+(g*y>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),u[a-1]=r),0!==n&&(s+=n,(n>0&&s>=c||0>n&&c>=s)&&(s=c,n=0));return h=i,v-=m,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,s),e.storeIntegerofObjectwithValue(4,t,n),e.storeIntegerofObjectwithValue(7,t,v),e.storeIntegerofObjectwithValue(9,t,h),void e.pop(5))}function o(){var t,h,o,v,g,k,a,O,l,b,r,d,c,m,u,S,w,y,i,s,n,f;if(t=e.stackValue(5),h=e.stackIntegerValue(4),o=e.stackInt16Array(3),v=e.stackIntegerValue(2),g=e.stackIntegerValue(1),k=e.stackIntegerValue(0),s=e.fetchIntegerofObject(3,t),n=e.fetchIntegerofObject(4,t),f=e.fetchIntegerofObject(5,t),m=e.fetchIntegerofObject(7,t),S=e.fetchInt16ArrayofObject(8,t),w=e.fetchIntegerofObject(10,t),i=e.fetchIntegerofObject(11,t),u=e.fetchIntegerofObject(12,t),y=e.fetchIntegerofObject(13,t),e.failed())return null;for(O=v+h-1,l=v,c=u+(i>>>16);w>=c&&O>=l;)d=S[c-1]*s>>15,g>0&&(a=2*l-1,r=o[a-1]+(d*g>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),o[a-1]=r),k>0&&(a=2*l,r=o[a-1]+(d*k>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),o[a-1]=r),0!==n&&(s+=n,(n>0&&s>=f||0>n&&f>=s)&&(s=f,n=0)),i+=y,i>=p&&(b=i>>>16,u+=b,i-=b<<16),c=u+(i>>>16),++l;return m-=h,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,s),e.storeIntegerofObjectwithValue(4,t,n),e.storeIntegerofObjectwithValue(7,t,m),e.storeIntegerofObjectwithValue(11,t,i),e.storeIntegerofObjectwithValue(12,t,u),void e.pop(5))}function i(r){var t;return e=r,t=e.majorVersion()==l,t===!1?!1:t=e.minorVersion()>=c}var l=1,c=11,f=511,r=512,d=32768,p=536870912,e=null,v="SoundGenerationPlugin 3 November 2014 (e)";Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:n,primitiveMixSampledSound:o,setInterpreter:i,getModuleName:h,primitiveApplyReverb:m,primitiveMixPluckedSound:a,primitiveMixLoopedSampledSound:s})}),registerSpeechPlugin(),registerSqueakSSL(),module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function i(e,t){return 0|Math.floor(e/t)}function a(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function r(t){return e.success(e.isWords(t)),e.failed()?0:t.words}function n(){return f}function s(){var S,s,y,g,h,d,u,k,b,l,p,m,v,n,o,f,a,c;if(l=e.stackValue(4),g=e.stackValue(3),n=e.stackIntegerValue(2),u=e.stackIntegerValue(1),s=e.stackIntegerValue(0),b=r(l),y=r(g),e.success(t(l)===t(g)),e.success(t(l)===n*u),e.failed())return null;for(S=(2*s+1)*(2*s+1),a=0;u-1>=a;a++)for(m=a-s,0>m&&(m=0),d=a+s,d>=u&&(d=u-1),o=0;n-1>=o;o++){for(p=o-s,0>p&&(p=0),h=o+s,h>=n&&(h=n-1),v=0,c=m;d>=c;c++)for(k=c*n,f=p;h>=f;f++)v+=b[k+f];y[a*n+o]=i(v,S)}e.pop(5)}function h(){var i,n,s,a,o;if(s=e.stackValue(1),a=e.stackIntegerValue(0),n=r(s),o=t(s),e.failed())return null;for(i=0;o-1>=i;i++)n[i]=n[i]*a>>>10;e.pop(2)}function o(){var O,p,c,g,u,v,n,b,d,o,l,k,y,S,m,s,f,h;if(m=e.stackValue(6),c=e.stackValue(5),s=e.stackIntegerValue(4),g=e.stackIntegerValue(3),n=e.stackIntegerValue(2),d=e.stackIntegerValue(1),k=e.stackIntegerValue(0),y=r(m),O=r(c),e.success(t(c)===s*g),e.success(t(c)===t(m)*n*n),e.failed())return null;for(o=0,(4&d)>0&&(o+=65536),(2&d)>0&&(o+=256),(1&d)>0&&++o,S=-1,h=0;h<=i(g,n)-1;h++)for(f=0;f<=i(s,n)-1;f++)for(u=a(y[++S],k),u>255&&(u=255),b=0>=u?1:u*o,v=(h*s+f)*n,l=v;v+(n-1)*s>=l;l+=s)for(p=l;l+n-1>=p;p++)O[p]=b;e.pop(7)}function u(r){var t;return e=r,t=e.majorVersion()==l,t===!1?!1:t=e.minorVersion()>=c}var l=1,c=11,e=null,f="StarSqueakPlugin 3 November 2014 (e)";Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:s,primitiveEvaporateRate:h,setInterpreter:u,primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:o,getModuleName:n})}),module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function q(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function r(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function g(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function At(e,t){return 0|Math.floor(e/t)}function H(e,t){return e-At(e,t)*t|0}function S(t,e){return e>31?0:t<<e}function wt(t,e){return e>31?0:t>>>e}function Ot(t,r,n){var e;if(i[t+n]!==i[r+n])return 0;if(i[t+n-1]!==i[r+n-1])return 0;if(i[t]!==i[r])return 0;if(i[t+1]!==i[r+1])return 1;for(e=2;_>e&&i[t+e]===i[r+e];)++e;return e}function yt(l,h,d){var n,a,e,t,o,f,r,u,p;if(m>l)return!1;if(s>=v)return!0;for(a=!1,e=m;l>=e;){if(a||(r=R(e,c-1,e,h,d),x(e),o=65535&r,t=r>>>16),r=R(e+1,t,o,h,d),p=65535&r,u=r>>>16,t>=u&&t>=c){for(n=vt(t,e-o),f=1;t-1>=f;f++)x(++e);a=!1,++e}else n=gt(i[e]),++e,l>=e&&!n&&(x(e),a=!0,o=p,t=u);if(n)return m=e,!0}return m=e,!1}function kt(t){var e;for(e=q(t);!e.isNil&&e.classInstSize()>=13;)e=e.superclass();return e.isNil?!1:(n=e.classInstSize(),!0)}function K(r){var e;for(e=q(r);!e.isNil&&e.classInstSize()>=7;)e=e.superclass();return e.isNil?!1:(t=e.classInstSize(),!0)}function gt(e){return P[s]=e,F[s]=0,I[e]++,++s,s===v||0===(4095&s)&&T()}function vt(t,e){var r,i;return P[s]=t-c,F[s]=e,i=U[t-c],I[i]++,r=257>e?k[e-1]:k[256+(e-1>>>7)],j[r]++,++s,++h,s===v||0===(4095&s)&&T()}function R(e,s,d,h,f){var n,u,a,i,o,r,t;if(t=s<<16|d,s>=_)return t;if(r=y[M(e+c-1)],a=e-r,!(a>0&&O>a))return t;for(u=h,o=e>O?e-O:0,n=s;;){if(i=Ot(e,r,n),e+i>l&&(i=l-e),i===c&&e-r>O>>2&&(i=c-1),i>n){if(t=i<<16|r,n=i,n>=_)return t;if(n>f)return t}if(!(--u>0))return t;if(r=C[r&B],o>=r)return t}}function ht(){return It}function x(e){var t;p=M(e+c-1),t=y[p],y[p]=e,C[e&B]=t}function ft(a){var n;if(!(e.isPointers(a)&&r(a)>=15))return!1;if(n=e.fetchPointerofObject(0,a),!e.isBytes(n))return!1;if(0===t){if(!K(a))return!1;if(r(a)<t+5)return t=0,!1}return i=n.bytes,d=g(n),l=e.fetchIntegerofObject(1,a),u=e.fetchIntegerofObject(2,a),n=e.fetchPointerofObject(t+0,a),e.isWords(n)&&r(n)===bt?(y=n.words,n=e.fetchPointerofObject(t+1,a),e.isWords(n)&&r(n)===mt?(C=n.words,p=e.fetchIntegerofObject(t+2,a),m=e.fetchIntegerofObject(t+3,a),n=e.fetchPointerofObject(t+5,a),e.isBytes(n)?(v=r(n),P=n.bytes,n=e.fetchPointerofObject(t+6,a),e.isWords(n)&&r(n)>=v?(F=n.words,n=e.fetchPointerofObject(t+7,a),e.isWords(n)&&r(n)===st?(I=n.words,n=e.fetchPointerofObject(t+8,a),e.isWords(n)&&r(n)===nt?(j=n.words,s=e.fetchIntegerofObject(t+9,a),h=e.fetchIntegerofObject(t+10,a),!e.failed()):!1):!1):!1):!1):!1):!1}function ut(n){var s;if(0===t){if(!K(n))return!1;if(r(n)<t+3)return t=0,!1}return e.isPointers(n)&&r(n)>=t+3?(s=e.fetchPointerofObject(0,n),e.isBytes(s)?(i=s.bytes,d=g(s),l=e.fetchIntegerofObject(1,n),u=e.fetchIntegerofObject(2,n),o=e.fetchIntegerofObject(t+1,n),a=e.fetchIntegerofObject(t+2,n),!e.failed()):e.primitiveFail()):!1}function b(r,t){if(!(t>=0&&S(1,r)>t))return e.primitiveFail();for(o|=S(t,a),a+=r;a>=8&&d>l;)i[l]=255&o,++l,o>>>=8,a-=8}function at(){var i,n,a,r,o;return 3!==e.methodArgumentCount()?e.primitiveFail():(n=e.stackIntegerValue(0),i=e.stackIntegerValue(1),a=e.stackIntegerValue(2),r=e.stackObjectValue(3),e.failed()?null:ft(r)?(o=yt(a,i,n),e.failed()||(e.storeIntegerofObjectwithValue(t+2,r,p),e.storeIntegerofObjectwithValue(t+3,r,m),e.storeIntegerofObjectwithValue(t+9,r,s),e.storeIntegerofObjectwithValue(t+10,r,h)),void(e.failed()||(e.pop(4),e.pushBool(o)))):e.primitiveFail())}function rt(){var n,s,t,i,a,o;if(2!==e.methodArgumentCount())return e.primitiveFail();if(n=e.stackIntegerValue(0),i=e.stackObjectValue(1),e.failed())return null;if(!e.isWords(i))return e.primitiveFail();for(o=r(i),a=i.wordsAsInt32Array(),t=0;o-1>=t;t++)s=a[t],a[t]=s>=n?s-n:0;e.pop(2)}function tt(){var s,t;if(2!==e.methodArgumentCount())return e.primitiveFail();if(s=e.stackValue(0),!e.isWords(s))return e.primitiveFail();if(L=s.words,D=r(s),s=e.stackValue(1),!e.isWords(s))return e.primitiveFail();if(W=s.words,z=r(s),t=e.stackValue(2),!e.isPointers(t))return e.primitiveFail();if(0===n){if(!kt(t))return e.primitiveFail();if(r(t)<n+8)return n=0,e.primitiveFail()}return r(t)<n+8?e.primitiveFail():(u=e.fetchIntegerofObject(2,t),w=e.fetchIntegerofObject(n+0,t),o=e.fetchIntegerofObject(n+1,t),a=e.fetchIntegerofObject(n+2,t),f=e.fetchIntegerofObject(n+4,t),A=e.fetchIntegerofObject(n+5,t),e.failed()?null:(--u,--f,--A,s=e.fetchPointerofObject(0,t),e.isBytes(s)?(i=s.bytes,d=g(s),s=e.fetchPointerofObject(n+3,t),e.isBytes(s)?(G=s.bytes,Ft(),void(e.failed()||(e.storeIntegerofObjectwithValue(2,t,u+1),e.storeIntegerofObjectwithValue(n+0,t,w),e.storeIntegerofObjectwithValue(n+1,t,o),e.storeIntegerofObjectwithValue(n+2,t,a),e.storeIntegerofObjectwithValue(n+4,t,f+1),e.pop(2)))):e.primitiveFail()):e.primitiveFail()))}function et(){var t,u,l,s,a,c,r,o,i,n;if(4!==e.methodArgumentCount())return e.primitiveFail();if(s=e.stackObjectValue(0),n=e.stackIntegerValue(1),i=e.stackIntegerValue(2),t=e.positive32BitValueOf(e.stackValue(3)),e.failed())return 0;if(!(e.isBytes(s)&&n>=i&&i>0))return e.primitiveFail();if(c=g(s),!(c>=n))return e.primitiveFail();for(l=s.bytes,--i,--n,r=65535&t,o=t>>>16&65535,a=i;n>=a;a++)u=l[a],r=H(r+u,65521),o=H(o+r,65521);t=(o<<16)+r,e.popthenPush(5,e.positive32BitIntegerFor(t))}function $(){var a,n,t,s,o,r,i;if(4!==e.methodArgumentCount())return e.primitiveFail();if(n=e.stackObjectValue(0),i=e.stackIntegerValue(1),r=e.stackIntegerValue(2),t=e.positive32BitValueOf(e.stackValue(3)),e.failed())return 0;if(!(e.isBytes(n)&&i>=r&&r>0))return e.primitiveFail();if(o=g(n),!(o>=i))return e.primitiveFail();for(a=n.bytes,--r,--i,s=r;i>=s;s++)t=Pt[255&(t^a[s])]^t>>>8;e.popthenPush(5,e.positive32BitIntegerFor(t))}function Q(){var i,s,u,c,t,f;return 4!==e.methodArgumentCount()?e.primitiveFail():(s=e.stackObjectValue(0),c=e.stackObjectValue(1),i=e.stackObjectValue(2),u=e.stackObjectValue(3),t=e.stackObjectValue(4),e.failed()?null:ut(t)&&e.isPointers(s)&&r(s)>=2&&e.isPointers(c)&&r(c)>=2&&e.isPointers(u)&&r(u)>=3&&e.isPointers(i)&&r(i)>=3?(f=Z(u,i,c,s),e.failed()||(e.storeIntegerofObjectwithValue(1,t,l),e.storeIntegerofObjectwithValue(n+1,t,o),e.storeIntegerofObjectwithValue(n+2,t,a)),void(e.failed()||(e.pop(5),e.pushInteger(f)))):e.primitiveFail())}function Z(h,p,A,w){var i,s,P,I,S,O,o,a,F,m,u,n,y,v,t,f;if(t=e.fetchPointerofObject(0,h),n=e.fetchIntegerofObject(1,h),u=e.fetchIntegerofObject(2,h),!(u>=n&&e.isBytes(t)&&u<=g(t)))return e.primitiveFail();if(F=t.bytes,t=e.fetchPointerofObject(0,p),!(e.isWords(t)&&u<=r(t)&&e.fetchIntegerofObject(1,p)===n&&e.fetchIntegerofObject(2,p)===u))return e.primitiveFail();if(P=t.words,t=e.fetchPointerofObject(0,A),!e.isWords(t))return e.primitiveFail();if(m=r(t),y=t.words,t=e.fetchPointerofObject(1,A),!e.isWords(t)||m!==r(t))return e.primitiveFail();if(v=t.words,t=e.fetchPointerofObject(0,w),!e.isWords(t))return e.primitiveFail();if(S=r(t),I=t.words,t=e.fetchPointerofObject(1,w),!e.isWords(t)||S!==r(t))return e.primitiveFail();for(O=t.words,b(0,0),f=0;u>n&&d>l+4;)if(a=F[n],s=P[n],++n,0===s){if(++f,!(m>a))return e.primitiveFail();b(y[a],v[a])}else{if(f=f+a+c,!(256>a))return e.primitiveFail();if(i=U[a],!(m>i))return e.primitiveFail();if(b(y[i],v[i]),o=ct[i-257],0!==o&&(a-=Y[i-257],b(o,a)),--s,!(32768>s))return e.primitiveFail();if(i=256>s?k[s]:k[256+(s>>>7)],!(S>i))return e.primitiveFail();b(I[i],O[i]),o=lt[i],0!==o&&(s-=X[i],b(o,s))}return e.failed()?null:(e.storeIntegerofObjectwithValue(1,h,n),e.storeIntegerofObjectwithValue(1,p,n),f)}function J(r){var t;return e=r,t=e.majorVersion()==it,t===!1?!1:t=e.minorVersion()>=ot}function T(){var e;return s===v?!0:0!==(4095&s)?!1:s>=10*h?!1:(e=s-h,h>=e?!1:h>=4*e)}function dt(e){return(p<<5^e)&pt}function M(e){return dt(i[e])}function E(s,o){var a,t,i,n,r;if(t=s[0]>>>24,t>N)return e.primitiveFail(),0;for(n=2;;){if(a=V(t),i=n+a-1,i>=o)return e.primitiveFail(),0;if(r=s[i],0===(1056964608&r))return r;if(n=65535&r,t=r>>>24&255,t>N)return e.primitiveFail(),0}return 0}function Ft(){var s,c,t,r,n,l,h,p,m,v,e;for(l=d-1;l>u&&A>=f;)if(p=o,h=a,m=f,e=E(W,z),256>e)i[++u]=e;else{if(256===e)return w&=St,0;if(t=(e>>>16)-1,n=65535&e,t>0&&(n+=V(t)),e=E(L,D),t=e>>>16,s=65535&e,t>0&&(s+=V(t)),u+n>=l)return o=p,a=h,f=m,0;for(c=u,v=u-s,r=1;n>=r;r++)i[c+r]=i[v+r];u+=n}}function V(e){for(var t,r;e>a;)r=G[++f],o+=S(r,a),a+=8;return t=o&S(1,e)-1,o=wt(o,e),a-=e,t}var it=1,ot=11,pt=32767,bt=32768,O=32768,nt=30,st=286,_=258,c=3,B=32767,mt=32768,N=16,St=1,e=null,It="ZipPlugin 3 November 2014 (e)",n=0,t=0,X=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],Y=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],o=0,a=0,m=0,i=null,d=0,Pt=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],L=null,D=0,k=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],j=null,F=null,lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ct=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],y=null,C=null,p=0,W=null,z=0,s=0,I=null,v=0,P=null,h=0,U=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],l=0,u=0,G=null,A=0,f=0,w=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:Q,primitiveUpdateAdler32:et,primitiveUpdateGZipCrc32:$,primitiveDeflateUpdateHashTable:rt,setInterpreter:J,getModuleName:ht,primitiveDeflateBlock:at,primitiveInflateDecompressBlock:tt})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var n,r,i,u,l,a,s,o="",t=0;for(e=LZString.compress(e);t<2*e.length;)t%2==0?(n=e.charCodeAt(t/2)>>8,r=255&e.charCodeAt(t/2),i=t/2+1<e.length?e.charCodeAt(t/2+1)>>8:0/0):(n=255&e.charCodeAt((t-1)/2),(t+1)/2<e.length?(r=e.charCodeAt((t+1)/2)>>8,i=255&e.charCodeAt((t+1)/2)):r=i=0/0),t+=3,u=n>>2,l=(3&n)<<4|r>>4,a=(15&r)<<2|i>>6,s=63&i,isNaN(r)?a=s=64:isNaN(i)&&(s=64),o=o+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(l)+LZString._keyStr.charAt(a)+LZString._keyStr.charAt(s);return o},decompressFromBase64:function(e){if(null==e)return"";var t,a,o,u,h,c,i,n,s="",f=0,r=0,l=LZString._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");r<e.length;)h=LZString._keyStr.indexOf(e.charAt(r++)),c=LZString._keyStr.indexOf(e.charAt(r++)),i=LZString._keyStr.indexOf(e.charAt(r++)),n=LZString._keyStr.indexOf(e.charAt(r++)),a=h<<2|c>>4,o=(15&c)<<4|i>>2,u=(3&i)<<6|n,f%2==0?(t=a<<8,64!=i&&(s+=l(t|o)),64!=n&&(t=u<<8)):(s+=l(t|a),64!=i&&(t=o<<8),64!=n&&(s+=l(t|u))),f+=3;return LZString.decompress(s)},compressToUTF16:function(n){if(null==n)return"";var s,e,t,r="",a=0,i=LZString._f;for(n=LZString.compress(n),s=0;s<n.length;s++)switch(e=n.charCodeAt(s),a++){case 0:r+=i((e>>1)+32),t=(1&e)<<14;break;case 1:r+=i(t+(e>>2)+32),t=(3&e)<<13;break;case 2:r+=i(t+(e>>3)+32),t=(7&e)<<12;break;case 3:r+=i(t+(e>>4)+32),t=(15&e)<<11;break;case 4:r+=i(t+(e>>5)+32),t=(31&e)<<10;break;case 5:r+=i(t+(e>>6)+32),t=(63&e)<<9;break;case 6:r+=i(t+(e>>7)+32),t=(127&e)<<8;break;case 7:r+=i(t+(e>>8)+32),t=(255&e)<<7;break;case 8:r+=i(t+(e>>9)+32),t=(511&e)<<6;break;case 9:r+=i(t+(e>>10)+32),t=(1023&e)<<5;break;case 10:r+=i(t+(e>>11)+32),t=(2047&e)<<4;break;case 11:r+=i(t+(e>>12)+32),t=(4095&e)<<3;break;case 12:r+=i(t+(e>>13)+32),t=(8191&e)<<2;break;case 13:r+=i(t+(e>>14)+32),t=(16383&e)<<1;break;case 14:r+=i(t+(e>>15)+32,(32767&e)+32),a=0}return r+i(t+32)},decompressFromUTF16:function(n){if(null==n)return"";for(var t,e,r="",a=0,s=0,i=LZString._f;s<n.length;){switch(e=n.charCodeAt(s)-32,a++){case 0:t=e<<1;break;case 1:r+=i(t|e>>14),t=(16383&e)<<2;break;case 2:r+=i(t|e>>13),t=(8191&e)<<3;break;case 3:r+=i(t|e>>12),t=(4095&e)<<4;break;case 4:r+=i(t|e>>11),t=(2047&e)<<5;break;case 5:r+=i(t|e>>10),t=(1023&e)<<6;break;case 6:r+=i(t|e>>9),t=(511&e)<<7;break;case 7:r+=i(t|e>>8),t=(255&e)<<8;break;case 8:r+=i(t|e>>7),t=(127&e)<<9;break;case 9:r+=i(t|e>>6),t=(63&e)<<10;break;case 10:r+=i(t|e>>5),t=(31&e)<<11;break;case 11:r+=i(t|e>>4),t=(15&e)<<12;break;case 12:r+=i(t|e>>3),t=(7&e)<<13;break;case 13:r+=i(t|e>>2),t=(3&e)<<14;break;case 14:r+=i(t|e>>1),t=(1&e)<<15;break;case 15:r+=i(t|e),a=0}s++}return LZString.decompress(r)},compress:function(p){if(null==p)return"";var r,i,d,c={},f={},l="",h="",n="",o=2,m=3,s=2,a="",e=0,t=0,u=LZString._f;for(d=0;d<p.length;d+=1)if(l=p.charAt(d),Object.prototype.hasOwnProperty.call(c,l)||(c[l]=m++,f[l]=!0),h=n+l,Object.prototype.hasOwnProperty.call(c,h))n=h;else{if(Object.prototype.hasOwnProperty.call(f,n)){if(n.charCodeAt(0)<256){for(r=0;s>r;r++)e<<=1,15==t?(t=0,a+=u(e),e=0):t++;for(i=n.charCodeAt(0),r=0;8>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1}else{for(i=1,r=0;s>r;r++)e=e<<1|i,15==t?(t=0,a+=u(e),e=0):t++,i=0;for(i=n.charCodeAt(0),r=0;16>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1}o--,0==o&&(o=Math.pow(2,s),s++),delete f[n]}else for(i=c[n],r=0;s>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1;o--,0==o&&(o=Math.pow(2,s),s++),c[h]=m++,n=String(l)}if(""!==n){if(Object.prototype.hasOwnProperty.call(f,n)){if(n.charCodeAt(0)<256){for(r=0;s>r;r++)e<<=1,15==t?(t=0,a+=u(e),e=0):t++;for(i=n.charCodeAt(0),r=0;8>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1}else{for(i=1,r=0;s>r;r++)e=e<<1|i,15==t?(t=0,a+=u(e),e=0):t++,i=0;for(i=n.charCodeAt(0),r=0;16>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1}o--,0==o&&(o=Math.pow(2,s),s++),delete f[n]}else for(i=c[n],r=0;s>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1;o--,0==o&&(o=Math.pow(2,s),s++)}for(i=2,r=0;s>r;r++)e=e<<1|1&i,15==t?(t=0,a+=u(e),e=0):t++,i>>=1;for(;;){if(e<<=1,15==t){a+=u(e);break}t++}return a},decompress:function(p){if(null==p)return"";if(""==p)return null;var v,f,l,r,n,i,t,s,a=[],o=4,u=4,h=3,c="",m="",d=LZString._f,e={string:p,val:p.charCodeAt(0),position:32768,index:1};for(f=0;3>f;f+=1)a[f]=f;for(r=0,i=Math.pow(2,2),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;switch(v=r){case 0:for(r=0,i=Math.pow(2,8),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;s=d(r);break;case 1:for(r=0,i=Math.pow(2,16),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;s=d(r);break;case 2:return""}for(a[3]=s,l=m=s;;){if(e.index>e.string.length)return"";for(r=0,i=Math.pow(2,h),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;switch(s=r){case 0:for(r=0,i=Math.pow(2,8),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;a[u++]=d(r),s=u-1,o--;break;case 1:for(r=0,i=Math.pow(2,16),t=1;t!=i;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),r|=(n>0?1:0)*t,t<<=1;a[u++]=d(r),s=u-1,o--;break;case 2:return m}if(0==o&&(o=Math.pow(2,h),h++),a[s])c=a[s];else{if(s!==u)return null;c=l+l.charAt(0)}m+=c,a[u++]=l+c.charAt(0),o--,l=c,0==o&&(o=Math.pow(2,h),h++)}}};"undefined"!=typeof module&&null!=module&&(module.exports=LZString),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.JSZip=e()}}(function(){var e;return function t(e,t,r){function i(n,l){if(!t[n]){if(!e[n]){var o="function"==typeof require&&require;if(!l&&o)return o(n,!0);if(s)return s(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var a=t[n]={exports:{}};e[n][0].call(a.exports,function(t){var r=e[n][1][t];return i(r?r:t)},a,a.exports,t,e,t,r)}return t[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}({1:[function(t,s,r){var i=t("./utils"),n=t("./support"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(r){for(var o,s,a,f,h,d,l,c=[],t=0,n=r.length,u=n,p="string"!==i.getTypeOf(r);t<r.length;)u=n-t,p?(o=r[t++],s=n>t?r[t++]:0,a=n>t?r[t++]:0):(o=r.charCodeAt(t++),s=n>t?r.charCodeAt(t++):0,a=n>t?r.charCodeAt(t++):0),f=o>>2,h=(3&o)<<4|s>>4,d=u>1?(15&s)<<2|a>>6:64,l=u>2?63&a:64,c.push(e.charAt(f)+e.charAt(h)+e.charAt(d)+e.charAt(l));return c.join("")},r.decode=function(t){var h,d,c,f,o,a,u,i=0,l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");var s=3*t.length/4;t.charAt(t.length-1)===e.charAt(64)&&s--,t.charAt(t.length-2)===e.charAt(64)&&s--;var r;for(r=n.uint8array?new Uint8Array(s):new Array(s);i<t.length;)f=e.indexOf(t.charAt(i++)),o=e.indexOf(t.charAt(i++)),a=e.indexOf(t.charAt(i++)),u=e.indexOf(t.charAt(i++)),h=f<<2|o>>4,d=(15&o)<<4|a>>2,c=(3&a)<<6|u,r[l++]=h,64!==a&&(r[l++]=d),64!==u&&(r[l++]=c);return r}},{"./support":27,"./utils":29}],2:[function(e,s){function t(e,t,r,i,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=n}var i=e("./external"),n=e("./stream/DataWorker"),r=e("./stream/DataLengthProbe"),a=e("./stream/Crc32Probe"),r=e("./stream/DataLengthProbe");t.prototype={getContentWorker:function(){var e=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new r("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},t.createWorkerFrom=function(t,e,i){return t.pipe(new a).pipe(new r("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new r("compressedSize")).withStreamInfo("compression",e)},s.exports=t},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(e,i,t){var r=e("./stream/GenericWorker");t.STORE={magic:"\x00\x00",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},t.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(t,r){function i(){for(var e,r=[],t=0;256>t;t++){e=t;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;r[t]=e}return r}function n(t,n,s,i){var a=e,o=i+s;t=-1^t;for(var r=i;o>r;r++)t=t>>>8^a[255&(t^n[r])];return-1^t}function s(t,n,s,i){var a=e,o=i+s;t=-1^t;for(var r=i;o>r;r++)t=t>>>8^a[255&(t^n.charCodeAt(r))];return-1^t}var a=t("./utils"),e=i();r.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var r="string"!==a.getTypeOf(e);return r?n(0|t,e,e.length,0):s(0|t,e,e.length,0)}},{"./utils":29}],5:[function(t,r,e){e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},{}],6:[function(e,t){var r=e("es6-promise").Promise;t.exports={Promise:r}},{"es6-promise":37}],7:[function(r,u,i){function e(e,i){t.call(this,"FlateWorker/"+e),this._pako=new a[e]({raw:!0,level:i.level||-1}),this.meta={};var r=this;this._pako.onData=function(e){r.push({data:e,meta:r.meta})}}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=r("pako"),n=r("./utils"),t=r("./stream/GenericWorker"),o=s?"uint8array":"array";i.magic="\b\x00",n.inherits(e,t),e.prototype.processChunk=function(e){this.meta=e.meta,this._pako.push(n.transformTo(o,e.data),!1)},e.prototype.flush=function(){t.prototype.flush.call(this),this._pako.push([],!0)},e.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this._pako=null},i.compressWorker=function(t){return new e("Deflate",t)},i.uncompressWorker=function(){return new e("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(n,l){function t(e,t,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=n("../utils"),i=n("../stream/GenericWorker"),a=n("../utf8"),o=n("../crc32"),s=n("../signature"),e=function(t,i){var e,r="";for(e=0;i>e;e++)r+=String.fromCharCode(255&t),t>>>=8;return r},c=function(e,r){var t=e;return e||(t=r?16893:33204),(65535&t)<<16},f=function(e){return 63&(e||0)},u=function(d,P,M,q,j,g){var h,l,i=d.file,V=d.compression,x=g!==a.utf8encode,m=r.transformTo("string",g(i.name)),A=r.transformTo("string",a.utf8encode(i.name)),b=i.comment,F=r.transformTo("string",g(b)),I=r.transformTo("string",a.utf8encode(b)),C=A.length!==i.name.length,_=I.length!==b.length,p="",S="",O="",w=i.dir,u=i.date,n={crc32:0,compressedSize:0,uncompressedSize:0};(!P||M)&&(n.crc32=d.crc32,n.compressedSize=d.compressedSize,n.uncompressedSize=d.uncompressedSize);var k=0;P&&(k|=8),x||!C&&!_||(k|=2048);var v=0,y=0;w&&(v|=16),"UNIX"===j?(y=798,v|=c(i.unixPermissions,w)):(y=20,v|=f(i.dosPermissions,w)),h=u.getUTCHours(),h<<=6,h|=u.getUTCMinutes(),h<<=5,h|=u.getUTCSeconds()/2,l=u.getUTCFullYear()-1980,l<<=4,l|=u.getUTCMonth()+1,l<<=5,l|=u.getUTCDate(),C&&(S=e(1,1)+e(o(m),4)+A,p+="up"+e(S.length,2)+S),_&&(O=e(1,1)+e(o(F),4)+I,p+="uc"+e(O.length,2)+O);var t="";t+="\n\x00",t+=e(k,2),t+=V.magic,t+=e(h,2),t+=e(l,2),t+=e(n.crc32,4),t+=e(n.compressedSize,4),t+=e(n.uncompressedSize,4),t+=e(m.length,2),t+=e(p.length,2);var B=s.LOCAL_FILE_HEADER+t+m+p,N=s.CENTRAL_FILE_HEADER+e(y,2)+t+e(F.length,2)+"\x00\x00\x00\x00"+e(v,4)+e(q,4)+m+p+F;return{fileRecord:B,dirRecord:N}},h=function(t,n,a,o,u){var l="",i=r.transformTo("string",u(o));return l=s.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+e(t,2)+e(t,2)+e(n,4)+e(a,4)+e(i.length,2)+i},d=function(t){var r="";
return r=s.DATA_DESCRIPTOR+e(t.crc32,4)+e(t.compressedSize,4)+e(t.uncompressedSize,4)};r.inherits(t,i),t.prototype.push=function(e){var r=e.meta.percent||0,t=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:t?(r+100*(t-n-1))/t:100}}))},t.prototype.openedSource=function(e){if(this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name,this.streamFiles&&!e.file.dir){var t=u(e,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:t.fileRecord,meta:{percent:0}})}else this.accumulate=!0},t.prototype.closedSource=function(e){this.accumulate=!1;var t=u(e,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(t.dirRecord),this.streamFiles&&!e.file.dir)this.push({data:d(e),meta:{percent:100}});else for(this.push({data:t.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},t.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,i=h(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},t.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},t.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},t.prototype.resume=function(){return i.prototype.resume.call(this)?!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0):!1},t.prototype.error=function(t){var r=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var e=0;e<r.length;e++)try{r[e].error(t)}catch(t){}return!0},t.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},l.exports=t},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(e,s,t){var r=e("../compressions"),i=e("./ZipFileWorker"),n=function(i,n){var e=i||n,t=r[e];if(!t)throw new Error(e+" is not a valid compression method !");return t};t.generateWorker=function(s,e,a){var t=new i(e.streamFiles,a,e.platform,e.encodeFileName),r=0;try{s.forEach(function(s,i){r++;var a=n(i.options.compression,e.compression),o=i.options.compressionOptions||e.compressionOptions||{},u=i.dir,l=i.date;i._compressWorker(a,o).withStreamInfo("file",{name:s,dir:u,date:l,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(t)}),t.entriesCount=r}catch(o){t.error(o)}return t}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var r=new e;for(var t in this)"function"!=typeof this[t]&&(r[t]=this[t]);return r}}e.prototype=t("./object"),e.prototype.loadAsync=t("./load"),e.support=t("./support"),e.defaults=t("./defaults"),e.loadAsync=function(t,r){return(new e).loadAsync(t,r)},e.external=t("./external"),r.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(e,n){function s(e){return new t.Promise(function(i,t){var r=e.decompressed.getContentWorker().pipe(new u);r.on("error",function(e){t(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):i()}).resume()})}var r=e("./utils"),t=e("./external"),a=e("./utf8"),r=e("./utils"),o=e("./zipEntries"),u=e("./stream/Crc32Probe"),i=e("./nodejsUtils");n.exports=function(u,e){var n=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),i.isNode&&i.isStream(u)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,e.optimizedBinaryString,e.base64).then(function(r){var t=new o(e);return t.load(r),t}).then(function(i){var n=[t.Promise.resolve(i)],a=i.files;if(e.checkCRC32)for(var r=0;r<a.length;r++)n.push(s(a[r]));return t.Promise.all(n)}).then(function(a){for(var r=a.shift(),s=r.files,i=0;i<s.length;i++){var t=s[i];n.file(t.fileNameStr,t.decompressed,{binary:!0,optimizedBinaryString:!0,date:t.date,dir:t.dir,comment:t.fileCommentStr.length?t.fileCommentStr:null,unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n})}},{"./external":6,"./nodejsUtils":12,"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(t,e){(function(t){e.exports={isNode:"undefined"!=typeof t,newBuffer:function(e,r){return new t(e,r)},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(e,v){function r(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var m=e("./utf8"),t=e("./utils"),i=e("./stream/GenericWorker"),f=e("./stream/StreamHelper"),n=e("./defaults"),s=e("./compressedObject"),g=e("./zipObject"),c=e("./generate"),a=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),o=function(o,r,e){var c,f=t.getTypeOf(r);e=t.extend(e||{},n),e.date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),"string"==typeof e.unixPermissions&&(e.unixPermissions=parseInt(e.unixPermissions,8)),e.unixPermissions&&16384&e.unixPermissions&&(e.dir=!0),e.dosPermissions&&16&e.dosPermissions&&(e.dir=!0),e.dir&&(o=u(o)),e.createFolders&&(c=p(o))&&l.call(this,c,!0);var m="string"===f&&e.binary===!1&&e.base64===!1;e.binary=!m;var v=r instanceof s&&0===r.uncompressedSize;(v||e.dir||!r||0===r.length)&&(e.base64=!1,e.binary=!0,r="",e.compression="STORE",f="string");var d=null;d=r instanceof s||r instanceof i?r:a.isNode&&a.isStream(r)?new h(o,r):t.prepareContent(o,r,e.binary,e.optimizedBinaryString,e.base64);var b=new g(o,d,e);this.files[o]=b},p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},u=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},l=function(e,t){return t="undefined"!=typeof t?t:n.createFolders,e=u(e),this.files[e]||o.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},d={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(i){var e,t,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],t=e.slice(this.root.length,e.length),t&&e.slice(0,this.root.length)===this.root&&i(t,r))},filter:function(t){var e=[];return this.forEach(function(i,r){t(i,r)&&e.push(r)}),e},file:function(e,i,n){if(1===arguments.length){if(r(e)){var s=e;return this.filter(function(e,t){return!t.dir&&s.test(e)})}var t=this.files[this.root+e];return t&&!t.dir?t:null}return e=this.root+e,o.call(this,e,i,n),this},folder:function(e){if(!e)return this;if(r(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var i=this.root+e,n=l.call(this,i),t=this.clone();return t.root=n.name,t},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter(function(r,t){return t.name.slice(0,e.length)===e}),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(r){var n,e={};try{if(e=t.extend(r||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:m.utf8encode}),e.type=e.type.toLowerCase(),e.compression=e.compression.toUpperCase(),"binarystring"===e.type&&(e.type="string"),!e.type)throw new Error("No output type specified.");t.checkSupport(e.type),("darwin"===r.platform||"freebsd"===r.platform||"linux"===r.platform||"sunos"===r.platform)&&(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var s=e.comment||this.comment||"";n=c.generateWorker(this,e,s)}catch(a){n=new i("error"),n.error(a)}return new f(n,e.type||"string",e.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};v.exports=d},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(t,i){function e(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}var r=t("./DataReader"),n=t("../utils");n.inherits(e,r),e.prototype.byteAt=function(e){return this.data[this.zero+e]},e.prototype.lastIndexOfSignature=function(t){for(var r=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),s=t.charCodeAt(3),e=this.length-4;e>=0;--e)if(this.data[e]===r&&this.data[e+1]===i&&this.data[e+2]===n&&this.data[e+3]===s)return e-this.zero;return-1},e.prototype.readAndCheckSignature=function(e){var r=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),s=e.charCodeAt(3),t=this.readData(4);return r===t[0]&&i===t[1]&&n===t[2]&&s===t[3]},e.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},i.exports=e},{"../utils":29,"./DataReader":15}],15:[function(t,r){function e(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}var i=t("../utils");e.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},r.exports=e},{"../utils":29}],16:[function(t,i){function e(e){r.call(this,e)}var r=t("./Uint8ArrayReader"),n=t("../utils");n.inherits(e,r),e.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},i.exports=e},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(t,i){function e(e){r.call(this,e)}var r=t("./DataReader"),n=t("../utils");n.inherits(e,r),e.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},e.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},e.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t},e.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},i.exports=e},{"../utils":29,"./DataReader":15}],18:[function(t,i){function e(e){r.call(this,e)}var r=t("./ArrayReader"),n=t("../utils");n.inherits(e,r),e.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},i.exports=e},{"../utils":29,"./ArrayReader":14}],19:[function(e,i){var t=e("../utils"),r=e("../support"),n=e("./ArrayReader"),s=e("./StringReader"),a=e("./NodeBufferReader"),o=e("./Uint8ArrayReader");i.exports=function(e){var i=t.getTypeOf(e);return t.checkSupport(i),"string"!==i||r.uint8array?"nodebuffer"===i?new a(e):r.uint8array?new o(t.transformTo("uint8array",e)):new n(t.transformTo("array",e)):new s(e)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(t,r,e){e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\b"},{}],21:[function(t,n){function e(e){r.call(this,"ConvertWorker to "+e),this.destType=e}var r=t("./GenericWorker"),i=t("../utils");i.inherits(e,r),e.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},n.exports=e},{"../utils":29,"./GenericWorker":25}],22:[function(e,i){function t(){r.call(this,"Crc32Probe")}var r=e("./GenericWorker"),n=e("../crc32"),s=e("../utils");s.inherits(t,r),t.prototype.processChunk=function(e){this.streamInfo.crc32=n(e.data,this.streamInfo.crc32||0),this.push(e)},i.exports=t},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(r,i){function e(e){t.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}var n=r("../utils"),t=r("./GenericWorker");n.inherits(e,t),e.prototype.processChunk=function(e){if(e){var r=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=r+e.data.length}t.prototype.processChunk.call(this,e)},i.exports=e},{"../utils":29,"./GenericWorker":25}],24:[function(i,n){function e(i){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(r){e.dataIsReady=!0,e.data=r,e.max=r&&r.length||0,e.type=t.getTypeOf(r),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}var t=i("../utils"),r=i("./GenericWorker"),s=16384;t.inherits(e,r),e.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},e.prototype.resume=function(){return r.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0):!1},e.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var r=s,e=null,t=Math.min(this.max,this.index+r);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=e},{"../utils":29,"./GenericWorker":25}],25:[function(r,t){function e(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,r){if(this._listeners[e])for(var t=0;t<this._listeners[e].length;t++)this._listeners[e][t].call(this,r)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=e},{}],26:[function(e,t){(function(a){function o(t,e,i){switch(t){case"blob":return r.newBlob(r.transformTo("arraybuffer",e),i);case"base64":return c.encode(e);default:return r.transformTo(t,e)}}function n(i,t){var e,n=0,r=null,s=0;for(e=0;e<t.length;e++)s+=t[e].length;switch(i){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(s),e=0;e<t.length;e++)r.set(t[e],n),n+=t[e].length;return r;case"nodebuffer":return a.concat(t);default:throw new Error("concat : unsupported type '"+i+"'")}}function s(e,t){return new h.Promise(function(s,i){var r=[],a=e._internalType,u=e._outputType,l=e._mimeType;e.on("data",function(e,i){r.push(e),t&&t(i)}).on("error",function(e){r=[],i(e)}).on("end",function(){try{var e=o(u,n(a,r),l);s(e)}catch(t){i(t)}r=[]}).resume()})}function i(i,t,n){var e=t;switch(t){case"blob":case"arraybuffer":e="uint8array";break;case"base64":e="string"}try{this._internalType=e,this._outputType=t,this._mimeType=n,r.checkSupport(e),this._worker=i.pipe(new u(e)),i.lock()}catch(s){this._worker=new l("error"),this._worker.error(s)}}var r=e("../utils"),u=e("./ConvertWorker"),l=e("./GenericWorker"),c=e("../base64"),f=e("../nodejs/NodejsStreamOutputAdapter"),h=e("../external");i.prototype={accumulate:function(e){return s(this,e)},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,function(e){t.call(i,e.data,e.meta)}):this._worker.on(e,function(){r.delay(t,arguments,i)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=i}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],27:[function(t,r,e){(function(n){if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,e.nodebuffer="undefined"!=typeof n,e.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)e.blob=!1;else{var r=new ArrayBuffer(0);try{e.blob=0===new Blob([r],{type:"application/zip"}).size}catch(a){try{var s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new s;i.append(r),e.blob=0===i.getBlob("application/zip").size}catch(a){e.blob=!1}}}e.nodestream=!!t("./nodejs/NodejsStreamOutputAdapter").prototype}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(s,d,t){function a(){o.call(this,"utf-8 decode"),this.leftOver=null}function u(){o.call(this,"utf-8 encode")}for(var i=s("./utils"),r=s("./support"),h=s("./nodejsUtils"),o=s("./stream/GenericWorker"),n=new Array(256),e=0;256>e;e++)n[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;n[254]=n[254]=1;var f=function(a){var i,e,s,t,n,u=a.length,o=0;for(t=0;u>t;t++)e=a.charCodeAt(t),55296===(64512&e)&&u>t+1&&(s=a.charCodeAt(t+1),56320===(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),t++)),o+=128>e?1:2048>e?2:65536>e?3:4;for(i=r.uint8array?new Uint8Array(o):new Array(o),n=0,t=0;o>n;t++)e=a.charCodeAt(t),55296===(64512&e)&&u>t+1&&(s=a.charCodeAt(t+1),56320===(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),t++)),128>e?i[n++]=e:2048>e?(i[n++]=192|e>>>6,i[n++]=128|63&e):65536>e?(i[n++]=224|e>>>12,i[n++]=128|e>>>6&63,i[n++]=128|63&e):(i[n++]=240|e>>>18,i[n++]=128|e>>>12&63,i[n++]=128|e>>>6&63,i[n++]=128|63&e);return i},l=function(r,e){var t;for(e=e||r.length,e>r.length&&(e=r.length),t=e-1;t>=0&&128===(192&r[t]);)t--;return 0>t?e:0===t?e:t+n[r[t]]>e?t:e},c=function(o){var a,r,e,s,u=o.length,t=new Array(2*u);for(r=0,a=0;u>a;)if(e=o[a++],128>e)t[r++]=e;else if(s=n[e],s>4)t[r++]=65533,a+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&u>a;)e=e<<6|63&o[a++],s--;s>1?t[r++]=65533:65536>e?t[r++]=e:(e-=65536,t[r++]=55296|e>>10&1023,t[r++]=56320|1023&e)}return t.length!==r&&(t.subarray?t=t.subarray(0,r):t.length=r),i.applyFromCharCode(t)};t.utf8encode=function(e){return r.nodebuffer?h.newBuffer(e,"utf-8"):f(e)},t.utf8decode=function(e){return r.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):(e=i.transformTo(r.uint8array?"uint8array":"array",e),c(e))},i.inherits(a,o),a.prototype.processChunk=function(a){var e=i.transformTo(r.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var o=e;e=new Uint8Array(o.length+this.leftOver.length),e.set(this.leftOver,0),e.set(o,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var n=l(e),s=e;n!==e.length&&(r.uint8array?(s=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(s=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:t.utf8decode(s),meta:a.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=a,i.inherits(u,o),u.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=u},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(s,p,e){function h(e){var t=null;return t=r.uint8array?new Uint8Array(e.length):new Array(e.length),o(e,t)}function n(e){return e}function o(t,r){for(var e=0;e<t.length;++e)r[e]=255&t.charCodeAt(e);return r}function a(r){var t=65536,i=e.getTypeOf(r),n=!0;if("uint8array"===i?n=u.applyCanBeUsed.uint8array:"nodebuffer"===i&&(n=u.applyCanBeUsed.nodebuffer),n)for(;t>1;)try{return u.stringifyByChunk(r,i,t)}catch(s){t=Math.floor(t/2)}return u.stringifyByChar(r)}function l(t,r){for(var e=0;e<t.length;e++)r[e]=t[e];return r}var r=s("./support"),f=s("./base64"),i=s("./nodejsUtils"),d=s("asap"),c=s("./external");e.newBlob=function(t,r){e.checkSupport("blob");try{return new Blob([t],{type:r})}catch(s){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new n;return i.append(t),i.getBlob(r)}catch(s){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(t,n,r){var s=[],e=0,i=t.length;if(r>=i)return String.fromCharCode.apply(null,t);for(;i>e;)s.push("array"===n||"nodebuffer"===n?String.fromCharCode.apply(null,t.slice(e,Math.min(e+r,i))):String.fromCharCode.apply(null,t.subarray(e,Math.min(e+r,i)))),e+=r;return s.join("")},stringifyByChar:function(t){for(var r="",e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,i.newBuffer(1)).length}catch(e){return!1}}()}};e.applyFromCharCode=a;var t={};t.string={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return t.string.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:function(e){return o(e,i.newBuffer(e.length))}},t.array={string:a,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBuffer(e)}},t.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return l(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBuffer(new Uint8Array(e))}},t.uint8array={string:a,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return i.newBuffer(e)}},t.nodebuffer={string:a,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return t.nodebuffer.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:n},e.transformTo=function(i,r){if(r||(r=""),!i)return r;e.checkSupport(i);var n=e.getTypeOf(r),s=t[n][i](r);return s},e.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":r.nodebuffer&&i.isBuffer(e)?"nodebuffer":r.uint8array&&e instanceof Uint8Array?"uint8array":r.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(e){var t=r[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(r){var t,e,i="";for(e=0;e<(r||"").length;e++)t=r.charCodeAt(e),i+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return i},e.delay=function(e,t,r){d(function(){e.apply(r||null,t||[])})},e.inherits=function(t,r){var e=function(){};e.prototype=r.prototype,t.prototype=new e},e.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof r[t]&&(r[t]=arguments[e][t]);return r},e.prepareContent=function(n,t,s,a,o){var i=null;return i=r.blob&&t instanceof Blob&&"undefined"!=typeof FileReader?new c.Promise(function(r,i){var e=new FileReader;e.onload=function(e){r(e.target.result)},e.onerror=function(e){i(e.target.error)},e.readAsArrayBuffer(t)}):c.Promise.resolve(t),i.then(function(t){var r=e.getTypeOf(t);return r?("arraybuffer"===r?t=e.transformTo("uint8array",t):"string"===r&&(o?t=f.decode(t):s&&a!==!0&&(t=h(t))),t):c.Promise.reject(new Error("The data of '"+n+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(r,n){function i(e){this.files=[],this.loadOptions=e}var s=r("./reader/readerFor"),t=r("./utils"),e=r("./signature"),a=r("./zipEntry"),o=(r("./utf8"),r("./support"));i.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var r=this.reader.readString(4);throw new Error("Corrupted zip or bug : unexpected signature ("+t.pretty(r)+", expected "+t.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),n=i===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),r=o.uint8array?"uint8array":"array",i=t.transformTo(r,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44,n=0;i>n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var r,t;for(r=0;r<this.files.length;r++)t=this.files[r],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(e.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(e.CENTRAL_FILE_HEADER);)t=new a({zip64:this.zip64},this.loadOptions),t.readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var r=this.reader.lastIndexOfSignature(e.CENTRAL_DIRECTORY_END);if(0>r){var a=!this.isSignature(0,e.LOCAL_FILE_HEADER);throw new Error(a?"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip : can't find end of central directory")}this.reader.setIndex(r);var s=r;if(this.checkSignature(e.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,r=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>r)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(r),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,e.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=s-n;if(i>0)this.isSignature(s,e.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(0>i)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=s(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=i},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(t,o){function a(e,t){this.options=e,this.loadOptions=t}var n=t("./reader/readerFor"),e=t("./utils"),u=t("./compressedObject"),s=t("./crc32"),i=t("./utf8"),r=t("./compressions"),l=t("./support"),c=0,f=3,h=function(t){for(var e in r)if(r.hasOwnProperty(e)&&r[e].magic===t)return r[e];
return null};a.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(t){var r,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(r=h(this.compressionMethod),null===r)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+e.transformTo("string",this.fileName)+")");this.decompressed=new u(this.compressedSize,this.uncompressedSize,this.crc32,r,t.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,e===c&&(this.dosPermissions=63&this.externalFileAttributes),e===f&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,i,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<n;)t=e.readInt(2),r=e.readInt(2),i=e.readData(r),this.extraFields[t]={id:t,length:r,value:i}},handleUTF8:function(){var t=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var r=this.findExtraFieldUnicodePath();if(null!==r)this.fileNameStr=r;else{var s=e.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(s)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var a=e.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:s(this.fileName)!==t.readInt(4)?null:i.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:s(this.fileComment)!==t.readInt(4)?null:i.utf8decode(t.readData(e.length-5))}return null}},o.exports=a},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(e,o){var l=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),i=e("./utf8"),n=e("./compressedObject"),u=e("./stream/GenericWorker"),r=function(t,r,e){this.name=t,this.dir=e.dir,this.date=e.date,this.comment=e.comment,this.unixPermissions=e.unixPermissions,this.dosPermissions=e.dosPermissions,this._data=r,this._dataBinary=e.binary,this.options={compression:e.compression,compressionOptions:e.compressionOptions}};r.prototype={internalStream:function(s){var e=s.toLowerCase(),r="string"===e||"text"===e;("binarystring"===e||"text"===e)&&(e="string");var t=this._decompressWorker(),n=!this._dataBinary;return n&&!r&&(t=t.pipe(new i.Utf8EncodeWorker)),!n&&r&&(t=t.pipe(new i.Utf8DecodeWorker)),new l(t,e,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(t,r){if(this._data instanceof n&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var e=this._decompressWorker();return this._dataBinary||(e=e.pipe(new i.Utf8EncodeWorker)),n.createWorkerFrom(e,t,r)},_decompressWorker:function(){return this._data instanceof n?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var s=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},t=0;t<s.length;t++)r.prototype[s[t]]=c;o.exports=r},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],33:[function(s,a){function o(){if(r.length)throw r.shift()}function t(r){var t;t=e.length?e.pop():new i,t.task=r,n(t)}function i(){this.task=null}var n=s("./raw"),e=[],r=[],u=n.makeRequestCallFromTimer(o);a.exports=t,i.prototype.call=function(){try{this.task.call()}catch(i){t.onerror?t.onerror(i):(r.push(i),u())}finally{this.task=null,e[e.length]=this}}},{"./raw":34}],34:[function(t,e){(function(o){function n(e){t.length||(i(),u=!0),t[t.length]=e}function a(){for(;r<t.length;){var i=r;if(r+=1,t[i].call(),r>f){for(var e=0,n=t.length-r;n>e;e++)t[e]=t[e+r];t.length-=r,r=0}}t.length=0,r=0,u=!1}function c(r){var e=1,i=new l(r),t=document.createTextNode("");return i.observe(t,{characterData:!0}),function(){e=-e,t.data=e}}function s(e){return function(){function t(){clearTimeout(r),clearInterval(i),e()}var r=setTimeout(t,0),i=setInterval(t,50)}}e.exports=n;var i,t=[],u=!1,r=0,f=1024,l=o.MutationObserver||o.WebKitMutationObserver;i="function"==typeof l?c(a):s(a),n.requestFlush=i,n.makeRequestCallFromTimer=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(){},{}],36:[function(c,u){function l(){n=!1,i.length?t=i.concat(t):s=-1,t.length&&o()}function o(){if(!n){var r=setTimeout(l);n=!0;for(var e=t.length;e;){for(i=t,t=[];++s<e;)i&&i[s].run();s=-1,e=t.length}i=null,n=!1,clearTimeout(r)}}function a(e,t){this.fun=e,this.array=t}function r(){}var i,e=u.exports={},t=[],n=!1,s=-1;e.nextTick=function(i){var r=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)r[e-1]=arguments[e];t.push(new a(i,r)),1!==t.length||n||setTimeout(o,0)},a.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=r,e.addListener=r,e.once=r,e.off=r,e.removeListener=r,e.removeAllListeners=r,e.emit=r,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],37:[function(t,r){(function(i,n){(function(){function nt(e){return"function"==typeof e||"object"==typeof e&&null!==e}function S(e){return"function"==typeof e}function at(e){return"object"==typeof e&&null!==e}function L(e){y=e}function X(e){l=e}function Q(){return function(){i.nextTick(d)}}function $(){return function(){I(d)}}function rt(){var e=0,r=new C(d),t=document.createTextNode("");return r.observe(t,{characterData:!0}),function(){t.data=e=++e%2}}function it(){var e=new MessageChannel;return e.port1.onmessage=d,function(){e.port2.postMessage(0)}}function x(){return function(){setTimeout(d,1)}}function d(){for(var e=0;p>e;e+=2){var t=h[e],r=h[e+1];t(r),h[e]=void 0,h[e+1]=void 0}p=0}function pt(){try{var r=t,e=r("vertx");return I=e.runOnLoop||e.runOnContext,$()}catch(i){return x()}}function m(){}function W(){return new TypeError("You cannot resolve a promise with itself")}function K(){return new TypeError("A promises callback cannot return that same promise.")}function U(e){try{return e.then}catch(t){return b.error=t,b}}function G(e,t,r,i){try{e.call(t,r,i)}catch(n){return n}}function H(t,e,r){l(function(i){var t=!1,n=G(r,e,function(r){t||(t=!0,e!==r?g(i,r):o(i,r))},function(e){t||(t=!0,s(i,e))},"Settle: "+(i._label||" unknown promise"));!t&&n&&(t=!0,s(i,n))},t)}function J(t,e){e._state===v?o(t,e._result):e._state===c?s(t,e._result):k(e,void 0,function(e){g(t,e)},function(e){s(t,e)})}function Z(e,t){if(t.constructor===e.constructor)J(e,t);else{var r=U(t);r===b?s(e,b.error):void 0===r?o(e,t):S(r)?H(e,t,r):o(e,t)}}function g(e,t){e===t?s(e,W()):nt(t)?Z(e,t):o(e,t)}function Y(e){e._onerror&&e._onerror(e._result),F(e)}function o(e,t){e._state===f&&(e._result=t,e._state=v,0!==e._subscribers.length&&l(F,e))}function s(e,t){e._state===f&&(e._state=c,e._result=t,l(Y,e))}function k(e,i,n,s){var t=e._subscribers,r=t.length;e._onerror=null,t[r]=i,t[r+v]=n,t[r+c]=s,0===r&&e._state&&l(F,e)}function F(e){var t=e._subscribers,s=e._state;if(0!==t.length){for(var i,n,a=e._result,r=0;r<t.length;r+=3)i=t[r],n=t[r+s],i?q(s,i,n,a):n(a);e._subscribers.length=0}}function M(){this.error=null}function st(e,t){try{return e(t)}catch(r){return O.error=r,O}}function q(i,t,n,a){var e,u,r,l,h=S(n);if(h){if(e=st(n,a),e===O?(l=!0,u=e.error,e=null):r=!0,t===e)return void s(t,K())}else e=a,r=!0;t._state!==f||(h&&r?g(t,e):l?s(t,u):i===v?o(t,e):i===c&&s(t,e))}function ot(e,t){try{t(function(t){g(e,t)},function(t){s(e,t)})}catch(r){s(e,r)}}function u(r,t){var e=this;e._instanceConstructor=r,e.promise=new r(m),e._validateInput(t)?(e._input=t,e.length=t.length,e._remaining=t.length,e._init(),0===e.length?o(e.promise,e._result):(e.length=e.length||0,e._enumerate(),0===e._remaining&&o(e.promise,e._result))):s(e.promise,e._validationError())}function mt(e){return new ut(this,e).promise}function T(t){function n(t){g(e,t)}function a(t){s(e,t)}var i=this,e=new i(m);if(!A(t))return s(e,new TypeError("You must pass an array to race.")),e;for(var o=t.length,r=0;e._state===f&&o>r;r++)k(i.resolve(t[r]),void 0,n,a);return e}function vt(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(m);return g(r,e),r}function D(t){var r=this,e=new r(m);return s(e,t),e}function E(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function R(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function a(e){this._id=dt++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==e&&(S(e)||E(),this instanceof a||R(),ot(this,e))}function z(){var e;if("undefined"!=typeof n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(r){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;(!t||"[object Promise]"!==Object.prototype.toString.call(t.resolve())||t.cast)&&(e.Promise=B)}var j;j=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var I,y,_,A=j,p=0,l=({}.toString,function(e,t){h[p]=e,h[p+1]=t,p+=2,2===p&&(y?y(d):_())}),V="undefined"!=typeof window?window:void 0,P=V||{},C=P.MutationObserver||P.WebKitMutationObserver,et="undefined"!=typeof i&&"[object process]"==={}.toString.call(i),tt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,h=new Array(1e3);_=et?Q():C?rt():tt?it():void 0===V&&"function"==typeof t?pt():x();var f=void 0,v=1,c=2,b=new M,O=new M;u.prototype._validateInput=function(e){return A(e)},u.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},u.prototype._init=function(){this._result=new Array(this.length)};var ut=u;u.prototype._enumerate=function(){for(var e=this,r=e.length,i=e.promise,n=e._input,t=0;i._state===f&&r>t;t++)e._eachEntry(n[t],t)},u.prototype._eachEntry=function(e,r){var t=this,i=t._instanceConstructor;at(e)?e.constructor===i&&e._state!==f?(e._onerror=null,t._settledAt(e._state,r,e._result)):t._willSettleAt(i.resolve(e),r):(t._remaining--,t._result[r]=e)},u.prototype._settledAt=function(i,n,r){var e=this,t=e.promise;t._state===f&&(e._remaining--,i===c?s(t,r):e._result[n]=r),0===e._remaining&&o(t,e._result)},u.prototype._willSettleAt=function(r,e){var t=this;k(r,void 0,function(r){t._settledAt(v,e,r)},function(r){t._settledAt(c,e,r)})};var lt=mt,ct=T,ft=vt,ht=D,dt=0,B=a;a.all=lt,a.race=ct,a.resolve=ft,a.reject=ht,a._setScheduler=L,a._setAsap=X,a._asap=l,a.prototype={constructor:a,then:function(i,n){var t=this,e=t._state;if(e===v&&!i||e===c&&!n)return this;var r=new this.constructor(m),s=t._result;if(e){var a=arguments[e-1];l(function(){q(e,r,a,s)})}else k(t,r,i,n);return r},"catch":function(e){return this.then(null,e)}};var N=z,w={Promise:B,polyfill:N};"function"==typeof e&&e.amd?e(function(){return w}):"undefined"!=typeof r&&r.exports?r.exports=w:"undefined"!=typeof this&&(this.ES6Promise=w),N()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:36}],38:[function(e,r){var i=e("./lib/utils/common").assign,n=e("./lib/deflate"),s=e("./lib/inflate"),a=e("./lib/zlib/constants"),t={};i(t,n,s,a),r.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,y,s){function e(a){if(!(this instanceof e))return new e(a);this.options=n.assign({level:g,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},a||{});var r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var s=i.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==t)throw new Error(c[s]);if(r.header&&i.deflateSetHeader(this.strm,r.header),r.dictionary){var u;if(u="string"==typeof r.dictionary?o.string2buf(r.dictionary):"[object ArrayBuffer]"===h.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,s=i.deflateSetDictionary(this.strm,u),s!==t)throw new Error(c[s]);this._dict_set=!0}}function a(r,i){var t=new e(i);if(t.push(r,!0),t.err)throw t.msg;return t.result}function v(t,e){return e=e||{},e.raw=!0,a(t,e)}function m(t,e){return e=e||{},e.gzip=!0,a(t,e)}var i=r("./zlib/deflate"),n=r("./utils/common"),o=r("./utils/strings"),c=r("./zlib/messages"),p=r("./zlib/zstream"),h=Object.prototype.toString,d=0,u=4,t=0,l=1,f=2,g=-1,b=0,k=8;e.prototype.push=function(a,c){var r,s,e=this.strm,p=this.options.chunkSize;if(this.ended)return!1;s=c===~~c?c:c===!0?u:d,e.input="string"==typeof a?o.string2buf(a):"[object ArrayBuffer]"===h.call(a)?new Uint8Array(a):a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new n.Buf8(p),e.next_out=0,e.avail_out=p),r=i.deflate(e,s),r!==l&&r!==t)return this.onEnd(r),this.ended=!0,!1;(0===e.avail_out||0===e.avail_in&&(s===u||s===f))&&this.onData("string"===this.options.to?o.buf2binstring(n.shrinkBuf(e.output,e.next_out)):n.shrinkBuf(e.output,e.next_out))}while((e.avail_in>0||0===e.avail_out)&&r!==l);return s===u?(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===t):s===f?(this.onEnd(t),e.avail_out=0,!0):!0},e.prototype.onData=function(e){this.chunks.push(e)},e.prototype.onEnd=function(e){e===t&&(this.result="string"===this.options.to?this.chunks.join(""):n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},s.Deflate=e,s.deflate=a,s.deflateRaw=v,s.gzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,d,a){function r(s){if(!(this instanceof r))return new r(s);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},s||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||s&&s.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var a=n.inflateInit2(this.strm,t.windowBits);if(a!==e.Z_OK)throw new Error(c[a]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function o(t,i){var e=new r(i);if(e.push(t,!0),e.err)throw e.msg;return e.result}function l(t,e){return e=e||{},e.raw=!0,o(t,e)}var n=t("./zlib/inflate"),i=t("./utils/common"),s=t("./utils/strings"),e=t("./zlib/constants"),c=t("./zlib/messages"),f=t("./zlib/zstream"),h=t("./zlib/gzheader"),u=Object.prototype.toString;r.prototype.push=function(l,h){var r,a,f,c,v,m,t=this.strm,p=this.options.chunkSize,o=this.options.dictionary,d=!1;if(this.ended)return!1;a=h===~~h?h:h===!0?e.Z_FINISH:e.Z_NO_FLUSH,t.input="string"==typeof l?s.binstring2buf(l):"[object ArrayBuffer]"===u.call(l)?new Uint8Array(l):l,t.next_in=0,t.avail_in=t.input.length;do{if(0===t.avail_out&&(t.output=new i.Buf8(p),t.next_out=0,t.avail_out=p),r=n.inflate(t,e.Z_NO_FLUSH),r===e.Z_NEED_DICT&&o&&(m="string"==typeof o?s.string2buf(o):"[object ArrayBuffer]"===u.call(o)?new Uint8Array(o):o,r=n.inflateSetDictionary(this.strm,m)),r===e.Z_BUF_ERROR&&d===!0&&(r=e.Z_OK,d=!1),r!==e.Z_STREAM_END&&r!==e.Z_OK)return this.onEnd(r),this.ended=!0,!1;t.next_out&&(0===t.avail_out||r===e.Z_STREAM_END||0===t.avail_in&&(a===e.Z_FINISH||a===e.Z_SYNC_FLUSH))&&("string"===this.options.to?(f=s.utf8border(t.output,t.next_out),c=t.next_out-f,v=s.buf2string(t.output,f),t.next_out=c,t.avail_out=p-c,c&&i.arraySet(t.output,t.output,f,c,0),this.onData(v)):this.onData(i.shrinkBuf(t.output,t.next_out))),0===t.avail_in&&0===t.avail_out&&(d=!0)}while((t.avail_in>0||0===t.avail_out)&&r!==e.Z_STREAM_END);return r===e.Z_STREAM_END&&(a=e.Z_FINISH),a===e.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===e.Z_OK):a===e.Z_SYNC_FLUSH?(this.onEnd(e.Z_OK),t.avail_out=0,!0):!0},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(t){t===e.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Inflate=r,a.inflate=o,a.inflateRaw=l,a.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(r){for(var i=Array.prototype.slice.call(arguments,1);i.length;){var e=i.shift();if(e){if("object"!=typeof e)throw new TypeError(e+"must be non-object");for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])}}return r},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(t,r,i,n,s){if(r.subarray&&t.subarray)return void t.set(r.subarray(i,i+n),s);for(var e=0;n>e;e++)t[s+e]=r[i+e]},flattenChunks:function(t){var e,r,i,n,s,a;for(i=0,e=0,r=t.length;r>e;e++)i+=t[e].length;for(a=new Uint8Array(i),n=0,e=0,r=t.length;r>e;e++)s=t[e],a.set(s,n),n+=s.length;return a}},i={arraySet:function(t,r,i,n,s){for(var e=0;n>e;e++)t[s+e]=r[i+e]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)},{}],42:[function(o,u,t){function n(e,t){if(65537>t&&(e.subarray&&a||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;t>r;r++)n+=String.fromCharCode(e[r]);return n}var i=o("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(l){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){a=!1}for(var r=new i.Buf8(256),e=0;256>e;e++)r[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;r[254]=r[254]=1,t.string2buf=function(a){var r,e,s,t,n,o=a.length,u=0;for(t=0;o>t;t++)e=a.charCodeAt(t),55296===(64512&e)&&o>t+1&&(s=a.charCodeAt(t+1),56320===(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),t++)),u+=128>e?1:2048>e?2:65536>e?3:4;for(r=new i.Buf8(u),n=0,t=0;u>n;t++)e=a.charCodeAt(t),55296===(64512&e)&&o>t+1&&(s=a.charCodeAt(t+1),56320===(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),t++)),128>e?r[n++]=e:2048>e?(r[n++]=192|e>>>6,r[n++]=128|63&e):65536>e?(r[n++]=224|e>>>12,r[n++]=128|e>>>6&63,r[n++]=128|63&e):(r[n++]=240|e>>>18,r[n++]=128|e>>>12&63,r[n++]=128|e>>>6&63,r[n++]=128|63&e);return r},t.buf2binstring=function(e){return n(e,e.length)},t.binstring2buf=function(r){for(var t=new i.Buf8(r.length),e=0,n=t.length;n>e;e++)t[e]=r.charCodeAt(e);return t},t.buf2string=function(o,l){var a,t,e,i,u=l||o.length,s=new Array(2*u);for(t=0,a=0;u>a;)if(e=o[a++],128>e)s[t++]=e;else if(i=r[e],i>4)s[t++]=65533,a+=i-1;else{for(e&=2===i?31:3===i?15:7;i>1&&u>a;)e=e<<6|63&o[a++],i--;i>1?s[t++]=65533:65536>e?s[t++]=e:(e-=65536,s[t++]=55296|e>>10&1023,s[t++]=56320|1023&e)}return n(s,t)},t.utf8border=function(i,e){var t;for(e=e||i.length,e>i.length&&(e=i.length),t=e-1;t>=0&&128===(192&i[t]);)t--;return 0>t?e:0===t?e:t+r[i[t]]>e?t:e}},{"./common":41}],43:[function(r,e){function t(n,s,t,a){for(var e=65535&n|0,r=n>>>16&65535|0,i=0;0!==t;){i=t>2e3?2e3:t,t-=i;do e=e+s[a++]|0,r=r+e|0;while(--i);e%=65521,r%=65521}return e|r<<16|0}e.exports=t},{}],44:[function(t,e){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,e){function t(){for(var e,r=[],t=0;256>t;t++){e=t;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;r[t]=e}return r}function r(e,n,s,r){var a=i,o=r+s;e^=-1;for(var t=r;o>t;t++)e=e>>>8^a[255&(e^n[t])];return-1^e}var i=t();e.exports=r},{}],46:[function(F,Ft,c){function f(t,e){return t.msg=ft[e],e}function L(e){return(e<<1)-(e>4?9:0)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function d(t){var r=t.state,e=r.pending;e>t.avail_out&&(e=t.avail_out),0!==e&&(n.arraySet(t.output,r.pending_buf,r.pending_out,e,t.next_out),t.next_out+=e,r.pending_out+=e,t.total_out+=e,t.avail_out-=e,r.pending-=e,0===r.pending&&(r.pending_out=0))}function i(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,d(e.strm)}function t(e,t){e.pending_buf[e.pending++]=t}function I(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function nt(e,r,i,s){var t=e.avail_in;return t>s&&(t=s),0===t?0:(e.avail_in-=t,n.arraySet(r,e.input,e.next_in,t,i),1===e.state.wrap?e.adler=D(e.adler,r,t,i):2===e.state.wrap&&(e.adler=p(e.adler,r,t,i)),e.next_in+=t,e.total_in+=t,t)}function E(t,a){var i,s,c=t.max_chain_length,r=t.strstart,n=t.prev_length,u=t.nice_match,d=t.strstart>t.w_size-o?t.strstart-(t.w_size-o):0,e=t.window,p=t.w_mask,m=t.prev,l=t.strstart+v,f=e[r+n-1],h=e[r+n];t.prev_length>=t.good_match&&(c>>=2),u>t.lookahead&&(u=t.lookahead);do if(i=a,e[i+n]===h&&e[i+n-1]===f&&e[i]===e[r]&&e[++i]===e[r+1]){r+=2,i++;do;while(e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&e[++r]===e[++i]&&l>r);if(s=v-(l-r),r=l-v,s>n){if(t.match_start=a,n=s,s>=u)break;f=e[r+n-1],h=e[r+n]}}while((a=m[a&p])>d&&0!==--c);return n<=t.lookahead?n:t.lookahead}function k(t){var a,i,u,l,s,r=t.w_size;do{if(l=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-o)){n.arraySet(t.window,t.window,r,r,0),t.match_start-=r,t.strstart-=r,t.block_start-=r,i=t.hash_size,a=i;do u=t.head[--a],t.head[a]=u>=r?u-r:0;while(--i);i=r,a=i;do u=t.prev[--a],t.prev[a]=u>=r?u-r:0;while(--i);l+=r}if(0===t.strm.avail_in)break;if(i=nt(t.strm,t.window,t.strstart+t.lookahead,l),t.lookahead+=i,t.lookahead+t.insert>=e)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+e-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<e)););}while(t.lookahead<o&&0!==t.strm.avail_in)}function Ot(e,s){var t=65535;for(t>e.pending_buf_size-5&&(t=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&s===b)return r;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+t;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,i(e,!1),0===e.strm.avail_out))return r;if(e.strstart-e.block_start>=e.w_size-o&&(i(e,!1),0===e.strm.avail_out))return r}return e.insert=0,s===m?(i(e,!0),0===e.strm.avail_out?g:w):e.strstart>e.block_start&&(i(e,!1),0===e.strm.avail_out)?r:r}function N(t,u){for(var n,s;;){if(t.lookahead<o){if(k(t),t.lookahead<o&&u===b)return r;if(0===t.lookahead)break}if(n=0,t.lookahead>=e&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+e-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-o&&(t.match_length=E(t,n)),t.match_length>=e)if(s=a._tr_tally(t,t.strstart-t.match_start,t.match_length-e),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=e){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+e-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(i(t,!1),0===t.strm.avail_out))return r}return t.insert=t.strstart<e-1?t.strstart:e-1,u===m?(i(t,!0),0===t.strm.avail_out?g:w):t.last_lit&&(i(t,!1),0===t.strm.avail_out)?r:A}function O(t,u){for(var n,s,l;;){if(t.lookahead<o){if(k(t),t.lookahead<o&&u===b)return r;if(0===t.lookahead)break}if(n=0,t.lookahead>=e&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+e-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=e-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-o&&(t.match_length=E(t,n),t.match_length<=5&&(t.strategy===H||t.match_length===e&&t.strstart-t.match_start>4096)&&(t.match_length=e-1)),t.prev_length>=e&&t.match_length<=t.prev_length){l=t.strstart+t.lookahead-e,s=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-e),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=l&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+e-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=e-1,t.strstart++,s&&(i(t,!1),0===t.strm.avail_out))return r}else if(t.match_available){if(s=a._tr_tally(t,0,t.window[t.strstart-1]),s&&i(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return r}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<e-1?t.strstart:e-1,u===m?(i(t,!0),0===t.strm.avail_out?g:w):t.last_lit&&(i(t,!1),0===t.strm.avail_out)?r:A}function St(t,c){for(var u,s,n,l,o=t.window;;){if(t.lookahead<=v){if(k(t),t.lookahead<=v&&c===b)return r;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=e&&t.strstart>0&&(n=t.strstart-1,s=o[n],s===o[++n]&&s===o[++n]&&s===o[++n])){l=t.strstart+v;do;while(s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&l>n);t.match_length=v-(l-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=e?(u=a._tr_tally(t,1,t.match_length-e),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(u=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),u&&(i(t,!1),0===t.strm.avail_out))return r}return t.insert=0,c===m?(i(t,!0),0===t.strm.avail_out?g:w):t.last_lit&&(i(t,!1),0===t.strm.avail_out)?r:A}function yt(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(t===b)return r;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(i(e,!1),0===e.strm.avail_out))return r}return e.insert=0,t===m?(i(e,!0),0===e.strm.avail_out?g:w):e.last_lit&&(i(e,!1),0===e.strm.avail_out)?r:A}function u(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function kt(t){t.window_size=2*t.w_size,h(t.head),t.max_lazy_match=S[t.level].max_lazy,t.good_match=S[t.level].good_length,t.nice_match=S[t.level].nice_length,t.max_chain_length=S[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=e-1,t.match_available=0,t.ins_h=0}function bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=V,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*ot),this.dyn_dtree=new n.Buf16(2*(2*st+1)),this.bl_tree=new n.Buf16(2*(2*at+1)),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(G+1),this.heap=new n.Buf16(2*M+1),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*M+1),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function W(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Y,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?j:y,t.adler=2===e.wrap?0:1,e.last_flush=b,a._tr_init(e),l):f(t,s)}function z(e){var t=W(e);return t===l&&kt(e.state),t}function gt(e,t){return e&&e.state?2!==e.state.wrap?s:(e.state.gzhead=t,l):s}function U(i,a,c,r,o,u){if(!i)return s;var l=1;if(a===ut&&(a=6),0>r?(l=0,r=-r):r>15&&(l=2,r-=16),1>o||o>$||c!==V||8>r||r>15||0>a||a>9||0>u||u>Z)return f(i,s);8===r&&(r=9);var t=new bt;return i.state=t,t.strm=i,t.wrap=l,t.gzhead=null,t.w_bits=r,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=o+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+e-1)/e),t.window=new n.Buf8(2*t.w_size),t.head=new n.Buf16(t.hash_size),t.prev=new n.Buf16(t.w_size),t.lit_bufsize=1<<o+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new n.Buf8(t.pending_buf_size),t.d_buf=t.lit_bufsize>>1,t.l_buf=3*t.lit_bufsize,t.level=a,t.strategy=u,t.method=c,z(i)}function vt(e,t){return U(e,t,V,et,tt,X)}function mt(i,o){var k,e,n,u;if(!i||!i.state||o>K||0>o)return i?f(i,s):s;if(e=i.state,!i.output||!i.input&&0!==i.avail_in||e.status===P&&o!==m)return f(i,0===i.avail_out?T:s);if(e.strm=i,k=e.last_flush,e.last_flush=o,e.status===j)if(2===e.wrap)i.adler=0,t(e,31),t(e,139),t(e,8),e.gzhead?(t(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),t(e,255&e.gzhead.time),t(e,e.gzhead.time>>8&255),t(e,e.gzhead.time>>16&255),t(e,e.gzhead.time>>24&255),t(e,9===e.level?2:e.strategy>=_||e.level<2?4:0),t(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(t(e,255&e.gzhead.extra.length),t(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(i.adler=p(i.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=B):(t(e,0),t(e,0),t(e,0),t(e,0),t(e,0),t(e,9===e.level?2:e.strategy>=_||e.level<2?4:0),t(e,wt),e.status=y);
else{var c=V+(e.w_bits-8<<4)<<8,O=-1;O=e.strategy>=_||e.level<2?0:e.level<6?1:6===e.level?2:3,c|=O<<6,0!==e.strstart&&(c|=ht),c+=31-c%31,e.status=y,I(e,c),0!==e.strstart&&(I(e,i.adler>>>16),I(e,65535&i.adler)),i.adler=1}if(e.status===B)if(e.gzhead.extra){for(n=e.pending;e.gzindex<(65535&e.gzhead.extra.length)&&(e.pending!==e.pending_buf_size||(e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),d(i),n=e.pending,e.pending!==e.pending_buf_size));)t(e,255&e.gzhead.extra[e.gzindex]),e.gzindex++;e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),e.gzindex===e.gzhead.extra.length&&(e.gzindex=0,e.status=x)}else e.status=x;if(e.status===x)if(e.gzhead.name){n=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),d(i),n=e.pending,e.pending===e.pending_buf_size)){u=1;break}u=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,t(e,u)}while(0!==u);e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),0===u&&(e.gzindex=0,e.status=q)}else e.status=q;if(e.status===q)if(e.gzhead.comment){n=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),d(i),n=e.pending,e.pending===e.pending_buf_size)){u=1;break}u=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,t(e,u)}while(0!==u);e.gzhead.hcrc&&e.pending>n&&(i.adler=p(i.adler,e.pending_buf,e.pending-n,n)),0===u&&(e.status=C)}else e.status=C;if(e.status===C&&(e.gzhead.hcrc?(e.pending+2>e.pending_buf_size&&d(i),e.pending+2<=e.pending_buf_size&&(t(e,255&i.adler),t(e,i.adler>>8&255),i.adler=0,e.status=y)):e.status=y),0!==e.pending){if(d(i),0===i.avail_out)return e.last_flush=-1,l}else if(0===i.avail_in&&L(o)<=L(k)&&o!==m)return f(i,T);if(e.status===P&&0!==i.avail_in)return f(i,T);if(0!==i.avail_in||0!==e.lookahead||o!==b&&e.status!==P){var v=e.strategy===_?yt(e,o):e.strategy===J?St(e,o):S[e.level].func(e,o);if((v===g||v===w)&&(e.status=P),v===r||v===g)return 0===i.avail_out&&(e.last_flush=-1),l;if(v===A&&(o===ct?a._tr_align(e):o!==K&&(a._tr_stored_block(e,0,0,!1),o===lt&&(h(e.head),0===e.lookahead&&(e.strstart=0,e.block_start=0,e.insert=0))),d(i),0===i.avail_out))return e.last_flush=-1,l}return o!==m?l:e.wrap<=0?R:(2===e.wrap?(t(e,255&i.adler),t(e,i.adler>>8&255),t(e,i.adler>>16&255),t(e,i.adler>>24&255),t(e,255&i.total_in),t(e,i.total_in>>8&255),t(e,i.total_in>>16&255),t(e,i.total_in>>24&255)):(I(e,i.adler>>>16),I(e,65535&i.adler)),d(i),e.wrap>0&&(e.wrap=-e.wrap),0!==e.pending?l:R)}function pt(t){var e;return t&&t.state?(e=t.state.status,e!==j&&e!==B&&e!==x&&e!==q&&e!==C&&e!==y&&e!==P?f(t,s):(t.state=null,e===y?f(t,Q):l)):s}function dt(r,o){var t,a,f,i,d,p,m,c,u=o.length;if(!r||!r.state)return s;if(t=r.state,i=t.wrap,2===i||1===i&&t.status!==j||t.lookahead)return s;for(1===i&&(r.adler=D(r.adler,o,u,0)),t.wrap=0,u>=t.w_size&&(0===i&&(h(t.head),t.strstart=0,t.block_start=0,t.insert=0),c=new n.Buf8(t.w_size),n.arraySet(c,o,u-t.w_size,t.w_size,0),o=c,u=t.w_size),d=r.avail_in,p=r.next_in,m=r.input,r.avail_in=u,r.next_in=0,r.input=o,k(t);t.lookahead>=e;){a=t.strstart,f=t.lookahead-(e-1);do t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+e-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++;while(--f);t.strstart=a,t.lookahead=e-1,k(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=e-1,t.match_available=0,r.next_in=p,r.input=m,r.avail_in=d,t.wrap=i,l}var S,n=F("../utils/common"),a=F("./trees"),D=F("./adler32"),p=F("./crc32"),ft=F("./messages"),b=0,ct=1,lt=3,m=4,K=5,l=0,R=1,s=-2,Q=-3,T=-5,ut=-1,H=1,_=2,J=3,Z=4,X=0,Y=2,V=8,$=9,et=15,tt=8,rt=29,it=256,M=it+1+rt,st=30,at=19,ot=2*M+1,G=15,e=3,v=258,o=v+e+1,ht=32,j=42,B=69,x=73,q=91,C=103,y=113,P=666,r=1,A=2,g=3,w=4,wt=3;S=[new u(0,0,0,0,Ot),new u(4,4,8,4,N),new u(4,5,16,8,N),new u(4,6,32,32,N),new u(4,4,16,16,O),new u(8,16,32,32,O),new u(8,16,128,128,O),new u(8,32,128,256,O),new u(32,128,258,1024,O),new u(32,258,258,4096,O)],c.deflateInit=vt,c.deflateInit2=U,c.deflateReset=z,c.deflateResetKeep=W,c.deflateSetHeader=gt,c.deflate=mt,c.deflateEnd=pt,c.deflateSetDictionary=dt,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,e){function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=t},{}],48:[function(i,t){var e=30,r=12;t.exports=function(c,C){var u,f,k,i,A,b,w,S,I,m,g,l,n,y,O,P,F,h,t,o,d,a,p,v,s;u=c.state,f=c.next_in,v=c.input,k=f+(c.avail_in-5),i=c.next_out,s=c.output,A=i-(C-c.avail_out),b=i+(c.avail_out-257),w=u.dmax,S=u.wsize,I=u.whave,m=u.wnext,g=u.window,l=u.hold,n=u.bits,y=u.lencode,O=u.distcode,P=(1<<u.lenbits)-1,F=(1<<u.distbits)-1;e:do{15>n&&(l+=v[f++]<<n,n+=8,l+=v[f++]<<n,n+=8),h=y[l&P];t:for(;;){if(t=h>>>24,l>>>=t,n-=t,t=h>>>16&255,0===t)s[i++]=65535&h;else{if(!(16&t)){if(0===(64&t)){h=y[(65535&h)+(l&(1<<t)-1)];continue t}if(32&t){u.mode=r;break e}c.msg="invalid literal/length code",u.mode=e;break e}o=65535&h,t&=15,t&&(t>n&&(l+=v[f++]<<n,n+=8),o+=l&(1<<t)-1,l>>>=t,n-=t),15>n&&(l+=v[f++]<<n,n+=8,l+=v[f++]<<n,n+=8),h=O[l&F];r:for(;;){if(t=h>>>24,l>>>=t,n-=t,t=h>>>16&255,!(16&t)){if(0===(64&t)){h=O[(65535&h)+(l&(1<<t)-1)];continue r}c.msg="invalid distance code",u.mode=e;break e}if(d=65535&h,t&=15,t>n&&(l+=v[f++]<<n,n+=8,t>n&&(l+=v[f++]<<n,n+=8)),d+=l&(1<<t)-1,d>w){c.msg="invalid distance too far back",u.mode=e;break e}if(l>>>=t,n-=t,t=i-A,d>t){if(t=d-t,t>I&&u.sane){c.msg="invalid distance too far back",u.mode=e;break e}if(a=0,p=g,0===m){if(a+=S-t,o>t){o-=t;do s[i++]=g[a++];while(--t);a=i-d,p=s}}else if(t>m){if(a+=S+m-t,t-=m,o>t){o-=t;do s[i++]=g[a++];while(--t);if(a=0,o>m){t=m,o-=t;do s[i++]=g[a++];while(--t);a=i-d,p=s}}}else if(a+=m-t,o>t){o-=t;do s[i++]=g[a++];while(--t);a=i-d,p=s}for(;o>2;)s[i++]=p[a++],s[i++]=p[a++],s[i++]=p[a++],o-=3;o&&(s[i++]=p[a++],o>1&&(s[i++]=p[a++]))}else{a=i-d;do s[i++]=s[a++],s[i++]=s[a++],s[i++]=s[a++],o-=3;while(o>2);o&&(s[i++]=s[a++],o>1&&(s[i++]=s[a++]))}break}}break}}while(k>f&&b>i);o=n>>3,f-=o,n-=o<<3,l&=(1<<n)-1,c.next_in=f,c.next_out=i,c.avail_in=k>f?5+(k-f):5-(f-k),c.avail_out=b>i?257+(b-i):257-(i-b),u.hold=l,u.bits=n}},{}],49:[function(u,kt,i){function Y(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function dt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function M(i){var e;return i&&i.state?(e=i.state,i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=1&e.wrap),e.mode=et,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new t.Buf32(mt),e.distcode=e.distdyn=new t.Buf32(vt),e.sane=1,e.back=-1,a):r}function H(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,M(e)):r}function J(i,e){var n,t;return i&&i.state?(t=i.state,0>e?(n=0,e=-e):(n=(e>>4)+1,48>e&&(e&=15)),e&&(8>e||e>15)?r:(null!==t.window&&t.wbits!==e&&(t.window=null),t.wrap=n,t.wbits=e,H(i))):r}function Z(e,n){var t,i;return e?(i=new dt,e.state=i,i.window=null,t=J(e,n),t!==a&&(e.state=null),t):r}function ht(e){return Z(e,bt)}function ft(e){if(x){var r;for(p=new t.Buf32(512),m=new t.Buf32(32),r=0;144>r;)e.lens[r++]=8;for(;256>r;)e.lens[r++]=9;for(;280>r;)e.lens[r++]=7;for(;288>r;)e.lens[r++]=8;for(o(F,e.lens,0,288,p,0,e.work,{bits:9}),r=0;32>r;)e.lens[r++]=5;o(I,e.lens,0,32,m,0,e.work,{bits:5}),x=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function C(a,n,s,r){var i,e=a.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new t.Buf8(e.wsize)),r>=e.wsize?(t.arraySet(e.window,n,s-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(i=e.wsize-e.wnext,i>r&&(i=r),t.arraySet(e.window,n,s-r,i,e.wnext),r-=i,r?(t.arraySet(e.window,n,s-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=i,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=i))),0}function tt(m,Ot){var i,J,kt,H,gt,x,lt,p,u,wt,tt,M,At,Pt,Z,dt,vt,mt,Ft,It,ut,bt,St,yt,ot=0,ht=new t.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!m||!m.state||!m.output||!m.input&&0!==m.avail_in)return r;i=m.state,i.mode===s&&(i.mode=k),gt=m.next_out,kt=m.output,lt=m.avail_out,H=m.next_in,J=m.input,x=m.avail_in,p=i.hold,u=i.bits,wt=x,tt=lt,bt=a;e:for(;;)switch(i.mode){case et:if(0===i.wrap){i.mode=k;break}for(;16>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(2&i.wrap&&35615===p){i.check=0,ht[0]=255&p,ht[1]=p>>>8&255,i.check=n(i.check,ht,2,0),p=0,u=0,i.mode=L;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&p)<<8)+(p>>8))%31){m.msg="incorrect header check",i.mode=e;break}if((15&p)!==N){m.msg="unknown compression method",i.mode=e;break}if(p>>>=4,u-=4,ut=(15&p)+8,0===i.wbits)i.wbits=ut;else if(ut>i.wbits){m.msg="invalid window size",i.mode=e;break}i.dmax=1<<ut,m.adler=i.check=1,i.mode=512&p?G:s,p=0,u=0;break;case L:for(;16>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(i.flags=p,(255&i.flags)!==N){m.msg="unknown compression method",i.mode=e;break}if(57344&i.flags){m.msg="unknown header flags set",i.mode=e;break}i.head&&(i.head.text=p>>8&1),512&i.flags&&(ht[0]=255&p,ht[1]=p>>>8&255,i.check=n(i.check,ht,2,0)),p=0,u=0,i.mode=D;case D:for(;32>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.head&&(i.head.time=p),512&i.flags&&(ht[0]=255&p,ht[1]=p>>>8&255,ht[2]=p>>>16&255,ht[3]=p>>>24&255,i.check=n(i.check,ht,4,0)),p=0,u=0,i.mode=E;case E:for(;16>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.head&&(i.head.xflags=255&p,i.head.os=p>>8),512&i.flags&&(ht[0]=255&p,ht[1]=p>>>8&255,i.check=n(i.check,ht,2,0)),p=0,u=0,i.mode=R;case R:if(1024&i.flags){for(;16>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.length=p,i.head&&(i.head.extra_len=p),512&i.flags&&(ht[0]=255&p,ht[1]=p>>>8&255,i.check=n(i.check,ht,2,0)),p=0,u=0}else i.head&&(i.head.extra=null);i.mode=W;case W:if(1024&i.flags&&(M=i.length,M>x&&(M=x),M&&(i.head&&(ut=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),t.arraySet(i.head.extra,J,H,M,ut)),512&i.flags&&(i.check=n(i.check,J,M,H)),x-=M,H+=M,i.length-=M),i.length))break e;i.length=0,i.mode=z;case z:if(2048&i.flags){if(0===x)break e;M=0;do ut=J[H+M++],i.head&&ut&&i.length<65536&&(i.head.name+=String.fromCharCode(ut));while(ut&&x>M);if(512&i.flags&&(i.check=n(i.check,J,M,H)),x-=M,H+=M,ut)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=K;case K:if(4096&i.flags){if(0===x)break e;M=0;do ut=J[H+M++],i.head&&ut&&i.length<65536&&(i.head.comment+=String.fromCharCode(ut));while(ut&&x>M);if(512&i.flags&&(i.check=n(i.check,J,M,H)),x-=M,H+=M,ut)break e}else i.head&&(i.head.comment=null);i.mode=U;case U:if(512&i.flags){for(;16>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(p!==(65535&i.check)){m.msg="header crc mismatch",i.mode=e;break}p=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),m.adler=i.check=0,i.mode=s;break;case G:for(;32>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}m.adler=i.check=Y(p),p=0,u=0,i.mode=h;case h:if(0===i.havedict)return m.next_out=gt,m.avail_out=lt,m.next_in=H,m.avail_in=x,i.hold=p,i.bits=u,rt;m.adler=i.check=1,i.mode=s;case s:if(Ot===nt||Ot===l)break e;case k:if(i.last){p>>>=7&u,u-=7&u,i.mode=d;break}for(;3>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}switch(i.last=1&p,p>>>=1,u-=1,3&p){case 0:i.mode=X;break;case 1:if(ft(i),i.mode=f,Ot===l){p>>>=2,u-=2;break e}break;case 2:i.mode=$;break;case 3:m.msg="invalid block type",i.mode=e}p>>>=2,u-=2;break;case X:for(p>>>=7&u,u-=7&u;32>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if((65535&p)!==(p>>>16^65535)){m.msg="invalid stored block lengths",i.mode=e;break}if(i.length=65535&p,p=0,u=0,i.mode=y,Ot===l)break e;case y:i.mode=Q;case Q:if(M=i.length){if(M>x&&(M=x),M>lt&&(M=lt),0===M)break e;t.arraySet(kt,J,H,M,gt),x-=M,H+=M,lt-=M,gt+=M,i.length-=M;break}i.mode=s;break;case $:for(;14>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(i.nlen=(31&p)+257,p>>>=5,u-=5,i.ndist=(31&p)+1,p>>>=5,u-=5,i.ncode=(15&p)+4,p>>>=4,u-=4,i.nlen>286||i.ndist>30){m.msg="too many length or distance symbols",i.mode=e;break}i.have=0,i.mode=T;case T:for(;i.have<i.ncode;){for(;3>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.lens[Ct[i.have++]]=7&p,p>>>=3,u-=3}for(;i.have<19;)i.lens[Ct[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,St={bits:i.lenbits},bt=o(st,i.lens,0,19,i.lencode,0,i.work,St),i.lenbits=St.bits,bt){m.msg="invalid code lengths set",i.mode=e;break}i.have=0,i.mode=B;case B:for(;i.have<i.nlen+i.ndist;){for(;ot=i.lencode[p&(1<<i.lenbits)-1],Z=ot>>>24,dt=ot>>>16&255,vt=65535&ot,!(u>=Z);){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(16>vt)p>>>=Z,u-=Z,i.lens[i.have++]=vt;else{if(16===vt){for(yt=Z+2;yt>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(p>>>=Z,u-=Z,0===i.have){m.msg="invalid bit length repeat",i.mode=e;break}ut=i.lens[i.have-1],M=3+(3&p),p>>>=2,u-=2}else if(17===vt){for(yt=Z+3;yt>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}p>>>=Z,u-=Z,ut=0,M=3+(7&p),p>>>=3,u-=3}else{for(yt=Z+7;yt>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}p>>>=Z,u-=Z,ut=0,M=11+(127&p),p>>>=7,u-=7}if(i.have+M>i.nlen+i.ndist){m.msg="invalid bit length repeat",i.mode=e;break}for(;M--;)i.lens[i.have++]=ut}}if(i.mode===e)break;if(0===i.lens[256]){m.msg="invalid code -- missing end-of-block",i.mode=e;break}if(i.lenbits=9,St={bits:i.lenbits},bt=o(F,i.lens,0,i.nlen,i.lencode,0,i.work,St),i.lenbits=St.bits,bt){m.msg="invalid literal/lengths set",i.mode=e;break}if(i.distbits=6,i.distcode=i.distdyn,St={bits:i.distbits},bt=o(I,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,St),i.distbits=St.bits,bt){m.msg="invalid distances set",i.mode=e;break}if(i.mode=f,Ot===l)break e;case f:i.mode=c;case c:if(x>=6&&lt>=258){m.next_out=gt,m.avail_out=lt,m.next_in=H,m.avail_in=x,i.hold=p,i.bits=u,at(m,tt),gt=m.next_out,kt=m.output,lt=m.avail_out,H=m.next_in,J=m.input,x=m.avail_in,p=i.hold,u=i.bits,i.mode===s&&(i.back=-1);break}for(i.back=0;ot=i.lencode[p&(1<<i.lenbits)-1],Z=ot>>>24,dt=ot>>>16&255,vt=65535&ot,!(u>=Z);){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(dt&&0===(240&dt)){for(mt=Z,Ft=dt,It=vt;ot=i.lencode[It+((p&(1<<mt+Ft)-1)>>mt)],Z=ot>>>24,dt=ot>>>16&255,vt=65535&ot,!(u>=mt+Z);){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}p>>>=mt,u-=mt,i.back+=mt}if(p>>>=Z,u-=Z,i.back+=Z,i.length=vt,0===dt){i.mode=V;break}if(32&dt){i.back=-1,i.mode=s;break}if(64&dt){m.msg="invalid literal/length code",i.mode=e;break}i.extra=15&dt,i.mode=P;case P:if(i.extra){for(yt=i.extra;yt>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.length+=p&(1<<i.extra)-1,p>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=w;case w:for(;ot=i.distcode[p&(1<<i.distbits)-1],Z=ot>>>24,dt=ot>>>16&255,vt=65535&ot,!(u>=Z);){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(0===(240&dt)){for(mt=Z,Ft=dt,It=vt;ot=i.distcode[It+((p&(1<<mt+Ft)-1)>>mt)],Z=ot>>>24,dt=ot>>>16&255,vt=65535&ot,!(u>=mt+Z);){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}p>>>=mt,u-=mt,i.back+=mt}if(p>>>=Z,u-=Z,i.back+=Z,64&dt){m.msg="invalid distance code",i.mode=e;break}i.offset=vt,i.extra=15&dt,i.mode=S;case S:if(i.extra){for(yt=i.extra;yt>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}i.offset+=p&(1<<i.extra)-1,p>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){m.msg="invalid distance too far back",i.mode=e;break}i.mode=j;case j:if(0===lt)break e;if(M=tt-lt,i.offset>M){if(M=i.offset-M,M>i.whave&&i.sane){m.msg="invalid distance too far back",i.mode=e;break}M>i.wnext?(M-=i.wnext,At=i.wsize-M):At=i.wnext-M,M>i.length&&(M=i.length),Pt=i.window}else Pt=kt,At=gt-i.offset,M=i.length;M>lt&&(M=lt),lt-=M,i.length-=M;do kt[gt++]=Pt[At++];while(--M);0===i.length&&(i.mode=c);break;case V:if(0===lt)break e;kt[gt++]=i.length,lt--,i.mode=c;break;case d:if(i.wrap){for(;32>u;){if(0===x)break e;x--,p|=J[H++]<<u,u+=8}if(tt-=lt,m.total_out+=tt,i.total+=tt,tt&&(m.adler=i.check=i.flags?n(i.check,kt,tt,gt-tt):g(i.check,kt,tt,gt-tt)),tt=lt,(i.flags?p:Y(p))!==i.check){m.msg="incorrect data check",i.mode=e;break}p=0,u=0}i.mode=_;case _:if(i.wrap&&i.flags){for(;32>u;){if(0===x)break e;x--,p+=J[H++]<<u,u+=8}if(p!==(4294967295&i.total)){m.msg="incorrect length check",i.mode=e;break}p=0,u=0}i.mode=O;case O:bt=it;break e;case e:bt=q;break e;case b:return v;case pt:default:return r}return m.next_out=gt,m.avail_out=lt,m.next_in=H,m.avail_in=x,i.hold=p,i.bits=u,(i.wsize||tt!==m.avail_out&&i.mode<e&&(i.mode<d||Ot!==A))&&C(m,m.output,m.next_out,tt-m.avail_out)?(i.mode=b,v):(wt-=m.avail_in,tt-=m.avail_out,m.total_in+=wt,m.total_out+=tt,i.total+=tt,i.wrap&&tt&&(m.adler=i.check=i.flags?n(i.check,kt,tt,m.next_out-tt):g(i.check,kt,tt,m.next_out-tt)),m.data_type=i.bits+(i.last?64:0)+(i.mode===s?128:0)+(i.mode===f||i.mode===y?256:0),(0===wt&&0===tt||Ot===A)&&bt===a&&(bt=ct),bt)}function lt(e){if(!e||!e.state)return r;var t=e.state;return t.window&&(t.window=null),e.state=null,a}function ut(e,i){var t;return e&&e.state?(t=e.state,0===(2&t.wrap)?r:(t.head=i,i.done=!1,a)):r}function ot(t,n){var e,i,o,s=n.length;return t&&t.state?(e=t.state,0!==e.wrap&&e.mode!==h?r:e.mode===h&&(i=1,i=g(i,n,s,0),i!==e.check)?q:(o=C(t,n,s,s))?(e.mode=b,v):(e.havedict=1,a)):r}var p,m,t=u("../utils/common"),g=u("./adler32"),n=u("./crc32"),at=u("./inffast"),o=u("./inftrees"),st=0,F=1,I=2,A=4,nt=5,l=6,a=0,it=1,rt=2,r=-2,q=-3,v=-4,ct=-5,N=8,et=1,L=2,D=3,E=4,R=5,W=6,z=7,K=8,U=9,G=10,h=11,s=12,k=13,X=14,y=15,Q=16,$=17,T=18,B=19,f=20,c=21,P=22,w=23,S=24,j=25,V=26,d=27,_=28,O=29,e=30,b=31,pt=32,mt=852,vt=592,gt=15,bt=gt,x=!0;i.inflateReset=H,i.inflateReset2=J,i.inflateResetKeep=M,i.inflateInit=ht,i.inflateInit2=Z,i.inflate=tt,i.inflateEnd=lt,i.inflateGetHeader=ut,i.inflateSetDictionary=ot,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,u){var i=o("../utils/common"),e=15,n=852,s=592,r=0,t=1,a=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];u.exports=function(w,j,N,W,P,T,O,D){var y,A,_,L,C,I,E,M,B,U=D.bits,o=0,u=0,g=0,p=0,d=0,k=0,m=0,b=0,F=0,v=0,q=null,R=0,S=new i.Buf16(e+1),V=new i.Buf16(e+1),x=null,z=0;for(o=0;e>=o;o++)S[o]=0;for(u=0;W>u;u++)S[j[N+u]]++;for(d=U,p=e;p>=1&&0===S[p];p--);if(d>p&&(d=p),0===p)return P[T++]=20971520,P[T++]=20971520,D.bits=1,0;for(g=1;p>g&&0===S[g];g++);for(g>d&&(d=g),b=1,o=1;e>=o;o++)if(b<<=1,b-=S[o],0>b)return-1;if(b>0&&(w===r||1!==p))return-1;for(V[1]=0,o=1;e>o;o++)V[o+1]=V[o]+S[o];for(u=0;W>u;u++)0!==j[N+u]&&(O[V[j[N+u]]++]=u);if(w===r?(q=x=O,I=19):w===t?(q=l,R-=257,x=c,z-=257,I=256):(q=f,x=h,I=-1),v=0,u=0,o=g,C=T,k=d,m=0,_=-1,F=1<<d,L=F-1,w===t&&F>n||w===a&&F>s)return 1;for(var K=0;;){K++,E=o-m,O[u]<I?(M=0,B=O[u]):O[u]>I?(M=x[z+O[u]],B=q[R+O[u]]):(M=96,B=0),y=1<<o-m,A=1<<k,g=A;do A-=y,P[C+(v>>m)+A]=E<<24|M<<16|B|0;while(0!==A);for(y=1<<o-1;v&y;)y>>=1;if(0!==y?(v&=y-1,v+=y):v=0,u++,0===--S[o]){if(o===p)break;o=j[N+O[u]]}if(o>d&&(v&L)!==_){for(0===m&&(m=d),C+=g,k=o-m,b=1<<k;p>k+m&&(b-=S[k+m],!(0>=b));)k++,b<<=1;if(F+=1<<k,w===t&&F>n||w===a&&F>s)return 1;_=v&L,P[_]=d<<24|k<<16|C-T|0}}return 0!==v&&(P[C+v]=o-m<<24|64<<16|0),D.bits=d,0}},{"../utils/common":41}],51:[function(t,e){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(pt,mt,h){function s(e){for(var t=e.length;--t>=0;)e[t]=0}function O(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function w(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function j(e){return 256>e?o[e]:o[256+(e>>>7)]}function l(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function e(e,t,r){e.bi_valid>k-r?(e.bi_buf|=t<<e.bi_valid&65535,l(e,e.bi_buf),e.bi_buf=t>>k-e.bi_valid,e.bi_valid+=r-k):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function t(i,t,r){e(i,r[2*t],r[2*t+1])}function W(t,r){var e=0;do e|=1&t,t>>>=1,e<<=1;while(--r>0);return e>>>1}function $(e){16===e.bi_valid?(l(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function dt(t,s){var u,r,a,e,l,f,n=s.dyn_tree,h=s.max_code,v=s.stat_desc.static_tree,p=s.stat_desc.has_stree,m=s.stat_desc.extra_bits,d=s.stat_desc.extra_base,o=s.stat_desc.max_length,c=0;for(e=0;i>=e;e++)t.bl_count[e]=0;for(n[2*t.heap[t.heap_max]+1]=0,u=t.heap_max+1;R>u;u++)r=t.heap[u],e=n[2*n[2*r+1]+1]+1,e>o&&(e=o,c++),n[2*r+1]=e,r>h||(t.bl_count[e]++,l=0,r>=d&&(l=m[r-d]),f=n[2*r],t.opt_len+=f*(e+l),p&&(t.static_len+=f*(v[2*r+1]+l)));if(0!==c){do{for(e=o-1;0===t.bl_count[e];)e--;t.bl_count[e]--,t.bl_count[e+1]+=2,t.bl_count[o]--,c-=2}while(c>0);for(e=o;0!==e;e--)for(r=t.bl_count[e];0!==r;)a=t.heap[--u],a>h||(n[2*a+1]!==e&&(t.opt_len+=(e-n[2*a+1])*n[2*a],n[2*a+1]=e),r--)}}function A(n,o,u){var e,t,s=new Array(i+1),a=0;for(e=1;i>=e;e++)s[e]=a=a+u[e-1]<<1;for(t=0;o>=t;t++){var r=n[2*t+1];0!==r&&(n[2*t]=W(s[r]++,r))}}function ht(){var e,h,m,t,s,l=new Array(i+1);for(m=0,t=0;S-1>t;t++)for(y[t]=m,e=0;e<1<<g[t];e++)a[m++]=t;for(a[m-1]=t,s=0,t=0;16>t;t++)for(p[t]=s,e=0;e<1<<d[t];e++)o[s++]=t;for(s>>=7;n>t;t++)for(p[t]=s<<7,e=0;e<1<<d[t]-7;e++)o[256+s++]=t;for(h=0;i>=h;h++)l[h]=0;for(e=0;143>=e;)r[2*e+1]=8,e++,l[8]++;for(;255>=e;)r[2*e+1]=9,e++,l[9]++;for(;279>=e;)r[2*e+1]=7,e++,l[7]++;for(;287>=e;)r[2*e+1]=8,e++,l[8]++;for(A(r,f+1,l),e=0;n>e;e++)u[2*e+1]=5,u[2*e]=W(e,5);P=new O(r,g,c+1,f,i),G=new O(u,d,0,n,i),U=new O(new Array(0),it,0,F,X)}function _(t){var e;for(e=0;f>e;e++)t.dyn_ltree[2*e]=0;for(e=0;n>e;e++)t.dyn_dtree[2*e]=0;for(e=0;F>e;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*b]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function V(e){e.bi_valid>8?l(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ft(e,r,t,i){V(e),i&&(l(e,t),l(e,~t)),tt.arraySet(e.pending_buf,e.window,r,t,e.pending),e.pending+=t}function T(e,t,r,i){var n=2*t,s=2*r;return e[n]<e[s]||e[n]===e[s]&&i[t]<=i[r]}function m(e,i,r){for(var n=e.heap[r],t=r<<1;t<=e.heap_len&&(t<e.heap_len&&T(i,e.heap[t+1],e.heap[t],e.depth)&&t++,!T(i,n,e.heap[t],e.depth));)e.heap[r]=e.heap[t],r=t,t<<=1;e.heap[r]=n}function E(r,l,f){var n,o,i,s,u=0;if(0!==r.last_lit)do n=r.pending_buf[r.d_buf+2*u]<<8|r.pending_buf[r.d_buf+2*u+1],o=r.pending_buf[r.l_buf+u],u++,0===n?t(r,o,l):(i=a[o],t(r,i+c+1,l),s=g[i],0!==s&&(o-=y[i],e(r,o,s)),n--,i=j(n),t(r,i,f),s=d[i],0!==s&&(n-=p[i],e(r,n,s)));while(u<r.last_lit);t(r,b,l)}function v(e,n){var t,s,i,r=n.dyn_tree,u=n.stat_desc.static_tree,l=n.stat_desc.has_stree,o=n.stat_desc.elems,a=-1;for(e.heap_len=0,e.heap_max=R,t=0;o>t;t++)0!==r[2*t]?(e.heap[++e.heap_len]=a=t,e.depth[t]=0):r[2*t+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>a?++a:0,r[2*i]=1,e.depth[i]=0,e.opt_len--,l&&(e.static_len-=u[2*i+1]);for(n.max_code=a,t=e.heap_len>>1;t>=1;t--)m(e,r,t);i=o;do t=e.heap[1],e.heap[1]=e.heap[e.heap_len--],m(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=t,e.heap[--e.heap_max]=s,r[2*i]=r[2*t]+r[2*s],e.depth[i]=(e.depth[t]>=e.depth[s]?e.depth[t]:e.depth[s])+1,r[2*t+1]=r[2*s+1]=i,e.heap[1]=i++,m(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],dt(e,n),A(r,a,e.bl_count)}function z(r,o,u){var a,e,l=-1,t=o[1],i=0,n=7,s=4;for(0===t&&(n=138,s=3),o[2*(u+1)+1]=65535,a=0;u>=a;a++)e=t,t=o[2*(a+1)+1],++i<n&&e===t||(s>i?r.bl_tree[2*e]+=i:0!==e?(e!==l&&r.bl_tree[2*e]++,r.bl_tree[2*N]++):10>=i?r.bl_tree[2*B]++:r.bl_tree[2*q]++,i=0,l=e,0===t?(n=138,s=3):e===t?(n=6,s=3):(n=7,s=4))}function K(r,l,f){var u,n,c=-1,s=l[1],i=0,a=7,o=4;for(0===s&&(a=138,o=3),u=0;f>=u;u++)if(n=s,s=l[2*(u+1)+1],!(++i<a&&n===s)){if(o>i){do t(r,n,r.bl_tree);while(0!==--i)}else 0!==n?(n!==c&&(t(r,n,r.bl_tree),i--),t(r,N,r.bl_tree),e(r,i-3,2)):10>=i?(t(r,B,r.bl_tree),e(r,i-3,3)):(t(r,q,r.bl_tree),e(r,i-11,7));i=0,c=n,0===s?(a=138,o=3):n===s?(a=6,o=3):(a=7,o=4)}}function ct(e){var t;for(z(e,e.dyn_ltree,e.l_desc.max_code),z(e,e.dyn_dtree,e.d_desc.max_code),v(e,e.bl_desc),t=F-1;t>=3&&0===e.bl_tree[2*x[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function lt(t,i,n,s){var r;for(e(t,i-257,5),e(t,n-1,5),e(t,s-4,4),r=0;s>r;r++)e(t,t.bl_tree[2*x[r]+1],3);K(t,t.dyn_ltree,i-1),K(t,t.dyn_dtree,n-1)}function ut(t){var e,r=4093624447;for(e=0;31>=e;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return M;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return I;for(e=32;c>e;e++)if(0!==t.dyn_ltree[2*e])return I;return M}function ot(e){D||(ht(),D=!0),e.l_desc=new w(e.dyn_ltree,P),e.d_desc=new w(e.dyn_dtree,G),e.bl_desc=new w(e.bl_tree,U),e.bi_buf=0,e.bi_valid=0,_(e)}function C(t,r,i,n){e(t,(Y<<1)+(n?1:0),3),ft(t,r,i,!0)}function at(i){e(i,L<<1,3),t(i,b,r),$(i)}function H(t,o,a,s){var i,n,l=0;t.level>0?(t.strm.data_type===Q&&(t.strm.data_type=ut(t)),v(t,t.l_desc),v(t,t.d_desc),l=ct(t),i=t.opt_len+3+7>>>3,n=t.static_len+3+7>>>3,i>=n&&(i=n)):i=n=a+5,i>=a+4&&-1!==o?C(t,o,a,s):t.strategy===et||n===i?(e(t,(L<<1)+(s?1:0),3),E(t,r,u)):(e(t,(Z<<1)+(s?1:0),3),lt(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),E(t,t.dyn_ltree,t.dyn_dtree)),_(t),s&&V(t)}function rt(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(a[r]+c+1)]++,e.dyn_dtree[2*j(t)]++),e.last_lit===e.lit_bufsize-1}var tt=pt("../utils/common"),et=4,M=0,I=1,Q=2,Y=0,L=1,Z=2,nt=3,J=258,S=29,c=256,f=c+1+S,n=30,F=19,R=2*f+1,i=15,k=16,X=7,b=256,N=16,B=17,q=18,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],it=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],st=512,r=new Array(2*(f+2));s(r);var u=new Array(2*n);s(u);var o=new Array(st);s(o);var a=new Array(J-nt+1);s(a);var y=new Array(S);s(y);var p=new Array(n);s(p);var P,G,U,D=!1;h._tr_init=ot,h._tr_stored_block=C,h._tr_flush_block=H,h._tr_tally=rt,h._tr_align=at},{"../utils/common":41}],53:[function(r,e){function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=t},{}]},{},[10])(10)});
//# sourceMappingURL=squeak.min.js.map