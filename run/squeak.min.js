window.module=function(n){if(""===n)return window;var a=n.split(".");n=a.pop();var a=module(a.join(".")),b=a[n];b||(a[n]=b={loaded:!1,pending:[],requires:function(a){return{toRun:function(e){function g(){e();b.loaded=!0;b.pending.forEach(function(a){a()})}a&&!module(a).loaded?module(a).pending.push(g):g()}}}});return b};Object.extend=function(n){for(var a=1;a<arguments.length;a++)if("object"==typeof arguments[a])for(var b in arguments[a])n[b]=arguments[a][b]};
Function.prototype.subclass=function(n){var a=function(){this.initialize&&this.initialize.apply(this,arguments);return this},b=function(){};b.prototype=this.prototype;a.prototype=new b;for(b=1;b<arguments.length;b++)Object.extend(a.prototype,arguments[b]);var b=n.split("."),c=b.pop();return module(b.join("."))[c]=a};
(function(){var n=document.getElementsByTagName("script"),n=n[n.length-1],a=n.src.replace(/[^\/]*$/,"");n.src.match(/squeak\.min\.js$/)||"vm.js jit.js plugins/ADPCMCodecPlugin.js plugins/B2DPlugin.js plugins/BitBltPlugin.js plugins/FFTPlugin.js plugins/FloatArrayPlugin.js plugins/GeniePlugin.js plugins/JPEGReaderPlugin.js plugins/KedamaPlugin.js plugins/KedamaPlugin2.js plugins/Klatt.js plugins/LargeIntegers.js plugins/Matrix2x3Plugin.js plugins/MiscPrimitivePlugin.js plugins/ScratchPlugin.js plugins/SocketPlugin.js plugins/SpeechPlugin.js plugins/SqueakSSL.js plugins/SoundGenerationPlugin.js plugins/StarSqueakPlugin.js plugins/ZipPlugin.js lib/lz-string.js lib/jszip.js".split(" ").forEach(function(b){var c=document.createElement("script");
c.setAttribute("type","text/javascript");c.setAttribute("src",a+b);document.getElementsByTagName("head")[0].appendChild(c)})})();
module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b,c){function d(b){a.fullscreen=b;h.style.background=b?"black":"";c.header&&(c.header.style.display=b?"none":"");c.footer&&(c.footer.style.display=b?"none":"");c.fullscreenCheckbox&&(c.fullscreenCheckbox.checked=b);setTimeout(window.onresize,0)}var h=b.parentElement,e="fullscreenchange",l="fullscreenElement",f="fullscreenEnabled";h.requestFullscreen||[{req:h.webkitRequestFullscreen,exit:document.webkitExitFullscreen,
evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:h.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:h.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(a){a.req&&(h.requestFullscreen=a.req,document.exitFullscreen=a.exit,e=a.evt,l=a.elem,f=a.enable)});var m;
if(h.requestFullscreen)document.addEventListener(e,function(){d(h==document[l])}),m=function(){document[f]&&h==document[l]!=a.fullscreen&&(a.fullscreen?h.requestFullscreen():document.exitFullscreen())};else{var u=!1;m=function(){(c.header||c.footer)&&u!=a.fullscreen&&(u=a.fullscreen,d(u))}}c.fullscreenCheckbox&&(c.fullscreenCheckbox.onclick=function(){a.fullscreen=c.fullscreenCheckbox.checked;m()});return m}function a(a){if(a.swapCheckbox){var b=l.squeakImageName||"default",c=JSON.parse(l["squeakSettings:"+
b]||"{}");"swapButtons"in c&&(a.swapButtons=c.swapButtons);a.swapCheckbox.checked=a.swapButtons;a.swapCheckbox.onclick=function(){a.swapButtons=a.swapCheckbox.checked;c.swapButtons=a.swapButtons;l["squeakSettings:"+b]=JSON.stringify(c)}}}function b(a,b){var c=(a.shiftKey?Squeak.Keyboard_Shift:0)+(a.ctrlKey&&!a.altKey?Squeak.Keyboard_Ctrl:0)+(a.metaKey||a.altKey&&!a.ctrlKey?Squeak.Keyboard_Cmd:0);b.buttons=b.buttons&~Squeak.Keyboard_All|c;return c}function c(a,b,c){var d=t?a.offsetX:a.layerX;a=t?a.offsetY:
a.layerY;c.cursorCanvas&&(c.cursorCanvas.style.left=d+b.offsetLeft+c.cursorOffsetX+"px",c.cursorCanvas.style.top=a+b.offsetTop+c.cursorOffsetY+"px");a=a*b.height/b.offsetHeight|0;c.mouseX=Math.max(0,Math.min(c.width,d*b.width/b.offsetWidth|0));c.mouseY=Math.max(0,Math.min(c.height,a))}function e(a,d,h,e,l,f){c(d,h,e);if(e.vm){h=e.buttons&Squeak.Mouse_All;switch(a){case "mousedown":switch(d.button||0){case 0:h=Squeak.Mouse_Red;break;case 1:h=Squeak.Mouse_Yellow;break;case 2:h=Squeak.Mouse_Blue}f.swapButtons&&
(h==Squeak.Mouse_Yellow?h=Squeak.Mouse_Blue:h==Squeak.Mouse_Blue&&(h=Squeak.Mouse_Yellow));break;case "mouseup":h=0}e.buttons=h|b(d,e);l&&(l.push([Squeak.EventTypeMouse,d.timeStamp,e.mouseX,e.mouseY,e.buttons&Squeak.Mouse_All,e.buttons>>3]),e.signalInputEvent&&e.signalInputEvent());e.idle=0;"mouseup"==a?e.runFor&&e.runFor(100):e.runNow&&e.runNow()}}function g(a,b,c,d){if(c.vm){var h=c.buttons>>3<<8|a;h===c.vm.interruptKeycode?c.vm.interruptPending=!0:d?(d.push([Squeak.EventTypeKeyboard,b,a,Squeak.EventKeyChar,
c.buttons>>3,a]),c.signalInputEvent&&c.signalInputEvent()):c.keys.push(h);c.idle=0;c.runNow&&c.runNow()}}function k(a,b,d,h,e){h.vm&&e&&(c(b,d,h),e.push([Squeak.EventTypeDragDropFiles,b.timeStamp,a,h.mouseX,h.mouseY,h.buttons>>3,h.droppedFiles.length]),h.signalInputEvent&&h.signalInputEvent())}function f(a,b,c,d){c.buttons&=~Squeak.Keyboard_All;c.buttons=c.buttons|Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl;c.keys=[];g(a,b,c,d)}function d(c,d){function h(a){if(a.touches.length)for(var b=w.x=w.y=0;b<
a.touches.length;b++)w.x+=a.touches[b].pageX/a.touches.length,w.y+=a.touches[b].pageY/a.touches.length;return{timeStamp:a.timeStamp,button:w.button,offsetX:w.x-c.offsetLeft,offsetY:w.y-c.offsetTop}}function l(a,b,c,d){a-=c;b-=d;return Math.sqrt(a*a+b*b)}function m(a,b){return l(a.pageX,a.pageY,b.pageX,b.pageY)}function u(a,b,h,e){var l=t.cursorCanvas,f=h/c.width;c.style.left=(a|0)+"px";c.style.top=(b|0)+"px";c.style.width=(h|0)+"px";c.style.height=(e|0)+"px";l&&(l.style.left=(a+t.cursorOffsetX+t.mouseX*
f|0)+"px",l.style.top=(b+t.cursorOffsetY+t.mouseY*f|0)+"px",l.style.width=(l.width*f|0)+"px",l.style.height=(l.height*f|0)+"px");d.pixelated||(3<=f?(c.classList.add("pixelated"),l&&l.classList.add("pixelated")):(c.classList.remove("pixelated"),l&&t.cursorCanvas.classList.remove("pixelated")));return f}function A(a){for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b])return!0;return!1}d=d||{};d.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor=
"black",document.ontouchmove=function(a){a.preventDefault()},d.header&&(d.header.style.display="none"),d.footer&&(d.footer.style.display="none"));var t={context:c.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:!1!==d.cursor&&document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};a(d);d.pixelated&&(c.classList.add("pixelated"),t.cursorCanvas&&t.cursorCanvas.classList.add("pixelated"));
var x=null;t.reset=function(){x=null;t.signalInputEvent=null;t.lastTick=0;t.getNextEvent=function(a,b){x=[];x.push=function(a){x.offset=Date.now()-a[1];delete x.push;x.push(a)};t.getNextEvent=function(a,b){var c=x.shift();if(c){var d=b-x.offset;a[0]=c[0];a[1]=c[1]-d&Squeak.MillisecondClockMask;for(d=2;d<c.length;d++)a[d]=c[d]}else a[0]=Squeak.EventTypeNone};t.getNextEvent(a,b)}};t.reset();var p=n(t,c,d);t.fullscreenRequest=function(a,b){t.fullscreen!=a?(t.fullscreen=a,t.resizeTodo=b,t.resizeTodoTimeout=
setTimeout(t.resizeDone,1E3),p()):b()};t.resizeDone=function(){clearTimeout(t.resizeTodoTimeout);var a=t.resizeTodo;a&&(t.resizeTodo=null,a())};t.clear=function(){c.width=c.width};t.showBanner=function(a,b){b=b||{};var d=t.context;d.clearRect(0,0,c.width,c.height);d.fillStyle=b.color||"#F90";d.font=b.font||"bold 48px sans-serif";!b.font&&d.measureText(a).width>c.width&&(d.font="bold 24px sans-serif");d.textAlign="center";d.textBaseline="middle";d.fillText(a,c.width/2,c.height/2)};t.showProgress=function(a,
b){b=b||{};var d=t.context,h=c.width/3|0,e=.5*c.width-h/2,l=.5*c.height+48;d.fillStyle=b.background||"#000";d.fillRect(e,l,h,24);d.lineWidth=2;d.strokeStyle=b.color||"#F90";d.strokeRect(e,l,h,24);d.fillStyle=b.color||"#F90";d.fillRect(e,l,h*a,24)};t.executeClipboardPaste=function(a,b){if(!t.vm)return!0;try{t.clipboardString=a,f(118,b,t,x)}catch(c){console.error("paste error "+c)}};t.executeClipboardCopy=function(a,b){if(!t.vm)return!0;t.clipboardStringChanged=!1;f((a||"c").charCodeAt(0),b,t,x);for(var c=
Date.now();!t.clipboardStringChanged&&500>Date.now()-c;)t.vm.interpret(20);if(t.clipboardStringChanged)try{return t.clipboardString}catch(d){console.error("copy error "+d)}};c.onmousedown=function(a){p();e("mousedown",a,c,t,x,d);a.preventDefault();return!1};c.onmouseup=function(a){e("mouseup",a,c,t,x,d);p();a.preventDefault()};c.onmousemove=function(a){e("mousemove",a,c,t,x,d);a.preventDefault()};c.oncontextmenu=function(){return!1};var w={state:"idle",button:0,x:0,y:0,dist:0,down:{}};c.ontouchstart=
function(a){a.preventDefault();for(var b=h(a),f=0;f<a.changedTouches.length;f++)switch(w.state){case "idle":w.state="got1stFinger";w.first=b;setTimeout(function(){"got1stFinger"===w.state&&(w.state="mousing",w.button=b.button=0,e("mousemove",b,c,t,x,d),e("mousedown",b,c,t,x,d))},100);break;case "got1stFinger":w.state="got2ndFinger",w.dist=m(a.touches[0],a.touches[1]),w.down.x=w.x,w.down.y=w.y,w.down.dist=w.dist,w.down.left=c.offsetLeft,w.down.top=c.offsetTop,w.down.width=c.offsetWidth,w.down.height=
c.offsetHeight,w.orig||(w.orig={left:w.down.left,top:w.down.top,right:w.down.left+w.down.width,bottom:w.down.top+w.down.height,width:w.down.width,height:w.down.height}),setTimeout(function(){"got2ndFinger"===w.state&&(10<Math.abs(w.down.dist-w.dist)||10<l(w.down.x,w.down.y,w.x,w.y)?w.state="zooming":(w.state="mousing",w.button=b.button=2,e("mousemove",b,c,t,x,d),e("mousedown",b,c,t,x,d)))},200)}};c.ontouchmove=function(a){a.preventDefault();var b=h(a);switch(w.state){case "got1stFinger":w.state="mousing";
w.button=b.button=0;e("mousemove",b,c,t,x,d);e("mousedown",b,c,t,x,d);break;case "mousing":e("mousemove",b,c,t,x,d);break;case "got2ndFinger":1<a.touches.length&&(w.dist=m(a.touches[0],a.touches[1]));break;case "zooming":if(!(2>a.touches.length)){w.dist=m(a.touches[0],a.touches[1]);a=w.orig.width/w.down.width;var l=Math.min(Math.max(w.dist/w.down.dist,.95*a),5*a);a=w.down.width*l;var b=w.orig.height*a/w.orig.width,f=w.down.left-(w.down.x-w.down.left)*(l-1)+(w.x-w.down.x),l=w.down.top-(w.down.y-w.down.top)*
(l-1)+(w.y-w.down.y),f=Math.max(Math.min(f,w.orig.left+20),w.orig.right-a-20),l=Math.max(Math.min(l,w.orig.top+20),w.orig.bottom-b-20);u(f,l,a,b)}}};c.ontouchend=function(a){a.preventDefault();p();for(var b=h(a),l=0;l<a.changedTouches.length;l++)switch(w.state){case "mousing":if(0<a.touches.length)break;w.state="idle";e("mouseup",b,c,t,x,d);return;case "got1stFinger":w.state="idle";w.button=b.button=0;e("mousemove",b,c,t,x,d);e("mousedown",b,c,t,x,d);e("mouseup",b,c,t,x,d);return;case "got2ndFinger":w.state=
"mousing";w.button=b.button=2;e("mousemove",b,c,t,x,d);e("mousedown",b,c,t,x,d);break;case "zooming":if(!(0<a.touches.length)){w.state="idle";a=c.offsetLeft;var b=c.offsetTop,l=c.offsetWidth,f,l=Math.min(Math.max(l,w.orig.width),5*w.orig.width);f=w.orig.height*l/w.orig.width;a=Math.max(Math.min(a,w.orig.left),w.orig.right-l);b=Math.max(Math.min(b,w.orig.top),w.orig.bottom-f);1E-4>u(a,b,l,f)-t.initialScale&&(w.orig=null,window.onresize());return}}};c.ontouchcancel=function(a){c.ontouchend(a)};if(t.cursorCanvas){var r=
window.getComputedStyle(c);t.cursorCanvas.style.display="block";t.cursorCanvas.style.position=r.position;t.cursorCanvas.style.cursor="none";t.cursorCanvas.style.background="transparent";t.cursorCanvas.style.pointerEvents="none";c.parentElement.appendChild(t.cursorCanvas);c.style.cursor="none"}document.onkeypress=function(a){if(!t.vm||/[CXVR]/.test(String.fromCharCode(a.charCode+64)))return!0;b(a,t);g(a.charCode,a.timeStamp,t,x);a.preventDefault()};document.onkeydown=function(a){p();if(!t.vm)return!0;
b(a,t);var c={8:8,9:9,13:13,27:27,32:32,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[a.keyCode];if(c)return g(c,a.timeStamp,t,x),a.preventDefault();if(a.metaKey||a.altKey&&!a.ctrlKey)if(c=a.key,!c&&a.keyIdentifier&&"U+"==a.keyIdentifier.slice(0,2)&&(c=String.fromCharCode(parseInt(a.keyIdentifier.slice(2),16))),c&&1==c.length){if(/[CXVR]/i.test(c))return!0;var d=c.charCodeAt(0);/[A-Z]/.test(c)&&!a.shiftKey&&(d+=32);g(d,a.timeStamp,t,x);return a.preventDefault()}};document.onkeyup=function(a){if(!t.vm)return!0;
b(a,t)};document.oncopy=function(a,b){var c=t.executeClipboardCopy(b,a.timeStamp);"string"===typeof c&&a.clipboardData.setData("Text",c);a.preventDefault()};document.oncut=function(a){if(!t.vm)return!0;document.oncopy(a,"x")};document.onpaste=function(a){var b=a.clipboardData.getData("Text");t.executeClipboardPaste(b,a.timeStamp);a.preventDefault()};"ontouchstart"in document&&(r=document.createElement("div"),r.innerHTML='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="50px" height="50px" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="Page-1" stroke="none" fill="#000000"><rect x="33" y="105" width="10" height="10" rx="1"></rect><rect x="26" y="60" width="10" height="10" rx="1"></rect><rect x="41" y="60" width="10" height="10" rx="1"></rect><rect x="56" y="60" width="10" height="10" rx="1"></rect><rect x="71" y="60" width="10" height="10" rx="1"></rect><rect x="86" y="60" width="10" height="10" rx="1"></rect><rect x="101" y="60" width="10" height="10" rx="1"></rect><rect x="116" y="60" width="10" height="10" rx="1"></rect><rect x="108" y="105" width="10" height="10" rx="1"></rect><rect x="33" y="75" width="10" height="10" rx="1"></rect><rect x="48" y="75" width="10" height="10" rx="1"></rect><rect x="63" y="75" width="10" height="10" rx="1"></rect><rect x="78" y="75" width="10" height="10" rx="1"></rect><rect x="93" y="75" width="10" height="10" rx="1"></rect><rect x="108" y="75" width="10" height="10" rx="1"></rect><rect x="41" y="90" width="10" height="10" rx="1"></rect><rect x="26" y="90" width="10" height="10" rx="1"></rect><rect x="56" y="90" width="10" height="10" rx="1"></rect><rect x="71" y="90" width="10" height="10" rx="1"></rect><rect x="86" y="90" width="10" height="10" rx="1"></rect><rect x="101" y="90" width="10" height="10" rx="1"></rect><rect x="116" y="90" width="10" height="10" rx="1"></rect><rect x="48" y="105" width="55" height="10" rx="1"></rect><path d="M20.0056004,51 C18.3456532,51 17.0000001,52.3496496 17.0000001,54.0038284 L17.0000001,85.6824519 L17,120.003453 C17.0000001,121.6584 18.3455253,123 20.0056004,123 L131.9944,123 C133.654347,123 135,121.657592 135,119.997916 L135,54.0020839 C135,52.3440787 133.654475,51 131.9944,51 L20.0056004,51 Z" fill="none" stroke="#000000" stroke-width="2"></path><path d="M52.0410156,36.6054687 L75.5449219,21.6503905 L102.666016,36.6054687" id="Line" stroke="#000000" stroke-width="3" stroke-linecap="round" fill="none"></path></g></svg>',
r.setAttribute("style","position:fixed;right:0;bottom:0;background-color:rgba(128,128,128,0.5);border-radius:5px"),c.parentElement.appendChild(r),r.onmousedown=function(a){c.contentEditable=!0;c.setAttribute("autocomplete","off");c.setAttribute("autocorrect","off");c.setAttribute("autocapitalize","off");c.setAttribute("spellcheck","off");c.focus();a.preventDefault()},r.ontouchstart=r.onmousedown);document.ondragover=function(a){a.preventDefault();A(a)?(a.dataTransfer.dropEffect="copy",k(Squeak.EventDragMove,
a,c,t,x)):a.dataTransfer.dropEffect="none"};document.ondragenter=function(a){A(a)&&k(Squeak.EventDragEnter,a,c,t,x)};document.ondragleave=function(a){A(a)&&k(Squeak.EventDragLeave,a,c,t,x)};document.ondrop=function(a){a.preventDefault();if(!A(a))return!1;var b=[].slice.call(a.dataTransfer.files),h=[],e,l=null;t.droppedFiles=[];b.forEach(function(f){t.droppedFiles.push(f.name);var m=new FileReader;m.onload=function(){var m=this.result;Squeak.filePut(f.name,m);h.push(f.name);e||!/.*image$/.test(f.name)||
t.vm&&!confirm("Run "+f.name+" now?\n(cancel to use as file)")||(e=m,l=f.name);h.length==b.length&&(e?(SqueakJS.appName=l.slice(0,-6),SqueakJS.runImage(e,l,t,d)):k(Squeak.EventDragDrop,a,c,t,x))};m.readAsArrayBuffer(f)});return!1};window.onresize=function(){if(!w.orig){var a=window.innerWidth,b=window.innerHeight;setTimeout(function(){a==window.innerWidth&&b==window.innerHeight&&t.resizeDone()},300);if(d.header&&d.footer||d.fullscreen){var h=d.fullscreen||t.fullscreen,e=h?0:d.header.offsetTop+d.header.offsetHeight,
l=window.innerWidth,h=h?window.innerHeight:Math.max(100,d.footer.offsetTop-e),f=0,m=0;if(d.fixedWidth){t.width=d.fixedWidth;t.height=d.fixedHeight;var u=t.width/t.height;l/h>u?f=l-Math.floor(h*u):m=h-Math.floor(l/u);t.initialScale=(l-f)/t.width}else d.minWidth||(d.minWidth=700),d.minHeight||(d.minHeight=700),u=Math.max(l<d.minWidth?d.minWidth/l:1,h<d.minHeight?d.minHeight/h:1),t.width=Math.floor(l*u),t.height=Math.floor(h*u),t.initialScale=l/t.width;c.style.left=0+Math.floor(f/2)+"px";c.style.top=
e+Math.floor(m/2)+"px";c.style.width=l-f+"px";c.style.height=h-m+"px";if(c.width!=t.width||c.height!=t.height)e=(d.fixedWidth||!t.resizeTodo)&&t.context.getImageData(0,0,c.width,c.height),c.width=t.width,c.height=t.height,e&&t.context.putImageData(e,0,0);t.cursorCanvas&&d.fixedWidth&&(e=t.cursorCanvas,u=c.offsetWidth/c.width,e.style.width=e.width*u+"px",e.style.height=e.height*u+"px")}else t.width=c.width,t.height=c.height}};window.onresize();return t}function p(a,b){var c=b.spinner;if(!c)return null;
c.onmousedown=function(b){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(a.interruptPending=!0)};return c.style}function B(a){var b=(location.hash||location.search).slice(1);if(b=b&&b.split("&"))for(var c=0;c<b.length;c++){var d=b[c].split("="),h=d[0],e=!0;if(1<d.length&&(e=decodeURIComponent(d.slice(1).join("=")),e.match(/^(true|false|null|[0-9"[{].*)$/)))try{e=JSON.parse(e)}catch(l){"["===e[0]&&(e=e.slice(1,-1).split(","))}a[h]=e}b=Squeak.splitFilePath(a.root||"/").fullname;Squeak.dirCreate(b,
!0);/\/$/.test(b)||(b+="/");a.root=b;SqueakJS.options=a}function y(a){if(a.templates){if(a.templates.constructor===Array){var b={};a.templates.forEach(function(a){b[a]=a});a.templates=b}for(var c in a.templates)Squeak.fetchTemplateDir("/"==c[0]?c:a.root+c,a.templates[c])}}function r(a,b,c,d){Squeak.filePut(c.root+a.name,a.data,function(){console.log("Stored "+c.root+a.name);a.zip?m(a,b,c,d):d()})}function m(a,b,c,d){JSZip().loadAsync(a.data).then(function(h){var e=[];h.forEach(function(h){!c.image.name&&
h.match(/\.image$/)&&(c.image.name=h);if(c.forceDownload||!Squeak.fileExists(c.root+h))e.push(h);else if(c.image.name===h){var l=d;d=function(){Squeak.fileGet(c.root+h,function(a){c.image.data=a;return l()},function(){Squeak.fileDelete(c.root+a.name);return m(a,b,c,l)})}}});if(0===e.length)return d();var l=0;b.showBanner("Unzipping "+a.name);b.showProgress(0);e.forEach(function(f){console.log("Inflating "+a.name+": "+f);h.file(f).async("arraybuffer",function(a){b.showProgress((a.percent/100+l)/e.length)}).then(function(a){console.log("Expanded size of "+
f+": "+a.byteLength);var h={};c.image.name===f&&(h=c.image);h.name=f;h.data=a;r(h,b,c,function(){++l===e.length&&d()})})})})}function h(a,b,c,d,h){if(!Squeak.fileExists(c.root+a.name))return h();a.image||a.zip?Squeak.fileGet(c.root+a.name,function(h){a.data=h;a.zip?m(a,b,c,d):d()},function(){Squeak.fileDelete(c.root+a.name);return h()}):d()}function u(a,b,c,d){b.showBanner("Downloading "+a.name);var h=new XMLHttpRequest;h.open("GET",(c.proxy||"")+a.url);c.ajax&&h.setRequestHeader("X-Requested-With",
"XMLHttpRequest");h.responseType="arraybuffer";h.onprogress=function(a){a.lengthComputable&&b.showProgress(a.loaded/a.total)};h.onload=function(h){if(200==this.status)a.data=this.response,r(a,b,c,d);else this.onerror(this.statusText)};h.onerror=function(b){if(c.proxy)return alert("Failed to download:\n"+a.url);console.warn("Retrying with CORS proxy: "+a.url);b=new XMLHttpRequest;b.open("GET","https://crossorigin.me/"+a.url);c.ajax&&b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.responseType=
h.responseType;b.onprogress=h.onprogress;b.onload=h.onload;b.onerror=function(){alert("Failed to download:\n"+a.url)};b.send()};h.send()}function A(a,b,c,d){function e(){if(0===a.length)return d();var l=a.shift();c.forceDownload||l.forceDownload?u(l,b,c,e):h(l,b,c,function(){e()},function(){u(l,b,c,e)})}e()}var l=window.localStorage;try{l["squeak-foo:"]="bar";if("bar"!==l["squeak-foo:"])throw Error();delete l["squeak-foo:"]}catch(L){l={}}var t=navigator.userAgent.match("AppleWebKit/"),x=0,F=0,w;SqueakJS.runImage=
function(b,c,d,h){window.onbeforeunload=function(a){var b=SqueakJS.appName+" is still running";return a.returnValue=b};window.clearTimeout(w);d.reset();d.clear();d.showBanner("Loading "+SqueakJS.appName);d.showProgress(0);var e=this;window.setTimeout(function(){var f=new Squeak.Image(c);f.readFromBuffer(b,function(){function b(){try{if(d.quitFlag)e.onQuit(m,d,h);else m.interpret(50,function(a){"sleep"==a&&(a=200);if(u){var c=u,h=m,e=500>h.lastTick-d.lastTick;0!==a||e?(c.display="none",F=0):0===F?
F=h.lastTick:1E3<h.lastTick-F&&(c.display="block",x=(x+30)%360,c.webkitTransform=c.transform="rotate("+x+"deg)")}w=window.setTimeout(b,a)})}catch(a){console.error(a),alert(a)}}d.quitFlag=!1;var m=new Squeak.Interpreter(f,d);SqueakJS.vm=m;l.squeakImageName=c;a(h);d.clear();d.showBanner("Starting "+SqueakJS.appName);var u=p(m,h);d.runNow=function(){window.clearTimeout(w);b()};d.runFor=function(a){a=Date.now()+a;do{if(d.quitFlag)break;d.runNow()}while(Date.now()<a)};b()},function(a){d.showProgress(a)})},
0)};SqueakJS.runSqueak=function(a,b,c){B(c);!a&&c.image&&(a=c.image);var h=c.url||a&&a.replace(/[^\/]*$/,"")||"";if(h.match(/^http:/)&&location.protocol.match(/^https/))location.protocol="http";else{y(c);var e=d(b,c),l={url:null,name:null,image:!0,data:null},f=[];a&&(a=Squeak.splitUrl(a,h),l.url=a.full,l.name=a.filename);c.files&&c.files.forEach(function(a){var b=Squeak.splitUrl(a,h);l.name!==a&&(!l.url&&a.match(/\.image$/)?(l.name=b.filename,l.url=b.full):f.push({url:b.full,name:b.filename}))});
c.zip&&("string"===typeof c.zip?[c.zip]:c.zip).forEach(function(a){a=Squeak.splitUrl(a,h);f.push({url:a.full,name:a.filename,zip:!0})});l.url&&f.push(l);c.document&&(a=Squeak.splitUrl(c.document,h),f.push({url:a.full,name:a.filename,forceDownload:!1!==c.forceDownload}),e.documentName=c.root+a.filename);c.image=l;A(f,e,c,function(){Squeak.fsck();var a=c.image;if(!a.name)return alert("could not find an image");if(!a.data)return alert("could not find image "+a.name);SqueakJS.appName=c.appName||a.name.replace(/\.image$/,
"");SqueakJS.runImage(a.data,c.root+a.name,e,c)});return e}};SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0};SqueakJS.onQuit=function(a,b,c){window.onbeforeunload=null;b.vm=null;c.spinner&&(c.spinner.style.display="none");if(c.onQuit)c.onQuit(a,b,c);else b.showBanner(SqueakJS.appName+" stopped.")}});
window.applicationCache&&applicationCache.addEventListener("updateready",function(){confirm((window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS")+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())});module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm;var n=window.localStorage;try{n["squeak-foo:"]="bar";if("bar"!==n["squeak-foo:"])throw Error();delete n["squeak-foo:"]}catch(a){console.warn("localStorage not available, faking"),n={}}Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.9.4",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},"object header",{HeaderTypeMask:3,
HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,
splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,splOb_ExternalObjectsArray:38,
splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},
"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,Stream_array:0,Stream_position:1,
Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,
BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,
EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"error codes",{PrimNoErr:0,PrimErrGenericFailure:1,PrimErrBadReceiver:2,PrimErrBadArgument:3,PrimErrBadIndex:4,PrimErrBadNumArgs:5,PrimErrInappropriate:6,PrimErrUnsupported:7,PrimErrNoModification:8,PrimErrNoMemory:9,PrimErrNoCMemory:10,PrimErrNotFound:11,
PrimErrBadMethod:12,PrimErrNamedInternal:13,PrimErrObjectMayMove:14,PrimErrLimitExceeded:15,PrimErrObjectIsPinned:16,PrimErrWritePastObject:17},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(a,b){this.externalModules[a]=b}},"files",{fsck:function(a,b,c,e){b=b||"";e=e||{dirs:0,files:0,bytes:0,deleted:0};if(!c){c={};for(var g in n){var k=g.match(/squeak-file(\.lz)?:(.*)$/);k&&(c[k[2]]=!0)}if("undefined"!==typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",
function(d){d=d.openCursor();d.onsuccess=function(d){(d=d.target.result)?(c[d.key]=!0,d["continue"]()):Squeak.fsck(a,b,c,e)};d.onerror=function(a){console.error("fsck failed")}})}g=Squeak.dirList(b);for(var f in g){var d=b+"/"+f;g[f][3]?"squeak:"+d in n?(Squeak.fsck(null,d,c,e),e.dirs++):(console.log("Deleting stale directory "+d),Squeak.dirDelete(d),e.deleted++):c[d]?(c[d]=!1,e.files++,e.bytes+=g[f][4]):(console.log("Deleting stale file entry "+d),Squeak.fileDelete(d,!0),e.deleted++)}if(""===b){console.log("squeak fsck: "+
e.dirs+" directories, "+e.files+" files, "+(e.bytes/1E6).toFixed(1)+" MBytes");var p=[];f=0;for(d in c)f++,c[d]&&p.push(d);if(0<p.length){for(d=0;d<p.length;d++)console.log("Deleting orphaned file "+p[d]),delete n["squeak-file:"+p[d]],delete n["squeak-file.lz:"+p[d]],e.deleted++;"undefined"!==typeof indexedDB&&this.dbTransaction("readwrite","fsck delete",function(a){for(var b=0;b<p.length;b++)a["delete"](p[b])})}a&&a(e)}},dbTransaction:function(a,b,c,e){function g(){c(Squeak.dbFake());e&&e()}function k(){var d=
SqueakDB.transaction("files",a),f=d.objectStore("files");d.oncomplete=function(a){e&&e()};d.onerror=function(a){console.error(a.target.error.name+": "+b)};d.onabort=function(a){console.error(a.target.error.name+": aborting "+b);c(Squeak.dbFake());e&&e()};c(f)}if("undefined"==typeof indexedDB)return g();if(window.SqueakDB)return k();var f=indexedDB.open("squeak");if(!f)return g();f.onsuccess=function(a){console.log("Opened files database.");window.SqueakDB=this.result;SqueakDB.onversionchange=function(a){delete window.SqueakDB;
this.close()};SqueakDB.onerror=function(a){console.error("Error accessing database: "+a.target.error.name)};k()};f.onupgradeneeded=function(a){console.log("Creating files database");a.target.result.createObjectStore("files")};f.onerror=function(a){console.error(a.target.error.name+": cannot open files database");console.warn("Falling back to local storage");g()};f.onblocked=function(a){console.log("Database upgrade needed, but was blocked.");console.warn("Falling back to local storage");g()}},dbFake:function(){"undefined"==
typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1E5,get:function(a){var b=SqueakDBFake.bigFiles[a];if(!b){var c=n["squeak-file:"+a];if(!c){var e=n["squeak-file.lz:"+a];e&&("object"==typeof LZString?c=LZString.decompressFromUTF16(e):console.error("LZString not loaded: cannot decompress "+a))}if(c){a=new Uint8Array(c.length);for(b=0;b<a.length;b++)a[b]=c.charCodeAt(b)&255;
b=a.buffer}}var g={result:b};setTimeout(function(){if(g.onsuccess)g.onsuccess({target:g})},0);return g},put:function(a,b){if(a.byteLength>SqueakDBFake.bigFileThreshold)SqueakDBFake.bigFiles[b]||console.log("File "+b+" ("+a.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[b]=a;else{var c=Squeak.bytesAsString(new Uint8Array(a));"object"==typeof LZString?(c=LZString.compressToUTF16(c),n["squeak-file.lz:"+b]=c,delete n["squeak-file:"+b]):n["squeak-file:"+b]=c}var e={};setTimeout(function(){if(e.onsuccess)e.onsuccess()},
0);return e},"delete":function(a){delete n["squeak-file:"+a];delete n["squeak-file.lz:"+a];delete SqueakDBFake.bigFiles[a];var b={};setTimeout(function(){if(b.onsuccess)b.onsuccess()},0);return b},openCursor:function(){var a={};setTimeout(function(){if(a.onsuccess)a.onsuccess({target:a})},0);return a}});return SqueakDBFake},fileGet:function(a,b,c){c||(c=function(a){console.log(a)});var e=this.splitFilePath(a);if(!e.basename)return c("Invalid path: "+a);if(window.SqueakDBFake&&SqueakDBFake.bigFiles[e.fullname])return b(SqueakDBFake.bigFiles[e.fullname]);
this.dbTransaction("readonly","get "+a,function(a){a=a.get(e.fullname);a.onerror=function(a){c(a.target.error.name)};a.onsuccess=function(a){if(void 0!==this.result)return b(this.result);Squeak.fetchTemplateFile(e.fullname,function(a){b(a)},function(){if("undefined"==typeof indexedDB)return c("file not found: "+e.fullname);var a=Squeak.dbFake().get(e.fullname);a.onerror=function(a){c("file not found: "+e.fullname)};a.onsuccess=function(a){b(this.result)}})}})},filePut:function(a,b,c){var e=this.splitFilePath(a);
if(!e.basename)return null;var g=this.dirList(e.dirname);if(!g)return null;var k=g[e.basename],f=this.totalSeconds();if(!k)k=[e.basename,f,0,!1,0],g[e.basename]=k;else if(k[3])return null;k[2]=f;k[4]=b.byteLength||b.length||0;n["squeak:"+e.dirname]=JSON.stringify(g);this.dbTransaction("readwrite","put "+a,function(a){a.put(b,e.fullname)},function(){c&&c()});return k},fileDelete:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;var e=this.dirList(c.dirname);if(!e)return!1;var g=e[c.basename];
if(!g||g[3])return!1;delete e[c.basename];n["squeak:"+c.dirname]=JSON.stringify(e);if(b)return!0;this.dbTransaction("readwrite","delete "+a,function(a){a["delete"](c.fullname)});return!0},fileRename:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;var e=this.splitFilePath(b);if(!e.basename)return!1;var g=this.dirList(c.dirname);if(!g)return!1;var k=g[c.basename];if(!k||k[3])return!1;var f=c.dirname==e.dirname,d=f?g:this.dirList(e.dirname);if(!d||d[e.basename])return!1;delete g[c.basename];
k[0]=e.basename;d[e.basename]=k;n["squeak:"+e.dirname]=JSON.stringify(d);f||(n["squeak:"+c.dirname]=JSON.stringify(g));this.fileGet(c.fullname,function(a){this.dbTransaction("readwrite","rename "+c.fullname+" to "+e.fullname,function(b){b["delete"](c.fullname);b.put(a,e.fullname)})}.bind(this),function(a){console.log("File rename failed: "+a)}.bind(this));return!0},fileExists:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b)return!1;a=b[a.basename];return!a||
a[3]?!1:!0},dirCreate:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;b&&!n["squeak:"+c.dirname]&&Squeak.dirCreate(c.dirname,!0);var e=this.dirList(c.dirname);if(!e||e[c.basename])return!1;var g=this.totalSeconds();e[c.basename]=[c.basename,g,g,!0,0];n["squeak:"+c.fullname]=JSON.stringify({});n["squeak:"+c.dirname]=JSON.stringify(e);return!0},dirDelete:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b||!b[a.basename])return!1;var c=this.dirList(a.fullname);
if(!c)return!1;for(var e in c)return!1;delete b[a.basename];n["squeak:"+a.dirname]=JSON.stringify(b);delete n["squeak:"+a.fullname];return!0},dirList:function(a,b){function c(a,b){for(var c in b)if(b.hasOwnProperty(c)){var e=b[c];a[e[0]]=e}}var e=this.splitFilePath(a),g=n["squeak:"+e.fullname],k=b&&n["squeak-template:"+e.fullname];return g||k?(e={},k&&c(e,JSON.parse(k).entries),g&&c(e,JSON.parse(g)),e):"/"==e.fullname?{}:null},splitFilePath:function(a){"/"!==a[0]&&(a="/"+a);a=a.replace(/\/\//g,"/");
var b=a.match(/(.*)\/(.*)/);return{fullname:a,dirname:b[1]?b[1]:"/",basename:b[2]?b[2]:null}},splitUrl:function(a,b){var c=a.match(/(.*\/)?(.*)/),e=c[1]?c[1]:"",c=c[2]?c[2]:null;e||(b&&!b.match(/\/$/)&&(b+="/"),e=b||"",a=e+c);return{full:a,uptoslash:e,filename:c}},flushFile:function(a){if(a.modified){var b=a.contents.buffer;b.byteLength!==a.size&&(b=new ArrayBuffer(a.size),(new Uint8Array(b)).set(a.contents.subarray(0,a.size)));Squeak.filePut(a.name,b);a.modified=!1}},flushAllFiles:function(){if("undefined"!=
typeof SqueakFiles)for(var a in SqueakFiles)this.flushFile(SqueakFiles[a])},closeAllFiles:function(){Squeak.flushAllFiles();delete window.SqueakFiles},fetchTemplateDir:function(a,b){function c(a){var b=Squeak.splitFilePath(a);"/"!==b.dirname&&c(b.dirname);a=JSON.parse(n["squeak-template:"+b.dirname]||'{"entries": {}}');if(!a.entries[b.basename]){var e=Squeak.totalSeconds();a.entries[b.basename]=[b.basename,e,e,!0,0];n["squeak-template:"+b.dirname]=JSON.stringify(a)}}function e(a,b){var c=JSON.parse(n["squeak-template:"+
a]),e;for(e in c.entries){var g=c.entries[e];g[3]&&Squeak.fetchTemplateDir(a+"/"+g[0],b+"/"+g[0])}}a=Squeak.splitFilePath(a).fullname;if(n["squeak-template:"+a])e(a,b);else{var g=b+"/sqindex.json",k=new XMLHttpRequest;k.open("GET",g,!0);k.onload=function(f){if(200==k.status){console.log("adding template "+a);c(a);f=JSON.parse(k.response);var d={url:b,entries:{}},g;for(g in f){var B=f[g];d.entries[B[0]]=B}n["squeak-template:"+a]=JSON.stringify(d);e(a,b)}else k.onerror(k.statusText)};k.onerror=function(a){console.log("cannot load template index "+
g)};k.send()}},fetchTemplateFile:function(a,b,c){a=Squeak.splitFilePath(a);var e=n["squeak-template:"+a.dirname];if(!e)return c();var g=JSON.parse(e).url;if(!g)return c();g+="/"+a.basename;e=new XMLHttpRequest;e.open("get",g,!0);e.responseType="arraybuffer";e.timeout=3E4;e.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var e=this.response;console.log("Got "+e.byteLength+" bytes from "+g);Squeak.dirCreate(a.dirname,!0);Squeak.filePut(a.fullname,e);b(e)}else alert("Download failed ("+
this.status+") "+g),c()};console.log("Fetching "+g);e.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioOutContext=a&&new a}return this.audioOutContext},startAudioIn:function(a,b){if(this.audioInContext)return this.audioInSource.disconnect(),a(this.audioInContext,this.audioInSource);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia;if(!navigator.getUserMedia)return b("test: audio input not supported");navigator.getUserMedia({audio:!0,toString:function(){return"audio"}},function(b){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=e&&new e;this.audioInSource=this.audioInContext.createMediaStreamSource(b);a(this.audioInContext,this.audioInSource)},function(){b("cannot access microphone")})},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},
"time",{Epoch:Date.UTC(1901,0,1)+6E4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1E3)}},"utils",{bytesAsString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}});Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(a){this.totalMemory=1E8;this.name=a;this.newSpaceCount=this.youngSpaceCount=this.oldSpaceCount=this.allocationCount=
this.gcTenured=this.pgcMilliseconds=this.pgcCount=this.gcMilliseconds=this.gcCount=0;this.hasNewInstances={}},readFromBuffer:function(a,b,c){function e(){if(W){for(var a=Q+(oa.oldSpaceCount/20|0);W&&Q<a;)W.installFromImage(x,F,O,X,f,h),W=W.nextObject,Q++;c&&c(Q/oa.oldSpaceCount);return!0}oa.specialObjectsArray=M;oa.decorateKnownObjects();oa.isSpur?oa.fixSkippedOops(J):(oa.fixCompiledMethods(),oa.fixCompactOops());return!1}function g(){e()?window.setTimeout(g,0):b&&b()}console.log("squeak: reading "+
this.name+" ("+a.byteLength+" bytes)");this.startupTime=Date.now();for(var k=new DataView(a),f=!1,d=0,p=function(){var a=k.getUint32(d,f);d+=4;return a},n=function(b,c){if(c){for(var h=[];h.length<b;)h.push(p());return h}h=new Uint32Array(a,d,b);d+=4*b;return h},y=[6501,6502,6504,6505,6521,68E3,68002,68003,68021],r=0,m=0;;){f=!f;d=m;r=p();if(0<=y.indexOf(r))break;f||(m+=512);if(512<m)throw Error("bad image version");}this.version=r;var h=0<=[6505,6521,68003,68021].indexOf(r);this.hasClosures=0<=[6504,
6505,6521,68002,68003,68021].indexOf(r);this.isSpur=0<=[6521,68021].indexOf(r);if(68E3<=r)throw Error("64 bit images not supported yet");var u=p(),A=p(),y=p(),r=p();this.lastHash=p();this.savedHeaderWords=[];for(var l=0;6>l;l++)this.savedHeaderWords.push(p());var l=p(),t,x={},F={},d=m+=u;if(this.isSpur){this.oldSpaceBytes=l-16;for(var A=d+l,u=0,w=l=null,L=0,J={};d<A;){for(;d<A-16;){var E=d,I=p(),H=p(),C=H>>>24;255===C&&(C=I,I=p(),H=p());var D=u+d-8-m,v=I>>>24&31,N=I&4194303,H=H&4194303,I=n(C,10>v&&
0<N),d=d+4*(2>C?2-C:C&1);32<=N?(P=new Squeak.ObjectSpur,P.initFromImage(D,N,v,H),t&&(t.nextObject=P),this.oldSpaceCount++,t=P,x[y+D]=P,F[D]=I,J[D]=L):(L+=d-E,l?w||(w=I):l=I,N&&(x[y+D]=I))}if(d!==A-16)throw Error("invalid segment");v=p();H=p();D=p();p();0!==D&&(v=H&4278190080?4*(v&16777215):0,A+=D,u+=v,L+=16+v,this.oldSpaceBytes+=v+D)}this.oldSpaceBytes-=L;this.firstOldObject=x[y];this.lastOldObject=P}else{for(;d<m+A;){u=P=0;l=p();switch(l&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:P=
l>>>2;u=p();l=p();break;case Squeak.HeaderTypeClass:u=l-Squeak.HeaderTypeClass;l=p();P=l>>>2&63;break;case Squeak.HeaderTypeShort:P=l>>>2&63;u=l>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");}P--;var D=d-4-m,v=l>>>8&15,H=l>>>17&4095,I=n(P,5>v),P=new Squeak.Object;P.initFromImage(D,u,v,H);32>u&&(P.hash|=268435456);t&&(t.nextObject=P);this.oldSpaceCount++;t=P;x[y+D]=P;F[D]=I}this.firstOldObject=x[y+4];this.lastOldObject=P;this.oldSpaceBytes=A}t=x[r];n=this.isSpur?this.spurClassTable(x,
F,w,t):F[x[F[t.oop][Squeak.splOb_CompactClasses]].oop];m=null;P=this.firstOldObject;for(t=null;P;)t=m,m=P.renameFromImage(x,F,n),t?t.nextObject=m:this.firstOldObject=m,x[y+P.oop]=m,P=P.nextObject;this.lastOldObject=m;var M=x[r],O=F[x[F[M.oop][Squeak.splOb_CompactClasses]].oop],X=x[F[M.oop][Squeak.splOb_ClassFloat]];this.isSpur&&(this.initCharacterTable(x[F[M.oop][Squeak.splOb_ClassCharacter]]),O=this.spurClassTable(x,F,w,M),h=this.getCharacter.bind(this),this.initSpurOverrides());var W=this.firstOldObject,
Q=0,oa=this;if(c)window.setTimeout(g,0);else{for(;e(););b&&b()}},decorateKnownObjects:function(){var a=this.specialObjectsArray.pointers;a[Squeak.splOb_NilObject].isNil=!0;a[Squeak.splOb_TrueObject].isTrue=!0;a[Squeak.splOb_FalseObject].isFalse=!0;a[Squeak.splOb_ClassFloat].isFloatClass=!0;if(!this.isSpur)for(this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,a=0;a<this.compactClasses.length;a++)this.compactClasses[a].isNil||(this.compactClasses[a].isCompact=
!0);Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var a=this.firstOldObject,b=0;a;){var c=268435455<a.hash;if(c!==!!a.sqClass.isCompact){var e=0===a.snapshotSize().header;c!==e&&(b+=e?-4:4)}a.hash&=268435455;a.oop+=b;a=a.nextObject}this.oldSpaceBytes+=b}},fixCompiledMethods:function(){if(!(6502<=this.version))for(var a=this.firstOldObject,b=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];a;)a.isMethod()&&
(a.sqClass=b),a=a.nextObject},fixSkippedOops:function(a){for(var b=this.firstOldObject;b;)b.oop-=a[b.oop],b=b.nextObject;b=this.lastOldObject;if(b.addr()+b.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes");}},"garbage collection - full",{fullGC:function(a){this.vm.addMessage("fullGC: "+a);var b=Date.now(),c=this.markReachableObjects();this.removeUnmarkedOldObjects();this.appendToOldObjects(c);this.finalizeWeakReferences();this.allocationCount+=this.newSpaceCount;
this.youngSpaceCount=this.newSpaceCount=0;this.hasNewInstances={};this.gcCount++;this.gcMilliseconds+=Date.now()-b;console.log("Full GC ("+a+"): "+(Date.now()-b)+" ms");return 0<c.length?c[0]:null},gcRoots:function(){this.vm.storeContextRegisters();return[this.specialObjectsArray,this.vm.activeContext]},markReachableObjects:function(){var a=this.gcRoots(),b=[];for(this.weakObjects=[];0<a.length;){var c=a.pop();if(!c.mark){0>c.oop&&b.push(c);c.mark=!0;c.sqClass.mark||a.push(c.sqClass);var e=c.pointers;
if(e){var g=e.length;c.isWeak()&&(g=c.sqClass.classInstSize(),this.weakObjects.push(c));if(this.vm.isContext(c))for(c=g=c.contextSizeWithStack();c<e.length;c++)e[c]=this.vm.nilObj;for(c=0;c<g;c++)"object"!==typeof e[c]||e[c].mark||a.push(e[c])}}}return this.isSpur?b:b.sort(function(a,b){return b.oop-a.oop})},removeUnmarkedOldObjects:function(){var a=0,b=0,c=this.firstOldObject;for(c.mark=!1;;){var e=c.nextObject;if(!e){this.lastOldObject=c;this.oldSpaceBytes-=b;this.oldSpaceCount-=a;break}e.dirty&&
(e.dirty=!1);e.mark?(c=e,c.mark=!1,c.oop-=b):(c.nextObject=e.nextObject,e.oop=-++this.newSpaceCount,b+=e.totalBytes(),a++)}},appendToOldObjects:function(a){for(var b=this.lastOldObject,c=0;c<a.length;c++){var e=a[c];e.mark=!1;this.oldSpaceBytes=e.setAddr(this.oldSpaceBytes);b=b.nextObject=e}b.nextObject=null;this.lastOldObject=b;this.oldSpaceCount+=a.length;this.gcTenured+=a.length},tenureIfYoung:function(a){0>a.oop&&this.appendToOldObjects([a])},finalizeWeakReferences:function(){var a=this.weakObjects;
this.weakObjects=null;for(var b=0;b<a.length;b++){for(var c=a[b],e=c.pointers,g=c.sqClass.classInstSize(),k=!1,f=g;f<e.length;f++)0>e[f].oop&&(e[f]=this.vm.nilObj,k=!0);k&&(this.vm.pendingFinalizationSignals++,2<=g&&(e=c.pointers[Squeak.WeakFinalizerItem_list],e.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]&&(c.pointers[Squeak.WeakFinalizerItem_next]=e.pointers[Squeak.WeakFinalizationList_first],e.pointers[Squeak.WeakFinalizationList_first]=c)))}0<this.vm.pendingFinalizationSignals&&
this.vm.forceInterruptCheck()}},"garbage collection - partial",{partialGC:function(a){this.vm.addMessage("partialGC: "+a);var b=Date.now(),c=this.findYoungObjects();this.appendToYoungSpace(c);this.finalizeWeakReferences();this.cleanupYoungSpace(c);this.allocationCount+=this.newSpaceCount-c.length;this.newSpaceCount=this.youngSpaceCount=c.length;this.hasNewInstances={};this.pgcCount++;this.pgcMilliseconds+=Date.now()-b;console.log("Partial GC ("+a+"): "+(Date.now()-b)+" ms");return c[0]},youngRoots:function(){for(var a=
this.gcRoots().filter(function(a){return 0>a.oop}),b=this.firstOldObject;b;){if(b.dirty){for(var c=b.pointers,e=!1,g=0;g<c.length;g++){var k=c[g];"object"===typeof k&&0>k.oop&&(a.push(k),e=!0)}b.dirty=e}b=b.nextObject}return a},findYoungObjects:function(){var a=this.youngRoots(),b=[];for(this.weakObjects=[];0<a.length;){var c=a.pop();if(!c.mark){b.push(c);c.mark=!0;0>c.sqClass.oop&&a.push(c.sqClass);var e=c.pointers;if(e){var g=e.length;c.isWeak()&&(g=c.sqClass.classInstSize(),this.weakObjects.push(c));
if(this.vm.isContext(c))for(c=g=c.contextSizeWithStack();c<e.length;c++)e[c]=this.vm.nilObj;for(c=0;c<g;c++){var k=e[c];"object"===typeof k&&0>k.oop&&a.push(e[c])}}}}return this.isSpur?b:b.sort(function(a,b){return b.oop-a.oop})},appendToYoungSpace:function(a){for(var b=this.lastOldObject.oop,c=0;c<a.length;c++){var e=a[c];e.oop=++b;e.nextObject=a[c+1]}},cleanupYoungSpace:function(a){a=a[0];for(var b=0;a;)a.oop=--b,a.mark=!1,a=a.nextObject}},"creating",{registerObject:function(a){a.oop=-++this.newSpaceCount;
this.lastHash=13849+27181*this.lastHash&4294967295;return this.lastHash&4095},registerObjectSpur:function(a){a.oop=-++this.newSpaceCount;return 0},instantiateClass:function(a,b,c){var e=new (a.classInstProto()),g=this.registerObject(e);e.initInstanceOf(a,b,g,c);this.hasNewInstances[a.oop]=!0;return e},clone:function(a){var b=new (a.sqClass.classInstProto()),c=this.registerObject(b);b.initAsClone(a,c);this.hasNewInstances[b.sqClass.oop]=!0;return b}},"operations",{bulkBecome:function(a,b,c,e){if(!a)return!b;
var g=a.length;if(g!==b.length)return!1;var k=null;0<this.newSpaceCount?k=this.partialGC("become"):this.vm.storeContextRegisters();for(var f={},d=0;d<g;d++){var p=a[d];if(!p.sqClass||f[p.oop])return!1;f[p.oop]=b[d]}if(c)for(d=0;d<g;d++){p=b[d];if(!p.sqClass||f[p.oop])return!1;f[p.oop]=a[d]}if(e)for(d=0;d<g;d++){if(!b[d].sqClass)return!1;p=a[d].hash;a[d].hash=b[d].hash;b[d].hash=p}this.lastOldObject.nextObject=k;for(p=this.firstOldObject;p;){if(a=f[p.sqClass.oop])p.sqClass=a;if(b=p.pointers)for(g=
0;g<b.length;g++)(a=f[b[g].oop])&&(b[g]=a);p=p.nextObject}this.lastOldObject.nextObject=null;this.vm.flushMethodCacheAfterBecome(f);return!0},objectAfter:function(a){return a.nextObject||this.nextObjectWithGC("nextObject",a)},someInstanceOf:function(a){for(var b=this.firstOldObject;b;){if(b.sqClass===a)return b;b=b.nextObject||this.nextObjectWithGCFor(b,a)}return null},nextInstanceAfter:function(a){for(var b=a.sqClass;;){a=a.nextObject||this.nextObjectWithGCFor(a,b);if(!a)return null;if(a.sqClass===
b)return a}},nextObjectWithGC:function(a,b){if(this.newSpaceCount<=(0<b.oop?0:this.youngSpaceCount))return null;0>b.oop&&console.warn("nextObject called on new object (might visit multiple times)");return this.partialGC(a)},nextObjectWithGCFor:function(a,b){return 0!==this.newSpaceCount&&this.hasNewInstances[b.oop]?this.nextObjectWithGC("instance of "+b.className(),a):null},allInstancesOf:function(a){for(var b=this.firstOldObject,c=[];b;)b.sqClass===a&&c.push(b),b=b.nextObject||this.nextObjectWithGCFor(b,
a);return c},writeToBuffer:function(){var a=new DataView(new ArrayBuffer(64+this.oldSpaceBytes)),b=0,c=function(c){a.setUint32(b,c);b+=4};c(this.formatVersion());c(64);c(this.oldSpaceBytes);c(this.firstOldObject.addr());c(this.objectToOop(this.specialObjectsArray));c(this.lastHash);for(c(52429400);64>b;)c(0);for(var c=this.firstOldObject,e=0;c;)b=c.writeTo(a,b,this),c=c.nextObject,e++;if(b!==a.byteLength)throw Error("wrong image size");if(e!==this.oldSpaceCount)throw Error("wrong object count");return a.buffer},
objectToOop:function(a){if("number"===typeof a)return a<<1|1;if(0>a.oop)throw Error("temporary oop");return a.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var a=new Uint32Array(this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand].bytes.buffer,0,1);return this.formatVersion()|a[0]&4278190080},loadImageSegment:function(a,b){var c=new DataView(a.words.buffer),
e=!1,g=0,k=function(){var a=c.getUint32(g,e);g+=4;return a},f=function(a,b){if(5>b){for(var d=[];d.length<a;)d.push(k());return d}d=new Uint32Array(c.buffer,g,a);g+=4*a;return d},d=k();if(d&1&&(e=!0,g=0,d=k(),d&1))return console.error("image segment format not supported"),null;this.tenureIfYoung(a);for(var p=a,d=p.nextObject,n=a.oop,y={},r={};g<c.byteLength;){var m=0,h=0,u=k();switch(u&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:m=u>>>2;h=k();u=k();break;case Squeak.HeaderTypeClass:h=
u-Squeak.HeaderTypeClass;u=k();m=u>>>2&63;break;case Squeak.HeaderTypeShort:m=u>>>2&63;h=u>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");}m--;var A=g,l=u>>>8&15,u=u>>>17&4095,t=f(m,l),m=new Squeak.Object;m.initFromImage(A+n,h,l,u);p.nextObject=m;this.oldSpaceCount++;p=m;y[A]=m;r[A+n]=t}m.nextObject=d;for(f=0;f<b.pointers.length;f++)y[2147483652+4*f]=b.pointers[f];var x=0,f=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers.map(function(a){y[--x]=
a;return x});a.words=new Uint32Array([a.words[0]]);p=a.nextObject;n=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat];h=p;do h.installFromImage(y,r,f,n,e,!1),h=h.nextObject;while(h!==d);return p}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur;this.writeToBuffer=this.writeToBufferSpur},spurClassTable:function(a,b,c,e){for(var g={},k=this.firstOldObject,f=0;4096>f;f++){var d=a[c[f]];d.oop&&(d=b[d.oop]);if(1024===d.length)for(var p=0;1024>p;p++){var n=
a[d[p]];if(!n)throw Error("Invalid class table entry (oop "+d[p]+")");if(n!==k){var y=1024*f+p;g[y]=n}}}for(var r in Squeak)/^splOb_Class/.test(r)&&(c=a[b[e.oop][Squeak[r]]],c!==k&&(y=c.hash,0<y&&1024>y&&(g[y]=c)));g[3]=g[1];this.classTable=g;this.classTableIndex=1024;return g},enterIntoClassTable:function(a){for(var b=this.classTableIndex,c=this.classTable;4194303>=b;){if(!c[b])return c[b]=a,this.classTableIndex=a.hash=b;b++}console.error("class table full?");return null},initCharacterTable:function(a){a.classInstProto("Character");
this.characterClass=a;this.characterTable={}},getCharacter:function(a){var b=this.characterTable[a];b||(b=new this.characterClass.instProto,b.initInstanceOfChar(this.characterClass,a),this.characterTable[a]=b);return b},maxClassIndex:function(){var a=1024,b=this.classTable,c;for(c in b){var e=b[c].hash;e>a&&(a=e)}return a},classTableBytes:function(){return 4*(4108+1028*((this.maxClassIndex()>>10)+1))},writeFreeLists:function(a,b,c,e){a.setUint32(b,167772178,c);b+=4;a.setUint32(b,536870912,c);return b+
4+128},writeClassTable:function(a,b,c,e){var g=(this.maxClassIndex()>>10)+1;a.setUint32(b,4104,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;for(var k=0;k<g;k++)a.setUint32(b,16624+4112*k,c),b+=4;b+=4*(4104-g);for(var f=0,k=0;k<g;k++){a.setUint32(b,1024,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;for(var d=0;1024>d;d++){var p=this.classTable[f];if(p&&p.pointers){if(!p.hash)throw Error("class without id");
p.hash!==f&&32<=f&&(console.warn("freeing class index "+f+" "+p.className()),p=null)}p&&a.setUint32(b,e(p),c);b+=4;f++}}return b},writeToBufferSpur:function(){function a(a){e.setUint32(k,a,!0);k+=4}function b(a){if("number"===typeof a)return a<<1|1;if(7===a._format){if(a.hash!==a.oop>>2||2!==(a.oop&3))throw Error("Bad immediate char");return a.oop}if(0>a.oop)throw Error("temporary oop");return 48>a.oop?a.oop:a.oop+c}var c=136+this.classTableBytes(),e=new DataView(new ArrayBuffer(64+c+this.oldSpaceBytes+
16)),g=Date.now(),k=0;a(this.formatVersion());a(64);a(c+this.oldSpaceBytes+16);a(this.firstOldObject.addr());a(b(this.specialObjectsArray));a(this.lastHash);this.savedHeaderWords.forEach(a);for(a(c+this.oldSpaceBytes+16);64>k;)a(0);var f=this.firstOldObject,d=0,k=f.writeTo(e,k,!0,b),f=f.nextObject;d++;k=f.writeTo(e,k,!0,b);f=f.nextObject;d++;k=f.writeTo(e,k,!0,b);f=f.nextObject;d++;k=this.writeFreeLists(e,k,!0,b);for(k=this.writeClassTable(e,k,!0,b);f;)k=f.writeTo(e,k,!0,b),f=f.nextObject,d++;a(1241513987);
a(8388608);a(0);a(0);if(k!==e.byteLength)throw Error("wrong image size");if(d!==this.oldSpaceCount)throw Error("wrong object count");g=Date.now()-g;console.log("Wrote "+d+" objects in "+g+" ms, image size "+k+" bytes");return e.buffer}});Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;c=a.pointers[Squeak.Class_format];var g=(c>>1&63)+(c>>10&192)-1;this._format=c>>7&15;8>this._format?6!=this._format?0<g+b&&(this.pointers=this.fillArray(g+
b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this["float"]=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},initAsClone:function(a,b){this.sqClass=a.sqClass;this.hash=b;this._format=a._format;a.isFloat?(this.isFloat=a.isFloat,this["float"]=a["float"]):(a.pointers&&(this.pointers=a.pointers.slice(0)),a.words&&(this.words=new Uint32Array(a.words)),a.bytes&&(this.bytes=new Uint8Array(a.bytes)))},initFromImage:function(a,b,c,e){this.oop=a;this.sqClass=b;this._format=c;this.hash=e},
classNameFromImage:function(a,b){var c=a[b[this.oop][Squeak.Class_name]];if(c&&8<=c._format&&12>c._format){var e=b[c.oop],c=c.decodeBytes(e.length,e,0,c._format&3);return Squeak.bytesAsString(c)}return"Class"},renameFromImage:function(a,b,c){c=32>this.sqClass?a[c[this.sqClass-1]]:a[this.sqClass];if(!c)return this;a=c.instProto||c.classInstProto(c.classNameFromImage(a,b));if(!a)return this;a=new a;a.oop=this.oop;a.sqClass=this.sqClass;a._format=this._format;a.hash=this.hash;return a},installFromImage:function(a,
b,c,e,g,k){var f=this.sqClass;this.sqClass=0<f&&32>f?a[c[f-1]]:a[f];b=b[this.oop];c=b.length;if(5>this._format)0<c&&(this.pointers=this.decodePointers(c,b,a));else if(12<=this._format)e=this.decodeWords(1,b,g)[0]>>10&255,g=this.decodeWords(e+1,b,g),this.pointers=this.decodePointers(e+1,g,a),this.bytes=this.decodeBytes(c-(e+1),b,e+1,this._format&3);else if(8<=this._format)0<c&&(this.bytes=this.decodeBytes(c,b,0,this._format&3));else if(this.sqClass==e){if(this.isFloat=!0,this["float"]=this.decodeFloat(b,
g,k),1.3797216632888E-310==this["float"]&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this["float"]=this.decodeFloat(b,g,k),1.3797216632888E-310==this["float"]))throw Error("Cannot deoptimize decodeFloat");}else 0<c&&(this.words=this.decodeWords(c,b,g));this.mark=!1},decodePointers:function(a,b,c){for(var e=Array(a),g=0;g<a;g++){var k=b[g];e[g]=1===(k&1)?k>>1:c[k]||42424242}return e},decodeWords:function(a,b,c){b=new DataView(b.buffer,
b.byteOffset);for(var e=new Uint32Array(a),g=0;g<a;g++)e[g]=b.getUint32(4*g,c);return e},decodeBytes:function(a,b,c,e){a=4*a-e;b=new Uint8Array(b.buffer,b.byteOffset+4*c,a);c=new Uint8Array(a);c.set(b);return c},decodeFloat:function(a,b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=new DataView(b);b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},decodeFloatDeoptimized:function(a,
b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=new DataView(b);b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},fillArray:function(a,b){for(var c=[],e=0;e<a;e++)c[e]=b;return c}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var a=this._format;return 8<=a&&11>=a},isWordsOrBytes:function(){var a=this._format;return 6==a||8<=a&&11>=a},isPointers:function(){return 4>=
this._format},isWeak:function(){return 4===this._format},isMethod:function(){return 12<=this._format},sameFormats:function(a,b){return 8>a?a===b:(a&12)===(b&12)},sameFormatAs:function(a){return this.sameFormats(this._format,a._format)}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(a){if(!this.bytes)return"";for(var b=[],c=0,e=this.bytes.length-1;0<=e;e--)b.push("0123456789ABCDEF"[this.bytes[e]>>
4]),b.push("0123456789ABCDEF"[this.bytes[e]&15]),c=256*c+this.bytes[e];a=a?"-":"";e=9007199254740991<c?"\u2248":"";return a+"16r"+b.join("")+" ("+e+a+c+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(a){var b=this.instSize();return a<=b?this.sqClass.allInstVarNames()[a-1]:(a-b).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var a=this["float"].toString();
/\./.test(a)||(a+=".0");return a}a=this.sqClass.className();if(/ /.test(a))return"the "+a;switch(a){case "String":case "ByteString":return"'"+this.bytesAsString()+"'";case "Symbol":case "ByteSymbol":return"#"+this.bytesAsString();case "Point":return this.pointers.join("@");case "Rectangle":return this.pointers.join(" corner: ");case "Association":case "ReadOnlyVariableBinding":return this.pointers.join("->");case "LargePositiveInteger":return this.bytesAsNumberString(!1);case "LargeNegativeInteger":return this.bytesAsNumberString(!0);
case "Character":return a=this.pointers?this.pointers[0]:this.hash,"$"+String.fromCharCode(a)+" ("+a.toString()+")"}return/^[aeiou]/i.test(a)?"an"+a:"a"+a}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){var a=this._format;return 4<a||2===a?0:2>a?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=
this._format;return 2>b?-1:3===b&&a.vm.isContext(this)&&!a.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():8>b?this.wordsSize():12>b?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var a=new ArrayBuffer(8),a=new DataView(a);a.setFloat64(0,this["float"],!1);return a},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||
this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=
new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null},setAddr:function(a){var b=this.snapshotSize();this.oop=a+4*b.header;return a+4*(b.header+b.body)},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);a++;return{header:63<a?2:this.sqClass.isCompact?
0:1,body:a}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var a=this.snapshotSize();return 4*(a.header+a.body)},writeTo:function(a,b,c){this.bytes&&(this._format|=-this.bytes.length&3);var e=b,g=this.snapshotSize(),k=(this._format&15)<<8|(this.hash&4095)<<17;switch(g.header){case 2:a.setUint32(b,g.body<<2|Squeak.HeaderTypeSizeAndClass);b+=4;a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass);b+=4;a.setUint32(b,k|Squeak.HeaderTypeSizeAndClass);b+=4;
break;case 1:a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeClass);b+=4;a.setUint32(b,k|g.body<<2|Squeak.HeaderTypeClass);b+=4;break;case 0:var f=c.compactClasses.indexOf(this.sqClass)+1;a.setUint32(b,k|f<<12|g.body<<2|Squeak.HeaderTypeShort);b+=4}if(this.isFloat)a.setFloat64(b,this["float"]),b+=8;else if(this.words)for(g=0;g<this.words.length;g++)a.setUint32(b,this.words[g]),b+=4;else if(this.pointers)for(g=0;g<this.pointers.length;g++)a.setUint32(b,c.objectToOop(this.pointers[g])),b+=4;if(this.bytes){for(g=
0;g<this.bytes.length;g++)a.setUint8(b++,this.bytes[g]);b+=-this.bytes.length&3}if(b!==e+this.totalBytes())throw Error("written size does not match");return b}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var a=this.pointers[Squeak.Class_format];return(a>>10&192)+(a>>1&63)-1},instVarNames:function(){return(this.pointers[12<this.pointers.length?4:9<this.pointers.length?3:4].pointers||[]).map(function(a){return a.bytesAsString()})},
allInstVarNames:function(){var a=this.superclass();return a.isNil?this.instVarNames():a.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";for(var a=6;7>=a;a++){var b=this.pointers[a];if(b&&b.bytes)return b.bytesAsString()}for(var c=5;6>=c;c++){var e=this.pointers[c];if(e&&e.pointers)for(a=6;7>=a;a++)if((b=e.pointers[a])&&b.bytes)return b.bytesAsString()+" class"}return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},
classInstProto:function(a){if(this.instProto)return this.instProto;var b=this.defaultInst();try{a||(a=this.className());var c=a.replace(/[^A-Za-z0-9]/g,"_"),c="UndefinedObject"===c?"nil":"True"===c?"true_":"False"===c?"false_":(/^[AEIOU]/.test(c)?"an":"a")+c,b=(new Function("return function "+c+"() {};"))();b.prototype=this.defaultInst().prototype}catch(e){}Object.defineProperty(this,"instProto",{value:b});return b}},"as method",{methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>
24&15},methodPrimitiveIndex:function(){var a=this.pointers[0]&805306879;return 511<a?(a&511)+(a>>19):a},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return 0<(this.pointers[0]&131072)},methodAddPointers:function(a){this.pointers=a},methodTempCount:function(){return this.pointers[0]>>18&63},methodGetLiteral:function(a){return this.pointers[1+a]},methodGetSelector:function(a){return this.pointers[1+a]}},"as context",
{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"===typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(a){if(a&&a.activeContext===this)return a.sp+1;a=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+
("number"===typeof a?a:0)}});Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;var g=a.pointers[Squeak.Class_format];c=g&65535;this._format=g=g>>16&31;12>g?10>g?0<c+b&&(this.pointers=this.fillArray(c+b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this["float"]=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},installFromImage:function(a,b,c,e,g,k){var f=this.sqClass;if(32>f)throw Error("Invalid class ID: "+f);
this.sqClass=c[f];if(!this.sqClass)throw Error("Class ID not in class table: "+f);b=b[this.oop];c=b.length;switch(this._format){case 0:break;case 1:case 2:case 3:case 4:case 5:0<c&&(this.pointers=this.decodePointers(c,b,a,k));break;case 10:if(this.sqClass===e){if(this.isFloat=!0,this["float"]=this.decodeFloat(b,g,!0),1.3797216632888E-310==this["float"]&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this["float"]=this.decodeFloat(b,
g,!0),1.3797216632888E-310==this["float"]))throw Error("Cannot deoptimize decodeFloat");}else 0<c&&(this.words=this.decodeWords(c,b,g));break;case 12:case 13:throw Error("16 bit arrays not supported yet");case 16:case 17:case 18:case 19:0<c&&(this.bytes=this.decodeBytes(c,b,0,this._format&3));break;case 24:case 25:case 26:case 27:e=this.decodeWords(1,b,g)[0];if(e&2147483648)throw Error("Alternate bytecode set not supported");e=e>>1&32767;g=this.decodeWords(e+1,b,g);this.pointers=this.decodePointers(e+
1,g,a,k);this.bytes=this.decodeBytes(c-(e+1),b,e+1,this._format&3);break;default:throw Error("Unknown object format: "+this._format);}this.mark=!1},decodePointers:function(a,b,c,e){for(var g=Array(a),k=0;k<a;k++){var f=b[k];g[k]=1===(f&1)?f>>1:2===(f&3)?e(f>>>2):c[f]||42424242}return g},initInstanceOfChar:function(a,b){this.oop=b<<2|2;this.sqClass=a;this.hash=b;this._format=7;this.mark=!0},classNameFromImage:function(a,b){var c=a[b[this.oop][Squeak.Class_name]];if(c&&16<=c._format&&24>c._format){var e=
b[c.oop],c=c.decodeBytes(e.length,e,0,c._format&7);return Squeak.bytesAsString(c)}return"Class"},renameFromImage:function(a,b,c){c=c[this.sqClass];if(!c)return this;a=c.instProto||c.classInstProto(c.classNameFromImage(a,b));if(!a)return this;a=new a;a.oop=this.oop;a.sqClass=this.sqClass;a._format=this._format;a.hash=this.hash;return a}},"accessing",{instSize:function(){return 2>this._format?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=this._format;return 2>b?-1:
3===b&&a.vm.isContext(this)&&!a.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():12>b?this.wordsSize():16>b?this.shortsSize():24>b?this.bytesSize():4*this.pointersSize()+this.bytesSize()},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);var b=255<=a?2:0,a=a+(a&1)+2;4>a&&(a=4);return{header:b,body:a}},writeTo:function(a,b,c,e){var g=this.isFloat?
2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(g+=this.bytes.length+3>>>2,this._format|=-this.bytes.length&3);var k=b,f=this._format<<24|this.sqClass.hash&4194303,d=g<<24|this.hash&4194303;255<=g&&(a.setUint32(b,g,c),b+=4,d=-16777216|this.hash&4194303,a.setUint32(b,d,c),b+=4);a.setUint32(b,f,c);b+=4;a.setUint32(b,d,c);b+=4;if(this.isFloat)a.setFloat64(b,this["float"],c),b+=8;else if(this.words)for(f=0;f<this.words.length;f++)a.setUint32(b,this.words[f],c),b+=4;else if(this.pointers)for(f=
0;f<this.pointers.length;f++)a.setUint32(b,e(this.pointers[f]),c),b+=4;if(this.bytes){for(f=0;f<this.bytes.length;f++)a.setUint8(b++,this.bytes[f]);b+=-this.bytes.length&3}b=0===g?b+8:b+4*(g&1);if(b!==k+this.totalBytes())throw Error("written size does not match");return b}},"testing",{isBytes:function(){var a=this._format;return 16<=a&&23>=a},isPointers:function(){return 6>=this._format},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var a=this._format;return 10===a||16<=a&&
23>=a},isWeak:function(){return 4===this._format},isMethod:function(){return 24<=this._format},sameFormats:function(a,b){return 16>a?a===b:(a&248)===(b&248)}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return this.pointers[Squeak.Class_format]&65535},classByteSizeOfInstance:function(a){var b=this.classInstFormat(),c=this.classInstSize(),c=9>b?c+a:16<=b?c+((a+3)/4|0):12<=b?c+((a+
1)/2|0):10<=b?c+a:c+2*a,c=c+(c&1),c=c+(255<=c?4:2);4>c&&(c=4);return 4*c}},"as method",{methodNumLits:function(){return this.pointers[0]&32767},methodPrimitiveIndex:function(){return 0===(this.pointers[0]&65536)?0:this.bytes[1]+256*this.bytes[2]}});Object.subclass("Squeak.Interpreter","initialization",{initialize:function(a,b){console.log("squeak: initializing interpreter "+Squeak.vmVersion);this.Squeak=Squeak;this.image=a;this.image.vm=this;this.primHandler=new Squeak.Primitives(this,b);this.loadImageState();
this.hackImage();this.initVMState();this.loadInitialContext();this.initCompiler();console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers;this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers;this.nilObj=this.specialObjects[Squeak.splOb_NilObject];this.falseObj=this.specialObjects[Squeak.splOb_FalseObject];this.trueObj=this.specialObjects[Squeak.splOb_TrueObject];this.hasClosures=this.image.hasClosures;this.globals=
this.findGlobals();this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0);6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.interruptCheckCounter=this.sendCount=this.byteCodeCount=0;this.interruptCheckCounterFeedBackReset=1E3;this.interruptChecksEveryNms=3;this.lastTick=this.nextWakeupTick=this.nextPollTick=0;this.interruptKeycode=2094;this.interruptPending=!1;this.pendingFinalizationSignals=0;this.freeLargeContexts=
this.freeContexts=this.nilObj;this.nAllocatedContexts=this.nRecycledContexts=this.reclaimableContextCount=0;this.methodCacheSize=1024;this.methodCacheMask=this.methodCacheSize-1;this.methodCacheRandomish=0;this.methodCache=[];for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1;this.breakOutTick=0;this.breakOnMethod=null;this.breakOnContextChanged=this.breakOnNewMethod=!1;this.breakOnContextReturned=
null;this.messages={};this.startupTime=Date.now()},loadInitialContext:function(){this.activeContext=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess].pointers[Squeak.Proc_suspendedContext];this.activeContext.dirty=!0;this.fetchContextRegisters(this.activeContext);this.reclaimableContextCount=0},findGlobals:function(){var a=this.specialObjects[Squeak.splOb_SmalltalkDictionary],b=a.sqClass.className();"Association"===b&&(a=a.pointers[1],
b=a.sqClass.className());if("SystemDictionary"===b)return a.pointers[1].pointers;if("SmalltalkImage"===b){a=a.pointers[0];b=a.sqClass.className();if("SystemDictionary"===b)return a.pointers[1].pointers;if("Environment"===b)return a.pointers[2].pointers[1].pointers}console.warn("cannot find global dict");return[]},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==(new Function("return 42"))())return console.warn("function constructor not working, disabling JIT")}catch(b){return console.warn("disabling JIT: "+
b)}var a=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>a)return console.warn("Slow machine detected (loaded "+(1E3*a|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),this.compiler=new Squeak.Compiler(this)}catch(b){console.warn("Compiler "+b)}},hackImage:function(){[].forEach(function(a){var b=this.findMethod(a.method);b&&(b.pointers[0]|=a.primitive,console.warn("Hacking "+a.method))},this);this.findMethod("PharoClassInstaller>>initialize")&&
(Squeak.platformName="unix")}},"interpreting",{interpretOne:function(a){if(this.method.compiled){if(a){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(a);this.breakNow()}this.method.compiled(this)}else{a=this.Squeak;var b,c;this.byteCodeCount++;b=this.nextByte();if(128>b)switch(b){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.push(this.receiver.pointers[b&15]);return;
case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.push(this.homeContext.pointers[a.Context_tempFrameStart+(b&15)]);return;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:this.push(this.method.methodGetLiteral(b&
31));return;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:this.push(this.method.methodGetLiteral(b&31).pointers[a.Assn_value]);return;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:this.receiver.dirty=!0;this.receiver.pointers[b&7]=this.pop();return;case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:this.homeContext.pointers[a.Context_tempFrameStart+
(b&7)]=this.pop();return;case 112:this.push(this.receiver);return;case 113:this.push(this.trueObj);return;case 114:this.push(this.falseObj);return;case 115:this.push(this.nilObj);return;case 116:this.push(-1);return;case 117:this.push(0);return;case 118:this.push(1);return;case 119:this.push(2);return;case 120:this.doReturn(this.receiver);return;case 121:this.doReturn(this.trueObj);return;case 122:this.doReturn(this.falseObj);return;case 123:this.doReturn(this.nilObj);return;case 124:this.doReturn(this.pop());
return;case 125:this.doReturn(this.pop(),this.activeContext.pointers[a.BlockContext_caller]);return;case 126:this.nono();return;case 127:this.nono();return}else switch(b){case 128:this.extendedPush(this.nextByte());return;case 129:this.extendedStore(this.nextByte());return;case 130:this.extendedStorePop(this.nextByte());return;case 131:c=this.nextByte();this.send(this.method.methodGetSelector(c&31),c>>5,!1);return;case 132:this.doubleExtendedDoAnything(this.nextByte());return;case 133:c=this.nextByte();
this.send(this.method.methodGetSelector(c&31),c>>5,!0);return;case 134:c=this.nextByte();this.send(this.method.methodGetSelector(c&63),c>>6,!1);return;case 135:this.pop();return;case 136:this.push(this.top());return;case 137:this.push(this.exportThisContext());return;case 138:this.pushNewArray(this.nextByte());return;case 139:this.callPrimBytecode();return;case 140:c=this.nextByte();this.push(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]);return;case 141:c=this.nextByte();
this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=this.top();return;case 142:c=this.nextByte();this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=this.pop();return;case 143:this.pushClosureCopy();return;case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:this.pc+=(b&7)+1;return;case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:this.jumpIfFalse((b&7)+1);return;case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:c=
this.nextByte();this.pc+=256*((b&7)-4)+c;4>(b&7)&&0>=this.interruptCheckCounter--&&this.checkForInterrupts();return;case 168:case 169:case 170:case 171:this.jumpIfTrue(256*(b&3)+this.nextByte());return;case 172:case 173:case 174:case 175:this.jumpIfFalse(256*(b&3)+this.nextByte());return;case 176:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 177:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)-
this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 178:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 179:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 180:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 181:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=
this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 182:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 183:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 184:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 185:this.success=!0;
this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 186:this.success=!0;this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 187:this.success=!0;this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(b&15);return;case 188:this.success=!0;this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 189:this.success=
!0;this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 190:this.success=!0;this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(b&15);return;case 191:this.success=!0;this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(b&15);return;case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:this.primHandler.quickSendOther(this.receiver,
b&15)||this.sendSpecial((b&15)+16);return;case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.send(this.method.methodGetSelector(b&15),0,!1);return;case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:this.send(this.method.methodGetSelector(b&15),1,!1);return;case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:this.send(this.method.methodGetSelector(b&
15),2,!1);return}throw Error("not a bytecode: "+b);}},interpret:function(a,b){if(this.frozen)return"frozen";this.breakOutOfInterpreter=this.isIdle=!1;for(this.breakOutTick=this.primHandler.millisecondClockValue()+(a||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(b);var c="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,
this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;b&&b(c);return c},goIdle:function(){var a=0!==this.nextWakeupTick;this.forceInterruptCheck();this.checkForInterrupts();this.isIdle=0!==this.nextWakeupTick||!a;this.breakOut()},freeze:function(a){var b;this.frozen=!0;this.breakOutOfInterpreter=function(a){if(!a)throw Error("need function to restart interpreter");b=a;return"frozen"}.bind(this);var c=function(){this.frozen=!1;if(!b)throw Error("no continue function");b(0)}.bind(this);
a&&window.setTimeout(function(){a(c)},0);return c},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!");},forceInterruptCheck:function(){this.interruptCheckCounter=-1E3},checkForInterrupts:function(){var a=this.primHandler.millisecondClockValue();a<this.lastTick&&(this.nextPollTick=a+(this.nextPollTick-this.lastTick),this.breakOutTick=a+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick&&
(this.nextWakeupTick=a+(this.nextWakeupTick-this.lastTick)));-100<this.interruptCheckCounter&&(this.interruptCheckCounterFeedBackReset=a-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+10:1E3>=this.interruptCheckCounterFeedBackReset?1E3:this.interruptCheckCounterFeedBackReset-12);this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset;this.lastTick=a;if(this.interruptPending){this.interruptPending=!1;var b=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];
b.isNil||this.primHandler.synchronousSignal(b)}0!==this.nextWakeupTick&&a>=this.nextWakeupTick&&(this.nextWakeupTick=0,b=this.specialObjects[Squeak.splOb_TheTimerSemaphore],b.isNil||this.primHandler.synchronousSignal(b));0<this.pendingFinalizationSignals&&(b=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore],this.pendingFinalizationSignals=0,b.isNil||this.primHandler.synchronousSignal(b));0<this.primHandler.semaphoresToSignal.length&&this.primHandler.signalExternalSemaphores();!this.method.compiled&&
this.compiler&&this.compiler.compile(this.method);a>=this.breakOutTick&&this.breakOut()},extendedPush:function(a){var b=a&63;switch(a>>6){case 0:this.push(this.receiver.pointers[b]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+b]);break;case 2:this.push(this.method.methodGetLiteral(b));break;case 3:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value])}},extendedStore:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.dirty=!0;this.receiver.pointers[b]=
this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.top();break;case 2:this.nono();break;case 3:a=this.method.methodGetLiteral(b),a.dirty=!0,a.pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.dirty=!0;this.receiver.pointers[b]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.pop();break;case 2:this.nono();break;case 3:a=this.method.methodGetLiteral(b),a.dirty=
!0,a.pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(a){var b=this.nextByte();switch(a>>5){case 0:this.send(this.method.methodGetSelector(b),a&31,!1);break;case 1:this.send(this.method.methodGetSelector(b),a&31,!0);break;case 2:this.push(this.receiver.pointers[b]);break;case 3:this.push(this.method.methodGetLiteral(b));break;case 4:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]);break;case 5:this.receiver.dirty=!0;this.receiver.pointers[b]=this.top();
break;case 6:this.receiver.dirty=!0;this.receiver.pointers[b]=this.pop();break;case 7:a=this.method.methodGetLiteral(b),a.dirty=!0,a.pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(a){var b=this.pop();b.isTrue?this.pc+=a:b.isFalse||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},jumpIfFalse:function(a){var b=this.pop();b.isFalse?this.pc+=a:b.isTrue||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},sendSpecial:function(a){this.send(this.specialSelectors[2*
a],this.specialSelectors[2*a+1],!1)},callPrimBytecode:function(){this.pc+=2;this.primFailCode&&(129===this.method.bytes[this.pc]&&this.stackTopPut(this.getErrorObjectFromPrimFailCode()),this.primFailCode=0)},getErrorObjectFromPrimFailCode:function(){var a=this.specialObjects[Squeak.splOb_PrimErrTableIndex];return a&&a.pointers&&(a=a.pointers[this.primFailCode-1])?a:this.primFailCode}},"closures",{pushNewArray:function(a){var b=127<a;a&=127;var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],
a);if(b){for(b=0;b<a;b++)c.pointers[b]=this.stackValue(a-b-1);this.popN(a)}this.push(c)},pushClosureCopy:function(){var a=this.nextByte(),b=a&15,a=a>>4,c=256*this.nextByte()+this.nextByte(),e=this.encodeSqueakPC(this.pc,this.method),b=this.newClosure(b,e,a);b.pointers[Squeak.Closure_outerContext]=this.activeContext;this.reclaimableContextCount=0;if(0<a){for(e=0;e<a;e++)b.pointers[Squeak.Closure_firstCopiedValue+e]=this.stackValue(a-e-1);this.popN(a)}this.pc+=c;this.push(b)},newClosure:function(a,
b,c){c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],c);c.pointers[Squeak.Closure_startpc]=b;c.pointers[Squeak.Closure_numArgs]=a;return c}},"sending",{send:function(a,b,c){var e=this.stackValue(b),g=this.getClass(e);c&&(g=this.method.methodClassForSuper(),g=g.pointers[Squeak.Class_superclass]);b=this.findSelectorInClass(a,b,g);b.primIndex&&(this.verifyAtSelector=a,this.verifyAtClass=g);this.executeNewMethod(e,b.method,b.argCount,b.primIndex,b.mClass,a)},sendAsPrimitiveFailure:function(a,
b,c){this.executeNewMethod(a,b,c,0)},findSelectorInClass:function(a,b,c){var e=this.findMethodCacheEntry(a,c);if(e.method)return e;for(var g=c,k;!g.isNil;){k=g.pointers[Squeak.Class_mdict];if(k.isNil)return e=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],c=this.createActualMessage(a,b,c),this.popNandPush(b,c),this.findSelectorInClass(e,1,g.superclass());k=this.lookupSelectorInDict(k,a);if(!k.isNil)return this.currentSelector=a,this.currentLookupClass=c,e.method=k,e.primIndex=k.isMethod()?
k.methodPrimitiveIndex():248,e.argCount=b,e.mClass=g,e;g=g.superclass()}g=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(a===g)throw Error("Recursive not understood error encountered");a=this.createActualMessage(a,b,c);this.popNandPush(b,a);return this.findSelectorInClass(g,1,c)},lookupSelectorInDict:function(a,b){for(var c=a.pointersSize(),e=(c-Squeak.MethodDict_selectorStart-1&b.hash)+Squeak.MethodDict_selectorStart,g=!1;;){var k=a.pointers[e];if(k===b)return a.pointers[Squeak.MethodDict_array].pointers[e-
Squeak.MethodDict_selectorStart];if(k.isNil)return this.nilObj;if(++e===c){if(g)return this.nilObj;e=Squeak.MethodDict_selectorStart;g=!0}}},executeNewMethod:function(a,b,c,e,g,k){this.sendCount++;b===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(b,g,k));this.logSends&&console.log(this.sendCount+" "+this.printMethod(b,g,k));this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow());if(!(0<e&&this.tryPrimitive(e,c,b))){e=this.allocateOrRecycleContext(b.methodNeedsLargeFrame());
var f=b.methodTempCount(),d=Squeak.Context_tempFrameStart+f-1;e.pointers[Squeak.Context_method]=b;e.pointers[Squeak.BlockContext_initialIP]=this.nilObj;e.pointers[Squeak.Context_sender]=this.activeContext;this.arrayCopy(this.activeContext.pointers,this.sp-c,e.pointers,Squeak.Context_tempFrameStart-1,c+1);this.arrayFill(e.pointers,Squeak.Context_tempFrameStart+c,Squeak.Context_tempFrameStart+f,this.nilObj);this.popN(c+1);this.reclaimableContextCount++;this.storeContextRegisters();this.activeContext=
e;this.activeContext.dirty=!0;this.homeContext=e;this.method=b;this.pc=0;this.sp=d;this.receiver=e.pointers[Squeak.Context_receiver];if(this.receiver!==a)throw Error("receivers don't match");!b.compiled&&this.compiler&&this.compiler.compile(b,g,k);0>=this.interruptCheckCounter--&&this.checkForInterrupts()}},doReturn:function(a,b){if(!b){var c=this.homeContext;if(this.hasClosures)for(var e;!(e=c.pointers[Squeak.Context_closure]).isNil;)c=e.pointers[Squeak.Closure_outerContext];b=c.pointers[Squeak.Context_sender]}if(b.isNil||
b.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(a);for(c=this.activeContext.pointers[Squeak.Context_sender];c!==b;){if(c.isNil)return this.cannotReturn(a);if(this.isUnwindMarked(c))return this.aboutToReturnThrough(a,c);c=c.pointers[Squeak.Context_sender]}for(c=this.activeContext;c!==b;)this.breakOnContextReturned===c&&(this.breakOnContextReturned=null,this.breakNow()),e=c.pointers[Squeak.Context_sender],c.pointers[Squeak.Context_sender]=this.nilObj,c.pointers[Squeak.Context_instructionPointer]=
this.nilObj,0<this.reclaimableContextCount&&(this.reclaimableContextCount--,this.recycleIfPossible(c)),c=e;this.activeContext=c;this.activeContext.dirty=!0;this.fetchContextRegisters(this.activeContext);this.push(a);this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(a,b){this.push(this.exportThisContext());this.push(a);this.push(b);this.send(this.specialObjects[Squeak.splOb_SelectorAboutToReturn],2)},cannotReturn:function(a){this.push(this.exportThisContext());
this.push(a);this.send(this.specialObjects[Squeak.splOb_SelectorCannotReturn],1)},tryPrimitive:function(a,b,c){if(255<a&&520>a){if(264<=a)return this.popNandPush(1,this.top().pointers[a-264]),!0;switch(a){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}this.popNandPush(1,a-261);return!0}return this.primHandler.doPrimitive(a,b,c)},createActualMessage:function(a,b,c){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],
0),g=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],b);this.arrayCopy(this.activeContext.pointers,this.sp-b+1,g.pointers,0,b);e.pointers[Squeak.Message_selector]=a;e.pointers[Squeak.Message_arguments]=g;e.pointers.length>Squeak.Message_lookupClass&&(e.pointers[Squeak.Message_lookupClass]=c);return e},primitivePerform:function(a){var b=this.stackValue(a-1),c=this.stackValue(a);--a;var e=this.sp-a,g=this.activeContext.pointers;this.arrayCopy(g,e+1,g,e,a);this.sp--;a=this.findSelectorInClass(b,
a,this.getClass(c));this.executeNewMethod(c,a.method,a.argCount,a.primIndex,a.mClass,b);return!0},primitivePerformWithArgs:function(a,b){var c=this.stackValue(a),e=this.stackValue(a-1),g=this.stackValue(a-2);if(g.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var k=b?this.stackValue(a-3):this.getClass(c);if(b)for(var f=this.getClass(c);f!==k;)if(f=f.pointers[Squeak.Class_superclass],f.isNil)return!1;f=g.pointersSize();this.arrayCopy(g.pointers,0,this.activeContext.pointers,this.sp-
1,f);this.sp+=f-a;g=this.findSelectorInClass(e,f,k);this.executeNewMethod(c,g.method,g.argCount,g.primIndex,g.mClass,e);return!0},primitiveInvokeObjectAsMethod:function(a,b){for(var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],a),e=0;e<a;e++)c.pointers[a-e-1]=this.pop();var e=this.pop(),g=this.currentSelector,k=this.specialObjects[Squeak.splOb_SelectorRunWithIn];this.push(b);this.push(g);this.push(c);this.push(e);this.send(k,3,!1);return!0},findMethodCacheEntry:function(a,
b){var c;this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var e=(a.hash^b.hash)&this.methodCacheMask,g=e,k=0;4>k;k++){c=this.methodCache[g];if(c.selector===a&&c.lkupClass===b)return c;k===this.methodCacheRandomish&&(e=g);g=g+a.hash&this.methodCacheMask}c=this.methodCache[e];c.lkupClass=b;c.selector=a;c.method=null;return c},flushMethodCache:function(){for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a].selector=null,this.methodCache[a].method=null;return!0},flushMethodCacheForSelector:function(a){for(var b=
0;b<this.methodCacheSize;b++)this.methodCache[b].selector===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheForMethod:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].method===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheAfterBecome:function(a){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(a){return this.isMethodContext(a)?198==a.pointers[Squeak.Context_method].methodPrimitiveIndex():
!1},newActiveContext:function(a){this.storeContextRegisters();this.activeContext=a;this.activeContext.dirty=!0;this.fetchContextRegisters(a)},exportThisContext:function(){this.storeContextRegisters();this.reclaimableContextCount=0;return this.activeContext},fetchContextRegisters:function(a){var b=a.pointers[Squeak.Context_method];this.isSmallInt(b)?(this.homeContext=a.pointers[Squeak.BlockContext_home],b=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=a;this.receiver=this.homeContext.pointers[Squeak.Context_receiver];
this.method=b;this.pc=this.decodeSqueakPC(a.pointers[Squeak.Context_instructionPointer],b);this.sp=this.decodeSqueakSP(a.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method);this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(a,b){return a+4*b.pointers.length+1},decodeSqueakPC:function(a,b){return a-4*b.pointers.length-
1},encodeSqueakSP:function(a){return a-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(a){return a+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(a){this.isMethodContext(a)&&(a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize?(a.pointers[0]=this.freeContexts,this.freeContexts=a):a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize&&(a.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=a))},allocateOrRecycleContext:function(a){if(a){if(!this.freeLargeContexts.isNil)return a=
this.freeLargeContexts,this.freeLargeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)}if(!this.freeContexts.isNil)return a=this.freeContexts,this.freeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},
popN:function(a){this.sp-=a},push:function(a){this.activeContext.pointers[++this.sp]=a},popNandPush:function(a,b){this.activeContext.pointers[this.sp-=a-1]=b},top:function(){return this.activeContext.pointers[this.sp]},stackTopPut:function(a){this.activeContext.pointers[this.sp]=a},stackValue:function(a){return this.activeContext.pointers[this.sp-a]},stackInteger:function(a){return this.checkSmallInt(this.stackValue(a))},stackIntOrFloat:function(a){a=this.stackValue(a);if("number"===typeof a)return a;
if(a.isFloat)return this.resultIsFloat=!0,a["float"];var b=a.bytes;if(b&&4==b.length){for(var c=0,e=3;0<=e;e--)c=256*c+b[e];if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return c;if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-c}this.success=!1;return 0},pop2AndPushIntResult:function(a){return this.success&&this.canBeSmallInt(a)?(this.popNandPush(2,a),!0):!1},pop2AndPushNumResult:function(a){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,
this.primHandler.makeFloat(a)),!0;if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return this.popNandPush(2,a),!0;if(-4294967295<=a&&4294967295>=a){var b=0>a;a=b?-a:a;var b=this.instantiateClass(this.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],4),c=b.bytes;c[0]=a&255;c[1]=a>>8&255;c[2]=a>>16&255;c[3]=a>>24&255;this.popNandPush(2,b);return!0}}return!1},pop2AndPushBoolResult:function(a){if(!this.success)return!1;this.popNandPush(2,a?this.trueObj:this.falseObj);
return!0}},"numbers",{getClass:function(a){return this.isSmallInt(a)?this.specialObjects[Squeak.splOb_ClassInteger]:a.sqClass},canBeSmallInt:function(a){return a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt},isSmallInt:function(a){return"number"===typeof a},checkSmallInt:function(a){if("number"===typeof a)return a;this.success=!1;return 1},quickDivide:function(a,b){if(0===b)return Squeak.NonSmallInt;var c=a/b|0;return c*b===a?c:Squeak.NonSmallInt},div:function(a,b){return 0===b?Squeak.NonSmallInt:Math.floor(a/
b)},mod:function(a,b){return 0===b?Squeak.NonSmallInt:a-Math.floor(a/b)*b},safeShift:function(a,b){if(0>b)return-31>b?0>a?-1:0:a>>-b;if(31<b)return 0==a?0:Squeak.NonSmallInt;var c=a<<b;return c>>b===a?c:Squeak.NonSmallInt}},"utils",{isContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||a.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]?!0:!1},isMethodContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(a,
b){return this.image.instantiateClass(a,b,this.nilObj)},arrayFill:function(a,b,c,e){for(;b<c;b++)a[b]=e},arrayCopy:function(a,b,c,e,g){if(a===c&&b<e)for(var k=g-1;0<=k;k--)c[e+k]=a[b+k];else for(k=0;k<g;k++)c[e+k]=a[b+k]}},"debugging",{addMessage:function(a){return this.messages[a]?++this.messages[a]:this.messages[a]=1},warnOnce:function(a){1==this.addMessage(a)&&console.warn(a)},printMethod:function(a,b,c){if(c)return b.className()+">>"+c.bytesAsString();a||(a=this.activeContext.contextMethod());
var e;this.allMethodsDo(function(b,c,f){if(c===a)return e=b.className()+">>"+f.bytesAsString()});return e?e:b?"("+b.pointers[Squeak.Context_receiver]+")>>?":"?>>?"},allInstancesOf:function(a,b){"string"===typeof a&&(a=this.globalNamed(a));for(var c=[],e=this.image.someInstanceOf(a);e;)b?b(e):c.push(e),e=this.image.nextInstanceAfter(e);return c},globalNamed:function(a){return this.allGlobalsDo(function(b,c){if(b.bytesAsString()===a)return c})},allGlobalsDo:function(a){for(var b=this.globals,c=0;c<
b.length;c++){var e=b[c];if(!e.isNil&&(e=a(e.pointers[0],e.pointers[1])))return e}},allMethodsDo:function(a){this.allGlobalsDo(function(b,c){if(c.pointers&&9<=c.pointers.length)for(var e=[c,c.sqClass],g=0;g<e.length;g++){var k=e[g],f=k.pointers[1];if(f.pointers&&f.pointers[1]){var d=f.pointers[1].pointers;if(d)for(var f=f.pointers,p=0;p<d.length;p++)if(a.call(this,k,d[p],f[2+p]))return!0}}})},printStack:function(a,b){"number"==typeof a&&(b=a,a=null);a||(a=this.activeContext);b||(b=100);for(var c=
[],e=Math.max(b,1E6);!a.isNil&&0<e--;)c.push(a),a=a.pointers[Squeak.Context_sender];c.length>b+200&&(a.isNil||c.push("..."),c=c.slice(0,b).concat(["..."]).concat(c.slice(-200)));for(var e=[],g=c.length;0<g--;)if(a=c[g],a.pointers){var k="",f=a.pointers[Squeak.Context_method];"number"===typeof f?(f=a.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],k="[] in "):a.pointers[Squeak.Context_closure].isNil||(k="[] in ");e.push(k+this.printMethod(f,a)+"\n")}else e.push("...\n");return e.join("")},
findMethod:function(a){var b,c=a.split(">>")[0],e=a.split(">>")[1];this.allMethodsDo(function(a,k,f){if(e.length==f.bytesSize()&&e==f.bytesAsString()&&c==a.className())return b=k});return b},breakNow:function(a){a&&console.log("Break: "+a);this.breakOutOfInterpreter="break"},breakOn:function(a){return this.breakOnMethod=a&&this.findMethod(a)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1;this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=
!0;this.breakOnContextReturned=null},printActiveContext:function(a){function b(b){b=b.sqInstName?b.sqInstName():b.toString();b=JSON.stringify(b).slice(1,-1);b.length>a-3&&(b=b.slice(0,a-3)+"...");return b}a||(a=72);for(var c=this.activeContext,e="number"===typeof c.pointers[Squeak.BlockContext_argumentCount],g=c.pointers[Squeak.Context_closure],k=e?c.pointers[Squeak.BlockContext_home]:c,g=e||g.isNil?k.pointers[Squeak.Context_method].methodTempCount():g.pointers[Squeak.Closure_numArgs],f=this.decodeSqueakSP(0),
d=k.contextSizeWithStack(this)-1,p=f+1,n=p+g-1,g="",y=f;y<=d;y++){var r=b(k.pointers[y]),m="";y==f?m="=rcvr":y<=n&&(m="=tmp"+(y-p));g+="\nctx["+y+"]"+m+": "+r}if(e)for(g+="\n",k=c.pointers[3],e=this.decodeSqueakSP(1),k=e+k,y=e;y<=this.sp;y++)r=b(c.pointers[y]),m="",y<=k&&(m="=arg"+(y-e)),g+="\nblk["+y+"]"+m+": "+r;return g},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value],b="Active: "+this.printProcess(a.pointers[Squeak.ProcSched_activeProcess],
!0),c=a.pointers[Squeak.ProcSched_processLists].pointers,e=c.length-1;0<=e;e--)for(a=c[e].pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nRunnable: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];for(c=this.image.someInstanceOf(this.specialObjects[Squeak.splOb_ClassSemaphore]);c;){for(a=c.pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nWaiting: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];c=this.image.nextInstanceAfter(c)}return b},printProcess:function(a,b){var c=
a.pointers[Squeak.Proc_suspendedContext],e=a.pointers[Squeak.Proc_priority],c=this.printStack(b?null:c);return a.toString()+" at priority "+e+"\n"+c},printByteCodes:function(a,b,c,e){a||(a=this.method);return(new Squeak.InstructionPrinter(a,this)).printInstructions(b,c,e)},willSendOrReturn:function(){var a=this.method.bytes[this.pc];if(120<=a&&125>=a)return!0;if(131>a||200==a)return!1;if(176<=a)return!0;if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return!1;a=this.method.bytes[this.pc+
2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);if("blockCopy:"!==this.method.methodGetLiteral(a).bytesAsString())return!0}return!1},nextSendSelector:function(){var a=this.method.bytes[this.pc];if(131>a||200==a)return null;var b;if(208<=a)b=this.method.methodGetLiteral(a&15);else if(176<=a)b=this.specialSelectors[2*(a-176)];else if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return null;a=this.method.bytes[this.pc+2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);b=this.method.methodGetLiteral(a)}if(b&&
(a=b.bytesAsString(),"blockCopy:"!==a))return a}});Object.subclass("Squeak.Primitives","initialization",{initialize:function(a,b){this.vm=a;this.display=b;this.display.vm=this.vm;this.allowAccessBeyondSP=this.oldPrims=!this.vm.image.hasClosures;this.deferDisplayUpdates=!1;this.semaphoresToSignal=[];this.initDisplay();this.initAtCache();this.initModules();a.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initModules:function(){this.loadedModules=
{};this.builtinModules={JavaScriptPlugin:this.findPluginFunctions("js_","",!0),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}};this.patchModules={ScratchPlugin:this.findPluginFunctions("scratch_")};
this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(a,b,c){var e={};b=new RegExp("^"+a+(b||"(initialise|shutdown|prim)"),"i");for(var g in this)if(b.test(g)&&"function"==typeof this[g]){var k=g;a&&(k=g[a.length].toLowerCase()+g.slice(a.length+1));e[k]=c?g:this[g].bind(this)}return e},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,
4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,
4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,
4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,
4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,
4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,
4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(a,b){this.success=!0;switch(b){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,
this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(a,b,c){this.success=!0;if(128>a)switch(a){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>
this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),
this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,this.doBitXor());case 17:return this.popNandPushIfOK(2,
this.doBitShift());case 18:return this.primitiveMakePoint(b,!1);case 19:return!1;case 20:return!1;case 21:return!1;case 22:return!1;case 23:return this.primitiveLessThanLargeIntegers();case 24:return this.primitiveGreaterThanLargeIntegers();case 25:return this.primitiveLessOrEqualLargeIntegers();case 26:return this.primitiveGreaterOrEqualLargeIntegers();case 27:return this.primitiveEqualLargeIntegers();case 28:return this.primitiveNotEqualLargeIntegers();case 29:return!1;case 30:return!1;case 31:return!1;
case 32:return!1;case 33:return!1;case 34:return!1;case 35:return!1;case 36:return!1;case 37:return!1;case 38:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(b+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)-this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<
this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)*this.stackFloat(0));
case 50:return this.popNandPushFloatIfOK(b+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(b+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(b+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(b+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(b+1,Math.sin(this.stackFloat(0)));
case 57:return this.popNandPushFloatIfOK(b+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(b+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(b+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(b+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(b+1,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(b+
1,this.objectAtPut(!1,!0,!1));case 65:return!1;case 66:return!1;case 67:return!1;case 68:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(b,!1);case 73:return this.popNandPushIfOK(b+
1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(b+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(b);case 77:return this.popNandPushIfOK(b+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(b+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(b);case 80:return this.popNandPushIfOK(2,this.doBlockCopy());case 81:return this.primitiveBlockValue(b);
case 82:return this.primitiveBlockValueWithArgs(b);case 83:return this.vm.primitivePerform(b);case 84:return this.vm.primitivePerformWithArgs(b,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(b);case 91:return this.primitiveTestDisplayDepth(b);case 93:return this.primitiveInputSemaphore(b);case 94:return this.primitiveGetNextEvent(b);
case 95:return this.primitiveInputWord(b);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",b);case 97:return this.primitiveSnapshot(b);case 99:return this.primitiveLoadImageSegment(b);case 100:return this.vm.primitivePerformWithArgs(b,!0);case 101:return this.primitiveBeCursor(b);case 102:return this.primitiveBeDisplay(b);case 103:return!1;case 104:return!1;case 105:return this.popNandPushIfOK(b+1,this.doStringReplace());case 106:return this.primitiveScreenSize(b);case 107:return this.primitiveMouseButtons(b);
case 108:return this.primitiveKeyboardNext(b);case 109:return this.primitiveKeyboardPeek(b);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(b+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(b+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(b);case 114:return this.primitiveExitToDebugger(b);case 115:return this.primitiveChangeClass(b);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());
case 117:return this.doNamedPrimitive(b,c);case 118:return this.primitiveDoPrimitiveWithArgs(b);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(b);case 122:return this.primitiveReverseDisplay(b);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(b);case 127:return this.primitiveShowDisplayRect(b)}else if(256>
a)switch(a){case 128:return this.primitiveArrayBecome(b,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(b);case 131:return this.primitivePartialGC(b);case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(b);
case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(b+1,this.someObject());case 139:return this.popNandPushIfOK(b+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(b);case 141:return this.primitiveClipboardText(b);case 142:return this.popNandPushIfOK(b+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(b);case 145:return this.primitiveConstantFill(b);case 146:return this.namedPrimitive("JoystickTabletPlugin",
"primitiveReadJoystick",b);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",b);case 148:return this.popNandPushIfOK(b+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(b);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(b);case 151:if(this.oldPrims)return this.primitiveFileClose(b);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(b);case 153:if(this.oldPrims)return this.primitiveFileOpen(b);case 154:if(this.oldPrims)return this.primitiveFileRead(b);
case 155:if(this.oldPrims)return this.primitiveFileSetPosition(b);case 156:if(this.oldPrims)return this.primitiveFileDelete(b);case 157:if(this.oldPrims)return this.primitiveFileSize(b);case 158:if(this.oldPrims)return this.primitiveFileWrite(b);case 159:if(this.oldPrims)return this.primitiveFileRename(b);break;case 160:return this.oldPrims?this.primitiveDirectoryCreate(b):this.primitiveAdoptInstance(b);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(b);break;case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(b);
break;case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(b);break;case 165:case 166:return this.primitiveIntegerAtAndPut(b);case 167:return!1;case 168:return this.primitiveCopyObject(b);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(b):this.pop2andPushBoolIfOK(this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",b):this.primitiveAsCharacter(b);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin",
"primitiveSoundStartWithSemaphore",b):this.popNandPushIfOK(b+1,this.stackNonInteger(0).hash);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",b);break;case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",b):this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",b):this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?
this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",b):this.popNandPushIfOK(b+1,this.behaviorHash(this.stackNonInteger(0)));case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",b);break;case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",b):this.popNandPushIfOK(b+1,this.allInstancesOf(this.stackNonInteger(0)));case 178:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin",
"primPluckedSoundmixSampleCountintostartingAtpan",b):!1;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",b);break;case 180:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",b):!1;case 181:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",b):this.primitiveSizeInBytesOfInstance(b);case 182:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin",
"oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",b):this.primitiveSizeInBytes(b);case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",b);break;case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",b);break;case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",b):this.primitiveExitCriticalSection(b);case 186:if(this.oldPrims)break;else return this.primitiveEnterCriticalSection(b);
case 187:if(this.oldPrims)break;else return this.primitiveTestAndSetOwnershipOfCriticalSection(b);case 188:if(this.oldPrims)break;else return this.primitiveExecuteMethodArgsArray(b);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",b):this.primitiveExecuteMethod(b);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",b);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",
b);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",b);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",b);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",b);break;case 195:return!1;case 196:return!1;case 197:return!1;case 198:return!1;case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",
b):this.primitiveClosureCopyWithCopiedValues(b);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",b):this.primitiveClosureValue(b);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",b):this.primitiveClosureValue(b);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",b):this.primitiveClosureValue(b);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin",
"primitiveResolverAddressLookupResult",b):this.primitiveClosureValue(b);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",b):this.primitiveClosureValue(b);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",b):this.primitiveClosureValueWithArgs(b);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverStatus",b);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveResolverError",b);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",b);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",b):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",b):this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",
b):this.popNandPushIfOK(1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",b);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",b);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",b);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",b);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveSocketConnectToPort",b);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",b);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",b);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",b);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",b):this.primitiveClosureValueNoContextSwitch(b);case 222:return this.oldPrims?
this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",b):this.primitiveClosureValueNoContextSwitch(b);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",b);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",b);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(b);case 231:return this.primitiveForceDisplayUpdate(b);case 233:return this.primitiveSetFullScreen(b);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin",
"primitiveDecompressFromByteArray",b);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",b);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",b);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",b);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",b);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin",
"primitiveSerialPortClose",b);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",b):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",b):this.popNandPushIfOK(1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;else return this.primitiveSignalAtUTCMicroseconds(b);case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",
b);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",b);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",b);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",b);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(b,c);case 249:return this.primitiveArrayBecome(b,!1);case 254:return this.primitiveVMParameter(b)}else switch(a){case 521:return this.namedPrimitive("MIDIPlugin",
"primitiveMIDIClosePort",b);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",b);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",b);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",b);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",b);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",b);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",
b);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",b);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",b);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",b);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",b);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",b);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",b);case 571:return this.primitiveUnloadModule(b);
case 572:return this.primitiveListBuiltinModule(b);case 573:return this.primitiveListLoadedModule(b)}console.error("primitive "+a+" not implemented yet");return!1},namedPrimitive:function(a,b,c){var e=""===a?this:this.loadedModules[a];void 0===e&&(e=this.loadModule(a),this.loadedModules[a]=e);var g=!1;if(e){this.interpreterProxy.argCount=c;var k=e[b];"function"===typeof k?g=e[b](c):"string"===typeof k?g=this[k](c):this.vm.warnOnce("missing primitive: "+a+"."+b)}else this.vm.warnOnce("missing module: "+
a+" ("+b+")");return!0===g||!1===g?g:this.success},doNamedPrimitive:function(a,b){if(2>b.pointersSize())return!1;var c=b.pointers[1];if(4!==c.pointersSize())return!1;this.primMethod=b;var e=c.pointers[0].bytesAsString(),c=c.pointers[1].bytesAsString();return this.namedPrimitive(e,c,a)},fakePrimitive:function(a,b,c){this.vm.warnOnce("faking primitive: "+a);void 0===b?this.vm.popN(c):this.vm.popNandPush(c+1,this.makeStObject(b));return!0}},"modules",{loadModule:function(a){var b=Squeak.externalModules[a]||
this.builtinModules[a];if(!b)return null;this.patchModules[a]&&this.patchModule(b,a);if(b.setInterpreter&&!b.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+a),null;var c=b.initialiseModule;if("function"===typeof c)b.initialiseModule();else if("string"===typeof c)this[c]();if(this.interpreterProxy.failed())return console.log("Module initialization failed: "+a),null;console.log("Loaded module: "+a);return b},patchModule:function(a,b){var c=this.patchModules[b],
e;for(e in c)a[e]=c[e]},unloadModule:function(a){var b=this.loadedModules[a];if(!a||!b||b===this)return null;delete this.loadedModules[a];var c=b.unloadModule;if("function"===typeof c)b.unloadModule(this);else if("string"===typeof c)this[c](this);console.log("Unloaded module: "+a);return b},loadFunctionFrom:function(a,b){var c=""===b?this:this.loadedModules[b];void 0===c&&(c=this.loadModule(b),this.loadedModules[b]=c);if(!c)return null;var e=c[a];if("function"===typeof e)return e.bind(c);if("string"===
typeof e)return this[e].bind(this);this.vm.warnOnce("missing primitive: "+b+"."+a);return null},primitiveUnloadModule:function(a){var b=this.stackNonInteger(0).bytesAsString();if(!b)return!1;this.unloadModule(b);return this.popNIfOK(a)},primitiveListBuiltinModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=Object.keys(this.builtinModules);return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))},primitiveListLoadedModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;
var c=[],e;for(e in this.loadedModules){var g=this.loadedModules[e];g&&(g=g.getModuleName?g.getModuleName():e,c.push(g))}return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))}},"stack access",{popNIfOK:function(a){if(!this.success)return!1;this.vm.popN(a);return!0},pop2andPushBoolIfOK:function(a){this.vm.success=this.success;return this.vm.pop2AndPushBoolResult(a)},popNandPushIfOK:function(a,b){if(!this.success||null==b)return!1;this.vm.popNandPush(a,b);return!0},popNandPushIntIfOK:function(a,
b){return this.success&&this.vm.canBeSmallInt(b)?this.popNandPushIfOK(a,b):!1},popNandPushFloatIfOK:function(a,b){return this.success?this.popNandPushIfOK(a,this.makeFloat(b)):!1},stackNonInteger:function(a){return this.checkNonInteger(this.vm.stackValue(a))},stackInteger:function(a){return this.checkSmallInt(this.vm.stackValue(a))},stackPos32BitInt:function(a){return this.positive32BitValueOf(this.vm.stackValue(a))},pos32BitIntFor:function(a){if(0<=a&&a<=Squeak.MaxSmallInt)return a;for(var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],
4),c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},pos53BitIntFor:function(a){if(4294967295>=a)return this.pos32BitIntFor(a);if(9007199254740991<a)return console.warn("Out of range: pos53BitIntFor("+a+")"),this.success=!1,0;for(var b=0xffffffffff>=a?5:0xffffffffffff>=a?6:7,c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],b),e=c.bytes,g=0;g<b;g++)e[g]=a&255,a/=256;return c},stackSigned32BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;
if(4!==a.bytesSize())return this.success=!1,0;for(var b=a.bytes,c=0,e=0,g=1;4>e;e++,g*=256)c+=b[e]*g;if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger)&&2147483647>=c)return c;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger)&&-2147483648<=-c)return-c;this.success=!1;return 0},signed32BitIntegerFor:function(a){if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return a;var b=0>a;a=b?-a:a;for(var b=this.vm.instantiateClass(this.vm.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],
4),c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},stackFloat:function(a){return this.checkFloat(this.vm.stackValue(a))},stackBoolean:function(a){return this.checkBoolean(this.vm.stackValue(a))},stackSigned53BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;var b=a.bytesSize();if(7>=b){for(var c=a.bytes,e=0,g=0,k=1;g<b;g++,k*=256)e+=c[g]*k;if(9007199254740991>=e){if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger))return e;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger))return-e}}this.success=
!1;return 0}},"numbers",{doBitAnd:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a&b):0},doBitOr:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a|b):0},doBitXor:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a^b):0},doBitShift:function(){var a=this.stackPos32BitInt(1),b=this.stackInteger(0);if(!this.success)return 0;
if(0<this.vm.safeShift(a,b))return this.pos32BitIntFor(this.vm.safeShift(a,b));this.success=!1;return 0},safeFDiv:function(a,b){return 0===b?(this.success=!1,1):a/b},floatAsSmallInt:function(a){return this.ensureSmallInt(0<=a?Math.floor(a):Math.ceil(a))},frexp_exponent:function(a){if(0==a)return 0;var b=new DataView(new ArrayBuffer(8));b.setFloat64(0,a);var c=b.getUint32(0)>>>20&2047;0===c&&(b.setFloat64(0,a*Math.pow(2,64)),c=(b.getUint32(0)>>>20&2047)-64);return c-1022},ldexp:function(a,b){return 1023<
b?a*Math.pow(2,1023)*Math.pow(2,b-1023):-1074>b?a*Math.pow(2,-1074)*Math.pow(2,b+1074):a*Math.pow(2,b)},primitiveLessThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},
primitiveGreaterOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(a){return a.isFloat?a["float"]:"number"===typeof a?a:0},positive32BitValueOf:function(a){if("number"===
typeof a){if(0<=a)return a;this.success=!1;return 0}if(!this.isA(a,Squeak.splOb_ClassLargePositiveInteger)||4!==a.bytesSize())return this.success=!1,0;a=a.bytes;for(var b=0,c=0,e=1;4>c;c++,e*=256)b+=a[c]*e;return b},checkFloat:function(a){if(a.isFloat)return a["float"];if("number"===typeof a)return a;this.success=!1;return 0},checkSmallInt:function(a){if("number"===typeof a)return a;this.success=!1;return 0},checkNonInteger:function(a){if("number"!==typeof a)return a;this.success=!1;return this.vm.nilObj},
checkBoolean:function(a){return a.isTrue?!0:a.isFalse?!1:this.success=!1},indexableSize:function(a){return"number"===typeof a?-1:a.indexableSize(this)},isA:function(a,b){return a.sqClass===this.vm.specialObjects[b]},isKindOf:function(a,b){for(var c=a.sqClass,e=this.vm.specialObjects[b];!c.isNil;){if(c===e)return!0;c=c.pointers[Squeak.Class_superclass]}return!1},isAssociation:function(a){return"number"!==typeof a&&2==a.pointersSize()},ensureSmallInt:function(a){if(a===(a|0)&&this.vm.canBeSmallInt(a))return a;
this.success=!1;return 0},charFromInt:function(a){var b=this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[a];if(b)return b;b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassCharacter],0);b.pointers[0]=a;return b},charFromIntSpur:function(a){return this.vm.image.getCharacter(a)},charToInt:function(a){return a.pointers[0]},charToIntSpur:function(a){return a.hash},makeFloat:function(a){var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassFloat],2);b["float"]=
a;return b},makeLargeIfNeeded:function(a){return this.vm.canBeSmallInt(a)?a:this.makeLargeInt(a)},makeLargeInt:function(a){if(0>a)throw Error("negative large ints not implemented yet");if(4294967295<a)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(a)},makePointWithXandY:function(a,b){var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassPoint],0);c.pointers[Squeak.Point_x]=a;c.pointers[Squeak.Point_y]=b;return c},makeStArray:function(a,b){for(var c=
this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length),e=0;e<a.length;e++)c.pointers[e]=this.makeStObject(a[e],b);return c},makeStString:function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c)&255);a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],b.length);a.bytes=b;return a},makeStObject:function(a,b){if(void 0===a||null===a)return this.vm.nilObj;if(!0===a)return this.vm.trueObj;if(!1===a)return this.vm.falseObj;if(a.sqClass)return a;
if("number"===typeof a)return a===(a|0)?this.makeLargeIfNeeded(a):this.makeFloat(a);if(b){var c=this.vm.instantiateClass(b,0);c.jsObject=a;return c}if("string"===typeof a||"Uint8Array"===a.constructor.name)return this.makeStString(a);if("Array"===a.constructor.name)return this.makeStArray(a);throw Error("cannot make smalltalk object");},pointsTo:function(a,b){return a.pointers?0<=a.pointers.indexOf(b):!1},asUint8Array:function(a){if("Uint8Array"===a.constructor.name)return a;if("ArrayBuffer"===a.constructor.name)return new Uint8Array(a);
if("string"===typeof a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}throw Error("unknown buffer type");},filenameToSqueak:function(a){a="/SqueakJS"+("/"!==a[0]?"/":"")+a;this.emulateMac&&(a=("Macintosh HD"+a).replace(/\//g,"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"));return a},filenameFromSqueak:function(a){a=this.emulateMac?a.replace(/^[^:]*:/,":").replace(/\//g,"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"):a;return a=a.replace(/^\/*SqueakJS\/?/,
"/")}},"indexing",{objectAt:function(a,b,c){var e=this.stackNonInteger(1),g=this.stackPos32BitInt(0);if(!this.success)return e;if(a){if(a=this.atCache[e.hash&this.atCacheMask],a.array!==e)return this.success=!1,e}else{if(e.isFloat){c=e.floatData();if(1==g)return this.pos32BitIntFor(c.getUint32(0,!1));if(2==g)return this.pos32BitIntFor(c.getUint32(4,!1));this.success=!1;return e}a=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],e,b,c)}if(1>g||g>a.size)return this.success=!1,e;if(c)return e.pointers[g-
1];if(e.isPointers())return e.pointers[g-1+a.ivarOffset];if(e.isWords())return a.convertChars?this.charFromInt(e.words[g-1]&1073741823):this.pos32BitIntFor(e.words[g-1]);if(e.isBytes())return a.convertChars?this.charFromInt(e.bytes[g-1]&255):e.bytes[g-1]&255;c=4*e.pointersSize();return 0>g-1-c?(this.success=!1,e):e.bytes[g-1-c]&255},objectAtPut:function(a,b,c){var e=this.stackNonInteger(2),g=this.stackPos32BitInt(1);if(!this.success)return e;var k;if(a){if(k=this.atPutCache[e.hash&this.atCacheMask],
k.array!==e)return this.success=!1,e}else{if(e.isFloat)return a=this.stackPos32BitInt(0),!this.success||1!=g&&2!=g?this.success=!1:(b=e.floatData(),b.setUint32(1==g?0:4,a,!1),e["float"]=b.getFloat64(0)),this.vm.stackValue(0);k=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],e,b,c)}if(1>g||g>k.size)return this.success=!1,e;a=this.vm.stackValue(0);if(c)return e.dirty=!0,e.pointers[g-1]=a;if(e.isPointers())return e.dirty=!0,e.pointers[g-1+k.ivarOffset]=a;if(e.isWords()){if(b){if(a.sqClass!==
this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else b=this.stackPos32BitInt(0);this.success&&(e.words[g-1]=b);return a}if(b){if(a.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else{if("number"!==typeof a)return this.success=!1,a;b=a}if(0>b||255<b)return this.success=!1,a;if(e.isBytes())return e.bytes[g-
1]=b;c=4*e.pointersSize();if(0>g-1-c)return this.success=!1,e;e.bytes[g-1-c]=b;return a},objectSize:function(a){var b=this.vm.stackValue(0),c=-1;a?b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?c=b.pointersSize():b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(c=b.bytesSize()):c=this.indexableSize(b);return-1===c?(this.success=!1,-1):this.pos32BitIntFor(c)},initAtCache:function(){this.atCacheSize=32;this.atCacheMask=this.atCacheSize-1;this.atCache=[];this.atPutCache=[];
this.nonCachedInfo={};for(var a=0;a<this.atCacheSize;a++)this.atCache.push({}),this.atPutCache.push({})},clearAtCache:function(){this.nonCachedInfo.array=null;for(var a=0;a<this.atCacheSize;a++)this.atCache[a].array=null,this.atPutCache[a].array=null},makeAtCacheInfo:function(a,b,c,e,g){a=this.vm.verifyAtSelector!==b||this.vm.verifyAtClass!==c.sqClass||this.vm.isContext(c)?this.nonCachedInfo:a[c.hash&this.atCacheMask];a.array=c;a.convertChars=e;g?(a.size=c.instSize()+Math.max(0,c.indexableSize(this)),
a.ivarOffset=0):(a.size=c.indexableSize(this),a.ivarOffset=c.isPointers()?c.instSize():0);return a}},"basic",{instantiateClass:function(a,b){return 4*b>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,this.vm.primFailCode=Squeak.PrimErrNoMemory,null):this.vm.instantiateClass(a,b)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(a){return this.vm.image.objectAfter(a)||0},someInstanceOf:function(a){if(a=this.vm.image.someInstanceOf(a))return a;
this.success=!1;return 0},nextInstanceAfter:function(a){if(a=this.vm.image.nextInstanceAfter(a))return a;this.success=!1;return 0},allInstancesOf:function(a){a=this.vm.image.allInstancesOf(a);var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length);b.pointers=a;return b},identityHash:function(a){return a.hash},identityHashSpur:function(a){var b=a.hash;return 0<b?b:a.hash=this.newObjectHash()},behaviorHash:function(a){var b=a.hash;return 0<b?b:this.vm.image.enterIntoClassTable(a)},
newObjectHash:function(a){return Math.floor(1073741822*Math.random())+1},primitiveSizeInBytesOfInstance:function(a){if(1<a)return!1;var b=this.stackNonInteger(a),c=a?this.stackInteger(0):0,b=b.classByteSizeOfInstance(c);return this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b))},primitiveSizeInBytes:function(a){var b=this.stackNonInteger(0).totalBytes();return this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b))},primitiveAsCharacter:function(a){var b=this.stackInteger(0);return 0>b||1073741823<b?
!1:(b=this.charFromInt(b))?this.popNandPushIfOK(a+1,b):!1},primitiveFullGC:function(a){this.vm.image.fullGC("primitive");a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitivePartialGC:function(a){this.vm.image.partialGC("primitive");a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitiveMakePoint:function(a,b){var c=this.vm.stackValue(1),e=this.vm.stackValue(0);if(b&&(this.checkFloat(c),this.checkFloat(e),!this.success))return!1;
this.vm.popNandPush(1+a,this.makePointWithXandY(c,e));return!0},primitiveStoreStackp:function(a){var b=this.stackNonInteger(1),c=this.stackInteger(0);if(!this.success||0>c||this.vm.decodeSqueakSP(c)>=b.pointers.length)return!1;for(var e=b.pointers[Squeak.Context_stackPointer];e<c;)b.pointers[this.vm.decodeSqueakSP(++e)]=this.vm.nilObj;b.pointers[Squeak.Context_stackPointer]=c;this.vm.popN(a);return!0},primitiveChangeClass:function(a){if(2<a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);
if(!this.success||b.sqClass.isCompact!==c.sqClass.isCompact)return!1;if(b.isPointers()){if(!c.isPointers()||b.sqClass.classInstSize()!==c.sqClass.classInstSize())return!1}else{if(c.isPointers())return!1;var e=b.isBytes(),g=c.isBytes();if(e&&!g){if(b.bytes){if(b.bytes.length&3)return!1;b.words=new Uint32Array(b.bytes.buffer);delete b.bytes}}else!e&&g&&b.words&&(b.bytes=new Uint8Array(b.words.buffer),delete b.words)}b._format=c._format;b.sqClass=c.sqClass;return this.popNIfOK(a)},primitiveAdoptInstance:function(a){if(2<
a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success||b.classInstFormat()!==c.sqClass.classInstFormat()||b.isCompact!==c.sqClass.isCompact||b.classInstSize()!==c.sqClass.classInstSize())return!1;c.sqClass=b;return this.popNIfOK(a)},primitiveDoPrimitiveWithArgs:function(a){a=this.stackNonInteger(0);var b=this.stackInteger(1);if(!this.success)return!1;var c=a.pointersSize(),e=this.vm.activeContext.pointersSize();if(this.vm.sp+c>=e)return!1;this.vm.popN(2);for(e=0;e<c;e++)this.vm.push(a.pointers[e]);
if(this.vm.tryPrimitive(b,c))return!0;this.vm.popN(c);this.vm.push(b);this.vm.push(a);return!1},primitiveShortAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1,b=b.wordsAsInt16Array();if(!this.success||!b||0>c||c>=b.length)return!1;var e;if(2>a)e=b[c];else{e=this.stackInteger(0);if(-32768>e||32767<e)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveIntegerAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1,b=b.wordsAsInt32Array();
if(!this.success||!b||0>c||c>=b.length)return!1;var e;if(2>a)e=this.signed32BitIntegerFor(b[c]);else{e=this.stackSigned32BitInt(0);if(!this.success)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveConstantFill:function(a){var b=this.stackNonInteger(1),c=this.stackPos32BitInt(0);if(!this.success||!b.isWordsOrBytes())return!1;var e=b.words||b.bytes;if(e){if(e===b.bytes&&255<c)return!1;for(b=0;b<e.length;b++)e[b]=c}this.vm.popN(a);return!0},primitiveNewMethod:function(a){var b=this.stackInteger(0),
c=this.stackInteger(1);if(!this.success)return 0;c=this.vm.instantiateClass(this.vm.stackValue(2),c);c.pointers=[b];for(var b=c.methodNumLits(),e=0;e<b;e++)c.pointers.push(this.vm.nilObj);this.vm.popNandPush(1+a,c);this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=c);return!0},primitiveExecuteMethodArgsArray:function(a){var b=this.stackNonInteger(0),c=this.stackNonInteger(1),e=this.vm.stackValue(2);if(!this.success||!b.isMethod()||4<a)return!1;var g=b.methodNumArgs();if(g!==c.pointersSize())return!1;
this.vm.popNandPush(a+1,e);for(a=0;a<g;a++)this.vm.push(c.pointers[a]);this.vm.executeNewMethod(e,b,g,b.methodPrimitiveIndex(),null,null);return!0},primitiveArrayBecome:function(a,b){var c=this.stackNonInteger(a),e=this.stackNonInteger(a-1),g=1<a?this.stackBoolean(a-2):!0;if(!this.success)return!1;this.success=this.vm.image.bulkBecome(c.pointers,e.pointers,b,g);return this.popNIfOK(a)},doStringReplace:function(){var a=this.stackNonInteger(4),b=this.stackInteger(3)-1,c=this.stackInteger(2)-b,e=this.stackNonInteger(1),
g=this.stackInteger(0)-1;if(!this.success)return a;if(!e.sameFormatAs(a))return this.success=!1,a;if(e.isPointers()){var k=e.pointersSize(),f=e.instSize(),g=g+f;if(0>g||g+c>k)return this.success=!1,a;k=a.pointersSize();f=a.instSize();b+=f;if(0>b||b+c>k)return this.success=!1,a;for(k=0;k<c;k++)a.pointers[b+k]=e.pointers[g+k]}else if(e.isWords()){k=e.wordsSize();if(0>g||g+c>k)return this.success=!1,a;k=a.wordsSize();if(0>b||b+c>k)return this.success=!1,a;if(e.isFloat&&a.isFloat)a["float"]=e["float"];
else if(e.isFloat)a.wordsAsFloat64Array()[b]=e["float"];else if(a.isFloat)a["float"]=e.wordsAsFloat64Array()[g];else for(k=0;k<c;k++)a.words[b+k]=e.words[g+k]}else{k=e.bytesSize();if(0>g||g+c>k)return this.success=!1,a;k=a.bytesSize();if(0>b||b+c>k)return this.success=!1,a;for(k=0;k<c;k++)a.bytes[b+k]=e.bytes[g+k]}return a},primitiveCopyObject:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0),e=b.pointersSize();if(!this.success||b.isWordsOrBytes()||b.sqClass!==c.sqClass||e!==c.pointersSize())return!1;
for(var g=0;g<e;g++)b.pointers[g]=c.pointers[g];b.dirty=c.dirty;this.vm.pop(a);return!0},primitiveLoadImageSegment:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);return b.words&&c.pointers?(b=this.vm.image.loadImageSegment(b,c))?this.popNandPushIfOK(a+1,b):!1:!1}},"blocks/closures",{doBlockCopy:function(){var a=this.vm.stackValue(1),b=this.stackInteger(0),c=a;this.vm.isContext(c)||(this.success=!1);if(!this.success)return a;"number"===typeof c.pointers[Squeak.Context_method]&&
(c=c.pointers[Squeak.BlockContext_home]);var a=c.pointersSize()-c.instSize(),a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],a),e=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);a.pointers[Squeak.BlockContext_initialIP]=e;a.pointers[Squeak.Context_instructionPointer]=e;a.pointers[Squeak.Context_stackPointer]=0;a.pointers[Squeak.BlockContext_argumentCount]=b;a.pointers[Squeak.BlockContext_home]=c;a.pointers[Squeak.Context_sender]=this.vm.nilObj;return a},primitiveBlockValue:function(a){var b=
this.vm.stackValue(a);if(!this.isA(b,Squeak.splOb_ClassBlockContext))return!1;var c=b.pointers[Squeak.BlockContext_argumentCount];if("number"!==typeof c||c!=a||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-a+1,b.pointers,Squeak.Context_tempFrameStart,a);b.pointers[Squeak.Context_instructionPointer]=b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=a;b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext;
this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveBlockValueWithArgs:function(a){var b=this.vm.stackValue(1),c=this.vm.stackValue(0);if(!this.isA(b,Squeak.splOb_ClassBlockContext)||!this.isA(c,Squeak.splOb_ClassArray))return!1;var e=b.pointers[Squeak.BlockContext_argumentCount];if("number"!==typeof e||e!=c.pointersSize()||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(c.pointers,0,b.pointers,Squeak.Context_tempFrameStart,e);b.pointers[Squeak.Context_instructionPointer]=
b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=e;b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext;this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveClosureCopyWithCopiedValues:function(a){this.vm.breakNow("primitiveClosureCopyWithCopiedValues");debugger;return!1},primitiveClosureValue:function(a){var b=this.vm.stackValue(a);return a!==b.pointers[Squeak.Closure_numArgs]?!1:this.activateNewClosureMethod(b,a)},primitiveClosureValueWithArgs:function(a){var b=
this.vm.top(),c=b.pointersSize();a=this.vm.stackValue(a);if(c!==a.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var e=0;e<c;e++)this.vm.push(b.pointers[e]);return this.activateNewClosureMethod(a,c)},primitiveClosureValueNoContextSwitch:function(a){return this.primitiveClosureValue(a)},activateNewClosureMethod:function(a,b){var c=a.pointers[Squeak.Closure_outerContext],e=this.vm.allocateOrRecycleContext(c.pointers[Squeak.Context_method].methodNeedsLargeFrame()),g=a.pointers.length-Squeak.Closure_firstCopiedValue;
e.pointers[Squeak.Context_sender]=this.vm.activeContext;e.pointers[Squeak.Context_instructionPointer]=a.pointers[Squeak.Closure_startpc];e.pointers[Squeak.Context_stackPointer]=b+g;e.pointers[Squeak.Context_method]=c.pointers[Squeak.Context_method];e.pointers[Squeak.Context_closure]=a;e.pointers[Squeak.Context_receiver]=c.pointers[Squeak.Context_receiver];for(var c=Squeak.Context_tempFrameStart,k=0;k<b;k++)e.pointers[c++]=this.vm.stackValue(b-k-1);for(k=0;k<g;k++)e.pointers[c++]=a.pointers[Squeak.Closure_firstCopiedValue+
k];this.vm.popN(b+1);this.vm.newActiveContext(e);return!0}},"scheduling",{primitiveResume:function(){this.resume(this.vm.top());return!0},primitiveSuspend:function(){var a=this.vm.top();if(a===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var b=a.pointers[Squeak.Proc_myList];if(b.isNil)return!1;this.removeProcessFromList(a,b);if(!this.success)return!1;a.pointers[Squeak.Proc_myList]=this.vm.nilObj;this.vm.popNandPush(1,b)}return!0},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},
activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},resume:function(a){var b=this.activeProcess();a.pointers[Squeak.Proc_priority]>b.pointers[Squeak.Proc_priority]?(this.putToSleep(b),this.transferTo(a)):this.putToSleep(a)},putToSleep:function(a){var b=a.pointers[Squeak.Proc_priority],b=this.getScheduler().pointers[Squeak.ProcSched_processLists].pointers[b-1];this.linkProcessToList(a,b)},transferTo:function(a){var b=this.getScheduler(),c=b.pointers[Squeak.ProcSched_activeProcess];
b.pointers[Squeak.ProcSched_activeProcess]=a;b.dirty=!0;c.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext;c.dirty=!0;this.vm.newActiveContext(a.pointers[Squeak.Proc_suspendedContext]);a.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj;this.vm.reclaimableContextCount=0;this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},wakeHighestPriority:function(){var a=this.getScheduler().pointers[Squeak.ProcSched_processLists],b=a.pointersSize()-1,c;do{if(0>
b)throw Error("scheduler could not find a runnable process");c=a.pointers[b--]}while(this.isEmptyList(c));return this.removeFirstLinkOfList(c)},linkProcessToList:function(a,b){if(this.isEmptyList(b))b.pointers[Squeak.LinkedList_firstLink]=a;else{var c=b.pointers[Squeak.LinkedList_lastLink];c.pointers[Squeak.Link_nextLink]=a;c.dirty=!0}b.pointers[Squeak.LinkedList_lastLink]=a;b.dirty=!0;a.pointers[Squeak.Proc_myList]=b;a.dirty=!0},isEmptyList:function(a){return a.pointers[Squeak.LinkedList_firstLink].isNil},
removeFirstLinkOfList:function(a){var b=a.pointers[Squeak.LinkedList_firstLink];b===a.pointers[Squeak.LinkedList_lastLink]?(a.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,a.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj):(a.pointers[Squeak.LinkedList_firstLink]=b.pointers[Squeak.Link_nextLink],a.dirty=!0);b.pointers[Squeak.Link_nextLink]=this.vm.nilObj;return b},removeProcessFromList:function(a,b){var c=b.pointers[Squeak.LinkedList_firstLink],e=b.pointers[Squeak.LinkedList_lastLink];
if(a===c)c=a.pointers[Squeak.Link_nextLink],b.pointers[Squeak.LinkedList_firstLink]=c,a===e&&(b.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj);else{for(var g=c;;){if(g.isNil)return this.success=!1;c=g.pointers[Squeak.Link_nextLink];if(c===a)break;g=c}c=a.pointers[Squeak.Link_nextLink];g.pointers[Squeak.Link_nextLink]=c;a===e&&(b.pointers[Squeak.LinkedList_lastLink]=g)}a.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(a){var b=this.vm.top();this.isA(b,Squeak.splOb_ClassSemaphore)?
this.vm.specialObjects[a]=b:this.vm.specialObjects[a]=this.vm.nilObj;return this.vm.stackValue(1)},primitiveWait:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;var b=a.pointers[Squeak.Semaphore_excessSignals];0<b?a.pointers[Squeak.Semaphore_excessSignals]=b-1:(this.linkProcessToList(this.activeProcess(),a),this.transferTo(this.wakeHighestPriority()));return!0},primitiveSignal:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;this.synchronousSignal(a);
return!0},synchronousSignal:function(a){this.isEmptyList(a)?a.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(a))},signalAtMilliseconds:function(a,b){this.isA(a,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=a,this.vm.nextWakeupTick=b):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);
if(!this.success)return!1;this.signalAtMilliseconds(c,b);this.vm.popN(a);return!0},primitiveSignalAtUTCMicroseconds:function(a){var b=this.stackSigned53BitInt(0),c=this.stackNonInteger(1);if(!this.success)return!1;this.signalAtMilliseconds(c,b/1E3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask);this.vm.popN(a);return!0},signalSemaphoreWithIndex:function(a){this.semaphoresToSignal.push(a)},signalExternalSemaphores:function(){for(var a=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,
b=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var c=this.semaphoresToSignal.shift(),c=a[c-1];c.sqClass==b&&this.synchronousSignal(c)}},primitiveEnterCriticalSection:function(a){if(1<a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];e.isNil?(b.pointers[Squeak.Mutex_owner]=c,b.dirty=!0,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):(this.popNandPushIfOK(a+
1,this.vm.falseObj),this.linkProcessToList(c,b),this.transferTo(this.wakeHighestPriority()));return!0},primitiveExitCriticalSection:function(a){a=this.vm.top();if(this.isEmptyList(a))a.pointers[Squeak.Mutex_owner]=this.vm.nilObj;else{var b=this.removeFirstLinkOfList(a);a.pointers[Squeak.Mutex_owner]=b;a.dirty=!0;this.resume(b)}return!0},primitiveTestAndSetOwnershipOfCriticalSection:function(a){if(1<a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];
e.isNil?(b.pointers[Squeak.Mutex_owner]=c,b.dirty=!0,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):this.popNandPushIfOK(a+1,this.vm.nilObj);return!0}},"vm functions",{primitiveGetAttribute:function(a){var b=this.stackInteger(0);if(!this.success)return!1;switch(b){case 0:b=this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:b=this.display.documentName||null;break;case 2:b=this.display.documentName||null;break;case 1001:b=Squeak.platformName;
break;case 1002:b=Squeak.osVersion;break;case 1003:b=Squeak.platformSubtype;break;case 1004:b=Squeak.vmVersion;break;case 1005:b=Squeak.windowSystem;break;case 1006:b=Squeak.vmBuild;break;case 1007:b=Squeak.vmVersion;break;case 1009:b=Squeak.vmVersion;break;default:return!1}this.vm.popNandPush(a+1,this.makeStObject(b));return!0},setLowSpaceThreshold:function(){var a=this.stackInteger(0);this.success&&(this.vm.lowSpaceThreshold=a);return this.vm.stackValue(1)},primitiveVMParameter:function(a){var b=
this.vm.image.isSpur?54:44;switch(a){case 0:a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],b);for(var c=0;c<b;c++)a.pointers[c]=this.makeStObject(this.vmParameterAt(c+1));return this.popNandPushIfOK(1,a);case 1:return a=this.stackInteger(0),1>a||a>b?!1:this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(a)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(a){switch(a){case 1:return this.vm.image.oldSpaceBytes;case 2:return this.vm.image.oldSpaceBytes;
case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return this.vm.image.pgcCount;case 10:return this.vm.image.pgcMilliseconds;case 11:return this.vm.image.gcTenured;case 22:return 0;case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:return 0;case 48:return 0;case 54:return this.vm.image.bytesLeft()}return null},
primitiveImageName:function(a){if(0==a)return this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name)));this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString());window.localStorage.squeakImageName=this.vm.image.name;return!0},primitiveSnapshot:function(a){this.vm.popNandPush(1,this.vm.trueObj);this.vm.storeContextRegisters();this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext;this.vm.image.fullGC("snapshot");a=this.vm.image.writeToBuffer();
Squeak.flushAllFiles();Squeak.filePut(this.vm.image.name,a);this.vm.popNandPush(1,this.vm.falseObj);return!0},primitiveQuit:function(a){Squeak.flushAllFiles();this.display.quitFlag=!0;this.vm.breakNow("quit");return!0},primitiveExitToDebugger:function(a){this.vm.breakNow("debugger primitive");debugger;return!0},primitiveSetGCBiasToGrow:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,a)},primitiveSetGCBiasToGrowGCLimit:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",
0,a)}},"display",{primitiveBeCursor:function(a){if(this.display.cursorCanvas){var b=this.loadForm(this.stackNonInteger(a),!0),c=1===a?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!b)return!1;var e=this.display.cursorCanvas,g=e.getContext("2d"),k={left:0,top:0,right:b.width,bottom:b.height};e.width=b.width;e.height=b.height;1===b.depth?c?(b=this.cursorMergeMask(b,c),this.showForm(g,b,k,[0,4278190335,4294967295,4278190080])):this.showForm(g,b,k,[0,4278190080]):this.showForm(g,b,k,!0);
c=this.display.context.canvas;c=c.offsetWidth/c.width;e.style.width=(e.width*c|0)+"px";e.style.height=(e.height*c|0)+"px";this.display.cursorOffsetX=b.offsetX*c|0;this.display.cursorOffsetY=b.offsetY*c|0}this.vm.popN(a);return!0},cursorMergeMask:function(a,b){for(var c=new Uint32Array(16),e=0;16>e;e++){for(var g=a.bits[e],k=b.bits[e],f=2147483648,d=0,p=0;16>p;p++)d=d|(k&f)>>p|(g&f)>>p+1,f>>>=1;c[e]=d}return{obj:a.obj,bits:c,depth:2,width:16,height:16,offsetX:a.offsetX,offsetY:a.offsetY,msb:!0,pixPerWord:16,
pitch:1}},primitiveBeDisplay:function(a){var b=this.vm.stackValue(0);this.vm.specialObjects[Squeak.splOb_TheDisplay]=b;this.vm.popN(a);return!0},primitiveReverseDisplay:function(a){this.reverseDisplay=!this.reverseDisplay;this.redrawDisplay();if(this.display.cursorCanvas){var b=this.display.cursorCanvas;a=b.getContext("2d");for(var b=a.getImageData(0,0,b.width,b.height),c=new Uint32Array(b.data.buffer),e=0;e<c.length;e++)c[e]^=16777215;a.putImageData(b,0,0)}return!0},primitiveShowDisplayRect:function(a){var b=
{left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};if(!this.success)return!1;this.redrawDisplay(b);this.vm.popN(a);return!0},redrawDisplay:function(a){var b=this.theDisplay(),c={left:0,top:0,right:b.width,bottom:b.height};a&&(a.left>c.left&&(c.left=a.left),a.right<c.right&&(c.right=a.right),a.top>c.top&&(c.top=a.top),a.bottom<c.bottom&&(c.bottom=a.bottom));c.left<c.right&&c.top<c.bottom&&this.displayUpdate(b,c)},showForm:function(a,b,c,e){if(c){var g=
c.left,k=c.top,f=c.right-g,d=c.bottom-k,p=a.createImageData(f,d),n=p.data;n.buffer||(n=new Uint8Array(f*d*4));var y=new Uint32Array(n.buffer);switch(b.depth){case 1:case 2:case 4:case 8:var r=e||this.swappedColors;if(!r){for(var r=[],m=0;256>m;m++){var h=this.indexedColors[m],h=(h&4278255360)+((h&16711680)>>16)+((h&255)<<16);r[m]=h}this.swappedColors=r}this.reverseDisplay&&(e?r=e.map(function(a){return a^16777215}):(this.reversedColors||(this.reversedColors=r.map(function(a){return a^16777215})),
r=this.reversedColors));var u=(1<<b.depth)-1,h=32-(g%b.pixPerWord+1)*b.depth;for(e=0;e<d;e++){for(var m=b.pitch*k+(g/b.pixPerWord|0),A=h,l=b.bits[m],t=p.width*e,x=0;x<f;x++)y[t++]=r[l>>>A&u],0>(A-=b.depth)&&(A=32-b.depth,l=b.bits[++m]);k++}break;case 16:h=g%2?0:16;for(e=0;e<d;e++){m=b.pitch*k+(g/2|0);A=h;l=b.bits[m];t=p.width*e;for(x=0;x<f;x++)r=l>>>A,y[t++]=((r&31744)>>7)+((r&992)<<6)+((r&31)<<19)+4278190080,0>(A-=16)&&(A=16,l=b.bits[++m]);k++}break;case 32:r=e?0:4278190080;for(e=0;e<d;e++){m=b.pitch*
k+g;t=p.width*e;for(x=0;x<f;x++)h=b.bits[m++],h=h&4278255360|(h&16711680)>>16|(h&255)<<16|r,y[t++]=h;k++}break;default:throw Error("depth not implemented");}p.data!==n&&p.data.set(n);a.putImageData(p,c.left,c.top)}},primitiveDeferDisplayUpdates:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;this.deferDisplayUpdates=b;this.vm.popN(a);return!0},primitiveForceDisplayUpdate:function(a){this.vm.breakOut();this.vm.popN(a);return!0},primitiveScreenSize:function(a){var b=this.display;return this.popNandPushIfOK(a+
1,this.makePointWithXandY(b.width||b.context.canvas.width,b.height||b.context.canvas.height))},primitiveSetFullScreen:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=b)if(this.display.fullscreenRequest){var c=this.vm.freeze();this.display.fullscreenRequest(b,function(){c()})}else this.display.fullscreen=b,this.vm.breakOut();this.vm.popN(a);return!0},primitiveTestDisplayDepth:function(a){return this.pop2andPushBoolIfOK(0<=[1,2,4,8,16,32].indexOf(this.stackInteger(0)))},
loadForm:function(a,b){if(a.isNil)return null;var c={obj:a,bits:a.pointers[Squeak.Form_bits].wordsOrBytes(),depth:a.pointers[Squeak.Form_depth],width:a.pointers[Squeak.Form_width],height:a.pointers[Squeak.Form_height]};if(b){var e=a.pointers[Squeak.Form_offset];c.offsetX=e.pointers?e.pointers[Squeak.Point_x]:0;c.offsetY=e.pointers?e.pointers[Squeak.Point_y]:0}if(0===c.width||0===c.height)return c;if(!(0<c.width&&0<c.height))return null;c.msb=0<c.depth;c.msb||(c.depth=-c.depth);if(!(0<c.depth))return null;
c.pixPerWord=32/c.depth;c.pitch=(c.width+(c.pixPerWord-1))/c.pixPerWord|0;return c.bits.length!==c.pitch*c.height?null:c},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(a,b){this.deferDisplayUpdates||a!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),b)},displayUpdate:function(a,b){this.showForm(this.display.context,a,b);this.display.lastTick=this.vm.lastTick;this.display.idle=0},primitiveBeep:function(a){var b=
Squeak.startAudioOut();if(b){var c=b.createOscillator();c.connect(b.destination);c.type="square";c.frequency.value=880;c.start();c.stop(b.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");return this.popNIfOK(a)}},"input",{primitiveClipboardText:function(a){if(0===a){if("string"!==typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}else 1===a&&(a=this.vm.top(),a.bytes&&(this.display.clipboardString=a.bytesAsString(),
this.display.clipboardStringChanged=!0),this.vm.pop());return!0},primitiveKeyboardNext:function(a){return this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(a){return this.popNandPushIfOK(a+1,this.display.keys.length?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(a){this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.buttons));this.vm.breakOut();20<this.display.idle++&&this.vm.goIdle();return!0},
primitiveMousePoint:function(a){var b=this.ensureSmallInt(this.display.mouseX),c=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(a+1,this.makePointWithXandY(b,c))},primitiveInputSemaphore:function(a){a=this.stackInteger(0);if(!this.success)return!1;this.inputEventSemaIndex=a;this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this);return!0},primitiveInputWord:function(a){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(a){this.display.idle++;
a=this.stackNonInteger(0);if(!this.display.getNextEvent)return!1;this.display.getNextEvent(a.pointers,this.vm.startupTime);return!0}},"time",{primitiveRelinquishProcessorForMicroseconds:function(a){this.vm.pop(a);this.vm.goIdle();return!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(a){this.vm.startupTime=Date.now()-a},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClock:function(a){var b=
Date.now()-a.epoch;if("object"!==typeof performance)return this.pos53BitIntFor(1E3*b);var c=1E3*performance.now()%1E3|0,e=a.millis,g=a.micros;e>b&&(b=e);b===e&&c<g&&b++;a.millis=b;a.micros=c;return this.pos53BitIntFor(1E3*b+c)},microsecondClockUTC:function(){this.microsecondClockUTCState||(this.microsecondClockUTCState={epoch:Squeak.EpochUTC,millis:0,micros:0});return this.microsecondClock(this.microsecondClockUTCState)},microsecondClockLocal:function(){this.microsecondClockLocalState||(this.microsecondClockLocalState=
{epoch:Squeak.Epoch,millis:0,micros:0});return this.microsecondClock(this.microsecondClockLocalState)}},"FilePlugin",{primitiveDirectoryCreate:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirCreate(b);this.success||(b=Squeak.splitFilePath(b),console.log("Directory not created: "+b.fullname));return this.popNIfOK(a)},primitiveDirectoryDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=
this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirDelete(b);return this.popNIfOK(a)},primitiveDirectoryDelimitor:function(a){return this.popNandPushIfOK(1,this.charFromInt((this.emulateMac?":":"/").charCodeAt(0)))},primitiveDirectoryEntry:function(a){this.vm.warnOnce("Not yet implemented: primitiveDirectoryEntry");return!1},primitiveDirectoryLookup:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);if(!this.success)return!1;var c=c.bytesAsString(),e=this.filenameFromSqueak(c),
g=Squeak.dirList(e,!0);if(!g)return a=Squeak.splitFilePath(e),console.log("Directory not found: "+a.fullname),!1;e=Object.keys(g).sort();g=g[e[b-1]];"/"===c&&(1===b?(g||(g=[0,0,0,0,0]),g[0]="SqueakJS",g[3]=!0):g=null);this.popNandPushIfOK(a+1,this.makeStObject(g));return!0},primitiveDirectorySetMacTypeAndCreator:function(a){return this.popNIfOK(a)},primitiveFileAtEnd:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeStObject(b.filePos>=
b.file.size));return!0},primitiveFileClose:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):(this.fileClose(b.file),this.vm.breakOut(),b.file=null);return this.popNIfOK(a)},primitiveFileDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.fileDelete(b);return this.popNIfOK(a)},primitiveFileFlush:function(a){var b=this.stackNonInteger(0);
if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):(Squeak.flushFile(b.file),this.vm.breakOut());return this.popNIfOK(a)},primitiveFileGetPosition:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.filePos));return!0},makeFileHandle:function(a,b,c){a=this.makeStString("squeakjs:"+a);a.file=b;a.fileWrite=c;a.filePos=0;return a},primitiveFileOpen:function(a){var b=this.stackBoolean(0),
c=this.stackNonInteger(1);if(!this.success)return!1;c=this.filenameFromSqueak(c.bytesAsString());c=this.fileOpen(c,b);if(!c)return!1;b=this.makeFileHandle(c.name,c,b);this.popNandPushIfOK(a+1,b);return!0},primitiveFileRead:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);return this.success&&g.file?b?e.bytes?0>c||c+b>e.bytes.length?!1:"string"===typeof g.file?(this.popNandPushIfOK(a+1,0),!0):this.fileContentsDo(g.file,function(k){if(!k.contents)return this.popNandPushIfOK(a+
1,0);var f=k.contents,d=e.bytes;b=Math.min(b,k.size-g.filePos);for(k=0;k<b;k++)d[c+k]=f[g.filePos++];this.popNandPushIfOK(a+1,b)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),!1):this.popNandPushIfOK(a+1,0):!1},primitiveFileRename:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());c=this.filenameFromSqueak(c.bytesAsString());this.success=Squeak.fileRename(b,c);this.vm.breakOut();
return this.popNIfOK(a)},primitiveFileSetPosition:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file)return!1;c.filePos=b;return this.popNIfOK(a)},primitiveFileSize:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.file.size));return!0},primitiveFileStdioHandles:function(a){var b=[null,this.makeFileHandle("console.log","log",!0),this.makeFileHandle("console.error","error",!0)];
this.popNandPushIfOK(a+1,this.makeStArray(b));return!0},primitiveFileTruncate:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file||!c.fileWrite)return!1;c.file.size>b&&(c.file.size=b,c.file.modified=!0,c.filePos>c.file.size&&(c.filePos=c.file.size));return this.popNIfOK(a)},primitiveDisableFileAccess:function(a){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,a)},primitiveFileWrite:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-
1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);if(!this.success||!g.file||!g.fileWrite)return!1;if(!b)return this.popNandPushIfOK(a+1,0);var k=e.bytes||e.wordsAsUint8Array();return!k||0>c||c+b>k.length?!1:"string"===typeof g.file?(this.fileConsoleWrite(g.file,k,c,b),this.popNandPushIfOK(a+1,b),!0):this.fileContentsDo(g.file,function(e){var d=e.contents||[];g.filePos+b>d.length&&(e.contents=new Uint8Array(0===d.length?g.filePos+b:Math.max(g.filePos+b,d.length+1E4)),e.contents.set(d),d=e.contents);
for(var p=0;p<b;p++)d[g.filePos++]=k[c+p];g.filePos>e.size&&(e.size=g.filePos);e.modified=!0;this.popNandPushIfOK(a+1,b)}.bind(this))},fileOpen:function(a,b){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});var c=Squeak.splitFilePath(a);if(!c.basename)return null;var e=Squeak.dirList(c.dirname,!0);if(!e)return null;var e=e[c.basename],g=null;if(e){var k=SqueakFiles[c.fullname];if(k)return++k.refCount,k}else{if(!b)return console.log("File not found: "+c.fullname),null;g=new Uint8Array;e=Squeak.filePut(c.fullname,
g.buffer);if(!e)return console.log("Cannot create file: "+c.fullname),null}k={name:c.fullname,size:e[4],contents:g,modified:!1,refCount:1};return SqueakFiles[k.name]=k},fileClose:function(a){Squeak.flushFile(a);0==--a.refCount&&delete SqueakFiles[a.name]},fileContentsDo:function(a,b){if(a.contents)b(a);else{if(!1===a.contents)return!1;this.vm.freeze(function(c){Squeak.fileGet(a.name,function(e){if(null==e)return error(a.name);a.contents=this.asUint8Array(e);c();b(a)}.bind(this),function(e){console.log("File get failed: "+
e);a.contents=!1;c();b(a)}.bind(this))}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(a,b,c,e){b=b.subarray(c,c+e);b=this.fileConsoleBuffer[a]+Squeak.bytesAsString(b);if(c=b.match("([^]*)\n(.*)"))console[a](c[1]),b=c[2];this.fileConsoleBuffer[a]=b},fileConsoleFlush:function(a){var b=this.fileConsoleBuffer[a];b&&(console[a](b),this.fileConsoleBuffer[a]="")}},"DropPlugin",{primitiveDropRequestFileHandle:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||
[];if(1>b||b>c.length)return!1;b=c[b-1];c=this.fileOpen(b,!1);if(!c)return!1;b=this.makeFileHandle(b,c,!1);this.popNandPushIfOK(a+1,b);return!0},primitiveDropRequestFileName:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;b=this.makeStString(this.filenameToSqueak(c[b-1]));return this.popNandPushIfOK(a+1,b)}},"SoundPlugin",{snd_primitiveSoundStart:function(a){return this.snd_primitiveSoundStartWithSemaphore(a)},snd_primitiveSoundStartWithSemaphore:function(a){var b=
this.stackInteger(a-1),c=this.stackInteger(a-2),e=this.stackBoolean(a-3),g=3<a?this.stackInteger(a-4):0;if(!this.success)return!1;this.audioContext=Squeak.startAudioOut();if(!this.audioContext)return this.vm.warnOnce("could not initialize audio"),!1;this.audioSema=g;this.audioNextTimeSlot=0;this.audioBuffersReady=[];this.audioBuffersUnused=[this.audioContext.createBuffer(e?2:1,b,c),this.audioContext.createBuffer(e?2:1,b,c)];console.log("sound: started");return this.popNIfOK(a)},snd_playNextBuffer:function(){if(this.audioContext&&
0!==this.audioBuffersReady.length){var a=this.audioContext.createBufferSource();a.buffer=this.audioBuffersReady.shift();a.connect(this.audioContext.destination);this.audioNextTimeSlot<this.audioContext.currentTime&&(0<this.audioNextTimeSlot&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=this.audioContext.currentTime);a.start(this.audioNextTimeSlot);this.audioNextTimeSlot+=
a.buffer.duration;window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(a.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1E3*(this.audioNextTimeSlot-this.audioContext.currentTime));this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(a){if(!this.audioContext)return console.log("sound: no audio context"),!1;var b=0;0<this.audioBuffersUnused.length&&(b=this.audioBuffersUnused[0],b=b.length*b.numberOfChannels*
2);return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;var b=this.stackInteger(2),c=this.stackNonInteger(1).wordsAsInt16Array(),e=this.stackInteger(0)-1;if(!this.success||!c)return!1;for(var g=this.audioBuffersUnused.shift(),k=g.numberOfChannels,f=0;f<k;f++)for(var d=g.getChannelData(f),p=e+f,n=0;n<b;n++)d[n]=c[p]/32768,p+=k;this.audioBuffersReady.push(g);this.snd_playNextBuffer();
return this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;for(var b=this.audioBuffersUnused.shift(),c=b.numberOfChannels,e=b.length,g=0;g<c;g++)for(var k=b.getChannelData(g),f=0;f<e;f++)k[f]=0;this.audioBuffersReady.push(b);this.snd_playNextBuffer();return this.popNandPushIfOK(a+1,e)},snd_primitiveSoundStop:function(a){this.audioContext&&(this.audioBuffersUnused=this.audioBuffersReady=
this.audioContext=null,this.audioSema=this.audioNextTimeSlot=0,console.log("sound: stopped"));return this.popNIfOK(a)},snd_primitiveSoundStartRecording:function(a){if(3!==a)return!1;var b=this.stackNonInteger(3),c=this.stackInteger(2),e=this.stackBoolean(1),g=this.stackInteger(0);if(!this.success)return!1;var k=this.primMethod,f=this.vm.freeze(),d=this;Squeak.startAudioIn(function(b,k){console.log("sound: recording started");d.audioInContext=b;d.audioInSource=k;d.audioInSema=g;d.audioInBuffers=[];
d.audioInBufferIndex=0;for(d.audioInOverSample=1;c*d.audioInOverSample<d.audioInContext.sampleRate;)d.audioInOverSample*=2;for(var n=1024*d.audioInOverSample;.1>n/d.audioInContext.sampleRate;)n*=2;d.audioInProcessor=b.createScriptProcessor(n,e?2:1,e?2:1);d.audioInProcessor.onaudioprocess=function(a){d.snd_recordNextBuffer(a.inputBuffer)};d.audioInSource.connect(d.audioInProcessor);d.audioInProcessor.connect(b.destination);d.vm.popN(a);window.setTimeout(f,0)},function(c){console.warn(c);d.vm.sendAsPrimitiveFailure(b,
k,a);window.setTimeout(f,0)});return!0},snd_recordNextBuffer:function(a){this.audioInContext&&(5<this.audioInBuffers.length&&this.audioInBuffers.shift(),this.audioInBuffers.push(a),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(a){if(!this.audioInContext)return!1;var b=this.audioInContext.sampleRate/this.audioInOverSample|0;console.log("sound: actual recording rate "+b+"x"+this.audioInOverSample);
return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundRecordSamples:function(a){var b=this.stackNonInteger(1).wordsAsInt16Array(),c=this.stackInteger(0)-1;if(!this.success)return!1;for(var e=0;c<b.length&&0!==this.audioInBuffers.length;){for(var g=this.audioInBuffers[0],k=g.numberOfChannels,f=k,d=this.audioInOverSample,p=Math.min((g.length-this.audioInBufferIndex)/d,(b.length-c)/f),n=0;n<k;n++)for(var y=g.getChannelData(n),r=this.audioInBufferIndex,m=c+n,h=0;h<p;h++)b[m]=32768*y[r]&65535,m+=f,r+=
d;e+=p*k;c+=p*k;r<g.length?this.audioInBufferIndex=r:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(a+1,e)},snd_primitiveSoundStopRecording:function(a){this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInProcessor=this.audioInSource=this.audioInBuffers=null,console.log("sound recording stopped"));return!0},snd_primitiveSoundSetRecordLevel:function(a){return!0}},"JPEGReadWriter2Plugin",
{jpeg2_primJPEGPluginIsPresent:function(a){return this.popNandPushIfOK(a+1,this.vm.trueObj)},jpeg2_primImageHeight:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+1,b[1]):!1},jpeg2_primImageWidth:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+1,b[0]):!1},jpeg2_primJPEGCompressStructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGDecompressStructSize:function(a){return this.popNandPushIfOK(a+1,8)},
jpeg2_primJPEGErrorMgr2StructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(a){var b=this.stackNonInteger(2).wordsOrBytes(),c=this.stackNonInteger(1).bytes;if(!b||!c)return!1;var e=this.vm.freeze();this.jpeg2_readImageFromBytes(c,function(a){this.jpeg2state={src:c,img:a};b[0]=a.width;b[1]=a.height;e()}.bind(this),function(){b[0]=0;b[1]=0;e()}.bind(this));return this.popNIfOK(a)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var b=
this.stackNonInteger(3).bytes,c=this.stackNonInteger(2).pointers,e=this.stackBoolean(1);if(!this.success||!b||!c)return!1;var g=this.jpeg2state;if(!g||g.src!==b)return console.error("jpeg read did not match header info"),!1;b=c[Squeak.Form_depth];g=this.jpeg2_getPixelsFromImage(g.img);c=c[Squeak.Form_bits].words;if(32===b)this.jpeg2_copyPixelsToForm32(g,c);else if(16===b)e?this.jpeg2_ditherPixelsToForm16(g,c):this.jpeg2_copyPixelsToForm16(g,c);else return!1;return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(a){this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet");
return!1},jpeg2_readImageFromBytes:function(a,b,c){a=new Blob([a],{type:"image/jpeg"});var e=new Image;e.onload=function(){b(e)};e.onerror=function(){console.warn("could not render JPEG");c()};e.src=(window.URL||window.webkitURL).createObjectURL(a)},jpeg2_getPixelsFromImage:function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return c.getImageData(0,0,a.width,a.height)},jpeg2_copyPixelsToForm32:function(a,b){for(var c=a.data,
e=0;e<b.length;e++)b[e]=4278190080|c[4*e+0]<<16|c[4*e+1]<<8|c[4*e+2]},jpeg2_copyPixelsToForm16:function(a,b){for(var c=a.width,e=a.height,g=a.data,k=0;k<e;k++)for(var f=0;f<c;f+=2){var d=k*e+f,p=g[4*d+4]>>3,n=g[4*d+5]>>3,y=g[4*d+6]>>3,r=g[4*d+0]>>3<<10|g[4*d+1]>>3<<5|g[4*d+2]>>3;0===r&&(r=1);r=r<<16|p<<10|n<<5|y;0===(r&65535)&&(r|=1);b[d>>1]=r}},jpeg2_ditherPixelsToForm16:function(a,b){for(var c=a.width>>1,e=a.height,g=a.data,k=[2,0,14,12,1,3,13,15],f=[10,8,6,4,9,11,5,7],d=0;d<e;d++)for(var p=0;p<
c;p++){var n=d*e+2*p<<2,y=g[n+0],r=g[n+1],m=g[n+2],h=g[n+4],u=g[n+5],A=g[n+6],l=(d&3)<<1|p&1,t=k[l],l=f[l],x,F;x=496*y>>8;F=x&15;x>>=4;y=t<F?x+1:x;x=496*r>>8;F=x&15;x>>=4;r=t<F?x+1:x;x=496*m>>8;F=x&15;x>>=4;m=t<F?x+1:x;x=496*h>>8;F=x&15;x>>=4;h=l<F?x+1:x;x=496*u>>8;F=x&15;x>>=4;u=l<F?x+1:x;x=496*A>>8;F=x&15;x>>=4;A=l<F?x+1:x;y=y<<10|r<<5|m;0===y&&(y=1);y=y<<16|h<<10|u<<5|A;0===(y&65535)&&(y|=1);b[n>>3]=y}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(a){var b=this.stackNonInteger(0).bytesAsString();
if(""==b)return!1;if(/^\/SqueakJS\//.test(b)){var b=b.slice(10),c=Squeak.splitFilePath(b),e=n["squeak-template:"+c.dirname];e&&(b=JSON.parse(e).url+"/"+c.basename)}window.open(b,"_blank");return this.popNIfOK(a)},scratch_primitiveGetFolderPath:function(a){var b=this.stackInteger(0);if(!this.success)return!1;var c;switch(b){case 1:c="/"}if(!c)return!1;this.vm.popNandPush(a+1,this.makeStString(this.filenameToSqueak(c)));return!0}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(a){var b=this.stackNonInteger(1),
c=this.js_objectOrGlobal(b),e=this.stackNonInteger(0).pointers,g=e[0].bytesAsString(),e=e[1].pointers||[],k=!("jsObject"in b),f=null;try{var d=g.match(/([^:]*)/)[0];if(k||"new"!==d){if(!(d in c))return this.js_setError("Property not found: "+d);var p=c[d];if("function"==typeof p&&(!k||0<e.length))f=p.apply(c,this.js_fromStArray(e));else if(0==e.length)f=p;else if(1==e.length)c[d]=this.js_fromStObject(e[0]);else return this.js_setError("Property "+d+" is not a function")}else if(0===e.length)f=new c;
else var n=[null].concat(this.js_fromStArray(e)),f=new (Function.prototype.bind.apply(c,n))}catch(y){return this.js_setError(y.message)}b=this.makeStObject(f,b.sqClass);return this.popNandPushIfOK(a+1,b)},js_primitiveAsString:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(String(b)))},js_primitiveTypeof:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(typeof b))},
js_primitiveAt:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0),e;try{var g=this.js_objectOrGlobal(b),k=this.js_fromStObject(c);e=this.makeStObject(g[k],b.sqClass)}catch(f){return this.js_setError(f.message)}return this.popNandPushIfOK(a+1,e)},js_primitiveAtPut:function(a){var b=this.stackNonInteger(2),c=this.vm.stackValue(1),e=this.vm.stackValue(0);try{var g=this.js_objectOrGlobal(b),k=this.js_fromStObject(c),f=this.js_fromStObject(e);g[k]=f}catch(d){return this.js_setError(d.message)}return this.popNandPushIfOK(a+
1,e)},js_primitiveSqueakAsJSObject:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0);this.success&&(b.jsObject=c);return this.popNIfOK(a)},js_primitiveInitCallbacks:function(a){this.js_callbackSema=this.stackInteger(0);this.js_activeCallback=null;return this.popNIfOK(a)},js_primitiveGetActiveCallbackBlock:function(a){var b=this.js_activeCallback;return b?this.popNandPushIfOK(a+1,b.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(a){var b=this.stackNonInteger(a),
c=this.js_activeCallback;if(!c)return this.js_setError("No active callback");try{var e=this.makeStArray(c.args,b);return this.popNandPushIfOK(a+1,e)}catch(g){return this.js_setError(g.message)}},js_primitiveReturnFromCallback:function(a){if(1!==a)return!1;if(!this.js_activeCallback)return this.js_setError("No active callback");this.js_activeCallback.result=this.vm.pop();this.vm.breakOut();return!0},js_primitiveGetError:function(a){var b=this.makeStObject(this.js_error);this.js_error=null;return this.popNandPushIfOK(a+
1,b)},js_setError:function(a){this.js_error=String(a);return!1},js_fromStObject:function(a){if("number"===typeof a)return a;if(a.jsObject)return a.jsObject;if(a.isFloat)return a["float"];if(a.isNil)return null;if(a.isTrue)return!0;if(a.isFalse)return!1;if(a.bytes||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return a.bytesAsString();if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(a.pointers||[],!0);if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||
a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(a);throw Error("asJSArgument needed for "+a);},js_fromStArray:function(a,b){if(0<a.length&&b&&this.isAssociation(a[0]))return this.js_fromStDict(a);for(var c=[],e=0;e<a.length;e++)c.push(this.js_fromStObject(a[e]));return c},js_fromStDict:function(a){for(var b={},c=0;c<a.length;c++){var e=a[c].pointers;if(!e||2!==e.length)throw Error(e+" is not an Association");var g=this.js_fromStObject(e[0]),e=this.js_fromStObject(e[1]);
b[g]=e}return b},js_fromStBlock:function(a){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var b=a.pointers[Squeak.BlockContext_argumentCount];"number"!==typeof b&&(b=a.pointers[Squeak.Closure_numArgs]);var c=this;return function(){for(var e=[],g=0;g<b;g++)e.push(arguments[g]);return new Promise(function(b,f){setTimeout(function(){c.js_executeCallbackAsync(a,e,b,f)},0)})}},js_executeCallbackAsync:function(a,b,c,e){function g(){k.js_executeCallbackAsync(a,
b,c,e)}var k=this;this.js_activeCallback||this.vm.frozen?setTimeout(g,0):this.js_executeCallback(a,b,c,e)},js_executeCallback:function(a,b,c,e){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:a,args:b,result:null};this.signalSemaphoreWithIndex(this.js_callbackSema);this.vm.forceInterruptCheck();for(a=Date.now()+500;Date.now()<a&&!this.js_activeCallback.result;)this.vm.interpret();a=this.js_activeCallback.result;this.js_activeCallback=null;if(a)try{c(this.js_fromStObject(a))}catch(g){c(a.toString())}else e(Error("SqueakJS timeout"))},
js_objectOrGlobal:function(a){return"jsObject"in a?a.jsObject:window}},"Obsolete",{primitiveFloatArrayAt:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",a)},primitiveFloatArrayMulFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",a)},primitiveFloatArrayAddScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",a)},primitiveFloatArrayDivFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveDivFloatArray",a)},primitiveFloatArrayDivScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",a)},primitiveFloatArrayHash:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",a)},primitiveFloatArrayAtPut:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",a)},primitiveFloatArrayMulScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",a)},primitiveFloatArrayAddFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveAddFloatArray",a)},primitiveFloatArraySubScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",a)},primitiveFloatArraySubFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",a)},primitiveFloatArrayEqual:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",a)},primitiveFloatArrayDotProduct:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",a)},m23PrimitiveInvertRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin",
"primitiveInvertRectInto",a)},m23PrimitiveTransformPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",a)},m23PrimitiveIsPureTranslation:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",a)},m23PrimitiveComposeMatrix:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",a)},m23PrimitiveTransformRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",a)},m23PrimitiveIsIdentity:function(a){return this.namedPrimitive("Matrix2x3Plugin",
"primitiveIsIdentity",a)},m23PrimitiveInvertPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",a)},primitiveDeflateBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",a)},primitiveDeflateUpdateHashTable:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",a)},primitiveUpdateGZipCrc32:function(a){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",a)},primitiveInflateDecompressBlock:function(a){return this.namedPrimitive("ZipPlugin",
"primitiveInflateDecompressBlock",a)},primitiveZipSendBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",a)},primitiveFFTTransformData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",a)},primitiveFFTScaleData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",a)},primitiveFFTPermuteData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",a)},gePrimitiveMergeFillFrom:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveMergeFillFrom",a)},gePrimitiveCopyBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",a)},gePrimitiveAddRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddRect",a)},gePrimitiveAddGradientFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",a)},gePrimitiveSetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",a)},gePrimitiveSetBitBltPlugin:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveSetBitBltPlugin",a)},gePrimitiveRegisterExternalEdge:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",a)},gePrimitiveGetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",a)},gePrimitiveAddBezier:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",a)},gePrimitiveInitializeProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",a)},gePrimitiveRenderImage:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveRenderImage",a)},gePrimitiveGetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",a)},gePrimitiveSetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",a)},gePrimitiveAddBezierShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",a)},gePrimitiveSetEdgeTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",a)},gePrimitiveGetTimes:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveGetTimes",a)},gePrimitiveNextActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",a)},gePrimitiveAddBitmapFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",a)},gePrimitiveGetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",a)},gePrimitiveAbortProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",a)},gePrimitiveNextGlobalEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveNextGlobalEdgeEntry",a)},gePrimitiveGetFailureReason:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",a)},gePrimitiveDisplaySpanBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",a)},gePrimitiveGetCounts:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",a)},gePrimitiveChangedActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",a)},gePrimitiveRenderScanline:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveRenderScanline",a)},gePrimitiveGetBezierStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",a)},gePrimitiveFinishedProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",a)},gePrimitiveNeedsFlush:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",a)},gePrimitiveAddLine:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddLine",a)},gePrimitiveSetOffset:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveSetOffset",a)},gePrimitiveNextFillEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",a)},gePrimitiveInitializeBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",a)},gePrimitiveDoProfileStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",a)},gePrimitiveAddActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",a)},gePrimitiveSetAALevel:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveSetAALevel",a)},gePrimitiveNeedsFlushPut:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",a)},gePrimitiveAddCompressedShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",a)},gePrimitiveSetColorTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",a)},gePrimitiveAddOval:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddOval",a)},gePrimitiveRegisterExternalFill:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveRegisterExternalFill",a)},gePrimitiveAddPolygon:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",a)},gePrimitiveGetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",a)}});Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(a){this.vm=a;this.remappableOops=[];Object.defineProperty(this,"successFlag",{get:function(){return a.primHandler.success},set:function(b){a.primHandler.success=
b}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(a){this.successFlag=!1},success:function(a){a||(this.successFlag=!1)}},"stack access",{pop:function(a){this.vm.popN(a)},popthenPush:function(a,b){this.vm.popNandPush(a,b)},push:function(a){this.vm.push(a)},pushBool:function(a){this.vm.push(a?this.vm.trueObj:this.vm.falseObj)},
pushInteger:function(a){this.vm.push(a)},pushFloat:function(a){this.vm.push(this.floatObjectOf(a))},stackValue:function(a){return this.vm.stackValue(a)},stackIntegerValue:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;this.successFlag=!1;return 0},stackFloatValue:function(a){this.vm.success=!0;a=this.vm.stackIntOrFloat(a);if(this.vm.success)return a;this.successFlag=!1;return 0},stackObjectValue:function(a){a=this.vm.stackValue(a);if("number"!==typeof a)return a;this.successFlag=
!1;return this.vm.nilObj},stackBytes:function(a){a=this.vm.stackValue(a);if(a.bytes)return a.bytes;"number"!==typeof a&&a.isBytes()||(this.successFlag=!1);return[]},stackWords:function(a){a=this.vm.stackValue(a);if(a.words)return a.words;"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt32Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsInt32Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt16Array:function(a){a=this.vm.stackValue(a);
if(a.words)return a.wordsAsInt16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackUint16Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsUint16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]}},"object access",{isBytes:function(a){return"number"!==typeof a&&a.isBytes()},isWords:function(a){return"number"!==typeof a&&a.isWords()},isWordsOrBytes:function(a){return"number"!==typeof a&&a.isWordsOrBytes()},isPointers:function(a){return"number"!==
typeof a&&a.isPointers()},isIntegerValue:function(a){return"number"===typeof a&&-1073741824<=a&&1073741823>=a},isArray:function(a){return a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(a,b){var c=a.sqClass.pointers[Squeak.Class_name].bytes;if(b.length!==c.length)return!1;for(var e=0;e<b.length;e++)if(b.charCodeAt(e)!==c[e])return!1;return!0},booleanValueOf:function(a){return a.isTrue?!0:a.isFalse?!1:this.successFlag=!1},positive32BitValueOf:function(a){return this.vm.primHandler.positive32BitValueOf(a)},
positive32BitIntegerFor:function(a){return this.vm.primHandler.pos32BitIntFor(a)},floatValueOf:function(a){if(a.isFloat)return a["float"];this.successFlag=!1;return 0},floatObjectOf:function(a){return this.vm.primHandler.makeFloat(a)},fetchPointerofObject:function(a,b){return b.pointers[a]},fetchBytesofObject:function(a,b){var c=b.pointers[a];if(c.bytes)return c.bytes;if(c.words)return c.wordsAsUint8Array();"number"!==typeof c&&c.isWordsOrBytes()||(this.successFlag=!1);return[]},fetchWordsofObject:function(a,
b){var c=b.pointers[a];if(c.words)return c.words;"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchInt32ArrayofObject:function(a,b){var c=b.pointers[a];if(c.words)return c.wordsAsInt32Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchInt16ArrayofObject:function(a,b){var c=b.pointers[a];if(c.words)return c.wordsAsInt16Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchUint16ArrayofObject:function(a,b){var c=b.pointers[a];
if(c.words)return c.wordsAsUint16Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchIntegerofObject:function(a,b){var c=b.pointers[a];if("number"===typeof c)return c;this.successFlag=!1;return 0},fetchLong32ofObject:function(a,b){return b.words[a]},fetchFloatofObject:function(a,b){return this.floatValueOf(b.pointers[a])},storeIntegerofObjectwithValue:function(a,b,c){"number"===typeof c?b.pointers[a]=c:this.successFlag=!1},storePointerofObjectwithValue:function(a,b,c){b.pointers[a]=
c},stObjectatput:function(a,b,c){if(a.sqClass!==this.classArray())throw Error("Array expected");if(1>b||b>=a.pointers.length)return this.successFlag=!1;a.pointers[b]=c}},"constant access",{isKindOfInteger:function(a){return"number"===typeof a||a.sqClass==this.classLargeNegativeInteger()||a.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},
classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},
"vm functions",{instantiateClassindexableSize:function(a,b){return this.vm.instantiateClass(a,b)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(a,b){return this.vm.primHandler.makePointWithXandY(a,b)},pushRemappableOop:function(a){this.remappableOops.push(a)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(a,b,c,e,g){b<e&&c<g&&this.vm.primHandler.displayDirty(a,{left:b,top:c,right:e,bottom:g})},ioLoadFunctionFrom:function(a,
b){return this.vm.primHandler.loadFunctionFrom(a,b)}});Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(a,b){this.method=a;this.vm=b}},"printing",{printInstructions:function(a,b,c){this.indent=a;this.highlight=b;this.highlightPC=c;this.innerIndents={};this.result="";this.scanner=new Squeak.InstructionStream(this.method,this.vm);this.oldPC=this.scanner.pc;this.endPC=0;for(this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(a){this.oldPC===
this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent);this.result+=this.oldPC;for(var b=0;b<this.innerIndents[this.oldPC];b++)this.result+="   ";this.result+=" <";for(b=this.oldPC;b<this.scanner.pc;b++)b>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[b]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+a+"\n";this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},
doPop:function(){this.print("pop")},jump:function(a){this.print("jumpTo: "+(this.scanner.pc+a));this.scanner.pc+a>this.endPC&&(this.endPC=this.scanner.pc+a)},jumpIf:function(a,b){this.print((a?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+b));this.scanner.pc+b>this.endPC&&(this.endPC=this.scanner.pc+b)},methodReturnReceiver:function(){this.print("return: receiver");this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack");this.done=this.scanner.pc>this.endPC},
methodReturnConstant:function(a){this.print("returnConst: "+a.toString());this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(a){this.print("popIntoBinding: "+a.assnKeyAsString())},popIntoReceiverVariable:function(a){this.print("popIntoInstVar: "+a)},popIntoTemporaryVariable:function(a){this.print("popIntoTemp: "+a)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(a){a=a.sqInstName?a.sqInstName():a.toString();this.print("pushConst: "+a)},pushLiteralVariable:function(a){this.print("pushBinding: "+
a.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(a){this.print("pushInstVar: "+a)},pushTemporaryVariable:function(a){this.print("pushTemp: "+a)},send:function(a,b,c){this.print((c?"superSend: #":"send: #")+(a.bytesAsString?a.bytesAsString():a))},storeIntoLiteralVariable:function(a){this.print("storeIntoBinding: "+a.assnKeyAsString())},storeIntoReceiverVariable:function(a){this.print("storeIntoInstVar: "+a)},storeIntoTemporaryVariable:function(a){this.print("storeIntoTemp: "+
a)},pushNewArray:function(a){this.print("push: (Array new: "+a+")")},popIntoNewArray:function(a){this.print("pop: "+a+" into: (Array new: "+a+")")},pushRemoteTemp:function(a,b){this.print("push: "+a+" ofTemp: "+b)},storeIntoRemoteTemp:function(a,b){this.print("storeInto: "+a+" ofTemp: "+b)},popIntoRemoteTemp:function(a,b){this.print("popInto: "+a+" ofTemp: "+b)},pushClosureCopy:function(a,b,c){var e=this.scanner.pc;c=e+c;this.print("closure("+e+"-"+(c-1)+"): "+a+" copied, "+b+" args");for(a=e;a<c;a++)this.innerIndents[a]=
(this.innerIndents[a]||0)+1;c>this.endPC&&(this.endPC=c)},callPrimitive:function(a){this.print("primitive: "+a)}});Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(a,b){this.vm=b;this.method=a;this.pc=0;this.specialConstants=[b.trueObj,b.falseObj,b.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(a){var b=this.method,c=b.bytes[this.pc++],e=c/16|0,g=c%16;if(0===e)return a.pushReceiverVariable(g);if(1===e)return a.pushTemporaryVariable(g);if(2===e)return a.pushConstant(b.methodGetLiteral(g));
if(3===e)return a.pushConstant(b.methodGetLiteral(g+16));if(4===e)return a.pushLiteralVariable(b.methodGetLiteral(g));if(5===e)return a.pushLiteralVariable(b.methodGetLiteral(g+16));if(6===e)return 8>g?a.popIntoReceiverVariable(g):a.popIntoTemporaryVariable(g-8);if(7===e){if(0===g)return a.pushReceiver();if(8>g)return a.pushConstant(this.specialConstants[g-1]);if(8===g)return a.methodReturnReceiver();if(12>g)return a.methodReturnConstant(this.specialConstants[g-9]);if(12===g)return a.methodReturnTop();
if(13===g)return a.blockReturnTop();if(13<g)throw Error("unusedBytecode");}if(8===e)return this.interpretExtension(g,b,a);if(9===e)return 8>g?a.jump(g+1):a.jumpIf(!1,g-8+1);if(10===e)return c=this.method.bytes[this.pc++],8>g?a.jump(256*(g-4)+c):a.jumpIf(12>g,256*(g&3)+c);if(11===e)return a.send(this.vm.specialSelectors[2*g],this.vm.specialSelectors[2*g+1],!1);if(12===e)return a.send(this.vm.specialSelectors[2*(g+16)],this.vm.specialSelectors[2*(g+16)+1],!1);if(12<e)return a.send(b.methodGetLiteral(g),
e-13,!1)},interpretExtension:function(a,b,c){if(6>=a){b=this.method.bytes[this.pc++];if(2>=a){var e=b/64|0,g=b%64;if(0===a){if(0===e)return c.pushReceiverVariable(g);if(1===e)return c.pushTemporaryVariable(g);if(2===e)return c.pushConstant(this.method.methodGetLiteral(g));if(3===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g))}if(1===a){if(0===e)return c.storeIntoReceiverVariable(g);if(1===e)return c.storeIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(2===
a){if(0===e)return c.popIntoReceiverVariable(g);if(1===e)return c.popIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.popIntoLiteralVariable(this.method.methodGetLiteral(g))}}if(3===a)return c.send(this.method.methodGetLiteral(b%32),b/32|0,!1);if(4===a){g=this.method.bytes[this.pc++];e=b/32|0;if(0===e)return c.send(this.method.methodGetLiteral(g),b%32,!1);if(1===e)return c.send(this.method.methodGetLiteral(g),b%32,!0);if(2===e)return c.pushReceiverVariable(g);if(3===
e)return c.pushConstant(this.method.methodGetLiteral(g));if(4===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g));if(5===e)return c.storeIntoReceiverVariable(g);if(6===e)return c.popIntoReceiverVariable(g);if(7===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(5===a)return c.send(this.method.methodGetLiteral(b&31),b>>5,!0);if(6===a)return c.send(this.method.methodGetLiteral(b&63),b>>6,!1)}if(7===a)return c.doPop();if(8===a)return c.doDup();if(9===a)return c.pushActiveContext();
b=this.method.bytes[this.pc++];if(10===a)return 128>b?c.pushNewArray(b):c.popIntoNewArray(b-128);g=this.method.bytes[this.pc++];if(11===a)return c.callPrimitive(b+256*g);if(12===a)return c.pushRemoteTemp(b,g);if(13===a)return c.storeIntoRemoteTemp(b,g);if(14===a)return c.popIntoRemoteTemp(b,g);a=this.method.bytes[this.pc++];return c.pushClosureCopy(b>>4,b&15,256*g+a)}})});module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(n){this.vm=n;this.comments=!!Squeak.Compiler.comments;this.specialSelectors="+ - < > <= >= = ~= * / \\ @ bitShift: // bitAnd: bitOr: at: at:put: size next nextPut: atEnd == class blockCopy: value value: do: new new: x y".split(" ")}},"accessing",{compile:function(n,a,b){void 0===n.compiled?n.compiled=!1:(this.singleStep=!1,this.debug=this.comments,
a=a&&a.className(),b=b&&b.bytesAsString(),n.compiled=this.generate(n,a,b))},enableSingleStepping:function(n,a,b){n.compiled&&n.compiled.canSingleStep||(this.debug=this.singleStep=!0,a=this.vm.printMethod(n,a,b).split(">>"),n.compiled=this.generate(n,a[0],a[1]),n.compiled.canSingleStep=!0);return!0},functionNameFor:function(n,a){if(!n||!a)return"Squeak_DOIT";if(!/[^a-zA-Z0-9:_]/.test(a))return(n+"_"+a).replace(/[: ]/g,"_");var b=a.replace(/./g,function(a){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",
">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[a]||"OPERATOR"});return n.replace(/[ ]/,"_")+"__"+b+"__"}},"generating",{generate:function(n,a,b){this.method=n;this.prevPC=this.endPC=this.pc=0;this.source=[];this.sourceLabels={};this.needsLabel={};this.sourcePos={};this.needsVar={};this.needsBreak=!1;a&&b&&this.source.push("// ",a,">>",b,"\n");this.allVars="context stack rcvr inst[ temp[ lit[".split(" ");this.sourcePos.context=this.source.length;
this.source.push("var context = vm.activeContext;\n");this.sourcePos.stack=this.source.length;this.source.push("var stack = context.pointers;\n");this.sourcePos.rcvr=this.source.length;this.source.push("var rcvr = vm.receiver;\n");this.sourcePos["inst["]=this.source.length;this.source.push("var inst = rcvr.pointers;\n");this.sourcePos["temp["]=this.source.length;this.source.push("var temp = vm.homeContext.pointers;\n");this.sourcePos["lit["]=this.source.length;this.source.push("var lit = vm.method.pointers;\n");
this.sourcePos["loop-start"]=this.source.length;this.source.push("while (true) switch (vm.pc) {\ncase 0:\n");for(this.done=!1;!this.done;){var c=n.bytes[this.pc++],e;switch(c&248){case 0:case 8:this.generatePush("inst[",c&15,"]");break;case 16:case 24:this.generatePush("temp[",6+(c&15),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(c&31),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(c&31),"].pointers[1]");break;case 96:this.generatePopInto("inst[",
c&7,"]");break;case 104:this.generatePopInto("temp[",6+(c&7),"]");break;case 112:switch(c){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(c){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");
break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode");}break;case 128:case 136:this.generateExtended(c);break;case 144:this.generateJump((c&7)+1);break;case 152:this.generateJumpIf(!1,(c&7)+1);break;case 160:e=n.bytes[this.pc++];this.generateJump(256*((c&7)-4)+e);break;case 168:e=n.bytes[this.pc++];this.generateJumpIf(172>
c,256*(c&3)+e);break;case 176:case 184:this.generateNumericOp(c);break;case 192:case 200:this.generateQuickPrim(c);break;case 208:case 216:this.generateSend("lit[",1+(c&15),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(c&15),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(c&15),"]",2,!1)}}n=this.functionNameFor(a,b);this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC');\n}")):(this.sourcePos["loop-end"]=
this.source.length,this.source.push("default: vm.interpretOne(true); return;\n}"),this.deleteUnneededLabels());this.deleteUnneededVariables();return(new Function("'use strict';\nreturn function "+n+"(vm) {\n"+this.source.join("")+"}"))()},generateExtended:function(n){var a;switch(n){case 128:switch(n=this.method.bytes[this.pc++],n>>6){case 0:this.generatePush("inst[",n&63,"]");return;case 1:this.generatePush("temp[",6+(n&63),"]");return;case 2:this.generatePush("lit[",1+(n&63),"]");return;case 3:this.generatePush("lit[",
1+(n&63),"].pointers[1]");return}case 129:n=this.method.bytes[this.pc++];switch(n>>6){case 0:this.generateStoreInto("inst[",n&63,"]");break;case 1:this.generateStoreInto("temp[",6+(n&63),"]");break;case 2:throw Error("illegal store into literal");case 3:this.generateStoreInto("lit[",1+(n&63),"].pointers[1]")}break;case 130:switch(n=this.method.bytes[this.pc++],n>>6){case 0:this.generatePopInto("inst[",n&63,"]");return;case 1:this.generatePopInto("temp[",6+(n&63),"]");return;case 2:throw Error("illegal pop into literal");
case 3:this.generatePopInto("lit[",1+(n&63),"].pointers[1]");return}case 131:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&31),"]",n>>5,!1);break;case 132:switch(n=this.method.bytes[this.pc++],a=this.method.bytes[this.pc++],n>>5){case 0:this.generateSend("lit[",1+a,"]",n&31,!1);return;case 1:this.generateSend("lit[",1+a,"]",n&31,!0);return;case 2:this.generatePush("inst[",a,"]");return;case 3:this.generatePush("lit[",1+a,"]");return;case 4:this.generatePush("lit[",1+a,"].pointers[1]");
return;case 5:this.generateStoreInto("inst[",a,"]");return;case 6:this.generatePopInto("inst[",a,"]");return;case 7:this.generateStoreInto("lit[",1+a,"].pointers[1]");return}case 133:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&31),"]",n>>5,!0);break;case 134:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&63),"]",n>>6,!1);break;case 135:this.generateInstruction("pop","vm.sp--");break;case 136:this.needsVar.stack=!0;this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");
break;case 137:this.needsVar.stack=!0;this.generateInstruction("thisContext","stack[++vm.sp] = vm.exportThisContext()");break;case 138:n=this.method.bytes[this.pc++];this.generateClosureTemps(n&127,127<n);break;case 139:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generateCallPrimitive(n+256*a);break;case 140:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePush("temp[",6+a,"].pointers[",n,"]");break;case 141:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];
this.generateStoreInto("temp[",6+a,"].pointers[",n,"]");break;case 142:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePopInto("temp[",6+a,"].pointers[",n,"]");break;case 143:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];var b=this.method.bytes[this.pc++];this.generateClosureCopy(n&15,n>>4,a<<8|b)}},generatePush:function(n,a,b,c,e){this.debug&&this.generateDebugCode("push");this.generateLabel();this.needsVar[n]=!0;this.needsVar.stack=!0;this.source.push("stack[++vm.sp] = ",
n);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(";\n")},generateStoreInto:function(n,a,b,c,e){this.debug&&this.generateDebugCode("store into");this.generateLabel();this.needsVar[n]=!0;this.needsVar.stack=!0;this.source.push(n);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp];\n");this.generateDirty(n,a)},generatePopInto:function(n,a,b,c,e){this.debug&&this.generateDebugCode("pop into");this.generateLabel();
this.needsVar[n]=!0;this.needsVar.stack=!0;this.source.push(n);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp--];\n");this.generateDirty(n,a)},generateReturn:function(n){this.debug&&this.generateDebugCode("return");this.generateLabel();this.needsVar[n]=!0;this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",n,"); return;\n");this.needsBreak=!1;this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return");
this.generateLabel();this.needsVar.stack=!0;this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return;\n");this.needsBreak=!1},generateJump:function(n){var a=this.pc+n;this.debug&&this.generateDebugCode("jump to "+a);this.generateLabel();this.needsVar.context=!0;this.source.push("vm.pc = ",a,"; ");0>n&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n",
"}\n");this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return;\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[a]=!0;a>this.endPC&&(this.endPC=a)},generateJumpIf:function(n,a){var b=this.pc+a;this.debug&&this.generateDebugCode("jump if "+n+" to "+b);this.generateLabel();this.needsVar.stack=!0;this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",n,"Obj) {vm.pc = ",b,"; ");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return; else ");
this.source.push("continue}\n","else if (cond !== vm.",!n,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return}\n");this.needsLabel[this.pc]=!0;this.needsLabel[b]=!0;b>this.endPC&&(this.endPC=b)},generateQuickPrim:function(n){this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[(n&15)+16]);this.generateLabel();switch(n){case 194:this.needsVar.stack=!0;this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n",
"else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }\n");this.needsLabel[this.pc]=!0;return;case 198:this.needsVar.stack=!0;this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");return;case 199:this.needsVar.stack=!0;this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");
return;case 200:this.needsVar.rcvr=!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,")) ","{vm.sendSpecial(",(n&15)+16,"); return}\n");this.needsLabel[this.pc]=!0;this.needsLabel[this.pc+2]=!0;return;case 201:case 202:case 203:this.needsVar.rcvr=!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,")) vm.sendSpecial(",(n&15)+16,"); return;\n");this.needsLabel[this.pc]=!0;return}this.needsVar.rcvr=!0;this.needsVar.context=
!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,"))"," vm.sendSpecial(",(n&15)+16,");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n");this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateNumericOp:function(n){this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[n&15]);this.generateLabel();this.needsLabel[this.pc]=!0;switch(n){case 176:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n",
"if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 177:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",
this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 178:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 179:this.needsVar.stack=
!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 180:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n",
"} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 181:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 182:this.needsVar.stack=
!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 183:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n",
"if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 184:this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",
this.pc,"; vm.sendSpecial(8); return}\n");break;case 185:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return}\n");break;case 186:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return}\n");break;case 187:this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",
this.pc,"; vm.sendSpecial(11); return}\n");break;case 188:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return}\n");break;case 189:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return}\n");break;case 190:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",
this.pc,"; vm.sendSpecial(14); return}\n");break;case 191:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return}\n")}},generateSend:function(n,a,b,c,e){this.debug&&this.generateDebugCode("send "+("lit["===n?this.method.pointers[a].bytesAsString():"..."));this.generateLabel();this.needsVar[n]=!0;this.needsVar.context=!0;this.source.push("vm.pc = ",this.pc,"; vm.send(",n,a,b,", ",c,", ",e,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n");
this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateClosureTemps:function(n,a){this.debug&&this.generateDebugCode("closure temps");this.generateLabel();this.needsVar.stack=!0;this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",n,");\n");if(a){for(var b=0;b<n;b++)this.source.push("array.pointers[",b,"] = stack[vm.sp - ",n-b-1,"];\n");this.source.push("stack[vm.sp -= ",n-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(n,a,
b){var c=this.pc;b=c+b;this.debug&&this.generateDebugCode("push closure("+c+"-"+(b-1)+"): "+a+" copied, "+n+" args");this.generateLabel();this.needsVar.stack=!0;this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",a,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",c+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",n,";\n");if(0<a){for(n=0;n<a;n++)this.source.push("closure.pointers[",n+3,"] = stack[vm.sp - ",a-
n-1,"];\n");this.source.push("stack[vm.sp -= ",a-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",b,";\n");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return;\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[c]=!0;this.needsLabel[b]=!0;b>this.endPC&&(this.endPC=b)},generateCallPrimitive:function(n){this.debug&&this.generateDebugCode("call primitive "+n);this.generateLabel();129===this.method.bytes[this.pc]&&
(this.needsVar.stack=!0,this.source.push("if (vm.primFailCode) {stack[vm.sp] = vm.getErrorObjectFromPrimFailCode(); vm.primFailCode = 0;}\n"))},generateDirty:function(n,a){switch(n){case "inst[":this.source.push("rcvr.dirty = true;\n");break;case "lit[":this.source.push(n,a,"].dirty = true;\n");break;case "temp[":break;default:throw Error("unexpected target "+n);}},generateLabel:function(){this.prevPC&&(this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n"));
this.prevPC=this.pc},generateDebugCode:function(n){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) {vm.pc = ",this.prevPC,"; return}\n"),this.needsLabel[this.prevPC]=!0);for(var a=[],b=this.prevPC;b<this.pc;b++)a.push((this.method.bytes[b]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",a.join(" "),"> ",n,"\n");this.needsBreak=this.singleStep},generateInstruction:function(n,a){this.debug&&this.generateDebugCode(n);this.generateLabel();this.source.push(a,
";\n")},deleteUnneededLabels:function(){var n=!1,a;for(a in this.sourceLabels)if(this.needsLabel[a])n=!0;else for(var b=0;3>b;b++)this.source[this.sourceLabels[a]+b]="";n||(this.source[this.sourcePos["loop-start"]]="",this.source[this.sourcePos["loop-end"]]="")},deleteUnneededVariables:function(){this.needsVar.stack&&(this.needsVar.context=!0);this.needsVar["inst["]&&(this.needsVar.rcvr=!0);for(var n=0;n<this.allVars.length;n++){var a=this.allVars[n];this.needsVar[a]||(this.source[this.sourcePos[a]]=
"")}}})});module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b){return 31<b?0:a>>>b}function a(a){var b,d;for(b=0;;)if(d=a-c,0<d)b+=31<d?0:g<<d,a-=c,g=k[++e-1],c=8;else return b+=n(g,0-d),c-=a,g&=n(255,8-c),b}function b(a,b){var d,f,m,h;f=b;for(m=a;;)if(d=8-c,h=d-m,0>h)g+=n(f,0-h),k[++e-1]=g,g=c=0,h=0-h,f&=(31<h?0:1<<h)-1,m-=d;else return g+=31<h?0:f<<h,c+=m,self}var c=0,e=0,g=0,k=null,f=null,d=null;Squeak.registerExternalModule("ADPCMCodecPlugin",
{primitiveDecodeStereo:function(){var b,n,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I,H,C,D,v,N,P,M,O;b=f.stackValue(1);n=f.stackIntegerValue(0);N=f.fetchInt16ArrayofObject(0,b);D=f.fetchInt16ArrayofObject(1,b);E=f.fetchIntegerofObject(2,b);H=f.fetchIntegerofObject(3,b);I=f.fetchIntegerofObject(4,b);C=f.fetchIntegerofObject(5,b);g=f.fetchIntegerofObject(6,b);c=f.fetchIntegerofObject(7,b);e=f.fetchIntegerofObject(8,b);k=f.fetchBytesofObject(9,b);O=f.fetchInt16ArrayofObject(10,b);P=f.fetchInt16ArrayofObject(11,b);
M=f.fetchIntegerofObject(12,b);J=f.fetchIntegerofObject(13,b);d=f.fetchInt16ArrayofObject(14,b);v=f.fetchInt16ArrayofObject(15,b);if(f.failed())return null;x=N[0];F=N[1];u=D[0];A=D[1];for(h=1;h<=n;h++){if(1===(h&C))x=a(16),u=a(6),F=a(16),A=a(6),32767<x&&(x-=65536),32767<F&&(F-=65536);else{r=a(J);m=a(J);w=d[u];L=d[A];l=t=0;for(y=I;0<y;)0<(r&y)&&(l+=w),0<(m&y)&&(t+=L),w>>>=1,L>>>=1,y>>>=1;l+=w;t+=L;x=0<(r&E)?x-l:x+l;F=0<(m&E)?F-t:F+t;32767<x?x=32767:-32768>x&&(x=-32768);32767<F?F=32767:-32768>F&&(F=
-32768);u+=v[r&H];0>u?u=0:88<u&&(u=88);A+=v[m&H];0>A?A=0:88<A&&(A=88)}O[++M-1]=x;P[M-1]=F}N[0]=x;N[1]=F;D[0]=u;D[1]=A;if(f.failed())return null;f.storeIntegerofObjectwithValue(6,b,g);f.storeIntegerofObjectwithValue(7,b,c);f.storeIntegerofObjectwithValue(8,b,e);f.storeIntegerofObjectwithValue(12,b,M);f.pop(1)},primitiveEncodeStereo:function(){var a;a=f.stackValue(1);f.stackIntegerValue(0);g=f.fetchIntegerofObject(6,a);c=f.fetchIntegerofObject(7,a);e=f.fetchIntegerofObject(8,a);k=f.fetchIntegerofObject(9,
a);d=f.fetchIntegerofObject(14,a);if(f.failed())return null;success(!1);if(f.failed())return null;f.storeIntegerofObjectwithValue(6,a,g);f.storeIntegerofObjectwithValue(7,a,c);f.storeIntegerofObjectwithValue(8,a,e);f.pop(1)},setInterpreter:function(a){f=a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},primitiveEncodeMono:function(){var a,n,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I,H,C;a=f.stackValue(1);n=f.stackIntegerValue(0);I=f.fetchIntegerofObject(0,a);J=f.fetchIntegerofObject(1,a);F=f.fetchIntegerofObject(2,
a);w=f.fetchIntegerofObject(4,a);L=f.fetchIntegerofObject(5,a);g=f.fetchIntegerofObject(6,a);c=f.fetchIntegerofObject(7,a);e=f.fetchIntegerofObject(8,a);k=f.fetchBytesofObject(9,a);C=f.fetchInt16ArrayofObject(10,a);H=f.fetchIntegerofObject(12,a);x=f.fetchIntegerofObject(13,a);d=f.fetchInt16ArrayofObject(14,a);E=f.fetchInt16ArrayofObject(15,a);if(f.failed())return null;t=d[0];for(h=1;h<=n;h++)if(1===(h&L)){I=C[++H-1];0>(u=I)&&(u+=65536);b(16,u);if(h<n){r=C[H]-I;0>r&&(r=0-r);y=63;for(m=1;62>=m;m++)63===
y&&d[m-1]>=r&&(y=m);J=y}b(6,J)}else{l=0;m=C[++H-1]-I;0>m&&(l=F,m=0-m);A=r=0;for(y=w;0<y;)m>=t&&(r+=y,A+=t,m-=t),t>>>=1,y>>>=1;A+=t;I=0<l?I-A:I+A;32767<I?I=32767:-32768>I&&(I=-32768);J+=E[r];0>J?J=0:88<J&&(J=88);t=d[J];b(x,l|r)}0<c&&(k[++e-1]=g);if(f.failed())return null;f.storeIntegerofObjectwithValue(0,a,I);f.storeIntegerofObjectwithValue(1,a,J);f.storeIntegerofObjectwithValue(6,a,g);f.storeIntegerofObjectwithValue(7,a,c);f.storeIntegerofObjectwithValue(8,a,e);f.storeIntegerofObjectwithValue(12,
a,H);f.pop(1)},primitiveDecodeMono:function(){var b,n,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I;b=f.stackValue(1);n=f.stackIntegerValue(0);J=f.fetchIntegerofObject(0,b);w=f.fetchIntegerofObject(1,b);l=f.fetchIntegerofObject(2,b);x=f.fetchIntegerofObject(3,b);t=f.fetchIntegerofObject(4,b);F=f.fetchIntegerofObject(5,b);g=f.fetchIntegerofObject(6,b);c=f.fetchIntegerofObject(7,b);e=f.fetchIntegerofObject(8,b);k=f.fetchBytesofObject(9,b);I=f.fetchInt16ArrayofObject(10,b);E=f.fetchIntegerofObject(12,b);A=f.fetchIntegerofObject(13,
b);d=f.fetchInt16ArrayofObject(14,b);L=f.fetchInt16ArrayofObject(15,b);if(f.failed())return null;for(m=1;m<=n;m++){if(1===(m&F))J=a(16),32767<J&&(J-=65536),w=a(6);else{r=a(A);u=d[w];h=0;for(y=t;0<y;)0<(r&y)&&(h+=u),u>>>=1,y>>>=1;h+=u;J=0<(r&l)?J-h:J+h;32767<J?J=32767:-32768>J&&(J=-32768);w+=L[r&x];0>w?w=0:88<w&&(w=88)}I[++E-1]=J}if(f.failed())return null;f.storeIntegerofObjectwithValue(0,b,J);f.storeIntegerofObjectwithValue(1,b,w);f.storeIntegerofObjectwithValue(6,b,g);f.storeIntegerofObjectwithValue(7,
b,c);f.storeIntegerofObjectwithValue(8,b,e);f.storeIntegerofObjectwithValue(12,b,E);f.pop(1)},getModuleName:function(){return"ADPCMCodecPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?q.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 31<b?0:a<<b}function c(a,b){return 31<b?0:a>>>b}function e(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function g(a,b){return new Float32Array(a.buffer,a.byteOffset+4*b)}function k(a,b){var c;c=a+z[48]-
1&~(z[48]-1);return c>b?b:c}function f(){return z[49]}function d(a,b){if(0===a)return 0>b?0-b:b;if(0===b)return 0>a?0-a:a;var c;c=a*a+b*b;c=32>c?[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6][c]:Math.sqrt(c)+.5|0;return c}function p(a){if(!y(1))return 0;Ea[z[12]]=a;z[12]+=1}function B(){Pb(6);return ra()}function y(a){var b,c,d,h;if(!Ka(a))return!1;if(0!==z[14])for(d=z[14],b=z[14]+a,c=1,h=z[14];c<=h;c++)S[--b]=S[--d];S=e(S,a);return!0}function r(a){var b,c,d,h;if(!y(a))return!1;
if(0!==z[12])for(d=z[12],b=z[12]+a,c=1,h=z[12];c<=h;c++)Ea[--b]=Ea[--d];Ea=e(Ea,a);return!0}function m(a,b,c){if(b>c){if(a>b)return b;if(a<c)return c}else{if(a<b)return b;if(a>c)return c}return a}function h(a){return e(G,a+10)}function u(a,d,h,l){var f,m,u;f=G[a+12];m=G[a+14];if(32===f)return d=d[m*l+h]|0,0!==d&&0===(d&4278190080)&&(d|=4278190080),$a(d);u=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1][f];d=d[m*l+c(h,u)];l=b(1,f)-1;u=32-f-(h&b(1,u)-1)*f;d=c(d,u)&l;16===f?0!==d&&(a=(d&31)<<3,h=(d>>>5&31)<<3,f=
(d>>>10&31)<<3,d=a+(a>>>5)+(h+(h>>>5)<<8)+(f+(f>>>5)<<16)+-16777216):d=0===G[a+15]?0:e(G,a+18)[d];return $a(d)}function A(a){return Aa(ra()-a+4)}function l(a,b){return Ab(ra()-a+4,b)}function t(a){return Aa(ra()-a+5)}function x(a,b){return Ab(ra()-a+5,b)}function F(a){return Aa(ra()-a+0)}function w(a,b){return Ab(ra()-a+0,b)}function L(a){return Aa(ra()-a+1)}function J(a,b){return Ab(ra()-a+1,b)}function E(a){return Aa(ra()-a+2)}function I(a,b){return Ab(ra()-a+2,b)}function H(a){return Aa(ra()-a+
3)}function C(a,b){return Ab(ra()-a+3,b)}function D(b,c,d){var h,e,l,f,m;e=a(b);b=b.wordsAsInt32Array();for(h=l=0;h<=e-1;h++){f=(b[h]|0)>>>16;m=(b[h]|0)&65535;if(!(0<=m&&m<=c))return!1;l+=f}return l===d}function v(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,
-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function N(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,
-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function P(a,b){return 0>a?0:a>=b?b-1:a}function M(){var a,b;a=c(z[32],f());b=c(z[34],f())+1;0>a&&(a=0);for(b>z[33]&&(b=z[33]);a<b;)ba[a]=0,++a;z[32]=z[33];z[34]=0}function O(a,b){var c,d,h,e,f,u,g,k,N,n,r;h=k=F(a);e=f=L(a);u=n=E(a);g=r=H(a);c=A(a);d=t(a);k=h+=(n-k)*b|0;N=e+=(r-
f)*b|0;u+=(c-n)*b|0;g+=(d-r)*b|0;k+=(u-h)*b|0;N+=(g-e)*b|0;e=m(e,f,N);g=m(g,N,d);f=B();if(aa)return 0;I(a,h);C(a,e);l(a,k);x(a,N);w(f,k);J(f,N);I(f,u);C(f,g);l(f,c);x(f,d);return f}function X(a){var b,c,d,h,e,f,m,u,g,k,N;e=B();if(aa)return 0;d=u=F(a);h=k=L(a);f=N=E(a);m=g=H(a);b=A(a);c=t(a);d+=N-u>>1;h+=g-k>>1;u=f+=b-N>>1;g=m+=c-g>>1;u+=d-f>>1;g+=h-m>>1;I(a,d);C(a,h);l(a,u);x(a,g);w(e,u);J(e,g);I(e,f);C(e,m);l(e,b);x(e,c);return e}function W(a,b){var c,d,e;c=h(a)[0]>>8;d=Na(a)[0]>>8;c>d&&(e=c,c=d,
d=e);Z(a,c);d-c>b?G[a+17]=d-c:G[a+17]=b}function Q(){return z[88]}function oa(a){var b,d;b=c(z[32],f());b<z[42]&&(b=z[42]);d=c(z[34]+z[48]-1,f());d>z[43]&&(d=z[43]);a=c(a,f());if(a<z[44]||a>=z[45]||d<z[42]||b>=z[43])return 0;(rb||lb())&&rb(b,d,a)}function U(a){return G[a+4]}function Z(a,b){return G[a+4]=b}function T(a,b){return G[a+5]=b}function xa(a,b){var c,d,h;R();d=a;for(h=db();h<b;){c=R();if(0!==c&&La(c,d,h))return!0;gc(h);d=h;h=db()}c=R();return 0!==c?La(c,d,b):!1}function la(a,b,d){var h;if(1!==
z[48]){var e,l,m,u,g;l=k(b,d);u=d-1&~(z[48]-1);h=z[48];e=f();if(b<l)for(g=c(a&z[51],z[50]);b<l;)m=c(b,e),ba[m]+=g,++b;if(b<u)for(l=c(z[51],f())|4042322160,g=c(a&l,f());b<u;)m=c(b,e),ba[m]+=g,b+=h;if(b<d)for(g=c(a&z[51],z[50]);b<d;)m=c(b,e),ba[m]+=g,++b}else{for(h=b;h+4<d;)ba[h]=a,ba[h+1]=a,ba[h+2]=a,ba[h+3]=a,h+=4;for(;h<d;)ba[h]=a,++h}}function wa(a,b){var c;c=Aa(a+1)-Aa(b+1);return 0!==c?0<c:Aa(a)>>>0<Aa(b)>>>0}function La(a,h,l){var m,g,t;if(0===a)return!1;g=h<z[35]?z[35]:h;t=l>b(z[33],f())?b(z[33],
f()):l;g<z[36]&&(g=z[36]);t>z[37]&&(t=z[37]);g<z[32]&&(z[32]=g);t>z[34]&&(z[34]=t);t>z[35]&&(z[35]=t);if(g>=t)return!1;if(0!==(a&4278190080))la(a,g,t);else{z[66]=a;z[67]=g;z[68]=t;m=(sb(a)&65280)>>>8;if(1>=m)return!0;switch(m){case 2:var A=z[66],x=z[67],N=z[68],w=Q(),n,r,C,p,v,y;C=e(G,A+12);v=G[A+10];r=G[A+6];n=(x-G[A+4])*r+(w-G[A+5])*G[A+7];for(y=x;(0>(p=n>>16)||p>=v)&&y<N;)++y,n+=r;y>x&&(0>p&&(p=0),p>=v&&(p=v-1),la(C[p],x,y));if(1===z[48])for(;(p=n>>16)<v&&0<=p&&y<N;)ba[y]=C[p],++y,n+=r;else{var q=
n,B=y,F,M,J,O,L,oa,E,D,X,I,H,wa;F=z[48];M=f();I=G[A+10];L=q;wa=B;X=L>>16;oa=k(B,N);D=N-1&~(z[48]-1);J=z[51];for(O=z[50];wa<oa&&X<I&&0<=X;){H=C[X];for(H=c(H&J,O);wa<oa&&L>>16===X;)E=c(wa,M),ba[E]+=H,++wa,L+=r;X=L>>16}J=c(z[51],f())|4042322160;for(O=f();wa<D&&X<I&&0<=X;){H=C[X];for(H=c(H&J,O);wa<D&&L>>16===X;)E=c(wa,M),ba[E]+=H,wa+=F,L+=b(r,O);X=L>>16}J=z[51];for(O=z[50];wa<N&&X<I&&0<=X;){H=C[X];for(H=c(H&J,O);wa<N&&L>>16===X;)E=c(wa,M),ba[E]+=H,++wa,L+=r;X=L>>16}y=wa}y<N&&(0>p&&(p=0),p>=v&&(p=v-1),
la(C[p],y,N));break;case 3:var Kb=z[66],Bc=z[67],Lb=z[68],Jc=Q(),xb,Z,U,T,sa,W,K,La,ta,xa,ea;ta=e(G,Kb+12);xa=G[Kb+10];Z=Bc-G[Kb+4];U=Jc-G[Kb+5];sa=G[Kb+6];K=G[Kb+8];T=Z*sa+U*G[Kb+7];W=Z*K+U*G[Kb+9];ea=Bc;for(La=(xa-1)*(xa-1);ga(T>>16,W>>16)>=La&&ea<Lb;)++ea,T+=sa,W+=K;ea>Bc&&la(ta[xa-1],Bc,ea);xb=ca();xb[0]=T;xb[1]=W;if(ea<G[Kb+4])if(1===z[48]){var Ma=ea,V,Sa,lb,R,S,Y,aa,da;V=xb[0]|0;Sa=xb[1]|0;S=d(V>>16,Sa>>16);Y=ta[S];lb=(S-1)*(S-1);aa=Ma;da=Lb;for(da>G[Kb+4]&&(da=G[Kb+4]);aa<da;){for(;aa<da&&
ga(V>>16,Sa>>16)>=lb;)ba[aa]=Y,++aa,V+=sa,Sa+=K;for(R=ga(V>>16,Sa>>16);R<lb;)--S,Y=ta[S],lb=(S-1)*(S-1)}xb[0]=V;xb[1]=Sa;ea=aa}else{var ka=ea,ma,ia,gb,jb,Wa,za,na,ha,qa,fa,ra,ja,va,pa,ya;Wa=xb[0]|0;za=xb[1]|0;ma=z[48];ia=f();ja=d(Wa>>16,za>>16);fa=(ja-1)*(ja-1);pa=ka;ya=G[Kb+4];ya>Lb&&(ya=Lb);na=k(ka,ya);qa=ya-1&~(z[48]-1);if(pa<na)for(gb=z[51],jb=z[50],va=ta[ja],va=c(va&gb,jb);pa<na;){for(;pa<na&&ga(Wa>>16,za>>16)>=fa;)ha=c(pa,ia),ba[ha]+=va,++pa,Wa+=sa,za+=K;for(ra=ga(Wa>>16,za>>16);ra<fa;)--ja,
va=ta[ja],va=c(va&gb,jb),fa=(ja-1)*(ja-1)}if(pa<qa)for(gb=c(z[51],f())|4042322160,jb=f(),va=ta[ja],va=c(va&gb,jb);pa<qa;){for(;pa<qa&&ga(Wa>>16,za>>16)>=fa;)ha=c(pa,ia),ba[ha]+=va,pa+=ma,Wa+=b(sa,jb),za+=b(K,jb);for(ra=ga(Wa>>16,za>>16);ra<fa;)--ja,va=ta[ja],va=c(va&gb,jb),fa=(ja-1)*(ja-1)}if(pa<ya)for(gb=z[51],jb=z[50],va=ta[ja],va=c(va&gb,jb);pa<ya;){for(;pa<ya&&ga(Wa>>16,za>>16)>=fa;)ha=c(pa,ia),ba[ha]+=va,++pa,Wa+=sa,za+=K;for(ra=ga(Wa>>16,za>>16);ra<fa;)--ja,va=ta[ja],va=c(va&gb,jb),fa=(ja-1)*
(ja-1)}xb[0]=Wa;xb[1]=za;ea=pa}if(ea<Lb)if(1===z[48]){var Ja=ea,Aa,eb,Ha,Ta,Pa,Ga,Xa,Ya,Qa;Aa=xb[0]|0;eb=xb[1]|0;Ga=d(Aa>>16,eb>>16);Ya=ta[Ga];Xa=G[Kb+10];Ta=(Xa-1)*(Xa-1);Pa=(Ga+1)*(Ga+1);Ha=ga(Aa>>16,eb>>16);for(Qa=Ja;Qa<Lb&&Ha<Ta;){for(;Qa<Lb&&ga(Aa>>16,eb>>16)<=Pa;)ba[Qa]=Ya,++Qa,Aa+=sa,eb+=K;for(Ha=ga(Aa>>16,eb>>16);Ha>Pa;)++Ga,Ya=ta[Ga],Pa=(Ga+1)*(Ga+1)}xb[0]=Aa;xb[1]=eb;ea=Qa}else{var ab=ea,bb,Za,Na,Ka,Da,Ea,db,Ra,Ia,fb,$a,Va,Ca,mb,pb,hb;Da=xb[0]|0;Ea=xb[1]|0;bb=z[48];Za=f();Ca=d(Da>>16,Ea>>
16);mb=G[Kb+10];$a=(mb-1)*(mb-1);Va=(Ca+1)*(Ca+1);Ia=ga(Da>>16,Ea>>16);hb=ab;db=k(ab,Lb);fb=Lb-1&~(z[48]-1);if(hb<db&&Ia<$a)for(Na=z[51],Ka=z[50],pb=ta[Ca],pb=c(pb&Na,Ka);hb<db&&Ia<$a;){for(;hb<db&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,++hb,Da+=sa,Ea+=K;for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=ta[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}if(hb<fb&&Ia<$a)for(Na=c(z[51],f())|4042322160,Ka=f(),pb=ta[Ca],pb=c(pb&Na,Ka);hb<fb&&Ia<$a;){for(;hb<fb&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,hb+=bb,Da+=
b(sa,Ka),Ea+=b(K,Ka);for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=ta[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}if(hb<Lb&&Ia<$a)for(Na=z[51],Ka=z[50],pb=ta[Ca],pb=c(pb&Na,Ka);hb<Lb&&Ia<$a;){for(;hb<Lb&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,++hb,Da+=sa,Ea+=K;for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=ta[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}xb[0]=Da;xb[1]=Ea;ea=hb}ea<Lb&&la(ta[xa-1],ea,Lb);break;case 4:case 5:var ib=z[66],kb=z[67],nb=z[68],vb=Q(),yb,qb,ub,Mb,Ab,rb,lc,wb,Db,Gb,Ib,jc,Eb,Fb;if(1!==z[48]){var Wb,
Nb,Pb,ac,bc,Hb,Sb,mc,Xb,Qb,Tb,Rb,Ub,Vb,dc,ic,gc,qc,cc,Bb,Cb;if(Pb=rc(ib)){bc=G[ib+10];ac=G[ib+11];qc=1===G[ib+16];mc=kb-G[ib+4];Xb=vb-G[ib+5];Tb=G[ib+6];Ub=G[ib+8];Qb=mc*Tb+Xb*G[ib+7];Rb=mc*Ub+Xb*G[ib+9];Wb=z[48];dc=k(kb,nb);gc=nb-1&~(z[48]-1);Nb=f();Hb=z[51];Sb=z[50];for(cc=kb;cc<dc;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=P(Bb,bc),Cb=P(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=u(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=Tb,Rb+=Ub,++cc;Hb=c(z[51],f())|4042322160;
for(Sb=f();cc<gc;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=P(Bb,bc),Cb=P(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=u(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=b(Tb,Sb),Rb+=b(Ub,Sb),cc+=Wb;Hb=z[51];for(Sb=z[50];cc<nb;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=P(Bb,bc),Cb=P(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=u(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=Tb,Rb+=Ub,++cc}}else if(yb=rc(ib))for(ub=G[ib+10],qb=G[ib+11],Ib=
1===G[ib+16],Mb=kb-G[ib+4],Ab=vb-G[ib+5],lc=G[ib+6],Db=G[ib+8],rb=Mb*lc+Ab*G[ib+7],wb=Mb*Db+Ab*G[ib+9],jc=kb;jc<nb;)Ib&&(rb=Ua(rb,ub<<16),wb=Ua(wb,qb<<16)),Eb=rb>>16,Fb=wb>>16,Ib||(Eb=P(Eb,ub),Fb=P(Fb,qb)),0<=Eb&&0<=Fb&&Eb<ub&&Fb<qb&&(Gb=u(ib,yb,Eb,Fb),ba[jc]=Gb),rb+=lc,wb+=Db,++jc}}return!1}function ea(){var a,b,c;for(c=Q();z[11]<z[12];){a=Ea[z[11]];if(G[a+5]>c)break;b=sb(a);if(2===(b&254))return!0;if(!Ka(1))break;switch(b){case 4:Ca(Ea[z[11]],Q());break;case 5:b=Ea[z[11]];var d=Q(),e,l,f,m,u,g;
l=G[b+20];e=l>>1;m=U(b);u=G[b+5];Ca(b,u);f=G[b+7];g=G[b+10];Z(b,m-e);G[b+7]=f+l;0<g?G[b+17]=G[b+12]+l:(G[b+17]=l-G[b+12],Z(b,U(b)+G[b+12]));l=0-f-e;G[b+18]=0;G[b+19]=l;0>=e&&0>l?fb(b,sb(b)&-65537):fb(b,sb(b)|65536);if(u!==d){for(e=u;e<=d-1;e++)Va(b,e);G[b+7]-=d-u}break;case 6:Eb(Ea[z[11]],Q());break;case 7:b=Ea[z[11]];d=Q();e=G[b+20];u=e>>1;f=G[b+14];l=G[b+5];Eb(b,l);m=G[b+7];for(g=0;5>=g;g++)Na(b)[g]=h(b)[g];g=h(b)[2];0===g&&h(b)[4];g=0<=g?1:-1;0>g?(h(b)[0]=h(b)[0]-256*u,g=Na(b)[0],Na(b)[0]=g+256*
(e-u),g=Na(b)[1],Na(b)[1]=g+256*e,G[b+21]=f-u):(h(b)[0]=h(b)[0]+256*u,g=Na(b)[0],Na(b)[0]=g-256*(e-u),g=Na(b)[1],Na(b)[1]=g+256*e,G[b+21]=f-u+e);0===m&&(h(b)[0]=256*G[b+21]);G[b+7]=m+e;f=0-m-u;G[b+18]=0;G[b+19]=f;0>=u&&0>f?fb(b,sb(b)&-65537):fb(b,sb(b)|65536);W(b,e);if(l!==d){for(g=l;g<=d-1;g++)Ra(b,g);G[b+7]-=d-l}}jb(a);z[11]+=1}return!1}function Ma(){var a,b,c;for(c=z[37];z[13]<z[14];){a=S[z[13]];b=c=U(a);if(b>=z[37])return!1;gc(b);if(va(a)){var d=a,h,e,l,f;h=sb(d)>>>1;Fb=d;switch(h){case 2:mb=
G[Fb+17];break;case 3:mb=G[Fb+17]}l=mb;switch(h){case 2:mb=G[Fb+16];break;case 3:mb=G[Fb+16]}e=mb;0!==e&&Ka(3)&&(h=(G[d+6]<<1)+1,f=U(d)+l,l=sa(e,h),-1===l?Ya(e,h,f):Aa(l+2)<f&&pa(l,f),gc(U(d)))}if(0===(G[a+0]&65536)&&(Ka(6)&&(d=G[a+6]<<1,h=G[a+8],0!==h&&Wb(h,d,999999999),h=G[a+9],0!==h&&Wb(h,d,999999999),gc(U(a))),aa))return!1;z[13]+=1;z[13]<z[14]&&(c=S[z[13]],c=U(c),c>=z[36]&&xa(b,c))}c<z[37]&&xa(c,z[37]);return!1}function Wa(){for(var a,b;z[13]<z[14];)if(b=S[z[13]],a=G[b+7]-1,0===a)Cc();else{G[b+
7]=a;a=sb(b);if(2===(a&254))return!0;switch(a){case 4:nb(S[z[13]],Q());break;case 5:Va(S[z[13]],Q());break;case 6:a=S[z[13]];b=Q();b=Da(h(a),b);Z(a,b);break;case 7:Ra(S[z[13]],Q())}Ga();z[13]+=1}return!1}function sa(a,b){var c;for(c=0;c<ra()&&(Aa(c)!==a||Aa(c+1)!==b);)c+=3;return c>=ra()?-1:c}function ta(a,b){var c;if(a===b)return!0;c=G[a+5]-G[b+5];if(0!==c)return 0>c;c=U(a)-U(b);return 0>c}function Sa(a,b){var c,d;c=sa(a,b);if(-1===c)return!1;if(0===c)return z[10]+=3,!0;ub(c,Aa(0));ma(c,Aa(1));pa(c,
Aa(2));z[10]+=3;if(3>=ra())return!0;d=0;for(c=3;c<ra();)wa(c,d)&&(d=c),c+=3;if(d+3===ra())return!0;c=Aa(d);ub(d,Aa(ra()-3));ha(c);c=Aa(d+1);ma(d,Aa(ra()-3+1));vb(c);c=Aa(d+2);pa(d,Aa(ra()-3+2));Gb(c);return!0}function V(a,b){return z[a]+=b}function lb(){Ta=q.ioLoadFunctionFrom("loadBitBltFrom",ia);rb=q.ioLoadFunctionFrom("copyBitsFromtoat",ia);return!!Ta&&!!rb}function gb(){ab(z[48]);0>z[42]&&(z[42]=0);z[43]>z[33]&&(z[43]=z[33]);z[36]=b(z[42],f());z[38]=b(z[44],f());z[37]=b(z[43],f());z[39]=b(z[45],
f());z[12]=0;z[14]=0;Ea=e(G,Y);S=e(G,Y);var a,c;c=0;for(a=Y;c<a;){var d=c;if((255<sb(d)?0:0!==(sb(d)&255))&&!(G[c+5]>=z[39]))if(d=c,4===(sb(d)&254)){var h;h=va(d)?G[d+20]:0;G[d+15]+h<z[38]||U(d)-h>=z[37]&&G[d+14]-h>=z[37]||p(d)}else 6===(sb(d)&254)?(h=va(d)?G[d+20]:0,G[d+15]+h<z[38]||U(d)-h>=z[37]&&G[d+14]-h>=z[37]||p(d)):p(d);c+=G[c+1]}if(aa)return null;if(0===z[12])return z[88]=z[39],0;sc(Ea,0,z[12]-1);z[88]=G[Ea[0]+5];Q()<z[38]&&(z[88]=z[38]);z[32]=0;z[34]=b(z[33],f())-1;M()}function jb(a){if(0>=
G[a+7])return null;var b,c;c=U(a);for(b=0;b<z[14]&&U(S[b])<c;)++b;for(;b<z[14]&&U(S[b])===c&&ta(S[b],a);)++b;if(Ka(1)){for(c=z[14]-1;!(c<b);)S[c+1]=S[c],--c;S[b]=a;z[14]+=1}}function za(a){var b;(b=0===a)||(b=0!==(a&4278190080))||!(b=0<=a&&a<Y)||(b=0!==(a&4278190080)||0!==(sb(a)&65280));return b}function va(a){return 0!==(sb(a)&1)}function eb(a,b,c,d){var h;h=B();if(aa)return 0;w(h,a[0]);J(h,a[1]);I(h,b[0]);C(h,b[1]);l(h,c[0]);x(h,c[1]);a=L(h);c=H(h);b=t(h);a=c-a;b-=c;0<=a*b?a=h:(V(108,1),b-=a,0>
a&&(a=0-a),0>b&&(b=0-b),a=O(h,a/b));a=b=c=a;d&&(b=da(h));b>c&&(c=b);h!==a&&d&&(b=da(a));b>c&&(c=b);for(a=d=c;h<=d;h+=6)if(b=Hb(h),b>a&&(a=b),aa)return 0;return Math.floor(a/6)|0}function hb(a){return Ta||lb()?Ta(a):!1}function Mb(c,d,h,l,f,m,u){var g,t,A,x,k;if(d.isNil)g=0,k=null;else{if(n(d)!==q.classBitmap())return q.primitiveFail();g=a(d);k=d.wordsAsInt32Array()}if("number"===typeof c||!q.isPointers(c)||5>a(c))return q.primitiveFail();d=q.fetchPointerofObject(0,c);if(n(d)!==q.classBitmap())return q.primitiveFail();
d=a(d);x=q.fetchIntegerofObject(1,c);t=q.fetchIntegerofObject(2,c);c=q.fetchIntegerofObject(3,c);if(q.failed())return null;if(!(0<=x&&0<=t)||32!==c&&8!==c&&16!==c&&1!==c&&2!==c&&4!==c||0!==g&&g!==b(1,c))return q.primitiveFail();A=Math.floor(32/c)|0;A=Math.floor((x+(A-1))/A)|0;if(d!==A*t)return q.primitiveFail();var N,w,C;N=18+g;if(r(N)){w=Y;Y=w+N;fb(w,1024);G[w+2]=0;G[w+1]=N;N=e(G,w+18);if(0!==z[17])for(C=0;C<=g-1;C++)N[C]=ka(k[C]);else for(C=0;C<=g-1;C++)N[C]=k[C];G[w+15]=g;g=w}else g=0;if(aa)return null;
G[g+10]=x;G[g+11]=t;G[g+12]=c;G[g+14]=A;G[g+13]=d;G[g+16]=h;G[g+2]=u;Sb(g,l,f,m,x,t);return g}function rc(b){var c;c=G[b+2];if(c>a(Db))return null;c=q.fetchPointerofObject(c,Db);c=q.fetchPointerofObject(0,c);return a(c)!==G[b+13]?null:c.wordsAsInt32Array()}function lc(a,b,c,d,h,e,l){var f,m,u,g;if(d===h&&(0===e||0===l))return null;a*=6;c?(c=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+0],u=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+1],f=(b.int16Array||
(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+2],g=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+3],m=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+4],b=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+5]):(c=b[a+0]|0,u=b[a+1]|0,f=b[a+2]|0,g=b[a+3]|0,m=b[a+4]|0,b=b[a+5]|0);if(c===f&&u===g||f===m&&g===b){if(c===m&&u===b)return null;ca()[0]=c;ca()[1]=u;qa()[0]=m;qa()[1]=b;Pa(2);return Ib(e,ca(),qa(),l,d,h)}ca()[0]=c;ca()[1]=
u;qa()[0]=f;qa()[1]=g;Ha()[0]=m;Ha()[1]=b;Pa(3);b=eb(ca(),qa(),Ha(),0!==e&&0!==l);if(aa)return null;tc(e,l,d,h,b)}function mc(b){var c;c=z[65];if(6>a(b))return null;Z(c,q.fetchIntegerofObject(1,b));T(c,q.fetchIntegerofObject(2,b));var d=q.fetchIntegerofObject(3,b);G[c+6]=d;b=q.fetchIntegerofObject(4,b);G[c+7]=b;return c}function Sb(a,b,c,d,h,e){var l,f,m;c[0]+=b[0];c[1]+=b[1];d[0]+=b[0];d[1]+=b[1];na(b);na(c);na(d);l=c[0]-b[0];f=c[1]-b[1];c=d[0]-b[0];d=d[1]-b[1];m=l*l+f*f;0<m?(l=l*h*65536/m|0,h=f*
h*65536/m|0):h=l=0;f=c*c+d*d;0<f?(c=c*e*65536/f|0,e=d*e*65536/f|0):e=c=0;G[a+4]=b[0];G[a+5]=b[1];G[a+6]=l;G[a+7]=h;G[a+8]=c;G[a+9]=e}function jc(b){var c,d,h,e;if(!q.isArray(b))return!1;Db=b;for(b=0;b<=a(Db)-1;b++){d=q.fetchPointerofObject(b,Db);if("number"===typeof d||!q.isPointers(d)||5>a(d))return!1;c=q.fetchPointerofObject(0,d);if(n(c)!==q.classBitmap())return!1;c=a(c);e=q.fetchIntegerofObject(1,d);h=q.fetchIntegerofObject(2,d);d=q.fetchIntegerofObject(3,d);if(q.failed()||!(0<=e&&0<=h))return!1;
d=Math.floor(32/d)|0;e=Math.floor((e+(d-1))/d)|0;if(c!==e*h)return!1}return!0}function Qa(a,b){var c;if(n(b)!==q.classPoint())return q.primitiveFail();c=q.fetchPointerofObject(0,b);if("number"!==typeof c&&!c.isFloat)return q.primitiveFail();a[0]="number"===typeof c?c:q.floatValueOf(c)|0;c=q.fetchPointerofObject(1,b);if("number"!==typeof c&&!c.isFloat)return q.primitiveFail();a[1]="number"===typeof c?c:q.floatValueOf(c)|0}function Dc(){var b,c,d;if(2!==q.methodArgumentCount())return 5;if(0!==(c=yb(q.stackValue(2))))return c;
d=q.stackObjectValue(0);b=q.stackObjectValue(1);if(q.failed())return 3;if(0!==(c=Tb(q.fetchPointerofObject(1,Ia))))return c;if(!hb(q.fetchPointerofObject(2,Ia)))return 122;if(!jc(q.fetchPointerofObject(3,Ia)))return 123;if(6>a(b))return 112;if(6>a(d))return 113;b=z[2];return 2===b||4===b||7===b?116:0}function Tb(b){if(n(b)!==q.classBitmap())return 114;ba=b.words;z[33]=a(b)-1;return 0}function Ub(b,c,d){if(b.isNil)return!1;if("number"===typeof b||a(b)!==d)return q.primitiveFail();if(q.isWords(b)){var h;
h=b.wordsAsFloat32Array();for(b=0;b<=d-1;b++)c[b]=h[b]}else a:{var e;for(h=0;h<=d-1;h++){e=q.fetchPointerofObject(h,b);if("number"!==typeof e&&!e.isFloat){q.primitiveFail();break a}c[h]="number"===typeof e?e:q.floatValueOf(e)}}return!0}function tc(a,b,c,d,h){var e,l,f;0===a||0===b?(f=!1,l=0):(f=!0,l=a>>1);for(h*=6;0<h;){f?r(28)?(e=Y,Y=e+28,fb(e,7),G[e+2]=0,G[e+1]=28):e=0:r(16)?(e=Y,Y=e+16,fb(e,6),G[e+2]=0,G[e+1]=16):e=0;if(aa)return 0;var m=e,u=h,g=c,x=d,k=l;if(t(u)>=L(u)){Z(m,F(u));T(m,L(u)-k);var N=
E(u);G[m+12]=N;N=H(u)-k;G[m+13]=N;N=A(u);G[m+14]=N;u=t(u)-k}else Z(m,A(u)),T(m,t(u)-k),N=E(u),G[m+12]=N,N=H(u)-k,G[m+13]=N,N=F(u),G[m+14]=N,u=L(u)-k;G[m+15]=u;G[m+6]=z[113];G[m+8]=g;G[m+9]=x;f&&(G[e+16]=b,G[e+17]=a,G[e+20]=a);h-=6}bb()}function Ib(a,b,c,d,h,e){var l,f;0===a||0===d?(r(16)?(l=Y,Y=l+16,fb(l,4),G[l+2]=0,G[l+1]=16):l=0,f=0):(r(21)?(l=Y,Y=l+21,fb(l,5),G[l+2]=0,G[l+1]=21):l=0,f=a>>1);if(aa)return 0;var m=l,u;b[1]<=c[1]?(u=b,b=c,c=1):(u=c,c=-1);Z(m,u[0]);T(m,u[1]-f);G[m+6]=z[113];G[m+8]=
h;G[m+9]=e;G[m+14]=b[0];G[m+15]=b[1]-f;G[m+11]=c;va(l)&&(G[l+16]=d,G[l+17]=a,G[l+20]=a)}function Xb(b){if("number"===typeof b)return 105;if(!q.isWords(b))return 106;if(256>a(b))return 107;z=b.wordsAsInt32Array();if(1097753705!==z[0])return 108;if(z[1]!==a(b))return 109;if(128!==z[8])return 110;G=e(z,z[8]);Ea=e(G,z[9]);S=e(Ea,z[12]);return 128+z[9]+z[12]+z[14]>z[1]?111:0}function Ka(a){return 128+Y+z[12]+z[14]+a>z[10]?(Za(1),!1):!0}function ya(a){return z[9]=a}function sb(a){return G[a+0]&65535}function fb(a,
b){return G[a+0]=b}function ca(){return e(z,80)}function qa(){return e(z,82)}function Ha(){return e(z,84)}function dc(){z[11]>=z[12]&&0===z[14]&&ja(8);Q()>=z[39]&&ja(8)}function Nb(){for(var a;8!==z[2];){fa&&(K=q.ioMicroMSecs());a=ea();fa&&(V(95,1),V(94,q.ioMicroMSecs()-K));if(aa)return ja(1);if(a)return ja(2),Za(4);z[13]=0;bb();z[69]=1;fa&&(K=q.ioMicroMSecs());0!==z[69]&&0===(Q()&z[52])&&M();z[69]=0;a=Ma();fa&&(V(99,1),V(98,q.ioMicroMSecs()-K));if(aa)return ja(3);if(a)return ja(4),Za(5);bb();z[35]=
0;fa&&(K=q.ioMicroMSecs());(Q()&z[52])===z[52]&&(oa(Q()),dc());fa&&(V(103,1),V(102,q.ioMicroMSecs()-K));if(aa)return ja(5);if(8===z[2])return 0;z[13]=0;z[88]=Q()+1;fa&&(K=q.ioMicroMSecs());a=Wa();fa&&(V(105,1),V(104,q.ioMicroMSecs()-K));if(aa)return ja(6);if(a)return ja(7),Za(6)}}function Ec(){var a;a=z[2];if(0===a){gb();if(aa)return 0;a=1}if(1===a){fa&&(K=q.ioMicroMSecs());a=ea();fa&&(V(95,1),V(94,q.ioMicroMSecs()-K));if(aa)return ja(1);if(a)return ja(2),Za(4);z[13]=0;bb();z[69]=1;a=3}if(3===a){fa&&
(K=q.ioMicroMSecs());0!==z[69]&&0===(Q()&z[52])&&M();z[69]=0;a=Ma();fa&&(V(99,1),V(98,q.ioMicroMSecs()-K));if(aa)return ja(3);if(a)return ja(4),Za(5);a=5;bb();z[35]=0}if(5===a){fa&&(K=q.ioMicroMSecs());(Q()&z[52])===z[52]&&(oa(Q()),dc());fa&&(V(103,1),V(102,q.ioMicroMSecs()-K));if(aa)return ja(5);if(8===z[2])return 0;a=6;z[13]=0;z[88]=Q()+1}if(6===a){fa&&(K=q.ioMicroMSecs());a=Wa();fa&&(V(105,1),V(104,q.ioMicroMSecs()-K));if(aa)return ja(6);if(a)return ja(7),Za(6);ja(1)}}function yb(b){if(q.failed())return 100;
if("number"===typeof b)return 101;if(!q.isPointers(b))return 102;if(12>a(b))return 103;Ia=b;if(0!==(b=Xb(q.fetchPointerofObject(0,b))))return b;z[64]=0;Y=z[9];aa=!1;return 0}function Xa(a,b){var c;if(0!==(c=yb(a)))return c;if(z[2]===b)return 0;z[64]=2;return 116}function gc(a){if(0===ra())return null;for(;db()<=a;){var b=R(),c;c=0===ra()?-1:Aa(ra()-3+1);Sa(b,c);if(0===ra())return null}}function sc(a,b,c){var d,h,e,l,f,m;if(1>=(d=c+1-b))return 0;e=a[b];f=a[c];h=ta(e,f);h||(h=a[b],a[b]=a[c],a[c]=h,
l=e,e=f,f=l);if(2>=d)return 0;m=b+c>>1;l=a[m];(h=ta(e,l))?(h=ta(l,f),h||(h=a[c],a[c]=a[m],a[m]=h,l=f)):(h=a[b],a[b]=a[m],a[m]=h,l=e);if(3>=d)return 0;e=b;f=c;for(d=!0;d;){for(h=!0;h;)e<=--f?(h=a[f],h=ta(l,h)):h=!1;for(h=!0;h;)++e<=f?(h=a[e],h=ta(h,l)):h=!1;if(d=e<=f)h=a[e],a[e]=a[f],a[f]=h}sc(a,b,f);sc(a,e,c)}function Cc(){var a;a=z[13];for(--z[14];a<z[14];)S[a]=S[a+1],++a}function Ua(a,b){var c;for(c=a;0>c;)c+=b;for(;c>=b;)c-=b;return c}function Ga(){var a,b;if(0===z[13])return null;a=S[z[13]];b=
U(a);if(U(S[z[13]-1])<=b)return null;var c;for(c=z[13];0<c&&U(S[c-1])>b;)S[c]=S[c-1],--c;S[c]=a}function ab(a){var b;4<=a&&(b=4);2<=a&&4>a&&(b=2);2>a&&(b=1);z[48]=b;1===b&&(z[49]=0,z[51]=4294967295,z[52]=0);2===b&&(z[49]=1,z[51]=4244438268,z[52]=1);4===b&&(z[49]=2,z[51]=4042322160,z[52]=3);z[50]=2*f();z[53]=f()}function Ya(a,b,c){if(!Pb(3))return null;Ab(0,a);ma(0,b);pa(0,c);if(3===ra())return null;wa(0,ra()-3)&&(ub(0,Aa(ra()-3)),ma(0,Aa(ra()-3+1)),pa(0,Aa(ra()-3+2)),ha(a),vb(b),Gb(c))}function ga(a,
b){return a*a+b*b}function ma(a,b){return Ab(a+1,b)}function pa(a,b){return Ab(a+2,b)}function ub(a,b){return Ab(a,b)}function ja(a){return z[2]=a}function Eb(a,b){var c,d,e,l,f,m,u,g,t;if(!va(a)&&b>=G[a+15])return G[a+7]=0;g=U(a);t=G[a+5];l=G[a+12];f=G[a+13];d=G[a+14];e=G[a+15];c=e-t;m=2*c;2>m&&(m=2);m=Math.floor(16777216/m)|0;var A;u=m&65535;A=m>>>16&255;u=(u*u>>>16)+u*A*2+(A*A<<16)>>>8;d=(g+d-2*l)*u*2;l=2*(l-g)*m+(d>>1);e=(t+e-2*f)*u*2;f=2*(f-t)*m+(e>>1);G[a+7]=c;m=h(a);m[0]=256*g;m[1]=256*t;m[2]=
l;m[3]=f;m[4]=d;m[5]=e;(t=G[a+5])!==b&&(g=Da(h(a),b),Z(a,g),G[a+7]=c-(b-t))}function Ca(a,b){var c,d,h,e,l;if(!va(a)&&b>=G[a+15])return G[a+7]=0;c=G[a+14]-U(a);d=G[a+15]-G[a+5];0<=c?(l=1,e=c,h=0):(l=-1,e=0-c,h=1-d);0===d?e=h=0:d>e?c=0:(c=(Math.floor(e/d)|0)*l,e=e-(Math.floor(e/d)|0)*d|0);G[a+7]=d;G[a+10]=l;G[a+12]=c;G[a+13]=h;G[a+14]=e;G[a+15]=d;if((l=G[a+5])!==b){for(h=l;h<=b-1;h++)nb(a,h);G[a+7]=d-(b-l)}}function Da(a,b){var c,d,h,e,l;h=a[0];e=a[1];c=a[2];d=a[3];for(l=256*b;l>e&&0<=d;)h+=c+32768>>
16,e+=d+32768>>16,c+=a[4],d+=a[5];a[0]=h;a[1]=e;a[2]=c;a[3]=d;return h>>8}function nb(a,b){var c,d;d=U(a)+G[a+12];c=G[a+13]+G[a+14];0<c&&(d+=G[a+10],c-=G[a+15]);G[a+13]=c;Z(a,d)}function Ra(a,b){var c,d,e,l;d=G[a+20];c=d>>1;e=G[a+18]+1;l=G[a+19]+1;G[a+18]=e;G[a+19]=l;e>=c&&fb(a,sb(a)&-65537);0<=l&&fb(a,sb(a)|65536);0>l+c?Da(h(a),b):h(a)[0]=256*G[a+21];Da(Na(a),b);W(a,d)}function Va(a,b){var c,d,h,e,l,f;l=G[a+18]+1;f=G[a+19]+1;G[a+18]=l;G[a+19]=f;h=G[a+20];d=h>>1;l>=d&&fb(a,sb(a)&-65537);0<=f&&fb(a,
sb(a)|65536);c=U(a);nb(a,b);e=U(a);if(l<=h||0<=f+d){var m,u;m=G[a+18];u=G[a+19];d=G[a+20];h=d>>1;l=G[a+17];f=G[a+10];e-=c;m<d&&(0>f?l-=e:(l+=e,Z(a,c)));0===u+h&&(0<f?l-=G[a+12]:(l+=G[a+12],Z(a,c)));0<u+h&&(0>f?(l+=e,Z(a,c)):l-=e);G[a+17]=l}}function Za(a){z[64]=a;aa=!0}function kb(b,c){if(6>a(c))return q.primitiveFail();q.storeIntegerofObjectwithValue(0,c,G[b+2]);q.storeIntegerofObjectwithValue(1,c,U(b));q.storeIntegerofObjectwithValue(2,c,Q());q.storeIntegerofObjectwithValue(3,c,G[b+6]);q.storeIntegerofObjectwithValue(4,
c,G[b+7]);z[65]=b}function qb(b){var c,d,h;c=z[66];d=z[67];h=z[68];if(6>a(b))return q.primitiveFail();q.storeIntegerofObjectwithValue(0,b,G[c+2]);q.storeIntegerofObjectwithValue(1,b,d);q.storeIntegerofObjectwithValue(2,b,h);q.storeIntegerofObjectwithValue(3,b,Q())}function Ja(){if(q.failed())return null;if(aa){var a=q.stackObjectValue(1),b=q.stackObjectValue(0),c,d;d=z[64];4===d&&(c=Ea[z[11]],kb(c,a),z[11]+=1);5===d&&qb(b);6===d&&(c=S[z[13]],kb(c,a))}ya(Y);q.pop(3);q.pushInteger(z[64])}function zc(a){var b,
c;b=L(a);c=t(a);if(c===b)return a;c-=b;0>c&&(c=0-c);if(255<c)return V(109,1),X(a);b=F(a);b=A(a)-b;0>b&&(b=0-b);return 32*c<b?(V(110,1),X(a)):a}function Hb(a){var b;b=zc(a);if(b!==a){a=Hb(a);if(aa)return 0;b=Hb(b);return aa?0:a>=b?a:b}return a}function da(a){var b,c,d;c=F(a);d=E(a);b=A(a);c=d-c;b-=d;if(0<=c*b)return a;V(108,1);b-=c;0>c&&(c=0-c);0>b&&(b=0-b);return O(a,c/b)}function Wb(a,b,c){var d;0===ra()?Pb(3)&&(ha(a),vb(b),Gb(c)):(d=Sa(a,b))||Ya(a,b,c)}function R(){return 0===ra()?0:Aa(ra()-3)}
function vb(a){return ma(ra()-3,a)}function Gb(a){return pa(ra()-3,a)}function ha(a){return ub(ra()-3,a)}function db(){return 0===ra()?999999999:Aa(ra()-3+2)}function ka(a){var b,c,d,h,e;if(0!==a&&0===(a&4278190080))return a;c=a&255;d=a>>>8&255;h=a>>>16&255;a=a>>>24&255;0!==z[17]&&(e=g(z,24),b=(a*e[6]+e[7])/a,h=(h*e[0]+e[1])*b|0,d=(d*e[2]+e[3])*b|0,c=(c*e[4]+e[5])*b|0,h=Math.max(h,0),h=Math.min(h,255),d=Math.max(d,0),d=Math.min(d,255),c=Math.max(c,0),c=Math.min(c,255),a=Math.max(a*b|0,0),a=Math.min(a,
255));if(1>a)return 0;255>a&&0!==z[63]&&Za(3);return c+(d<<8)+(h<<16)+(a<<24)}function na(a){if(0!==z[16]){var b=a[0]|0,c=a[1]|0,d,h;d=g(z,18);h=(d[0]*b+d[1]*c+d[2])*z[48]|0;b=(d[3]*b+d[4]*c+d[5])*z[48]|0;a[0]=h;a[1]=b}else a[0]=(a[0]+z[46])*z[48],a[1]=(a[1]+z[47])*z[48]}function Pa(a){0<a&&na(ca());1<a&&na(qa());2<a&&na(Ha());3<a&&na(e(z,86))}function wb(a){var b,c;if(0===a)return 0;ca()[0]=0;ca()[1]=0;qa()[0]=256*a;qa()[1]=0;Ha()[0]=0;Ha()[1]=256*a;Pa(3);b=qa()[0]-ca()[0];c=qa()[1]-ca()[1];a=(Math.sqrt(b*
b+c*c)|0)+128>>8;b=Ha()[0]-ca()[0];c=Ha()[1]-ca()[1];b=(Math.sqrt(b*b+c*c)|0)+128>>8;b<a&&(a=b);return 0===a?1:a}function $a(a){var b,c,d,h;if(0===z[17])return a;b=a&255;c=a>>>8&255;d=a>>>16&255;a=a>>>24&255;h=g(z,24);d=d*h[0]+h[1]|0;c=c*h[2]+h[3]|0;b=b*h[4]+h[5]|0;a=a*h[6]+h[7]|0;d=Math.max(d,0);d=Math.min(d,255);c=Math.max(c,0);c=Math.min(c,255);b=Math.max(b,0);b=Math.min(b,255);a=Math.max(a,0);a=Math.min(a,255);return 16>a?0:b+(c<<8)+(d<<16)+(a<<24)}function bb(){z[10]=z[1]}function Pb(a){if(!Ka(a))return!1;
z[10]-=a;return!0}function ra(){return z[1]-z[10]}function Aa(a){return z[z[10]+a]}function Ab(a,b){return z[z[10]+a]=b}function Na(a){return e(G,a+22)}var S=null,ia="BitBltPlugin",rb=null,mb=0,Fb=0,fa=0,Ia=0,aa=0,Db=0,K=0,Ea=null,q=null,Ta=null,G=null,Y=0,ba=null,z=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:function(){var b,d,h;fa&&(K=q.ioMicroMSecs());if(2!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(b=Xa(q.stackValue(2),4))||0!==(b=Tb(q.fetchPointerofObject(1,
Ia))))return q.primitiveFailFor(b);d=q.stackObjectValue(0);b=q.stackObjectValue(1);if(q.failed()||n(b)!==q.classBitmap())return q.primitiveFailFor(3);if(6>a(d))return q.primitiveFailFor(113);h=q.fetchIntegerofObject(0,d);if(G[z[66]+2]!==h)return q.primitiveFailFor(117);h=q.fetchIntegerofObject(1,d);if(z[67]!==h)return q.primitiveFailFor(117);h=q.fetchIntegerofObject(2,d);if(z[68]!==h)return q.primitiveFailFor(117);if(a(b)<z[68]-z[67])return q.primitiveFailFor(3);if(q.failed())return null;b=b.wordsAsInt32Array();
d=z[68];var e,l,m,u,g,t;t=z[67];e=-1;if(1===z[48])for(;t<d;)u=b[++e]|0,ba[t]=u,++t;else for(l=z[51],m=z[50],h=f();t<d;)g=c(t,h),u=b[++e]|0,u=c(u&l,m),ba[g]+=u,++t;d>z[34]&&(z[34]=d);d>z[35]&&(z[35]=d);ja(3);ya(Y);q.pop(2);fa&&(V(101,1),V(100,q.ioMicroMSecs()-K))},primitiveCopyBuffer:function(){var b,c,d,h,l,f;if(2!==q.methodArgumentCount())return q.primitiveFailFor(5);c=q.stackValue(0);b=q.stackValue(1);if(0!==(d=Xb(b)))return q.primitiveFailFor(d);if(n(b)!==n(c))return q.primitiveFailFor(114);b=
a(c)-a(b);if(0>b)return q.primitiveFailFor(115);l=z;d=c.wordsAsInt32Array();h=0;for(f=z[10]-1;h<=f;h++)d[h]=l[h];d[10]=z[10]+b;d[1]=z[1]+b;l=e(l,z[10]);d=e(d,z[10]+b);h=0;for(f=z[1]-z[10]-1;h<=f;h++)d[h]=l[h];if(0!==(d=Xb(c)))return q.primitiveFailFor(d);q.pop(2)},primitiveAddRect:function(){var a,b,c,d,h,l;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);a=q.positive32BitValueOf(q.stackValue(0));b=q.stackIntegerValue(1);h=q.positive32BitValueOf(q.stackValue(2));c=q.stackObjectValue(3);
l=q.stackObjectValue(4);if(q.failed())return q.primitiveFailFor(3);if(0!==(d=Xa(q.stackValue(5),0)))return q.primitiveFailFor(d);if(!za(a)||!za(h))return q.primitiveFailFor(117);a=ka(a);h=ka(h);if(aa)return q.primitiveFailFor(104);if(0===h&&(0===a||0===b))return q.pop(5);if(!Ka(64))return q.primitiveFailFor(111);b=0<b&&0!==a?wb(b):0;Qa(ca(),l);Qa(Ha(),c);if(q.failed())return q.primitiveFailFor(121);qa()[0]=Ha()[0];qa()[1]=ca()[1];e(z,86)[0]=ca()[0];e(z,86)[1]=Ha()[1];Pa(4);Ib(b,ca(),qa(),a,0,h);Ib(b,
qa(),Ha(),a,0,h);Ib(b,Ha(),e(z,86),a,0,h);Ib(b,e(z,86),ca(),a,0,h);if(q.failed())return q.primitiveFailFor(119);z[63]=1;ya(Y);q.pop(5)},primitiveAddGradientFill:function(){var b,c,d,h,l,f;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);d=q.booleanValueOf(q.stackValue(0));h=q.stackValue(1);b=q.stackValue(2);l=q.stackValue(3);f=q.stackValue(4);if(q.failed())return q.primitiveFailFor(3);if(0!==(c=Xa(q.stackValue(5),0)))return q.primitiveFailFor(c);Qa(ca(),l);Qa(qa(),b);Qa(Ha(),h);if(q.failed())return q.primitiveFailFor(121);
b=ca();c=qa();h=Ha();if(n(f)!==q.classBitmap())d=q.primitiveFail();else{l=a(f);f=f.wordsAsInt32Array();var m,u;u=12+l;if(r(u)){m=Y;Y=m+u;d?fb(m,768):fb(m,512);G[m+2]=0;G[m+1]=u;u=e(G,m+12);if(0!==z[17])for(d=0;d<=l-1;d++)u[d]=ka(f[d]);else for(d=0;d<=l-1;d++)u[d]=f[d];G[m+10]=l;d=m}else d=0;aa?d=null:Sb(d,b,c,h,l,l)}if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);ya(Y);q.popthenPush(6,q.positive32BitIntegerFor(d))},primitiveSetClipRect:function(){var b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);
if(0!==(b=Xa(q.stackValue(1),0)))return q.primitiveFailFor(b);b=q.stackObjectValue(0);if(q.failed()||!(q.isPointers(b)&&2<=a(b)))return q.primitiveFailFor(3);Qa(ca(),q.fetchPointerofObject(0,b));Qa(qa(),q.fetchPointerofObject(1,b));if(q.failed())return q.primitiveFailFor(3);z[42]=ca()[0];z[44]=ca()[1];z[43]=qa()[0];z[45]=qa()[1];ya(Y);q.pop(1)},initialiseModule:lb,primitiveSetBitBltPlugin:function(){var a,b;b=q.stackValue(0);if(!q.isBytes(b)||256<=(b.bytes?b.bytes.length:b.words?4*b.words.length:
0))return q.primitiveFail();a=!1;b=b.bytesAsString();b!==ia&&(ia=b,a=!0);if(a&&!lb())return q.primitiveFail();q.pop(1)},primitiveRegisterExternalEdge:function(){var a,b,c,d,h,e,l;if(6!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(6),0)))return q.primitiveFailFor(a);l=q.positive32BitValueOf(q.stackValue(0));e=q.positive32BitValueOf(q.stackValue(1));h=q.stackIntegerValue(2);d=q.stackIntegerValue(3);c=q.stackIntegerValue(4);b=q.stackIntegerValue(5);if(q.failed())return q.primitiveFailFor(3);
if(!r(10))return q.primitiveFailFor(111);if(!za(e)||!za(l))return q.primitiveFailFor(117);a=Y;Y=a+10;fb(a,2);G[a+1]=10;G[a+2]=b;Z(a,c);T(a,d);G[a+6]=h;b=ka(e);G[a+8]=b;l=ka(l);G[a+9]=l;if(aa)return q.primitiveFailFor(104);q.failed()||(ya(Y),q.pop(6))},primitiveGetClipRect:function(){var b,c;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(b=yb(q.stackValue(1))))return q.primitiveFailFor(b);c=q.stackObjectValue(0);if(q.failed()||!(q.isPointers(c)&&2<=a(c)))return q.primitiveFailFor(3);
q.pushRemappableOop(c);b=q.makePointwithxValueyValue(z[42],z[44]);q.storePointerofObjectwithValue(0,q.topRemappableOop(),b);b=q.makePointwithxValueyValue(z[43],z[45]);c=q.popRemappableOop();q.storePointerofObjectwithValue(1,c,b);q.popthenPush(2,c)},primitiveAddBezier:function(){var a,b,c,d,h,e;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);d=q.positive32BitValueOf(q.stackValue(0));c=q.positive32BitValueOf(q.stackValue(1));e=q.stackObjectValue(2);a=q.stackObjectValue(3);h=q.stackObjectValue(4);
if(q.failed())return q.primitiveFailFor(3);if(0!==(b=Xa(q.stackValue(5),0)))return q.primitiveFailFor(b);if(!za(c)||!za(d))return q.primitiveFailFor(117);Qa(ca(),h);Qa(qa(),e);Qa(Ha(),a);if(q.failed())return q.primitiveFailFor(3);Pa(3);a=eb(ca(),qa(),Ha(),!1);Ka(16*a);aa||(c=ka(c),d=ka(d));aa||tc(0,0,c,d,a);if(aa)return bb(),q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);ya(Y);q.pop(5)},primitiveInitializeProcessing:function(){var a;fa&&(K=q.ioMicroMSecs());if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);
if(0!==(a=Xa(q.stackValue(0),0))||0!==(a=Tb(q.fetchPointerofObject(1,Ia))))return q.primitiveFailFor(a);gb();if(aa)return q.primitiveFailFor(104);ja(1);q.failed()||ya(Y);fa&&(V(91,1),V(90,q.ioMicroMSecs()-K))},primitiveRenderImage:function(){var a;if(0!==(a=Dc()))return q.primitiveFailFor(a);Ec();if(aa)return Ja();Nb();Ja()},primitiveGetOffset:function(){var a;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);a=q.makePointwithxValueyValue(z[46],
z[47]);q.popthenPush(1,a)},primitiveSetDepth:function(){var a;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);a=q.stackIntegerValue(0);if(q.failed())return q.primitiveFailFor(3);z[113]=a;ya(Y);q.pop(1)},primitiveAddBezierShape:function(){var b,c,d,h,e,l,f;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);d=q.positive32BitValueOf(q.stackValue(0));h=q.stackIntegerValue(1);c=q.positive32BitValueOf(q.stackValue(2));e=
q.stackIntegerValue(3);l=q.stackObjectValue(4);if(q.failed())return q.primitiveFailFor(3);if(0!==(b=Xa(q.stackValue(5),0)))return q.primitiveFailFor(b);b=a(l);if(q.isWords(l)){if(f=!1,b!==3*e&&b!==6*e)return q.primitiveFailFor(3)}else{if(!q.isArray(l)||b!==3*e)return q.primitiveFailFor(3);f=!0}if(!Ka((0===h||0===d?16:21)*e))return q.primitiveFailFor(111);if(!za(d)||!za(c))return q.primitiveFailFor(117);d=ka(d);c=ka(c);if(aa)return q.primitiveFailFor(104);if((0===d||0===h)&&0===c)return q.pop(5);0!==
h&&(h=wb(h),1>h&&(h=1));if(f)a:{b=c;var m,u,g,t,A;for(c=0;c<=e-1;c++){f=q.fetchPointerofObject(3*c,l);Qa(ca(),f);f=q.fetchPointerofObject(3*c+1,l);Qa(qa(),f);f=q.fetchPointerofObject(3*c+2,l);Qa(Ha(),f);if(q.failed())break a;Pa(3);f=ca()[0];g=ca()[1];m=qa()[0];t=qa()[1];u=Ha()[0];A=Ha()[1];if(f===g&&m===t||m===u&&t===A)Ib(h,ca(),Ha(),d,b,0);else{f=eb(ca(),qa(),Ha(),0!==h&&0!==d);if(aa)break a;tc(h,d,b,0,f)}if(aa)break a}}else a:for(l=l.wordsAsInt32Array(),b=3*e===b,f=1;f<=e;f++)if(lc(f-1,l,b,c,0,
h,d),aa)break a;if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);z[63]=1;ya(Y);q.pop(5)},primitiveSetEdgeTransform:function(){var a,b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);b=q.stackObjectValue(0);if(q.failed())return q.primitiveFailFor(3);z[16]=0;a=g(z,18);b=Ub(b,a,6);!q.failed()&&b&&(z[16]=1,a[2]+=z[46],a[5]+=z[47]);if(q.failed())return q.primitiveFailFor(3);ya(Y);q.pop(1)},getModuleName:function(){return"B2DPlugin 14 November 2014 (e)"},
primitiveGetTimes:function(){var b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(b=yb(q.stackValue(1))))return q.primitiveFailFor(b);b=q.stackObjectValue(0);if(q.failed()||!(q.isWords(b)&&9<=a(b)))return q.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[90];b[1]+=z[92];b[2]+=z[94];b[3]+=z[96];b[4]+=z[98];b[5]+=z[100];b[6]+=z[102];b[7]+=z[104];b[8]+=z[106];q.pop(1)},primitiveNextActiveEdgeEntry:function(){var a,b,c;fa&&(K=q.ioMicroMSecs());if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);
a=q.stackValue(1);0===(a=yb(a))&&(6===z[2]?a=0:8===z[2]?a=0:(z[64]=2,a=116));if(0!==a)return q.primitiveFailFor(a);b=q.stackObjectValue(0);if(q.failed())return q.primitiveFailFor(3);c=!1;8!==z[2]&&((c=Wa())?(a=S[z[13]],kb(a,b),ja(7)):ja(1));if(q.failed())return null;ya(Y);q.pop(2);q.pushBool(!c);fa&&(V(105,1),V(104,q.ioMicroMSecs()-K))},primitiveAddBitmapFill:function(){var a,b,c,d,h,e,l,f;if(7!==q.methodArgumentCount())return q.primitiveFailFor(5);f=q.stackIntegerValue(0);if(0>=f)return q.primitiveFailFor(3);
h=q.stackObjectValue(1);b=q.stackObjectValue(2);e=q.stackObjectValue(3);l=q.booleanValueOf(q.stackValue(4));a=q.stackObjectValue(5);d=q.stackObjectValue(6);if(q.failed())return q.primitiveFailFor(3);if(0!==(c=Xa(q.stackValue(7),0)))return q.primitiveFailFor(c);Qa(ca(),e);Qa(qa(),b);Qa(Ha(),h);if(q.failed())return q.primitiveFailFor(121);a=Mb(d,a,l?1:0,ca(),qa(),Ha(),f-1);if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);ya(Y);q.popthenPush(8,q.positive32BitIntegerFor(a))},
primitiveGetDepth:function(){var a;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);q.pop(1);q.pushInteger(z[113])},primitiveAbortProcessing:function(){var a;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);ja(8);ya(Y)},primitiveNextGlobalEdgeEntry:function(){var a,b,c;fa&&(K=q.ioMicroMSecs());if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==
(a=Xa(q.stackValue(1),1)))return q.primitiveFailFor(a);b=q.stackObjectValue(0);if(c=ea())a=Ea[z[11]],kb(a,b),z[11]+=1;if(q.failed())return q.primitiveFailFor(118);c?ja(2):(ja(3),z[69]=1,z[13]=0,bb());ya(Y);q.pop(2);q.pushBool(!c);fa&&(V(95,1),V(94,q.ioMicroMSecs()-K))},primitiveGetFailureReason:function(){var b;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);Ia=q.stackValue(0);if("number"===typeof Ia)return q.primitiveFailFor(101);if(!q.isPointers(Ia))return q.primitiveFailFor(102);if(12>
a(Ia))return q.primitiveFailFor(103);if(0!==(b=Xb(q.fetchPointerofObject(0,Ia))))return q.primitiveFailFor(b);q.pop(1);q.pushInteger(z[64])},primitiveDisplaySpanBuffer:function(){var a;fa&&(K=q.ioMicroMSecs());if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(0),5))||0!==(a=Tb(q.fetchPointerofObject(1,Ia))))return q.primitiveFailFor(a);if(!hb(q.fetchPointerofObject(2,Ia)))return q.primitiveFailFor(122);(Q()&z[52])===z[52]&&(oa(Q()),dc());8!==z[2]&&(z[13]=0,z[88]=
Q()+1,ja(6));ya(Y);fa&&(V(103,1),V(102,q.ioMicroMSecs()-K))},moduleUnloaded:function(a){0===strcmp(a,ia)&&(rb=Ta=0)},primitiveGetCounts:function(){var b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(b=yb(q.stackValue(1))))return q.primitiveFailFor(b);b=q.stackObjectValue(0);if(q.failed()||!(q.isWords(b)&&9<=a(b)))return q.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[91];b[1]+=z[93];b[2]+=z[95];b[3]+=z[97];b[4]+=z[99];b[5]+=z[101];b[6]+=z[103];b[7]+=z[105];b[8]+=z[107];
q.pop(1)},primitiveChangedActiveEdgeEntry:function(){var a;fa&&(K=q.ioMicroMSecs());if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),7)))return q.primitiveFailFor(a);a=q.stackObjectValue(0);if(q.failed())return q.primitiveFailFor(3);a=mc(a);if(!a)return q.primitiveFailFor(112);0===G[a+7]?Cc():(Ga(),z[13]+=1);ja(6);ya(Y);q.pop(1);fa&&(V(107,1),V(106,q.ioMicroMSecs()-K))},primitiveRenderScanline:function(){var a;if(0!==(a=Dc()))return q.primitiveFailFor(a);Ec();
Ja()},primitiveGetBezierStats:function(){var b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(b=yb(q.stackValue(1))))return q.primitiveFailFor(b);b=q.stackObjectValue(0);if(q.failed()||!(q.isWords(b)&&4<=a(b)))return q.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[108];b[1]+=z[109];b[2]+=z[110];b[3]+=z[111];q.pop(1)},primitiveFinishedProcessing:function(){var a;fa&&(K=q.ioMicroMSecs());if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);
a=8===z[2];ya(Y);q.pop(1);q.pushBool(a);fa&&(V(93,1),V(92,q.ioMicroMSecs()-K))},setInterpreter:function(a){q=a;a=1==q.majorVersion();return!1===a?!1:a=11<=q.minorVersion()},primitiveNeedsFlush:function(){var a;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);a=0!==z[63];ya(Y);q.pop(1);q.pushBool(a)},primitiveAddLine:function(){var a,b,c,d,h;if(4!==q.methodArgumentCount())return q.primitiveFailFor(5);d=q.positive32BitValueOf(q.stackValue(0));
c=q.positive32BitValueOf(q.stackValue(1));a=q.stackObjectValue(2);h=q.stackObjectValue(3);if(q.failed())return q.primitiveFailFor(3);if(0!==(b=Xa(q.stackValue(4),0)))return q.primitiveFailFor(b);if(!za(c)||!za(d))return q.primitiveFailFor(117);Qa(ca(),h);Qa(qa(),a);if(q.failed())return q.primitiveFailFor(121);Pa(2);c=ka(c);d=ka(d);if(aa)return q.primitiveFailFor(104);Ib(0,ca(),qa(),0,c,d);if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);ya(Y);q.pop(4)},primitiveSetOffset:function(){var a;
if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);a=q.stackValue(0);if(n(a)!==q.classPoint())return q.primitiveFailFor(3);Qa(ca(),a);if(q.failed())return q.primitiveFailFor(3);z[46]=ca()[0];z[47]=ca()[1];ya(Y);q.pop(1)},primitiveNextFillEntry:function(){var a,b;fa&&(K=q.ioMicroMSecs());if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),3))||0!==(a=Tb(q.fetchPointerofObject(1,Ia))))return q.primitiveFailFor(a);
if(!jc(q.fetchPointerofObject(3,Ia)))return q.primitiveFailFor(123);0!==z[69]&&(0===(Q()&z[52])&&M(),z[69]=0);a=q.stackObjectValue(0);b=Ma();if(aa)return q.primitiveFailFor(104);b&&qb(a);if(q.failed())return q.primitiveFailFor(117);b?ja(4):(bb(),z[35]=0,ja(5));ya(Y);q.pop(2);q.pushBool(!b);fa&&(V(99,1),V(98,q.ioMicroMSecs()-K))},primitiveInitializeBuffer:function(){var b,c;if(1!==q.methodArgumentCount())return q.primitiveFail();c=q.stackObjectValue(0);if(q.failed())return null;if(!q.isWords(c)||256>
(b=a(c)))return q.primitiveFail();z=c.wordsAsInt32Array();G=e(z,128);z[0]=1097753705;z[1]=b;z[10]=b;ja(0);z[8]=128;ya(4);fb(0,256);G[1]=4;G[2]=0;z[11]=0;z[12]=0;z[13]=0;z[14]=0;z[64]=0;z[63]=0;z[42]=0;z[43]=0;z[44]=0;z[45]=0;z[113]=0;z[90]=0;z[92]=0;z[94]=0;z[96]=0;z[98]=0;z[100]=0;z[102]=0;z[104]=0;z[106]=0;z[91]=0;z[93]=0;z[95]=0;z[97]=0;z[99]=0;z[101]=0;z[103]=0;z[105]=0;z[107]=0;z[108]=0;z[109]=0;z[110]=0;z[111]=0;b=g(z,18);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;z[16]=0;b=g(z,24);b[0]=1;b[1]=
0;b[2]=1;b[3]=0;b[4]=1;b[5]=0;b[6]=1;b[7]=0;z[17]=0;q.pop(2);q.push(c)},primitiveDoProfileStats:function(){var a,b;b=fa;a=q.stackObjectValue(0);a=q.booleanValueOf(a);q.failed()||(fa=a,q.pop(2),q.pushBool(b))},primitiveAddActiveEdgeEntry:function(){var a;fa&&(K=q.ioMicroMSecs());if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),2)))return q.primitiveFailFor(a);a=q.stackObjectValue(0);if(q.failed())return q.primitiveFailFor(3);a=mc(a);if(!a)return q.primitiveFailFor(112);
if(!Ka(1))return q.primitiveFailFor(111);0<G[a+7]&&jb(a);if(aa)return q.primitiveFailFor(104);ja(1);ya(Y);q.pop(1);fa&&(V(97,1),V(96,q.ioMicroMSecs()-K))},primitiveSetAALevel:function(){var a;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);a=q.stackIntegerValue(0);if(q.failed())return q.primitiveFailFor(3);ab(a);ya(Y);q.pop(1)},primitiveNeedsFlushPut:function(){var a;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);
if(0!==(a=yb(q.stackValue(1))))return q.primitiveFailFor(a);a=q.booleanValueOf(q.stackValue(0));if(q.failed())return q.primitiveFailFor(3);z[63]=!0===a?1:0;ya(Y);q.pop(1)},primitiveAddCompressedShape:function(){var b,c,d,h,e,l,f,m;if(7!==q.methodArgumentCount())return q.primitiveFailFor(5);c=q.stackObjectValue(0);h=q.stackObjectValue(1);e=q.stackObjectValue(2);m=q.stackObjectValue(3);d=q.stackObjectValue(4);l=q.stackIntegerValue(5);f=q.stackObjectValue(6);if(q.failed())return q.primitiveFailFor(3);
if(0!==(b=Xa(q.stackValue(7),0)))return q.primitiveFailFor(b);q.isWords(f)?(b=a(f),b=b!==3*l&&b!==6*l?!1:!0):b=!1;if(b){b:{var u,g,t;if(q.isWords(c)){t=a(c);u=c.wordsAsInt32Array();for(g=0;g<=t-1;g++)if(b=u[g],!za(b)){b=!1;break b}b=!0}else b=!1}if(b)if(b=a(c),D(d,b,l)&&D(m,b,l)&&D(h,b,l)){var A;u=a(e);t=e.wordsAsInt32Array();for(b=g=0;b<=u-1;b++)A=(t[b]|0)>>>16,g+=A;b=g!==l?!1:!0}else b=!1;else b=!1}else b=!1;if(!b)return q.primitiveFailFor(120);if(!Ka(Math.max(16,16)*l))return q.primitiveFailFor(111);
b=a(f)===3*l;a:{f=f.wordsAsInt32Array();d=d.wordsAsInt32Array();m=m.wordsAsInt32Array();e=e.wordsAsInt32Array();h=h.wordsAsInt32Array();c=c.wordsAsInt32Array();var x,k,N,w,n,r,C,p,v;if(0!==l)for(t=n=p=k=-1,g=w=C=x=1,A=r=v=N=0,u=1;u<=l;u++){if(0>=--g&&(++t,g=(d[t]|0)>>>16,A=(d[t]|0)&65535,0!==A&&(A=c[A-1],A=ka(A),aa)))break a;0>=--w&&(++n,w=(m[n]|0)>>>16,r=(m[n]|0)&65535,0!==r&&(r=c[r-1],r=ka(r)));0>=--C&&(++p,C=(e[p]|0)>>>16,v=(e[p]|0)&65535,0!==v&&(v=wb(v)));0>=--x&&(++k,x=(h[k]|0)>>>16,N=(h[k]|
0)&65535,0!==N&&(N=c[N-1]));lc(u-1,f,b,A,r,v,N);if(aa)break a}}if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);z[63]=1;ya(Y);q.pop(7)},primitiveSetColorTransform:function(){var a;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);a=q.stackObjectValue(0);if(q.failed())return q.primitiveFailFor(3);var b;b=g(z,24);z[17]=0;Ub(a,b,8)&&(z[17]=1,b[1]*=256,b[3]*=256,b[5]*=256,b[7]*=256);if(q.failed())return q.primitiveFailFor(119);
ya(Y);q.pop(1)},primitiveAddOval:function(){var a,b,c,d,h,e;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);a=q.positive32BitValueOf(q.stackValue(0));b=q.stackIntegerValue(1);h=q.positive32BitValueOf(q.stackValue(2));c=q.stackObjectValue(3);e=q.stackObjectValue(4);if(q.failed())return q.primitiveFailFor(3);if(0!==(d=Xa(q.stackValue(5),0)))return q.primitiveFailFor(d);if(!za(a)||!za(h))return q.primitiveFailFor(117);h=ka(h);a=ka(a);if(aa)return q.primitiveFailFor(104);if(0===h&&(0===a||
0>=b))return q.pop(5);if(!Ka(256))return q.primitiveFailFor(111);b=0<b&&0!==a?wb(b):0;Qa(ca(),e);Qa(qa(),c);if(q.failed())return q.primitiveFailFor(121);a:{var l,f,m;m=qa()[0]-ca()[0]>>1;e=qa()[1]-ca()[1]>>1;c=qa()[0]+ca()[0]>>1;d=qa()[1]+ca()[1]>>1;for(l=0;15>=l;l++){var u=l,g=m,t=e,A=c,x=d,k,w,n;f=v()[2*u+0]*g+A|0;w=N()[2*u+0]*t+x|0;ca()[0]=f;ca()[1]=w;k=v()[2*u+2]*g+A|0;n=N()[2*u+2]*t+x|0;Ha()[0]=k;Ha()[1]=n;g=v()[2*u+1]*g+A|0;u=N()[2*u+1]*t+x|0;g=2*g-(f+k>>1);u=2*u-(w+n>>1);qa()[0]=g;qa()[1]=
u;Pa(3);f=eb(ca(),qa(),Ha(),0!==b&&0!==a);if(aa)break a;tc(b,a,0,h,f);if(aa)break a}}if(aa)return bb(),q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);z[63]=1;ya(Y);q.pop(5)},primitiveRegisterExternalFill:function(){var a,b;if(1!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=Xa(q.stackValue(1),0)))return q.primitiveFailFor(a);b=q.stackIntegerValue(0);if(q.failed())return q.primitiveFailFor(3);for(a=0;0===a;){if(!r(10))return q.primitiveFailFor(111);a=Y;Y=a+4;
fb(a,256);G[a+1]=4;G[a+2]=b}q.failed()||(ya(Y),q.pop(2),q.pushInteger(a))},primitiveAddPolygon:function(){var b,c,d,h,e,l,f;if(5!==q.methodArgumentCount())return q.primitiveFailFor(5);d=q.positive32BitValueOf(q.stackValue(0));h=q.stackIntegerValue(1);c=q.positive32BitValueOf(q.stackValue(2));e=q.stackIntegerValue(3);l=q.stackObjectValue(4);if(q.failed())return q.primitiveFailFor(3);if(0!==(b=Xa(q.stackValue(5),0)))return q.primitiveFailFor(b);b=a(l);if(q.isWords(l)){if(f=!1,b!==e&&2*e!==b)return q.primitiveFailFor(3)}else{if(!q.isArray(l)||
b!==e)return q.primitiveFailFor(3);f=!0}if(!Ka((0===h||0===d?16:21)*e))return q.primitiveFail();if(!za(d)||!za(c))return q.primitiveFailFor(117);d=ka(d);c=ka(c);if(aa)return q.primitiveFailFor(104);if((0===d||0===h)&&0===c)return q.pop(5);0!==h&&(h=wb(h));if(f)a:{var m,u,g;Qa(ca(),q.fetchPointerofObject(0,l));if(!q.failed())for(f=ca()[0],u=ca()[1],b=1;b<=e-1;b++){Qa(ca(),q.fetchPointerofObject(b,l));if(q.failed())break a;m=ca()[0];g=ca()[1];ca()[0]=f;ca()[1]=u;qa()[0]=m;qa()[1]=g;Pa(2);Ib(h,ca(),
qa(),d,c,0);if(aa)break a;f=m;u=g}}else a:{l=l.wordsAsInt32Array();b=e===b;var t;b?(m=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[0],g=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[1]):(m=l[0]|0,g=l[1]|0);for(f=1;f<=e-1;f++){b?(u=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[2*f],t=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[2*f+1]):(u=l[2*f]|0,t=l[2*f+1]|0);ca()[0]=m;ca()[1]=g;qa()[0]=u;qa()[1]=t;Pa(2);
Ib(h,ca(),qa(),d,c,0);if(aa)break a;m=u;g=t}}if(aa)return q.primitiveFailFor(104);if(q.failed())return q.primitiveFailFor(119);z[63]=1;ya(Y);q.pop(5)},primitiveGetAALevel:function(){var a;if(0!==q.methodArgumentCount())return q.primitiveFailFor(5);if(0!==(a=yb(q.stackValue(0))))return q.primitiveFailFor(a);q.pop(1);q.pushInteger(z[48])}})});module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?K.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a,b){return Math.floor(a/b)|0}function e(a,b){return 31<b?0:a<<b}function g(a,b){return 31<b?0:a>>>b}function k(a,b){return 0>b?-31>b?0:a>>>0-b:31<
b?0:a<<b}function f(a,b){var c,d;if(16>R){c=a^b;for(d=Y[R];0!==c;)0!==(c&d)&&++ub,c=g(c,R);return b}16===R?(c=Mb(a,b,5,3),ub=ub+(c&31)+(c>>>5&31)+(c>>>10&31),c=Mb(a>>>16,b>>>16,5,3),ub=ub+(c&31)+(c>>>5&31)+(c>>>10&31)):(c=Mb(a,b,8,3),ub=ub+(c&255)+(c>>>8&255)+(c>>>16&255));return b}function d(a,b){var c,d,h,e;if(5!==(Ra&5))return b;if(16>R){c=Y[R]&Za;e=b;for(h=1;h<=na;h++)d=e&c,Va[d&Za]+=1,e=g(e,R);return b}16===R?(d=Ka(b&65535,5,nb),Va[d&Za]+=1,d=Ka(b>>>16,5,nb)):d=Ka(b,8,nb);Va[d&Za]+=1;return b}
function p(a,b){return a+b}function B(a,b){var c,d,h;h=a>>>24;if(0===h)return b;if(255===h)return a;c=255-h;d=(a&16711935)*h+(b&16711935)*c+16711935;c=((a>>>8|16711680)&16711935)*h+(b>>>8&16711935)*c+16711935;return d+(d-65537>>>8&16711935)>>>8&16711935|(c+(c-65537>>>8&16711935)>>>8&16711935)<<8}function y(a,b){return r(a,b,!1)}function r(a,b,d){var h,l,f,m,u,t,A,x,k,N,w;if(16>R)return b;x=255-oc;m=b;if(1===na)d&&0===a||(d=(a&16711935)*oc+(b&16711935)*x+16711935,x=(a>>>8&16711935)*oc+(b>>>8&16711935)*
x+16711935,m=d+(d-65537>>>8&16711935)>>>8&16711935|(x+(x-65537>>>8&16711935)>>>8&16711935)<<8);else for(h=Y[R],w=ka,f=a,l=1;l<=na;l++){t=f&h;if(!(0===(w&h)||d&&0===t)){k=b&h;a=0;for(A=1;3>=A;A++)u=5*(A-1),N=c((g(t,u)&31)*oc+(g(k,u)&31)*x+254,255)&31,a|=e(N,u);m=m&~e(h,16*(l-1))|e(a,16*(l-1))}w=g(w,R);f=g(f,R);b=g(b,R)}return m}function m(a,b){var c,d;c=255-(a>>>24);d=((b&16711935)*c>>>8&16711935)+(a&16711935);c=((b>>>8&16711935)*c>>>8&16711935)+(a>>>8&16711935);return(c&16711935)<<8|255*(c&16777472)|
d&16711935|255*(d&16777472)>>>8}function h(a,b){return 0===a?b:r(a,b,!0)}function u(a,b){return a&b}function A(a,b){return a&~b}function l(a,b){return~a&b}function t(a,b){return~a&~b}function x(a,b){return~b}function F(a,b){return~a|b}function w(a,b){return~a|~b}function L(a,b){return~a}function J(a,b){return~a^b}function E(a,b){return a|b}function I(a,b){return a|~b}function H(a,b){return a^b}function C(a,b){return 0}function D(){$a>=Ca?(Fa=pc,S=$a,ma=$b):(Fa=pc+(Ca-$a),ma=$b-(Ca-$a),S=Ca);S+ma>
Ca+Eb&&(ma-=S+ma-(Ca+Eb));bb>=Da?(Oa=Ac,ia=bb,ga=Db):(Oa=Ac+Da-bb,ga=Db-(Da-bb),ia=Da);ia+ga>Da+ja&&(ga-=ia+ga-(Da+ja));if(Ob)return null;0>Fa&&(S-=Fa,ma+=Fa,Fa=0);Fa+ma>hc&&(ma-=Fa+ma-hc);0>Oa&&(ia-=Oa,ga+=Oa,Oa=0);Oa+ga>ec&&(ga-=Oa+ga-ec)}function v(){D();if(0>=ma||0>=ga)return Ga=ab=Ya=Ua=0,null;if(!lb())return K.primitiveFail();N();sc()}function N(){P();if(K.failed())return K.primitiveFail();if(gc())return null;if(30===Ja||31===Ja)if(1===K.methodArgumentCount()){if(oc=K.stackIntegerValue(0),K.failed()||
!(0<=oc&&255>=oc))return K.primitiveFail()}else return K.primitiveFail();ub=0;W();if(Ob){var a,b,d,h,l,f;d=ua[Ja+1];d;for(f=1;f<=ga;f++){b=z?4294967295:la(ia+f-1);ka=Ta;h=da[ha>>>2];a=d(b,h);h=ka&a|h&~ka;da[ha>>>2]=h;ha+=4;ka=4294967295;if(3===Ja)for(h=b,l=2;l<=ba-1;l++)da[ha>>>2]=h,ha+=4;else for(l=2;l<=ba-1;l++)h=da[ha>>>2],a=d(b,h),da[ha>>>2]=a,ha+=4;1<ba&&(ka=G,h=da[ha>>>2],a=d(b,h),h=ka&a|h&~ka,da[ha>>>2]=h,ha+=4);ha+=Wb}}else if(Jb===vb&&ia>=Oa&&(ia>Oa?(kc=-1,Oa=Oa+ga-1,ia=ia+ga-1):ia===Oa&&
S>Fa&&(mb=-1,Fa=Fa+ma-1,S=S+ma-1,1<ba&&(a=Ta,Ta=G,G=a)),ha=ia*Pa+4*c(S,na),Wb=Pa*kc-4*ba*mb),cb!==R||0!==Ra||fc!==db)M();else{h=na-1;b=Fa&h;a=S&h;0<mb?(d=Math.min(ma,na-a),uc=b+d>h):(d=Math.min(ma,a+1),uc=0>b-d+1);zb=fc?(b-a)*R:(a-b)*R;uc&&(zb=0>zb?zb+32:zb-32);ob=Oa*tb+4*c(Fa,c(32,cb));vc=tb*kc-4*ba*mb;uc&&(vc-=4*mb);var m,u,t,A,x,N;h=ua[Ja+1];h;l=4*mb;-32===zb?zb=d=a=0:0>zb?(d=zb+32,a=e(4294967295,0-zb)):0===zb?(d=0,a=4294967295):(d=zb-32,a=g(4294967295,zb));N=~a;z?(b=4294967295,Ia=0):b=la(0);t=
ia;for(A=1;A<=ga;A++){1<Ia&&(b=la(t),t+=kc);uc?(f=Ba[ob>>>2],ob+=l):f=0;ka=Ta;x=Ba[ob>>>2];ob+=l;m=k(f&N,d)|k(x&a,zb);f=x;u=da[ha>>>2];m=h(m&b,u);u=ka&m|u&~ka;da[ha>>>2]=u;ha+=l;ka=4294967295;if(3===Ja)if(0===zb&&4294967295===b)if(-1===mb)for(u=2;u<=ba-1;u++)x=Ba[ob>>>2],ob+=l,da[ha>>>2]=x,ha+=l;else for(u=2;u<=ba-1;u++)da[ha>>>2]=f,ha+=l,f=Ba[ob>>>2],ob+=l;else for(u=2;u<=ba-1;u++)x=Ba[ob>>>2],ob+=l,m=k(f&N,d)|k(x&a,zb),f=x,da[ha>>>2]=m&b,ha+=l;else for(u=2;u<=ba-1;u++)x=Ba[ob>>>2],ob+=l,m=k(f&N,
d)|k(x&a,zb),f=x,m=h(m&b,da[ha>>>2]),da[ha>>>2]=m,ha+=l;1<ba&&(ka=G,x=Ba[ob>>>2],ob+=l,m=k(f&N,d)|k(x&a,zb),u=da[ha>>>2],m=h(m&b,u),u=ka&m|u&~ka,da[ha>>>2]=u,ha+=l);ob+=vc;ha+=Wb}}if(22===Ja||32===Ja)Ga=ab=Ya=Ua=0;0<mb?(Ga=S,ab=S+ma):(Ga=S-ma+1,ab=S+1);0<kc?(Ya=ia,Ua=ia+ga):(Ya=ia-ga+1,Ua=ia+1)}function P(){var a;if(41===Ja)if(zc=255,Hb=16777215,Yb=rb=null,2<=K.methodArgumentCount()){zc=K.stackIntegerValue(K.methodArgumentCount()-2);if(K.failed())return K.primitiveFail();Hb=K.stackIntegerValue(K.methodArgumentCount()-
1);if(K.failed())return K.primitiveFail();4===K.methodArgumentCount()&&(a=K.stackObjectValue(1),K.isBytes(a)&&(rb=a.bytes),a=K.stackObjectValue(0),K.isBytes(a)&&(Yb=a.bytes))}else if(1===K.methodArgumentCount()){if(Hb=K.stackIntegerValue(0),K.failed())return K.primitiveFail()}else return K.primitiveFail()}function M(){var a,b,d,h,l,f,m,u,t,A,x,k,N,w,n,r,C;t=ua[Ja+1];t;Zb=c(32,cb);h=Y[cb];N=Y[R];a=Ra&-9;ob=Oa*tb+4*c(Fa,Zb);b=Zb-(Fa&Zb-1);b=ma<b?0:c(ma-b,Zb)+1;vc=tb-4*b;u=na-(S&na-1);r=(S+ma-1&na-1)+
1;ma<u&&(u=ma);n=(Fa&Zb-1)*cb;A=(S&na-1)*R;b=cb;w=R;d=0;fc&&(n=32-cb-n,b=0-b);db&&(A=32-R-A,w=0-w,d=32-R);for(x=1;x<=ga;x++){k=z?4294967295:la(ia+x-1);wc=n;Na=A;ka=Ta;C=u;f=ba;do{m=a;l=h;var p=N,v=b,y=w,q,P,B,F,M;B=Ba[ob>>>2];M=0;P=wc;F=Na;if(5===m){do q=g(B,P)&l,q=Va[q&Za],M|=e(q&p,F),F+=y,0!==((P+=v)&4294967264)&&(P=fc?P+32:P-32,B=Ba[(ob+=4)>>>2]);while(0!==--C)}else{do q=g(B,P)&l,q=gb(q,m),M|=e(q&p,F),F+=y,0!==((P+=v)&4294967264)&&(P=fc?P+32:P-32,B=Ba[(ob+=4)>>>2]);while(0!==--C)}wc=P;l=M;Na=d;
4294967295===ka?(l=t(l&k,da[ha>>>2]),da[ha>>>2]=ka&l):(m=da[ha>>>2],l=t(l&k,m&ka),m=ka&l|m&~ka,da[ha>>>2]=m);ha+=4;2===f?(ka=G,C=r):(ka=4294967295,C=na)}while(0!==--f);ob+=vc;ha+=Wb}}function O(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,
4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,
4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,
4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,
4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,
4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}function X(a,b,d){return b>
a?c(b-a+16384,d+1)+1:b===a?0:0-(c(a-b+16384,d+1)+1)}function W(){var a,b,d;d=na-1;b=na-(S&d);Ta=db?g(4294967295,32-b*R):e(4294967295,32-b*R);a=(S+ma-1&d)+1;G=db?e(4294967295,32-a*R):g(4294967295,32-a*R);ma<b?(Ta&=G,G=0,ba=1):ba=c(ma-b+d,na)+1;mb=kc=1;ha=ia*Pa+4*c(S,na);Wb=Pa*kc-4*ba*mb}function Q(a,b){return b}function oa(a,b){var c;c=b<<8;return(Pb[c+(a>>>16&255)]<<10)+(Pb[c+(a>>>8&255)]<<5)+Pb[c+(a&255)]}function U(a,b,c){var d;d=da[a>>>2];da[a>>>2]=d&c|b}function Z(a,b){var c;c=K.fetchPointerofObject(a,
b);if("number"===typeof c)return c;c=K.floatValueOf(c);return-2147483648<=c&&2147483647>=c?c|0:(K.primitiveFail(),0)}function T(a,b,c){a=K.fetchPointerofObject(a,b);if("number"===typeof a)return a;if(a.isNil)return c;c=K.floatValueOf(a);return-2147483648<=c&&2147483647>=c?c|0:(K.primitiveFail(),0)}function xa(a,b){return 32!==R?b:0===b?0:0!==(b&4278190080)?b:b|a&4278190080}function la(a){var b=Fb,d=Ia;a=a-c(a,d)*d|0;return b[a]}function wa(a){return a.isNil||0===Ja||5===Ja||10===Ja||15===Ja?!0:!1}
function La(){var a;da=K.fetchPointerofObject(0,vb);wb=K.fetchIntegerofObject(1,vb);Gb=K.fetchIntegerofObject(2,vb);if(!(0<=wb&&0<=Gb))return!1;R=K.fetchIntegerofObject(3,vb);db=0<R;0>R&&(R=0-R);if("number"===typeof da){if(!Qa(da))return!1;na=c(32,R);da=Pa=0}else{na=c(32,R);Pa=4*c(wb+(na-1),na);a=b(da);if(!K.isWordsOrBytes(da)||a!==Pa*Gb)return!1;da=da.wordsOrBytes()}return!0}function ea(a){return Ma(a,!1)}function Ma(b,c){var d;pa=b;Ea=c;Ja=K.fetchIntegerofObject(3,pa);if(K.failed()||0>Ja||41<Ja||
16<=Ja&&17>=Ja)return!1;Jb=K.fetchPointerofObject(1,pa);Ob=wa(Jb);fa=K.fetchPointerofObject(2,pa);z=wa(fa);vb=K.fetchPointerofObject(0,b);if(!(K.isPointers(vb)&&4<=a(vb)))return!1;d=La();if(!d)return!1;$a=T(4,pa,0);bb=T(5,pa,0);$b=T(6,pa,wb);Db=T(7,pa,Gb);if(K.failed())return!1;if(Ob)pc=Ac=0;else{if(!(K.isPointers(Jb)&&4<=a(Jb)))return!1;d=Wa();if(!d)return!1;d=sa();if(!d)return!1;0===(Ra&8)&&Ha();pc=T(8,pa,0);Ac=T(9,pa,0)}d=Sa();if(!d)return!1;Ca=T(10,pa,0);Da=T(11,pa,0);Eb=T(12,pa,wb);ja=T(13,pa,
Gb);if(K.failed())return!1;0>Ca&&(Eb+=Ca,Ca=0);0>Da&&(ja+=Da,Da=0);Ca+Eb>wb&&(Eb=wb-Ca);Da+ja>Gb&&(ja=Gb-Da);return!0}function Wa(){var a;Ba=K.fetchPointerofObject(0,Jb);hc=Z(1,Jb);ec=Z(2,Jb);if(!(0<=hc&&0<=ec))return!1;cb=K.fetchIntegerofObject(3,Jb);fc=0<cb;0>cb&&(cb=0-cb);if("number"===typeof Ba){if(!Dc(Ba))return!1;Zb=c(32,cb);Ba=tb=0}else{Zb=c(32,cb);tb=4*c(hc+(Zb-1),Zb);a=b(Ba);if(!K.isWordsOrBytes(Ba)||a!==tb*ec)return!1;Ba=Ba.wordsOrBytes()}return!0}function sa(){var b,c,d;Ra=Za=nb=0;Va=kb=
qb=null;b=K.fetchPointerofObject(14,pa);if(b.isNil)return!0;Ra=1;d=!1;if(K.isWords(b))c=a(b),Va=b.words,d=!0;else{if(!(K.isPointers(b)&&3<=a(b)))return!1;qb=ta(K.fetchPointerofObject(0,b));kb=ta(K.fetchPointerofObject(1,b));b=K.fetchPointerofObject(2,b);if(b.isNil)c=0;else{if(!K.isWords(b))return!1;c=a(b);Va=b.words}Ra|=8}if(0!==(c&c-1))return!1;Za=c-1;nb=0;512===c&&(nb=3);4096===c&&(nb=4);32768===c&&(nb=5);0===c?(Va=null,Za=0):Ra|=4;d&&Ha();c=qb&&kb?0===qb[0]&&0===qb[1]&&0===qb[2]&&0===qb[3]&&16711680===
kb[0]&&65280===kb[1]&&255===kb[2]&&4278190080===kb[3]?!0:!1:!0;c?qb=kb=null:Ra|=2;return!0}function ta(b){return b.isNil?null:"number"!==typeof b&&K.isWords(b)&&4===a(b)?b.words:(K.primitiveFail(),null)}function Sa(){var b;if(z)return Fb=null,!0;if(K.isPointers(fa)&&4<=a(fa))b=K.fetchPointerofObject(0,fa),Ia=K.fetchIntegerofObject(2,fa),K.isWords(b)||(z=!0);else{if(K.isPointers(fa)||!K.isWords(fa))return!1;b=fa;Ia=a(b)}Fb=b.wordsOrBytes();return!0}function V(){nc=K.ioLoadFunctionFrom("ioGetSurfaceFormat",
"SurfacePlugin");q=K.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin");xc=K.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin");return!!nc&&!!q&&!!xc}function lb(){var a,b,c,d,h,e;aa=!1;if(0===da){if(!q&&!V())return null;c=q;a=K.fetchIntegerofObject(0,vb);if(0===Ba&&!Ob&&(b=K.fetchIntegerofObject(0,Jb),b===a))return Ea?(e=Math.min(Fa,S),d=Math.max(Fa,S)+ma,a=Math.min(Oa,ia),h=Math.max(Oa,ia)+ga,Ba=c(b,function(a){tb=a},e,a,d-e,h-a)):Ba=c(b,function(a){tb=a},0,0,hc,ec),da=Ba,Pa=tb,aa=!0,0!==da;
da=c(a,function(a){Pa=a},S,ia,ma,ga);aa=!0}if(0===Ba&&!Ob){b=K.fetchIntegerofObject(0,Jb);if(!q&&!V())return null;c=q;Ba=Ea?c(b,function(a){tb=a},0,0,hc,ec):c(b,function(a){tb=a},Fa,Oa,ma,ga);aa=!0}return 0!==da&&(0!==Ba||Ob)}function gb(a,b){var c;c=a;0!==(b&1)&&(0!==(b&2)&&(c=k(a&kb[0],qb[0]),c|=k(a&kb[1],qb[1]),c|=k(a&kb[2],qb[2]),c|=k(a&kb[3],qb[3]),0===c&&0!==a&&(c=1)),0!==(b&4)&&(c=Va[c&Za]));return c}function jb(a,b,c,d){var h,l,f;f=Y[c];h=0;for(l=1;l<=d;l++)(a&f)===f&&(h|=b&f),f=e(f,c);return h}
function za(a,b,c,d,h){var e;e=a&h;h&=b;a=(a^e)+(b^h);return a^e^h|g(e&h|(e|h)&a,c-1)*d}function va(a,b,c,d){var h,l,f;f=Y[c];h=0;for(l=1;l<=d;l++)h|=Math.max(b&f,a&f),f=e(f,c);return h}function eb(a,b,c,d){var h,l,f;f=Y[c];h=0;for(l=1;l<=d;l++)h|=Math.min(b&f,a&f),f=e(f,c);return h}function hb(a,b,c,d){var h,l,f,m;m=Y[c];h=e(m,c);l=g(((a&m)+1)*((b&m)+1)-1&h,c);if(1===d)return l;f=((g(a,c)&m)+1)*((g(b,c)&m)+1)-1&h;l|=f;if(2===d)return l;f=((g(a,2*c)&m)+1)*((g(b,2*c)&m)+1)-1&h;l|=e(f,c);if(3===d)return l;
f=((g(a,3*c)&m)+1)*((g(b,3*c)&m)+1)-1&h;return l|=e(f,2*c)}function Mb(a,b,c,d){var h,l,f,m,u;u=Y[c];l=0;for(m=1;m<=d;m++)f=a&u,h=b&u,l=f<h?l|h-f:l|f-h,u=e(u,c);return l}function rc(a,b){var c,d;if(0>a||0>b||(d=a>>>14)>=hc||(c=b>>>14)>=ec)return 0;c=c*tb+4*g(d,Gc);c=Ba[c>>>2];wc=Hc[d&Fc];return g(c,wc)&Ic}function lc(a,b){var c,d,h,l,f;if(32===R)return a===b?0:b;d=R;f=Y[d];h=0;for(l=1;l<=na;l++)c=b&f,(a&f)===c&&(c=0),h|=c,f=e(f,d);return h}function mc(a,b){return jb(~a,b,R,na)}function Sb(a,b){return 0===
a?b:a|jb(~a,b,R,na)}function jc(a,b){var c,d,h,l,f;if(1===na)return b;c=0;h=e(1,R)-1;l=e(h,(na-1)*R);d=32-R;c|=e(b&h,d)|g(b&l,d);if(2>=na)return c;for(f=2;f<=na>>1;f++)h=e(h,R),l=g(l,R),d-=2*R,c|=e(b&h,d)|g(b&l,d);return c}function Qa(a){return nc||V()?nc(a,function(a,b,c,d){wb=a;Gb=b;R=c;db=d}):!1}function Dc(a){return nc||V()?nc(a,function(a,b,c,d){hc=a;ec=b;cb=c;fc=d}):!1}function Tb(a,b){var d,h;return 16>R?(h=e(1,R)-1,d=e(c(4294967295,h),R-1),za(a,b,R,h,d)):16===R?za(a&2147450879,b&2147450879,
5,31,1108361744):za(a,b,8,255,2155905152)}function Ub(a,b){var c,d,h,e,l,f,m,u;e=a;if(0===e)return b;d=Hb;f=zc&255;m=e&255;e>>>=8;c=e&255;e>>>=8;l=e&255;e=e>>>8&255;255!==f&&(e=e*f>>>8,l=l*f>>>8,c=c*f>>>8,m=m*f>>>8);f=b;h=f&255;u=d&255;Yb&&(h=Yb[h],u=Yb[u]);m=(h*(255-m)>>>8)+(u*m>>>8);255<m&&(m=255);rb&&(m=rb[m]);f>>>=8;d>>>=8;h=f&255;u=d&255;Yb&&(h=Yb[h],u=Yb[u]);c=(h*(255-c)>>>8)+(u*c>>>8);255<c&&(c=255);rb&&(c=rb[c]);f>>>=8;h=f&255;u=d>>>8&255;Yb&&(h=Yb[h],u=Yb[u]);d=(h*(255-l)>>>8)+(u*l>>>8);
255<d&&(d=255);rb&&(d=rb[d]);e=((f>>>8&255)*(255-e)>>>8)+e;255<e&&(e=255);return(((e<<8)+d<<8)+c<<8)+m}function tc(a,b){if(0===a)return b;var c=R,d=na,h,l,f,m,u;u=Y[c];l=0;for(m=1;m<=d;m++)f=g(a&u,(m-1)*c),h=g(b&u,(m-1)*c),32!==c&&(16===c?(f=Xb(f)|4278190080,h=Xb(h)|4278190080):(f=Ka(f,c,32)|4278190080,h=Ka(h,c,32)|4278190080)),h=Ub(f,h),32!==c&&(h=Ka(h,32,c)),l|=e(h,(m-1)*c),u=e(u,c);return l}function Ib(a,b){var c,d,h,e,l,f,m,u,t;e=Y[R];16===R?(d=5,l=31):(d=8,l=255);u=ka;f=b;h=a;for(m=1;m<=na;m++)0<
(u&e)&&(t=f&e,c=h&e,16>R?c=c===t?0:1:(c=Mb(c,t,d,3),c=(c&l)+(g(c,d)&l)+(g(g(c,d),d)&l)),ub+=c),u=g(u,R),h=g(h,R),f=g(f,R);return b}function Xb(a){return(a&31)<<3|(a&992)<<6|(a&31744)<<9}function Ka(a,b,c){var d,h;if(0<(d=c-b))return b=e(1,b)-1,h=e(a,d),b=e(b,d),a=h&b,b=e(b,c),h=e(h,d),a+(h&b)+(e(h,d)&e(b,c));if(0===d)return 5===b?a&32767:8===b?a&16777215:a;if(0===a)return a;d=b-c;b=e(1,c)-1;h=g(a,d);a=h&b;b=e(b,c);h=g(h,d);a=a+(h&b)+(g(h,d)&e(b,c));return 0===a?1:a}function ya(a,b){return 16>R?va(a,
b,R,na):16===R?va(a,b,5,3)+(va(a>>>16,b>>>16,5,3)<<16):va(a,b,8,4)}function sb(a,b){return 16>R?eb(a,b,R,na):16===R?eb(a,b,5,3)+(eb(a>>>16,b>>>16,5,3)<<16):eb(a,b,8,4)}function fb(a,b){var c;c=~a;return 16>R?eb(c,b,R,na):16===R?eb(c,b,5,3)+(eb(c>>>16,b>>>16,5,3)<<16):eb(c,b,8,4)}function ca(a,b){return 16>R?hb(a,b,R,na):16===R?hb(a,b,5,3)+(hb(a>>>16,b>>>16,5,3)<<16):hb(a,b,8,4)}function qa(a,b){return 16>R?Mb(a,b,R,na):16===R?Mb(a,b,5,3)+(Mb(a>>>16,b>>>16,5,3)<<16):Mb(a,b,8,4)}function Ha(){var a,
b;a=b=0;if(8>=cb)return null;16===cb&&(a=5);32===cb&&(a=8);if(0===nb){if(8>=R)return null;16===R&&(b=5);32===R&&(b=8)}else b=nb;dc(a,b)}function dc(a,b){var c=[0,0,0,0],d=[0,0,0,0],h,l;h=b-a;if(0===h)return 0;0>=h?(l=e(1,b)-1,d[0]=e(l,2*a-h),d[1]=e(l,a-h),d[2]=e(l,0-h),d[3]=0):(l=e(1,a)-1,d[0]=e(l,2*a),d[1]=e(l,a),d[2]=l);c[0]=3*h;c[1]=2*h;c[2]=h;c[3]=0;qb=c;kb=d;Ra|=3}function Nb(){K.showDisplayBitsLeftTopRightBottom(vb,Ga,Ya,ab,Ua)}function Ec(a,b){return a}function yb(a,b){return a-b}function Xa(a,
b){var c,d,h,e,l;if(5!==(Ra&5))return b;c=Y[R];h=b;l=ka;for(e=1;e<=na;e++)0!==(l&c)&&(d=h&c,d=16>R?d:16===R?Ka(d,5,nb):Ka(d,8,nb),Va[d&Za]+=1),l=g(l,R),h=g(h,R);return b}function gc(){if(Ob||34!==Ja&&41!==Ja||32!==cb||Jb===vb)return!1;if(41===Ja){if(32===R){var a,b,d,h,l,f,u,t;f=ga+1;u=Oa;for(t=ia;0!==--f;){b=u*tb+4*Fa;h=t*Pa+4*S;for(d=ma+1;0!==--d;)if(a=Ba[b>>>2],l=a&16777215,0===l){b+=4;for(h+=4;0!==--d&&0===(Ba[b>>>2]&16777215);)b+=4,h+=4;++d}else l=da[h>>>2],l=Ub(a,l),da[h>>>2]=l,b+=4,h+=4;++u;
++t}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}if(16===R){var A,x,k,N,w;x=ga+1;k=Oa;N=ia;d=16*(S&1);db&&(d=16-d);for(Ta=e(65535,16-d);0!==--x;){f=k*tb+4*Fa;t=N*Pa+4*(S>>1);a=4*(N&3);w=(Fa&3)-1;u=ma+1;l=Ta;for(d=65535===l?16:0;0!==--u;)b=ra[a+(w=w+1&3)],h=Ba[f>>>2],A=h&16777215,0!==A&&(A=da[t>>>2],A&=~l,A=g(A,d),A=(A&31744)<<9|(A&992)<<6|(A&31)<<3|4278190080,h=Ub(h,A),h=oa(h,b),h=0===h?e(1,d):e(h,d),U(t,h,l)),f+=4,db?0===d&&(t+=4):0!==d&&(t+=4),d^=16,l=~l;++k;++N}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}if(8===
R){f=O();l=Ra&-9;k=ga+1;N=Oa;w=ia;Ta=8*(S&3);db&&(Ta=24-Ta);G=4294967295^e(255,Ta);t=0===(S&1)?0:522133279;for(0===(ia&1)&&(t^=522133279);0!==--k;){t^=522133279;d=N*tb+4*Fa;u=w*Pa+4*(S>>2);h=ma+1;a=Ta;for(x=G;0!==--h;)b=(Ba[d>>>2]&~t)+t,A=b&16777215,A=c((A>>>16)+(A>>>8&255)+(A&255),3),31<A&&(224<A&&(b=4294967295),A=da[u>>>2],A&=~x,A=g(A,a),A=f[A],b=Ub(b,A),b=gb(b,l),b=e(b,a),U(u,b,x)),d+=4,db?0===a?(u+=4,a=24,x=16777215):(a-=8,x=x>>>8|4278190080):32===a?(u+=4,a=0,x=4294967040):(a+=8,x=x<<8|255),t^=
522133279;++N;++w}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}return!1}if(8>R||8===R&&0===(Ra&1))return!1;if(32===R)for(f=ga+1,u=Oa,t=ia;0!==--f;){b=u*tb+4*Fa;h=t*Pa+4*S;for(d=ma+1;0!==--d;)if(a=Ba[b>>>2],l=a>>>24,255===l){da[h>>>2]=a;b+=4;for(h+=4;0!==--d&&255===(a=Ba[b>>>2])>>>24;)da[h>>>2]=a,b+=4,h+=4;++d}else if(0===l){b+=4;for(h+=4;0!==--d&&0===Ba[b>>>2]>>>24;)b+=4,h+=4;++d}else l=da[h>>>2],l=m(a,l),da[h>>>2]=l,b+=4,h+=4;++u;++t}if(16===R)for(x=ga+1,k=Oa,N=ia,d=16*(S&1),db&&(d=16-d),Ta=e(65535,16-d);0!==
--x;){f=k*tb+4*Fa;t=N*Pa+4*(S>>1);a=4*(N&3);w=(Fa&3)-1;u=ma+1;l=Ta;for(d=65535===l?16:0;0!==--u;)b=ra[a+(w=w+1&3)],h=Ba[f>>>2],A=h>>>24,255===A?(h=oa(h,b),h=0===h?e(1,d):e(h,d),U(t,h,l)):0!==A&&(A=da[t>>>2],A&=~l,A=g(A,d),A=(A&31744)<<9|(A&992)<<6|(A&31)<<3|4278190080,h=m(h,A),h=oa(h,b),h=0===h?e(1,d):e(h,d),U(t,h,l)),f+=4,db?0===d&&(t+=4):0!==d&&(t+=4),d^=16,l=~l;++k;++N}if(8===R)for(f=O(),l=Ra&-9,k=ga+1,N=Oa,w=ia,Ta=8*(S&3),db&&(Ta=24-Ta),G=4294967295^e(255,Ta),t=0===(S&1)?0:522133279,0===(ia&1)&&
(t^=522133279);0!==--k;){t^=522133279;d=N*tb+4*Fa;u=w*Pa+4*(S>>2);h=ma+1;a=Ta;for(x=G;0!==--h;)b=(Ba[d>>>2]&~t)+t,A=b>>>24,31<A&&(224>A&&(A=da[u>>>2],A&=~x,A=g(A,a),A=f[A],b=m(b,A)),b=gb(b,l),b=e(b,a),U(u,b,x)),d+=4,db?0===a?(u+=4,a=24,x=16777215):(a-=8,x=x>>>8|4278190080):24===a?(u+=4,a=0,x=4294967040):(a+=8,x=x<<8|255),t^=522133279;++N;++w}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}function sc(){var a,b,c,d;if(aa){if(!xc&&!V())return null;c=xc;d=!1;a=K.fetchPointerofObject(0,vb);"number"===typeof a&&
(c(a,Ga,Ya,ab-Ga,Ua-Ya),da=Pa=0,d=!0);Ob||(b=K.fetchPointerofObject(0,Jb),"number"===typeof b&&(d&&b===a||c(b,0,0,0,0),Ba=tb=0));aa=!1}}function Cc(){var b,d,h,l,f,m,u,g,t,A,x,k,N,w,n,r,C,p,v,y,q,P,B,F,M;t=ua[Ja+1];t;if(!(27<=a(pa)))return K.primitiveFail();f=Db-1;0>=f&&(f=1);y=Z(15,pa);h=Z(18,pa);F=X(y,h,f);0>F&&(y=h-f*F);n=Z(16,pa);h=Z(19,pa);q=X(n,h,f);0>q&&(n=h-f*q);C=Z(24,pa);h=Z(21,pa);A=X(C,h,f);0>A&&(C=h-f*A);x=Z(25,pa);h=Z(22,pa);m=X(x,h,f);0>m&&(x=h-f*m);if(K.failed())return!1;if(2===K.methodArgumentCount())if(M=
K.stackIntegerValue(1),p=K.stackValue(0),p.isNil){if(16>cb)return K.primitiveFail()}else{if(a(p)<e(1,cb))return K.primitiveFail();p=p.wordsOrBytes()}else M=1,p=K.nilObject();f=$b-1;0>=f&&(f=1);g=na-(S&na-1);P=(S+ma-1&na-1)+1;ma<g&&(g=ma);bb<Da&&(y+=(Da-bb)*F,n+=(Da-bb)*q,C+=(Da-bb)*A,x+=(Da-bb)*m);yc=0;for(b=cb;1!==b;)++yc,b>>>=1;Ic=Y[cb];Gc=5-yc;Fc=e(1,Gc)-1;for(b=0;b<=Fc;b++)Hc[b]=fc?32-e(b+1,yc):e(b,yc);1<M&&0===(Ra&8)&&(Va?dc(8,nb):16===R&&dc(8,5));b=Ra&-9;db?(r=0-R,d=32-R):(r=R,d=0);for(k=1;k<=
ga;k++){v=X(y,C,f);Fa=0<=v?y:C-f*v;N=X(n,x,f);Oa=0<=N?n:x-f*N;Na=db?32-((S&na-1)+1)*R:(S&na-1)*R;$a<Ca&&(Fa+=(Ca-$a)*v,Oa+=(Ca-$a)*N);w=z?4294967295:la(ia+k-1);ka=Ta;B=g;h=ba;do{if(1===M){u=v;l=N;var J=r,O=b,L,E,oa;E=Y[R];oa=0;if(5===O){do L=rc(Fa,Oa),L=Va[L&Za],oa|=e(L&E,Na),Na+=J,Fa+=u,Oa+=l;while(0!==--B)}else{do L=rc(Fa,Oa),L=gb(L,O),oa|=e(L&E,Na),Na+=J,Fa+=u,Oa+=l;while(0!==--B)}}else{var D=B;u=v;l=N;var I=F,H=q,J=p,O=M;E=r;var wa,U,T,sa,W,Q,ta,La,ea,xa,V,Ma,Sa;T=Y[R];oa=0;2===O?(B=u>>1,L=l>>
1,I>>=1,H>>=1):(B=c(u,O),L=c(l,O),I=c(I,O),H=c(H,O));U=D;do{ea=Fa;W=Oa;Ma=xa=V=La=Q=0;wa=O;do{Sa=ea;ta=W;D=O;do{sa=rc(Sa,ta);if(25!==Ja||0!==sa)++Ma,sa=16>cb?J[sa]:16===cb?Xb(sa):sa,Q+=sa&255,La+=sa>>>8&255,V+=sa>>>16&255,xa+=sa>>>24;Sa+=B;ta+=L}while(0!==--D);ea+=I;W+=H}while(0!==--wa);0===Ma||25===Ja&&Ma<O*O>>1?sa=0:(4===Ma?(V>>>=2,La>>>=2,Q>>>=2,xa>>>=2):(V=c(V,Ma),La=c(La,Ma),Q=c(Q,Ma),xa=c(xa,Ma)),sa=(xa<<24)+(V<<16)+(La<<8)+Q,0===sa&&0<V+La+Q+xa&&(sa=1),sa=gb(sa,Ra));oa|=e(sa&T,Na);Na+=E;Fa+=
u;Oa+=l}while(0!==--U)}l=oa;Na=d;4294967295===ka?(l=t(l&w,da[ha>>>2]),da[ha>>>2]=ka&l):(u=da[ha>>>2],l=t(l&w,u&ka),u=ka&l|u&~ka,da[ha>>>2]=u);ha+=4;2===h?(ka=G,B=P):(ka=4294967295,B=na)}while(0!==--h);y+=F;n+=q;C+=A;x+=m;ha+=Wb}}var Ua=0,Ga=0,ab=0,Ya=0,ga=0,ma=0,pa=0,ub=0,ja=0,Eb=0,Ca=0,Da=0,nb=0,Ra=0,Va=null,Za=0,kb=null,qb=null,Ja=0,zc=0,Hb=0,da=0,Wb=0,R=0,vb=0,Gb=0,ha=0,db=0,ka=0,na=0,Pa=0,wb=0,$a=0,bb=0,Pb=Array(4096),ra=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Aa=[0,2,4,6,8,12,14,16],Ab=[0,0,
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],Na=0,S=0,ia=0,rb=null,mb=0,Fb=0,fa=0,Ia=0,aa=0,Db=0,K=null,Ea=0,q=null,Ta=0,G=0,Y=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],ba=0,z=0,Ob=0,ua=Array(43),uc=0,nc=null,zb=0,oc=0,Ba=0,vc=0,cb=0,Jb=0,ec=0,ob=0,fc=0,Zb=0,tb=0,hc=0,pc=0,Ac=0,wc=0,Fa=0,Oa=0,Yb=null,xc=null,kc=0,Fc=0,Gc=0,Hc=Array(32),Ic=0,yc=0,$b=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:function(){var a;
a=K.stackValue(K.methodArgumentCount());if(!ea(a))return K.primitiveFail();v();if(K.failed())return null;Nb();if(K.failed())return null;K.pop(K.methodArgumentCount());if(22===Ja||32===Ja)return K.pop(1),K.pushInteger(ub)},copyBits:v,moduleUnloaded:function(a){0===strcmp(a,"SurfacePlugin")&&(nc=q=xc=0)},primitiveDrawLoop:function(){var a,b,c;b=K.stackValue(2);c=K.stackIntegerValue(1);a=K.stackIntegerValue(0);if(!ea(b))return K.primitiveFail();if(!K.failed()){a:{var d,h,l,e,f,m,u;b=0<c?1:0===c?0:-1;
u=0<a?1:0===a?0:-1;a=Math.abs(a);e=Math.abs(c);l=d=9999;h=m=-9999;if(e>a)for(c=e>>1,f=1;f<=e;f++){if($a+=b,0>(c-=a)&&(bb+=u,c+=e),f<e){v();if(K.failed())break a;Ga<ab&&Ya<Ua&&(l=Math.min(l,Ga),h=Math.max(h,ab),d=Math.min(d,Ya),m=Math.max(m,Ua),4E3<(h-l)*(m-d)&&(Ga=l,ab=h,Ya=d,Ua=m,Nb(),l=d=9999,h=m=-9999))}}else for(c=a>>1,f=1;f<=a;f++)if(bb+=u,0>(c-=e)&&($a+=b,c+=a),f<a){v();if(K.failed())break a;Ga<ab&&Ya<Ua&&(l=Math.min(l,Ga),h=Math.max(h,ab),d=Math.min(d,Ya),m=Math.max(m,Ua),4E3<(h-l)*(m-d)&&
(Ga=l,ab=h,Ya=d,Ua=m,Nb(),l=d=9999,h=m=-9999))}Ga=l;ab=h;Ya=d;Ua=m;K.storeIntegerofObjectwithValue(4,pa,$a);K.storeIntegerofObjectwithValue(5,pa,bb)}Nb()}K.failed()||K.pop(2)},primitiveDisplayString:function(){var c,d,h,l,e,f,m,u,g,t,A;if(6!==K.methodArgumentCount())return K.primitiveFail();A=K.stackIntegerValue(0);e=K.stackObjectValue(1);g=K.stackObjectValue(2);if(n(e)!==K.classArray()||n(g)!==K.classArray()||256!==a(g))return K.primitiveFail();if(K.failed())return null;f=a(e)-2;h=K.stackIntegerValue(3);
c=K.stackIntegerValue(4);d=K.stackObjectValue(5);if(!(K.isBytes(d)&&0<c&&0<h&&h<=b(d)))return K.primitiveFail();l=K.stackObjectValue(6);if(!ea(l)||30===Ja||31===Ja)return K.primitiveFail();m=0!==da&&0!==Ba&&!1===Ob&&Jb!==vb&&(0!==Ra||fc!==db||cb!==R);t=$a;for(d=d.bytes;c<=h;c++){u=d[c-1];u=K.fetchIntegerofObject(u,g);if(0>u||u>f)return K.primitiveFail();pc=K.fetchIntegerofObject(u,e);$b=K.fetchIntegerofObject(u+1,e)-pc;if(K.failed())return null;D();0<ma&&0<ga&&(m?(W(),M(),Ga=S,ab=S+ma,Ya=ia,Ua=ia+
ga):v());if(K.failed())return null;$a=$a+$b+A}Ga=t;Nb();K.storeIntegerofObjectwithValue(4,l,$a);K.pop(6)},initialiseModule:function(){ua[1]=C;ua[2]=u;ua[3]=A;ua[4]=Ec;ua[5]=l;ua[6]=Q;ua[7]=H;ua[8]=E;ua[9]=t;ua[10]=J;ua[11]=x;ua[12]=I;ua[13]=L;ua[14]=F;ua[15]=w;ua[16]=Q;ua[17]=Q;ua[18]=Q;ua[19]=p;ua[20]=yb;ua[21]=Tb;ua[22]=qa;ua[23]=f;ua[24]=d;ua[25]=B;ua[26]=Sb;ua[27]=mc;ua[28]=ya;ua[29]=sb;ua[30]=fb;ua[31]=y;ua[32]=h;ua[33]=Ib;ua[34]=Xa;ua[35]=m;ua[36]=m;ua[37]=m;ua[38]=ca;ua[39]=jc;ua[40]=lc;ua[41]=
xa;ua[42]=tc;var a,b,c;for(b=0;255>=b;b++)for(a=0;15>=a;a++){var e,g;e=b&255;c=Aa[e&7];e=Ab[e>>>3];g=a<c?e+1:e;e=b>>>8&255;c=Aa[e&7];e=Ab[e>>>3];g=a<c?g|e+1<<5:g|e<<5;e=b>>>16&255;c=Aa[e&7];e=Ab[e>>>3];c=g=a<c?g|e+1<<10:g|e<<10;Pb[(a<<8)+b]=c}return!0},loadBitBltFrom:ea,setInterpreter:function(a){K=a;a=1==K.majorVersion();return!1===a?!1:a=11<=K.minorVersion()},primitiveWarpBits:function(){var a;a=K.stackValue(K.methodArgumentCount());if(!Ma(a,!0))return K.primitiveFail();a=Ob;Ob=!0;D();(Ob=a)||0>=
ma||0>=ga?Ga=ab=Ya=Ua=0:lb()?(W(),Cc(),0<mb?(Ga=S,ab=S+ma):(Ga=S-ma+1,ab=S+1),0<kc?(Ya=ia,Ua=ia+ga):(Ya=ia-ga+1,Ua=ia+1),sc()):K.primitiveFail();if(K.failed())return null;Nb();if(K.failed())return null;K.pop(K.methodArgumentCount())},getModuleName:function(){return"BitBltPlugin 3 November 2014 (e)"},primitivePixelValueAt:function(){var d,h,e,l,f,m;d=K.stackIntegerValue(1);m=K.stackIntegerValue(0);K.stackValue(2);if(K.failed())return null;if(0>d||0>m){d=0;if(K.failed())return null;K.popthenPush(3,
d);return null}h=K.stackValue(K.methodArgumentCount());if(!(K.isPointers(h)&&4<=a(h)))return K.primitiveFail(),null;e=K.fetchPointerofObject(0,h);if(!K.isWordsOrBytes(e))return K.primitiveFail(),null;$b=K.fetchIntegerofObject(1,h);Db=K.fetchIntegerofObject(2,h);h=K.fetchIntegerofObject(3,h);if(K.failed())return null;if(d>=$b||m>=Db){d=0;if(K.failed())return null;K.popthenPush(3,d);return null}if(0>h)return K.primitiveFail(),null;l=c(32,h);f=c($b+(l-1),l);if(b(e)!==f*Db*4)return K.primitiveFail(),
null;e=K.fetchLong32ofObject(m*f+c(d,l),e);m=g(4294967295,32-h);d=g(e,32-((d&l-1)+1)*h)&m;d=K.positive32BitIntegerFor(d);if(K.failed())return null;K.popthenPush(3,d);return null},copyBitsFromtoat:function(a,b,c){$a=a;bb=c;pc=a;$b=b-a;v();Nb()}})});module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){d.success(d.isWords(a));return d.failed()?0:a.wordsAsFloat32Array()}function b(b){var c;d.success(6<=n(b));if(d.failed())return!1;p=d.fetchIntegerofObject(0,b);g=d.fetchIntegerofObject(1,b);c=d.fetchPointerofObject(2,b);u=n(c);h=a(c);c=d.fetchPointerofObject(3,b);y=n(c);d.success(d.isWords(c));
B=c.words;c=d.fetchPointerofObject(4,b);m=n(c);r=a(c);c=d.fetchPointerofObject(5,b);f=n(c);k=a(c);d.success((31<p?0:1<<p)===g&&(g>>2)+1===u&&g===m&&g===f&&m===f);return!1===d.failed()}function c(){var a,b,c,h,e;h=0;for(c=y;h<c;){a=B[h]-1;b=B[h+1]-1;if(!(a<m&&b<m))return d.success(!1);e=r[a];r[a]=r[b];r[b]=e;e=k[a];k[a]=k[b];k[b]=e;h+=2}}function e(){var a,b;if(1>=g)return null;b=1/g;for(a=0;a<=g-1;a++)r[a]*=b,k[a]*=b}var g=0,k=null,f=0,d=null,p=0,B=null,y=0,r=null,m=0,h=null,u=0;Squeak.registerExternalModule("FFTPlugin",
{primitiveFFTTransformData:function(){var a,l;a=d.booleanValueOf(d.stackValue(0));l=d.stackObjectValue(1);if(!b(l))return null;c();if(d.failed())c();else{var f,m,n,w,y,B,E,I,H,C,D,v,N;f=g>>1;m=g>>2;for(D=1;D<=p;D++)for(H=31<D?0:1<<D,C=H>>1,l=Math.floor(g/H)|0,I=1;I<=C;I++)for(n=(I-1)*l,n<m?(N=h[u-n-1],B=h[n]):(N=0-h[n-m],B=h[f-n]),a||(B=0-B),n=I;n<=g;)E=n+C-1,w=n-1,v=r[E]*N-k[E]*B,y=r[E]*B+k[E]*N,r[E]=r[w]-v,k[E]=k[w]-y,r[w]+=v,k[w]+=y,n+=H;a||e()}d.failed()||d.pop(1)},setInterpreter:function(a){d=
a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveFFTPermuteData:function(){var a;a=d.stackObjectValue(0);if(!b(a))return null;c();d.failed()&&c()},primitiveFFTScaleData:function(){var a;a=d.stackObjectValue(0);if(!b(a))return null;e()},getModuleName:function(){return"FFTPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}var a=null;Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;
g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]*=b[c];a.pop(1)},primitiveEqual:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;a.pop(2);e=n(b);if(e!==n(g))return a.pushBool(!1);g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)if(g[c]!==b[c])return a.pushBool(!1);return a.pushBool(!0)},primitiveAtPut:function(){var b,c,e,g;g=a.stackValue(0);
b="number"===typeof g?g:a.floatValueOf(g);c=a.stackIntegerValue(1);e=a.stackObjectValue(2);if(a.failed())return null;a.success(a.isWords(e));a.success(0<c&&c<=n(e));if(a.failed())return null;e.wordsAsFloat32Array()[c-1]=b;a.failed()||a.popthenPush(3,g)},primitiveAt:function(){var b,c;b=a.stackIntegerValue(0);c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(0<b&&b<=n(c));if(a.failed())return null;b=c.wordsAsFloat32Array()[b-1];a.pop(2);a.pushFloat(b)},primitiveNormalize:function(){var b,
c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;e=n(b);a.success(!0);g=b.wordsAsFloat32Array();for(b=c=0;b<=e-1;b++)c+=g[b]*g[b];a.success(0<c);if(a.failed())return null;c=Math.sqrt(c);for(b=0;b<=e-1;b++)g[b]/=c},primitiveSubFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;
g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]-=b[c];a.pop(1)},primitiveDivFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)if(0===b[c])return a.primitiveFail();for(c=0;c<=e-1;c++)g[c]/=b[c];a.pop(1)},primitiveAddScalar:function(){var b,
c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]+=g;a.pop(1)},primitiveDotProduct:function(){var b,c,e,g,k;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=
k=0;c<=e-1;c++)k+=g[c]*b[c];a.pop(2);a.pushFloat(k)},primitiveSubScalar:function(){var b,c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]-=g;a.pop(1)},setInterpreter:function(b){a=b;b=1==a.majorVersion();return!1===b?!1:b=11<=a.minorVersion()},primitiveSum:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;
c=n(b);e=b.wordsAsFloat32Array();for(b=g=0;b<=c-1;b++)g+=e[b];a.popthenPush(1,a.floatObjectOf(g))},getModuleName:function(){return"FloatArrayPlugin 3 November 2014 (e)"},primitiveHashArray:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsInt32Array();for(b=g=0;b<=c-1;b++)g+=e[b];a.pop(1);return a.pushInteger(g&536870911)},primitiveMulScalar:function(){var b,c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);
if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]*=g;a.pop(1)},primitiveLength:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);a.success(!0);e=b.wordsAsFloat32Array();for(b=g=0;b<=c-1;b++)g+=e[b]*e[b];g=Math.sqrt(g);a.popthenPush(1,a.floatObjectOf(g))},primitiveAddFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);
if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]+=b[c];a.pop(1)},primitiveDivScalar:function(){var b,c,e,g;b=a.stackFloatValue(0);g=a.stackObjectValue(1);if(a.failed())return null;if(0===b)return a.primitiveFail();a.success(a.isWords(g));if(a.failed())return null;e=n(g);g=g.wordsAsFloat32Array();c=1/b;for(b=0;b<=e-1;b++)g[b]*=
c;a.pop(1)}})});module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function b(a,b){var c,d,e,n;c=a[0];e=a[1];d=b[0];n=b[1];c=d-c;e=n-e;return c*c+e*e}function c(a){console.log("GeniePlugin v2.0 14 November 2014 (e): "+a)}var e=null;Squeak.registerExternalModule("GeniePlugin",{primVersionNO:function(){if(e.failed())return null;
e.popthenPush(1,2E3);return null},setInterpreter:function(a){e=a;a=1==e.majorVersion();return!1===a?!1:a=11<=e.minorVersion()},primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:function(){var g,k,f,d,p,B,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I,H,C,D,v,N,P,M;f=e.stackValue(11);p=e.stackValue(10);D=e.stackValue(9);h=e.stackValue(8);x=e.stackValue(7);k=e.stackValue(6);
I=e.stackValue(5);C=e.stackValue(4);l=e.stackIntegerValue(3);r=e.stackValue(2);v=e.stackValue(1);d=e.stackValue(0);if(e.failed())return null;if(e.failed())return c("failed 1"),null;e.success(e.isWords(f)&&e.isWords(p)&&e.isWords(D)&&e.isWords(h)&&e.isWords(x)&&e.isWords(k)&&e.isWords(I)&&e.isWords(C)&&e.isWords(r)&&e.isWords(v)&&e.isWords(d));if(e.failed())return c("failed 2"),null;e.success(e.isMemberOf(f,"PointArray")&&e.isMemberOf(p,"PointArray"));if(e.failed())return c("failed 3"),null;A=f.wordsAsInt32Array();
w=p.wordsAsInt32Array();L=D.wordsAsInt32Array();m=h.wordsAsInt32Array();t=x.wordsAsInt32Array();u=k.wordsAsInt32Array();N=I.wordsAsInt32Array();g=C.wordsAsInt32Array();E=r.wordsAsInt32Array();P=v.wordsAsInt32Array();J=d.wordsAsInt32Array();p=n(p)>>>1;D=n(D)>>>1;h=n(h)>>>1;k=n(k);r=n(r);e.success(r===n(v)&&r===n(d)&&r>h);if(e.failed())return c("failed 4"),null;e.success(n(x)>=D-1&&n(f)>>>1>=D&&k>=h-1&&p>=h&&n(I)>=D-1&&n(C)>=h-1);if(e.failed())return c("failed 5"),null;f=l&1;l>>>=1;x=f?0:l*l>>>10;E[0]=
0;P[0]=0;J[0]=2;H=0-x;l=h;if(!(p>=l-1&&k>=l-1))return e.primitiveFail(),null;for(I=1;I<=l;I++)d=I-1,H=H+(u[d]+b(a(w,d<<1),A)>>>7)+x,P[I]=H,E[I]=H*I,J[I]=I+1;H=P[0]-x;for(C=1;C<=D;C++){p=C-1;k=p<<1;v=E[0];H=H+(t[p]+b(a(A,k),w)>>>7)+x;P[0]=H;E[0]=H*C;J[0]=C+1;l=h;for(I=1;I<=l;I++)d=I-1,B=d<<1,y=E[I],M=E[d],F=t[p]+b(a(A,k),a(w,I<<1))>>>7,0===(H=P[I])?y+=F:(y=y+H+F*J[I],F+=H),r=u[d]+b(a(w,B),a(A,C<<1))>>>7,0===(H=P[d])?M+=r:(M=M+H+r*J[d],r+=H),f?v=536870912:(H=b(a(m,B),a(L,k))+b(a(w,B),a(A,k)),B=Math.abs(N[p]-
g[d]),180<B&&(B=360-B),H=H*(16+(B*B>>>6))>>>11,v+=H),v<=y&&v<=M?(y=v,H=0,d=1):y<=M?(H=F+x,d=J[I]+1):(y=M,H=r+x,d=J[d]+1),v=E[I],E[I]=Math.min(y,536870912),P[I]=Math.min(H,536870912),J[I]=d;H=P[0]}g=y;if(e.failed())return null;e.popthenPush(13,g);return null},getModuleName:function(){return"GeniePlugin v2.0 14 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){if("number"===typeof b||!t.isPointers(b)||11>n(b))return!1;a[0]=t.fetchIntegerofObject(0,b);a[1]=t.fetchIntegerofObject(1,b);a[2]=t.fetchIntegerofObject(2,b);a[3]=t.fetchIntegerofObject(3,b);a[5]=t.fetchIntegerofObject(5,b);a[8]=t.fetchIntegerofObject(8,b);a[10]=t.fetchIntegerofObject(10,
b);return!t.failed()}function b(a,b){var c,d,h,e;if("number"===typeof b||!t.isPointers(b)||11>n(b))return!1;c=t.fetchPointerofObject(4,b);if("number"===typeof c||!t.isPointers(c))return!1;e=n(c);if(128<e)return!1;for(h=0;h<=e-1;h++){d=t.fetchPointerofObject(h,c);if("number"===typeof d||!t.isWords(d)||64!==n(d))return!1;a[h]=d.wordsAsInt32Array()}return!t.failed()}function c(a,b){var c,d,h;d=g(u,A);if(0>d)return t.primitiveFail();0!==d&&(c=e(d),d=f(c,d));d=b[10]+=d;a[0]=d;for(d=1;63>=d;d++)a[d]=0;
for(h=1;64>h;){d=g(p,B);if(0>d)return t.primitiveFail();c=d>>>4;d&=15;if(0!==d){h+=c;c=e(d);d=f(c,d);if(0>h||64<=h)return t.primitiveFail();a[w[h]]=d}else if(15===c)h+=c;else return null;++h}}function e(a){if(a>J){for(var b;16>=J&&I<H;){b=E[I];++I;if(255===b){if(!(I<H&&0===E[I])){--I;break}++I}L=L<<8|b;J+=8}if(a>J)return-1}J-=a;a=31<J?0:L>>>J;L&=(31<J?0:1<<J)-1;return a}function g(a,b){var c,d;c=a[0]>>>24;if(16<c)return-1;for(d=2;;){c=e(c);if(0>c)break;d=d+c-1;if(d>=b)break;c=a[d];if(0===(c&1056964608))return c;
d=c&65535;c=c>>>24&255;if(16<c)break}return-1}function k(){var a,b,c,d,h;b=a=v[0];c=v[1];d=v[2];h=v[3];0!==d&&0!==h&&(b=Math.floor(b/d)|0,c=Math.floor(c/h)|0);b=D[(c>>>3)*v[5]+(b>>>3)][((c&7)<<3)+(b&7)];++a;a<8*v[8]?v[0]=a:(v[0]=0,v[1]++);return b}function f(a,b){var c=b-1;return a<(31<c?0:1<<c)?a-(31<b?0:1<<b)+1:a}function d(c){return a(v,c)&&b(D,c)}var p=null,B=0,y=Array(128),r=Array(11),m=Array(128),h=Array(11),u=null,A=0,l=0,t=null,x=null,F=0,w=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,
33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],L=0,J=0,E=null,I=0,H=0,C=null,D=Array(128),v=Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:function(a){t=a;a=1==t.majorVersion();return!1===a?!1:a=11<=t.minorVersion()},primitiveIdctInt:function(){var a,b;if(2!==t.methodArgumentCount())return t.primitiveFail();a=t.stackObjectValue(0);if(t.failed())return null;if(!t.isWords(a)||64!==n(a))return t.primitiveFail();
b=a.wordsAsInt32Array();a=t.stackObjectValue(1);if(t.failed())return null;if(!t.isWords(a)||64!==n(a))return t.primitiveFail();a=a.wordsAsInt32Array();var c,d,h,e,l,f,m,u,g,A=Array(64),x,k,w,r,C;for(d=0;7>=d;d++){c=-1;for(h=1;7>=h;h++)-1===c&&0!==a[8*h+d]&&(c=h);if(-1===c)for(c=a[d]*b[0]<<2,h=0;7>=h;h++)A[8*h+d]=c;else k=a[16+d]*b[16+d],w=a[48+d]*b[48+d],x=4433*(k+w),u=x+-15137*w,g=x+6270*k,k=a[d]*b[d],w=a[32+d]*b[32+d],c=k+w<<13,h=k-w<<13,e=c+g,m=c-g,l=h+u,f=h-u,c=a[56+d]*b[56+d],h=a[40+d]*b[40+
d],u=a[24+d]*b[24+d],g=a[8+d]*b[8+d],x=c+g,k=h+u,w=c+u,r=h+g,C=9633*(w+r),c*=2446,h*=16819,u*=25172,g*=12299,x*=-7373,k*=-20995,w*=-16069,r*=-3196,w+=C,r+=C,c=c+x+w,h=h+k+r,u=u+k+w,g=g+x+r,A[d]=e+g>>11,A[56+d]=e-g>>11,A[8+d]=l+u>>11,A[48+d]=l-u>>11,A[16+d]=f+h>>11,A[40+d]=f-h>>11,A[24+d]=m+c>>11,A[32+d]=m-c>>11}for(d=0;56>=d;d+=8)k=A[d+2],w=A[d+6],x=4433*(k+w),u=x+-15137*w,g=x+6270*k,c=A[d]+A[d+4]<<13,h=A[d]-A[d+4]<<13,e=c+g,m=c-g,l=h+u,f=h-u,c=A[d+7],h=A[d+5],u=A[d+3],g=A[d+1],x=c+g,k=h+u,w=c+u,
r=h+g,C=9633*(w+r),c*=2446,h*=16819,u*=25172,g*=12299,x*=-7373,k*=-20995,w*=-16069,r*=-3196,w+=C,r+=C,c=c+x+w,h=h+k+r,u=u+k+w,g=g+x+r,b=(e+g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d]=b,b=(e-g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+7]=b,b=(l+u>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+1]=b,b=(l-u>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+6]=b,b=(f+h>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+2]=b,b=(f-h>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+5]=b,b=(m+c>>18)+127,
b=Math.min(b,255),b=Math.max(b,0),a[d+3]=b,b=(m-c>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[d+4]=b;t.pop(2)},primitiveColorConvertMCU:function(){var c;if(4!==t.methodArgumentCount())return t.primitiveFail();l=t.stackIntegerValue(0);c=t.stackObjectValue(1);if(t.failed())return null;if(!t.isWords(c)||3!==n(c))return t.primitiveFail();C=c.wordsAsInt32Array();c=t.stackObjectValue(2);if(t.failed())return null;if(!t.isWords(c))return t.primitiveFail();F=n(c);x=c.wordsAsInt32Array();c=t.stackObjectValue(3);
if(t.failed())return null;if(!t.isPointers(c)||3!==n(c)||!d(t.fetchPointerofObject(0,c)))return t.primitiveFail();var e=t.fetchPointerofObject(1,c);if(!a(r,e)||!b(y,e))return t.primitiveFail();c=t.fetchPointerofObject(2,c);if(!a(h,c)||!b(m,c))return t.primitiveFail();var f,u,g;v[0]=0;v[1]=0;r[0]=0;r[1]=0;h[0]=0;for(c=h[1]=0;c<=F-1;c++){var e=k(),A,w;g=f=r[0];u=r[1];A=r[2];w=r[3];0!==A&&0!==w&&(g=Math.floor(g/A)|0,u=Math.floor(u/w)|0);g=y[(u>>>3)*r[5]+(g>>>3)][((u&7)<<3)+(g&7)];++f;f<8*r[8]?r[0]=f:
(r[0]=0,r[1]++);f=g;f-=127;var p;u=g=h[0];A=h[1];w=h[2];p=h[3];0!==w&&0!==p&&(u=Math.floor(u/w)|0,A=Math.floor(A/p)|0);u=m[(A>>>3)*h[5]+(u>>>3)][((A&7)<<3)+(u&7)];++g;g<8*h[8]?h[0]=g:(h[0]=0,h[1]++);u-=127;g=e+(91881*u>>16)+C[0];g=Math.min(g,255);g=Math.max(g,0);C[0]=g&l;g&=255-l;g=Math.max(g,1);u=e-(22554*f>>16)-(46802*u>>16)+C[1];u=Math.min(u,255);u=Math.max(u,0);C[1]=u&l;u&=255-l;u=Math.max(u,1);e=e+(116130*f>>16)+C[2];e=Math.min(e,255);e=Math.max(e,0);C[2]=e&l;e&=255-l;e=Math.max(e,1);x[c]=4278190080+
(g<<16)+(u<<8)+e}t.pop(4)},primitiveColorConvertGrayscaleMCU:function(){var a;if(4!==t.methodArgumentCount())return t.primitiveFail();l=t.stackIntegerValue(0);a=t.stackObjectValue(1);if(t.failed())return null;if(!t.isWords(a)||3!==n(a))return t.primitiveFail();C=a.wordsAsInt32Array();a=t.stackObjectValue(2);if(t.failed())return null;if(!t.isWords(a))return t.primitiveFail();F=n(a);x=a.wordsAsInt32Array();a=t.stackObjectValue(3);if(t.failed())return null;if(!d(a))return t.primitiveFail();var b;v[0]=
0;for(a=v[1]=0;a<=F-1;a++)b=k(),b+=C[1],b=Math.min(b,255),C[1]=b&l,b&=255-l,b=Math.max(b,1),x[a]=4278190080+(b<<16)+(b<<8)+b;t.pop(4)},primitiveDecodeMCU:function(){var b;if(5!==t.methodArgumentCount())return t.primitiveFail();b=t.stackObjectValue(0);if(t.failed())return null;var d;5>n(b)||!t.isPointers(b)?b=!1:(d=t.fetchPointerofObject(0,b),"number"!==typeof d&&t.isBytes(d)?(d=(E=d.bytes)?d.bytes.length:d.words?4*d.words.length:0,I=t.fetchIntegerofObject(1,b),H=t.fetchIntegerofObject(2,b),L=t.fetchIntegerofObject(3,
b),J=t.fetchIntegerofObject(4,b),b=t.failed()||d<H||0>I||I>=H?!1:!0):b=!1);if(!b)return t.primitiveFail();b=t.stackObjectValue(1);if(t.failed())return null;if(!t.isWords(b))return t.primitiveFail();B=n(b);p=b.wordsAsInt32Array();b=t.stackObjectValue(2);if(t.failed())return null;if(!t.isWords(b))return t.primitiveFail();A=n(b);u=b.wordsAsInt32Array();b=t.stackObjectValue(3);if(t.failed())return null;if(!a(v,b))return t.primitiveFail();b=t.stackObjectValue(4);if(t.failed())return null;if(!t.isWords(b)||
64!==n(b))return t.primitiveFail();b=b.wordsAsInt32Array();if(t.failed())return null;c(b,v);if(t.failed())return null;b=t.stackValue(0);t.storeIntegerofObjectwithValue(1,b,I);t.storeIntegerofObjectwithValue(3,b,L);t.storeIntegerofObjectwithValue(4,b,J);t.storeIntegerofObjectwithValue(10,t.stackValue(3),v[10]);t.pop(5)},getModuleName:function(){return"JPEGReaderPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){var c;if(0===a)return 0<=b?90:270;c=Math.atan(b/a);return 0<=a?0<=b?c/.0174532925199433:360+c/.0174532925199433:180+c/.0174532925199433}function b(a){var b;a=90-a;b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function c(a){var b;b=y;d=p*(d-(Math.floor(d/b)|0)*b|0)-r*(Math.floor(d/
y)|0);b=(d&65535)*((0>a?0-a:a)+1)>>>16;return 0>a?0-b:b}function e(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function g(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=d}function k(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,c[a]=6.283185307179586-
c[a]));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),c[a]=6.283185307179586-c[a]));b[a]=d}var f=null,d=0,p=0,B=0,y=0,r=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:function(){var a,b,c,d,e,g,x;c=f.stackValue(0);x=f.stackIntegerValue(1);d=f.stackValue(2);b=f.stackValue(3);if(f.failed())return null;c=c.words[0];if(f.failed())return null;g=Math.log(c);c=n(b);e=n(d);if(c!==e)return f.primitiveFail(),null;b=b.words;e=d.words;for(d=0;d<=c-1;d++)a=b[d],a=0===a?0:255/g*Math.log(a)|
0,255<a&&(a=255),e[d]=a<<24&4278190080|x;f.pop(4)},vectorGetDistanceTo:function(){var a,b,c,d,e,g,x,k,w,r,p,y,B;w=f.stackValue(0);B=f.stackValue(1);p=f.stackValue(2);e=f.stackValue(3);a=f.stackValue(4);if(f.failed())return null;if(!f.isWords(w)||!f.isWords(p)||!f.isWords(B))return f.primitiveFail(),null;r=n(w);if(0>r||n(p)!==r||n(B)!==r)return f.primitiveFail(),null;if(a.isFloat)if(e.isFloat)b=!1;else return f.primitiveFail(),null;else{if(e.isFloat)return f.primitiveFail(),null;b=!0}if(b&&(n(a)!==
r||n(e)!==r))return f.primitiveFail(),null;k=w.wordsAsFloat32Array();p=p.wordsAsFloat32Array();B=B.wordsAsFloat32Array();b&&(c=a.wordsAsFloat32Array(),d=e.wordsAsFloat32Array());b||(g=f.floatValueOf(a),x=f.floatValueOf(e));for(a=0;a<=r-1;a++)b&&(g=c[a],x=d[a]),e=g-p[a],y=x-B[a],k[a]=Math.sqrt(e*e+y*y);if(f.failed())return null;f.pop(6);f.push(w)},getScalarHeading:function(){var a,b;a=f.stackValue(0);b=f.stackIntegerValue(1);if(f.failed())return null;if(!f.isWords(a)||n(a)<b)return f.primitiveFail(),
null;a=a.wordsAsFloat32Array()[b-1];a=e(a);if(f.failed())return null;f.pop(3);f.pushFloat(a)},shutdownModule:function(){return!0},primitiveAddScalar:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;c="number"===typeof a;d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),
null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a,d=g.words):(c=b.words,b=f.floatValueOf(a),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]+b;f.pop(4);f.push(g)},primSetPixelsAtXY:function(){var a,b,c,d,e,g,x,k,w,r,p,y;c=f.stackValue(0);b=f.stackIntegerValue(1);d=f.stackIntegerValue(2);a=f.stackValue(3);y=f.stackValue(4);r=f.stackValue(5);
if(f.failed())return null;if(!f.isWords(r)||!f.isWords(y)||!f.isWords(a)||b*d!==n(a))return f.primitiveFail(),null;x=n(r);if(n(y)!==x)return f.primitiveFail(),null;(g="number"===typeof c)&&(e=c);if(!(g||f.isMemberOf(c,"WordArray")&&n(c)===x))return f.primitiveFail(),null;r=r.wordsAsFloat32Array();y=y.wordsAsFloat32Array();g||(w=c.words);a=a.words;g&&(k=e);for(e=0;e<=x-1;e++)c=r[e]|0,p=y[e]|0,0<=c&&0<=p&&c<d&&p<b&&(c=p*d+c,g||(k=w[e]),a[c]=k);if(f.failed())return null;f.pop(6)},turtleScalarSetX:function(){var a,
b,c,d,e,t,x,k;d=f.stackIntegerValue(0);c=f.stackIntegerValue(1);a=f.stackFloatValue(2);t=f.stackFloatValue(3);b=f.stackValue(4);x=f.stackIntegerValue(5);k=f.stackValue(6);if(f.failed())return null;if(!f.isWords(k)||!f.isWords(b))return f.primitiveFail(),null;e=n(k);if(n(b)!==e)return f.primitiveFail(),null;e=k.wordsAsFloat32Array();b=b.wordsAsFloat32Array();g(x-1,e,b,t,a,c,d);if(f.failed())return null;f.pop(7)},primPixelAtXY:function(){var a,b,c,d,e;b=f.stackIntegerValue(0);c=f.stackIntegerValue(1);
e=f.stackFloatValue(2);d=f.stackFloatValue(3);a=f.stackValue(4);if(f.failed())return null;if(!f.isWords(a)||n(a)!==b*c)return f.primitiveFail(),null;d|=0;e|=0;a=a.words;b=0<=d&&d<c&&0<=e&&e<b?a[e*c+d]:0;if(f.failed())return null;f.pop(6);f.pushInteger(b)},primUpHill:function(){var b,c,d,g,l,t,x,k,w,r,p,y,B,H,C;g=f.stackIntegerValue(0);d=f.stackIntegerValue(1);B=f.stackIntegerValue(2);b=f.stackValue(3);w=f.stackFloatValue(4);c=f.stackFloatValue(5);r=f.stackFloatValue(6);if(f.failed())return null;if(!f.isWords(b)||
n(b)!==d*B)return f.primitiveFail(),null;b=b.words;r=Math.max(r,0);y=Math.max(c,0);r=Math.min(r,B-1);y=Math.min(y,d-1);k=Math.max(r-g,0);c=Math.min(r+g,B-1);x=Math.max(y-g,0);d=Math.min(y+g,d-1);g=b[y*B+r];l=-1;for(C=x;C<=d;C++)for(x=C*B,H=k;H<=c;H++)p=b[x+H],p>g&&(l=H,t=C,g=p);t=-1===l?e(w):a(l-r,t-y)+90|0;if(f.failed())return null;f.pop(8);f.pushFloat(t)},primScalarForward:function(){var a,b,c,d,e,t,x,r,w,p,y,B;a=f.stackIntegerValue(0);y=f.stackIntegerValue(1);w=f.stackIntegerValue(2);t=f.stackIntegerValue(3);
b=f.stackFloatValue(4);c=f.stackFloatValue(5);r=f.stackFloatValue(6);d=f.stackValue(7);B=f.stackValue(8);x=f.stackValue(9);e=f.stackIntegerValue(10);if(f.failed())return null;if(!f.isWords(x)||!f.isWords(B)||!f.isWords(d))return f.primitiveFail(),null;p=n(x);if(n(B)!==p||n(d)!==p)return f.primitiveFail(),null;p=x.wordsAsFloat32Array();B=B.wordsAsFloat32Array();d=d.wordsAsFloat32Array();--e;x=p[e]+r*Math.cos(d[e]);r=B[e]-r*Math.sin(d[e]);g(e,p,d,x,c,t,w);k(e,B,d,r,b,y,a);if(f.failed())return null;
f.pop(11)},primitiveDivArrays:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;c=f.isMemberOf(a,"WordArray");d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),
null;d?c?(c=b.words,b=a.words,d=g.words):(c=b.words,b=a.wordsAsFloat32Array(),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]/b[a];f.pop(4);f.push(g)},getModuleName:function(){return"KedamaPlugin 3 November 2014 (e)"},primitiveSubArrays:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));
f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;c=f.isMemberOf(a,"WordArray");d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a.words,d=g.words):(c=b.words,b=a.wordsAsFloat32Array(),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),
b=a.wordsAsFloat32Array()),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]-b[a];f.pop(4);f.push(g)},scalarGetAngleTo:function(){var b,c,d,e;c=f.stackFloatValue(0);b=f.stackFloatValue(1);e=f.stackFloatValue(2);d=f.stackFloatValue(3);if(f.failed())return null;b=a(d-b,e-c);b+=90;360<b&&(b-=360);if(f.failed())return null;f.pop(5);f.pushFloat(b)},randomRange:function(){var a;a=f.stackIntegerValue(0);if(f.failed())return null;a=c(a);if(f.failed())return null;f.pop(2);f.pushInteger(a)},setInterpreter:function(a){f=
a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},kedamaSetRandomSeed:function(){var a;a=f.stackIntegerValue(0);if(f.failed())return null;d=a&65536;f.pop(1)},drawTurtlesInArray:function(){var a,b,c,d,e,g,x,k,w,r,p,y;k=f.stackValue(0);b=f.stackValue(1);y=f.stackValue(2);r=f.stackValue(3);d=f.stackIntegerValue(4);e=f.stackIntegerValue(5);c=f.stackValue(6);if(f.failed())return null;if(!(f.isWords(c)&&f.isWords(r)&&f.isWords(y)&&f.isWords(b)&&f.isBytes(k))||d*e!==n(c))return f.primitiveFail(),
null;x=n(r);if(n(y)!==x||n(b)!==x||n(k)!==x)return f.primitiveFail(),null;r=r.wordsAsFloat32Array();y=y.wordsAsFloat32Array();b=b.words;k=k.bytes;c=c.words;for(g=0;g<=x-1;g++)w=r[g]|0,p=y[g]|0,a=k[g],0!==a&&0<=w&&0<=p&&w<e&&p<d&&(a=p*e+w,c[a]=b[g]);if(f.failed())return null;f.pop(7)},turtleScalarSetY:function(){var a,b,c,d,e,g,x,r;a=f.stackIntegerValue(0);e=f.stackIntegerValue(1);b=f.stackFloatValue(2);g=f.stackFloatValue(3);c=f.stackValue(4);x=f.stackIntegerValue(5);r=f.stackValue(6);if(f.failed())return null;
if(!f.isWords(r)||!f.isWords(c))return f.primitiveFail(),null;d=n(r);if(n(c)!==d)return f.primitiveFail(),null;d=r.wordsAsFloat32Array();c=c.wordsAsFloat32Array();k(x-1,d,c,g,b,e,a);if(f.failed())return null;f.pop(7)},randomIntoIntegerArray:function(){var a,b,d,e,l;a=f.stackFloatValue(0);d=f.stackValue(1);l=f.stackIntegerValue(2);b=f.stackIntegerValue(3);e=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(d)&&n(d)>=l&&1<=b&&l>=b))return f.primitiveFail(),null;d=d.words;if(f.failed())return null;
for(;b<=l;b++)d[b-1]=c(e)*a|0;f.pop(5)},getHeadingArrayInto:function(){var a,b,c,d,e;a=f.stackValue(0);b=f.stackValue(1);if(f.failed())return null;if(!f.isWords(b)||!f.isWords(a))return f.primitiveFail(),null;e=n(b);if(n(a)!==e)return f.primitiveFail(),null;b=b.wordsAsFloat32Array();d=a.wordsAsFloat32Array();for(c=0;c<=e-1;c++)a=b[c],a/=.0174532925199433,a=90-a,0<a||(a+=360),d[c]=a;if(f.failed())return null;f.pop(2)},makeTurtlesMap:function(){var a,b,c,d,e,g,x,k,w,r;a=f.stackIntegerValue(0);x=f.stackIntegerValue(1);
r=f.stackValue(2);k=f.stackValue(3);g=f.stackValue(4);b=f.stackValue(5);if(!(f.isWords(r)&&f.isWords(k)&&f.isWords(g)&&f.isWords(b)))return f.primitiveFail(),null;e=n(g);if(n(k)!==e||n(r)!==e||n(b)!==a*x)return f.primitiveFail(),null;k=k.wordsAsFloat32Array();r=r.wordsAsFloat32Array();g=g.words;c=b.words;for(b=0;b<=a*x-1;b++)c[b]=0;for(b=0;b<=e-1;b++)d=k[b],w=r[b],d=x*w+d,0<=d&&d<a*x&&(c[d]=g[b]);if(f.failed())return null;f.pop(6)},setHeadingArrayFrom:function(){var a,c,d,e,l,g;d=f.stackValue(0);
c=f.stackValue(1);if(f.failed())return null;if(!f.isWords(c))return f.primitiveFail(),null;g=n(c);if(d.isFloat)e=!1;else if(f.isWords(d)){if(n(d)!==g)return f.primitiveFail(),null;e=!0}else return f.primitiveFail(),null;c=c.wordsAsFloat32Array();e?l=d.wordsAsFloat32Array():(a=f.floatValueOf(d),a=b(a));for(d=0;d<=g-1;d++)e&&(a=l[d],a=b(a)),c[d]=a;if(f.failed())return null;f.pop(2)},turtlesSetX:function(){var a,b,c,d,e,t,x,k,w,r,p;x=f.stackIntegerValue(0);e=f.stackIntegerValue(1);a=f.stackFloatValue(2);
c=f.stackValue(3);b=f.stackValue(4);p=f.stackValue(5);if(f.failed())return null;if(!f.isWords(p)||!f.isWords(b))return f.primitiveFail(),null;if(c.isFloat)d=!1;else if(f.isWords(c))d=!0;else return f.primitiveFail(),null;k=n(p);if(n(b)!==k||d&&n(c)!==k)return f.primitiveFail(),null;p=p.wordsAsFloat32Array();b=b.wordsAsFloat32Array();d?r=c.wordsAsFloat32Array():w=f.floatValueOf(c);for(c=0;c<=k-1;c++)t=d?r[c]:w,g(c,p,b,t,a,e,x);if(f.failed())return null;f.pop(6)},setScalarHeading:function(){var a,c,
d;a=f.stackFloatValue(0);c=f.stackValue(1);d=f.stackIntegerValue(2);if(f.failed())return null;if(!f.isWords(c)||n(c)<d)return f.primitiveFail(),null;c.wordsAsFloat32Array()[d-1]=b(a);if(f.failed())return null;f.pop(3)},makeMask:function(){var a,b,c,d,e,g,x;x=f.stackIntegerValue(0);g=f.stackIntegerValue(1);d=f.stackValue(2);b=f.stackValue(3);if(f.failed())return null;c=n(b);e=n(d);if(c!==e||-32>x||8<x)return f.primitiveFail(),null;b=b.words;e=d.words;for(d=0;d<=c-1;d++)a=b[d],a=0>x?-31>x?0:a>>>0-x:
31<x?0:a<<x,255<a&&(a=255),0>a&&(a=0),e[d]=a<<24&4278190080|g;f.pop(4)},primitiveDivScalar:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;c="number"===typeof a;d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),
null;if(d)if(c)for(c=b.words,b=a,d=g.words,a=0;a<=e-1;a++)d[a]=Math.floor(c[a]/b)|0;else for(c=b.words,b=f.floatValueOf(a),d=g.wordsAsFloat32Array(),a=0;a<=e-1;a++)d[a]=c[a]/b;else for(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),d=g.wordsAsFloat32Array(),a=0;a<=e-1;a++)d[a]=c[a]/b;f.pop(4);f.push(g)},primitiveSubScalar:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));
f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;c="number"===typeof a;d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a,d=g.words):(c=b.words,b=f.floatValueOf(a),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),d=g.wordsAsFloat32Array());for(a=
0;a<=e-1;a++)d[a]=c[a]-b;f.pop(4);f.push(g)},primPixelsAtXY:function(){var a,b,c,d,e,g,x,k,w,r;e=f.stackValue(0);b=f.stackIntegerValue(1);d=f.stackIntegerValue(2);a=f.stackValue(3);r=f.stackValue(4);k=f.stackValue(5);if(f.failed())return null;if(!(f.isWords(e)&&f.isWords(k)&&f.isWords(r)&&f.isWords(a))||b*d!==n(a))return f.primitiveFail(),null;x=n(k);if(n(r)!==x||n(e)!==x)return f.primitiveFail(),null;k=k.wordsAsFloat32Array();r=r.wordsAsFloat32Array();e=e.words;a=a.words;for(g=0;g<=x-1;g++)c=k[g]|
0,w=r[g]|0,0<=c&&0<=w&&c<d&&w<b&&(c=w*d+c,e[g]=a[c]);if(f.failed())return null;f.pop(6)},vectorGetAngleTo:function(){var b,c,d,e,l,g,x,k,w,r,p,y,B;w=f.stackValue(0);B=f.stackValue(1);p=f.stackValue(2);l=f.stackValue(3);b=f.stackValue(4);if(f.failed())return null;if(!f.isWords(w)||!f.isWords(p)||!f.isWords(B))return f.primitiveFail(),null;r=n(w);if(0>r||n(p)!==r||n(B)!==r)return f.primitiveFail(),null;if(b.isFloat)if(l.isFloat)c=!1;else return f.primitiveFail(),null;else{if(l.isFloat)return f.primitiveFail(),
null;c=!0}if(c&&(n(b)!==r||n(l)!==r))return f.primitiveFail(),null;k=w.wordsAsFloat32Array();p=p.wordsAsFloat32Array();B=B.wordsAsFloat32Array();c&&(d=b.wordsAsFloat32Array(),e=l.wordsAsFloat32Array());c||(g=f.floatValueOf(b),x=f.floatValueOf(l));for(b=0;b<=r-1;b++)c&&(g=d[b],x=e[b]),l=g-p[b],y=x-B[b],l=a(l,y),l+=90,360<l&&(l-=360),k[b]=l;if(f.failed())return null;f.pop(6);f.push(w)},primitiveMulArrays:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);
if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;c=f.isMemberOf(a,"WordArray");d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a.words,d=g.words):(c=b.words,b=a.wordsAsFloat32Array(),d=g.wordsAsFloat32Array()):
(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]*b[a];f.pop(4);f.push(g)},primPixelAtXYPut:function(){var a,b,c,d,e,g;b=f.stackIntegerValue(0);d=f.stackIntegerValue(1);c=f.stackIntegerValue(2);g=f.stackFloatValue(3);e=f.stackFloatValue(4);a=f.stackValue(5);if(f.failed())return null;if(!f.isWords(a)||n(a)!==b*d)return f.primitiveFail(),null;e|=0;g|=0;1073741823<c&&(c=1073741823);0>c&&(c=0);a=a.words;
0<=e&&e<d&&0<=g&&g<b&&(a[g*d+e]=c);if(f.failed())return null;f.pop(6)},zoomBitmap:function(){var a,b,c,d,e,g,x,k,w,r,p,y,B,H;H=f.stackIntegerValue(0);y=f.stackIntegerValue(1);g=f.stackIntegerValue(2);x=f.stackIntegerValue(3);a=f.stackValue(4);b=f.stackValue(5);if(f.failed())return null;c=n(b);d=n(a);if(x*g!==c||c*y*H!==d)return f.primitiveFail(),null;d=b.words;b=a.words;for(p=c=w=k=0;p<=g-1;p++){for(B=0;B<=H-1;B++){for(r=0;r<=x-1;r++)for(a=d[k],++k,e=0;e<=y-1;e++)b[c]=a,++c;k=w}k=w+=x}f.pop(6)},initialiseModule:function(){d=
17;p=16807;B=2147483647;y=Math.floor(B/p)|0;var a=p;r=B-(Math.floor(B/a)|0)*a|0},primitiveAddArrays:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;c=f.isMemberOf(a,"WordArray");d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),
null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a.words,d=g.words):(c=b.words,b=a.wordsAsFloat32Array(),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]+b[a];f.pop(4);f.push(g)},scalarGetDistanceTo:function(){var a,b,c,d;b=f.stackFloatValue(0);a=f.stackFloatValue(1);d=f.stackFloatValue(2);c=f.stackFloatValue(3);if(f.failed())return null;
a-=c;b-=d;b=Math.sqrt(a*a+b*b);if(f.failed())return null;f.pop(5);f.pushFloat(b)},turtlesSetY:function(){var a,b,c,d,e,g,x,r,w,p,y;a=f.stackIntegerValue(0);r=f.stackIntegerValue(1);b=f.stackFloatValue(2);d=f.stackValue(3);c=f.stackValue(4);y=f.stackValue(5);if(f.failed())return null;if(!f.isWords(y)||!f.isWords(c))return f.primitiveFail(),null;if(d.isFloat)e=!1;else if(f.isWords(d))e=!0;else return f.primitiveFail(),null;x=n(y);if(n(c)!==x||e&&n(d)!==x)return f.primitiveFail(),null;y=y.wordsAsFloat32Array();
c=c.wordsAsFloat32Array();e?p=d.wordsAsFloat32Array():w=f.floatValueOf(d);for(d=0;d<=x-1;d++)g=e?p[d]:w,k(d,y,c,g,b,r,a);if(f.failed())return null;f.pop(6)},randomIntoFloatArray:function(){var a,b,d,e,l;a=f.stackFloatValue(0);b=f.stackValue(1);l=f.stackIntegerValue(2);d=f.stackIntegerValue(3);e=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(b)&&n(b)>=l&&1<=d&&l>=d))return f.primitiveFail(),null;b=b.wordsAsFloat32Array();if(f.failed())return null;for(;d<=l;d++)b[d-1]=c(e)*a;f.pop(5)},
primTurtlesForward:function(){var a,b,c,d,e,t,x,r,w,p,y,B,I,H,C,D;a=f.stackIntegerValue(0);B=f.stackIntegerValue(1);p=f.stackIntegerValue(2);r=f.stackIntegerValue(3);b=f.stackFloatValue(4);c=f.stackFloatValue(5);t=f.stackValue(6);e=f.stackValue(7);D=f.stackValue(8);C=f.stackValue(9);if(f.failed())return null;if(!f.isWords(C)||!f.isWords(D)||!f.isWords(e))return f.primitiveFail(),null;if(t.isFloat)x=!1;else if(f.isWords(t))x=!0;else return f.primitiveFail(),null;y=n(C);if(n(D)!==y||n(e)!==y||x&&n(t)!==
y)return f.primitiveFail(),null;C=C.wordsAsFloat32Array();D=D.wordsAsFloat32Array();e=e.wordsAsFloat32Array();x?H=t.wordsAsFloat32Array():I=f.floatValueOf(t);for(t=0;t<=y-1;t++)d=x?H[t]:I,w=C[t]+d*Math.cos(e[t]),d=D[t]-d*Math.sin(e[t]),g(t,C,e,w,c,r,p),k(t,D,e,d,b,B,a);if(f.failed())return null;f.pop(10)},primitiveMulScalar:function(){var a,b,c,d,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;
e=n(b);f.success(e===n(g));if(f.failed())return null;c="number"===typeof a;d=f.isMemberOf(b,"WordArray");if(c&&d){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;d?c?(c=b.words,b=a,d=g.words):(c=b.words,b=f.floatValueOf(a),d=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),d=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)d[a]=c[a]*b;f.pop(4);f.push(g)}})});module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return a-(Math.floor(a/b)|0)*b|0}function b(a,b){var c;if(0===a)return 0<=b?90:270;c=Math.atan(b/a);return 0<=a?0<=b?c/.0174532925199433:360+c/.0174532925199433:180+c/.0174532925199433}function c(a){var b;a=90-a;b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function e(b){var c,
d,e;e=0>b?0-b:b;c=Math.floor(p/r)|0;d=a(p,r);p=B*d-m*c;c=(p&65535)*(e+1)>>>16;return 0>b?0-c:c}function g(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function k(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=d}function f(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=
0),3===f&&(d=0-d,c[a]=6.283185307179586-c[a]));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),c[a]=6.283185307179586-c[a]));b[a]=d}var d=null,p=0,B=0,y=0,r=0,m=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===
n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]+b[a];d.pop(4);
d.push(g)},getModuleName:function(){return"KedamaPlugin2 13 November 2014 (e)"},primitiveMulArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),
null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]*b[a];d.pop(4);d.push(g)},drawTurtlesInArray:function(){var a,b,c,e,f,g,m,k,r,p,y,B;k=d.stackValue(0);b=d.stackValue(1);B=d.stackValue(2);p=d.stackValue(3);e=d.stackIntegerValue(4);
f=d.stackIntegerValue(5);c=d.stackValue(6);if(d.failed())return null;if(!(d.isWords(c)&&d.isWords(p)&&d.isWords(B)&&d.isWords(b)&&d.isBytes(k))||e*f!==n(c))return d.primitiveFail(),null;m=n(p);if(n(B)!==m||n(b)!==m||n(k)!==m)return d.primitiveFail(),null;p=p.wordsAsFloat32Array();B=B.wordsAsFloat32Array();b=b.words;k=k.bytes;c=c.words;for(g=0;g<=m-1;g++)r=p[g]|0,y=B[g]|0,a=k[g],0!==a&&0<=r&&0<=y&&r<f&&y<e&&(a=y*f+r,c[a]=b[g]);if(d.failed())return null;d.pop(7)},primitiveGTScalar:function(){var a,
b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>b;d.pop(4);d.push(g)},setScalarHeading:function(){var a,
b,e;a=d.stackFloatValue(0);b=d.stackValue(1);e=d.stackIntegerValue(2);if(d.failed())return null;if(!d.isWords(b)||n(b)<e)return d.primitiveFail(),null;b.wordsAsFloat32Array()[e-1]=c(a);if(d.failed())return null;d.pop(3)},primitiveSubScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;
e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]-b;d.pop(4);d.push(g)},turtleScalarSetY:function(){var a,b,c,e,g,m,k,w;a=d.stackIntegerValue(0);g=d.stackIntegerValue(1);
b=d.stackFloatValue(2);m=d.stackFloatValue(3);c=d.stackValue(4);k=d.stackIntegerValue(5);w=d.stackValue(6);if(d.failed())return null;if(!d.isWords(w)||!d.isWords(c))return d.primitiveFail(),null;e=n(w);if(n(c)!==e)return d.primitiveFail(),null;e=w.wordsAsFloat32Array();c=c.wordsAsFloat32Array();f(k-1,e,c,m,b,g,a);if(d.failed())return null;d.pop(7)},vectorGetAngleTo:function(){var a,c,e,f,g,m,k,w,r,p,y,B,H;r=d.stackValue(0);H=d.stackValue(1);y=d.stackValue(2);g=d.stackValue(3);a=d.stackValue(4);if(d.failed())return null;
if(!d.isWords(r)||!d.isWords(y)||!d.isWords(H))return d.primitiveFail(),null;p=n(r);if(0>p||n(y)!==p||n(H)!==p)return d.primitiveFail(),null;if(a.isFloat)if(g.isFloat)c=!1;else return d.primitiveFail(),null;else{if(g.isFloat)return d.primitiveFail(),null;c=!0}if(c&&(n(a)!==p||n(g)!==p))return d.primitiveFail(),null;w=r.wordsAsFloat32Array();y=y.wordsAsFloat32Array();H=H.wordsAsFloat32Array();c&&(e=a.wordsAsFloat32Array(),f=g.wordsAsFloat32Array());c||(m=d.floatValueOf(a),k=d.floatValueOf(g));for(a=
0;a<=p-1;a++)c&&(m=e[a],k=f[a]),g=m-y[a],B=k-H[a],g=b(g,B),g+=90,360<g&&(g-=360),w[a]=g;if(d.failed())return null;d.pop(6);d.push(r)},primitiveRemArrays:function(){var b,c,e,f,g,m,k,w,r;r=d.stackObjectValue(0);b=d.stackObjectValue(1);k=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(k));d.success(d.isWords(r));if(d.failed())return null;w=n(b);d.success(w===n(k));d.success(w===n(r));if(d.failed())return null;m=d.isMemberOf(b,"WordArray");f=d.isMemberOf(k,
"WordArray");if(m&&f){if(!d.isMemberOf(r,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(r,"KedamaFloatArray"))return d.primitiveFail(),null;if(f)if(m)for(m=k.words,c=b.words,f=r.words,b=0;b<=w-1;b++)e=m[b],g=c[b],k=a(e,g),f[b]=k;else for(m=k.words,g=b.wordsAsFloat32Array(),k=r.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],c=g[b],f=e/c,f=Math.floor(f),k[b]=e-f*c;else if(m)for(m=k.wordsAsFloat32Array(),c=b.words,k=r.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],g=c[b],f=e/g,f=Math.floor(f),
k[b]=e-f*g;else for(m=k.wordsAsFloat32Array(),g=b.wordsAsFloat32Array(),k=r.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],c=g[b],f=e/c,f=Math.floor(f),k[b]=e-f*c;d.pop(4);d.push(r)},primitiveLTArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,
"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<b[e];d.pop(4);d.push(g)},primitiveAddScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;
c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]+b;d.pop(4);d.push(g)},primPixelsAtXY:function(){var a,b,c,e,f,g,m,k,r,p;f=d.stackValue(0);
b=d.stackIntegerValue(1);e=d.stackIntegerValue(2);a=d.stackValue(3);p=d.stackValue(4);k=d.stackValue(5);if(d.failed())return null;if(!(d.isWords(f)&&d.isWords(k)&&d.isWords(p)&&d.isWords(a))||b*e!==n(a))return d.primitiveFail(),null;m=n(k);if(n(p)!==m||n(f)!==m)return d.primitiveFail(),null;k=k.wordsAsFloat32Array();p=p.wordsAsFloat32Array();f=f.words;a=a.words;for(g=0;g<=m-1;g++)c=k[g]|0,r=p[g]|0,0<=c&&0<=r&&c<e&&r<b&&(c=r*e+c,f[g]=a[c]);if(d.failed())return null;d.pop(6)},primitiveMulScalar:function(){var a,
b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):
(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]*b;d.pop(4);d.push(g)},primSetPixelsAtXY:function(){var a,b,c,e,f,g,m,k,r,p,y,B,H,C,D;m=d.stackValue(0);b=d.stackIntegerValue(1);e=d.stackIntegerValue(2);a=d.stackValue(3);k=d.stackValue(4);C=d.stackValue(5);p=d.stackValue(6);if(d.failed())return null;if(!(d.isBytes(p)&&d.isWords(C)&&d.isWords(k)&&d.isWords(a))||b*e!==n(a))return d.primitiveFail(),null;y=n(C);if(n(p)!==
y||n(k)!==y)return d.primitiveFail(),null;p=p.bytes;C=C.wordsAsFloat32Array();D=k.wordsAsFloat32Array();if(k="number"===typeof m)B=m;else{if(n(m)!==y)return d.primitiveFail(),null;(r=d.isMemberOf(m,"WordArray"))?H=m.words:f=m.wordsAsFloat32Array()}a=a.words;for(m=0;m<=y-1;m++)1===p[m]&&(c=C[m]|0,g=D[m]|0,0<=c&&0<=g&&c<e&&g<b&&(c=g*e+c,k?a[c]=B:r?a[c]=H[m]:(g=f[m],a[c]=g)));if(d.failed())return null;d.pop(7)},setHeadingArrayFrom:function(){var a,b,e,f,g,m,k;e=d.stackValue(0);b=d.stackValue(1);g=d.stackValue(2);
if(d.failed())return null;if(!d.isBytes(g)||!d.isWords(b))return d.primitiveFail(),null;k=n(b);if(e.isFloat)f=!1;else if(d.isWords(e)){if(n(e)!==k)return d.primitiveFail(),null;f=!0}else return d.primitiveFail(),null;g=g.bytes;b=b.wordsAsFloat32Array();f?m=e.wordsAsFloat32Array():(a=d.floatValueOf(e),a=c(a));for(e=0;e<=k-1;e++)1===g[e]&&(f&&(a=m[e],a=c(a)),b[e]=a);if(d.failed())return null;d.pop(3)},primPixelAtXYPut:function(){var a,b,c,e,f,g;b=d.stackIntegerValue(0);e=d.stackIntegerValue(1);c=d.stackIntegerValue(2);
g=d.stackFloatValue(3);f=d.stackFloatValue(4);a=d.stackValue(5);if(d.failed())return null;if(!d.isWords(a)||n(a)!==b*e)return d.primitiveFail(),null;f|=0;g|=0;1073741823<c&&(c=1073741823);0>c&&(c=0);a=a.words;0<=f&&f<e&&0<=g&&g<b&&(a[g*e+f]=c);if(d.failed())return null;d.pop(6)},makeMaskLog:function(){var a,b,c,e,f,g,m;c=d.stackValue(0);m=d.stackIntegerValue(1);e=d.stackValue(2);b=d.stackValue(3);if(d.failed())return null;c=c.words[0];if(d.failed())return null;g=Math.log(c);c=n(b);f=n(e);if(c!==f)return d.primitiveFail(),
null;b=b.words;f=e.words;for(e=0;e<=c-1;e++)a=b[e],a=0===a?0:255/g*Math.log(a)|0,255<a&&(a=255),f[e]=a<<24&4278190080|m;d.pop(4)},primitiveLTScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<b;d.pop(4);d.push(g)},scalarGetAngleTo:function(){var a,c,e,f;c=d.stackFloatValue(0);a=d.stackFloatValue(1);f=d.stackFloatValue(2);e=d.stackFloatValue(3);if(d.failed())return null;a=b(e-a,f-c);a+=90;360<a&&(a-=360);if(d.failed())return null;d.pop(5);d.pushFloat(a)},primitiveOrByteArray:function(){var a,b,c,e,f;f=d.stackObjectValue(0);a=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(a));d.success(d.isBytes(f));
if(d.failed())return null;c=n(a);e=n(f);if(d.failed())return null;b=c;c>e&&(b=e);c=f.bytes;e=a.bytes;for(a=0;a<=b-1;a++)e[a]=0<e[a]+c[a];d.pop(1)},primitiveLEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,
"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<=b[e];d.pop(4);d.push(g)},primitiveRemScalar:function(){var b,c,e,f,g,m,k,w;w=d.stackObjectValue(0);b=d.stackValue(1);g=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(g));d.success(d.isWords(w));if(d.failed())return null;k=n(g);d.success(k===n(w));if(d.failed())return null;
f="number"===typeof b;m=d.isMemberOf(g,"WordArray");if(f&&m){if(!d.isMemberOf(w,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(w,"KedamaFloatArray"))return d.primitiveFail(),null;if(m)if(f)for(g=g.words,c=b,f=w.words,b=0;b<=k-1;b++)f[b]=a(g[b],c);else for(g=g.words,c=d.floatValueOf(b),m=w.wordsAsFloat32Array(),b=0;b<=k-1;b++)e=g[b],f=e/c,f=Math.floor(f),m[b]=e-f*c;else for(f?(g=g.wordsAsFloat32Array(),c=b):(g=g.wordsAsFloat32Array(),c=d.floatValueOf(b)),m=w.wordsAsFloat32Array(),
b=0;b<=k-1;b++)e=g[b],f=e/c,f=Math.floor(f),m[b]=e-f*c;d.pop(4);d.push(w)},getHeadingArrayInto:function(){var a,b,c,e,f;a=d.stackValue(0);b=d.stackValue(1);if(d.failed())return null;if(!d.isWords(b)||!d.isWords(a))return d.primitiveFail(),null;f=n(b);if(n(a)!==f)return d.primitiveFail(),null;b=b.wordsAsFloat32Array();e=a.wordsAsFloat32Array();for(c=0;c<=f-1;c++)a=b[c],a/=.0174532925199433,a=90-a,0<a||(a+=360),e[c]=a;if(d.failed())return null;d.pop(2)},turtlesSetX:function(){var a,b,c,e,f,g,m,w,r,
p,y,B,H,C;r=d.stackIntegerValue(0);g=d.stackIntegerValue(1);a=d.stackFloatValue(2);c=d.stackValue(3);b=d.stackValue(4);C=d.stackValue(5);w=d.stackValue(6);if(d.failed())return null;if(!d.isBytes(w)||!d.isWords(C)||!d.isWords(b))return d.primitiveFail(),null;if(c.isFloat)e=!1;else if(d.isWords(c))e=!0,f=d.isMemberOf(c,"WordArray");else return d.primitiveFail(),null;p=n(C);if(n(w)!==p||n(b)!==p||e&&n(c)!==p)return d.primitiveFail(),null;w=w.bytes;C=C.wordsAsFloat32Array();b=b.wordsAsFloat32Array();
e?f?H=c.words:B=c.wordsAsFloat32Array():y=d.floatValueOf(c);for(c=0;c<=p-1;c++)1===w[c]&&(m=e?f?H[c]:B[c]:y,k(c,C,b,m,a,g,r));if(d.failed())return null;d.pop(7)},primitivePredicateReplaceBytes:function(){var a,b,c,e,f,g,m,k,r;e=d.stackIntegerValue(0);a=d.stackObjectValue(1);m=d.stackIntegerValue(2);g=d.stackIntegerValue(3);b=d.stackObjectValue(4);if(d.failed())return null;r=d.fetchPointerofObject(1,b);c=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(c)||!d.isBytes(r)||!d.isBytes(a))return d.primitiveFail(),
null;k=r.bytes;b=c.bytes;f=a.bytes;r=n(r);c=n(c);a=n(a);if(g>m||1>g||g>r||g>c||m>r||m>c||1>e||e>a||a-e+1<m-g+1)return d.primitiveFail(),null;for(a=g-1;a<=m-1;a++)1===b[a]&&(k[a]=f[e+a-g]);d.pop(4)},primitiveDivArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;
c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]/b[a];d.pop(4);d.push(g)},makeMask:function(){var a,
b,c,e,f,g,m;m=d.stackIntegerValue(0);g=d.stackIntegerValue(1);e=d.stackValue(2);b=d.stackValue(3);if(d.failed())return null;c=n(b);f=n(e);if(c!==f||-32>m||8<m)return d.primitiveFail(),null;b=b.words;f=e.words;for(e=0;e<=c-1;e++)a=b[e],a=0>m?-31>m?0:a>>>0-m:31<m?0:a<<m,255<a&&(a=255),0>a&&(a=0),f[e]=a<<24&4278190080|g;d.pop(4)},primitiveLEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));
if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<=b;d.pop(4);d.push(g)},kedamaSetRandomSeed:function(){var a;a=d.stackIntegerValue(0);if(d.failed())return null;p=a&65536;d.pop(1)},randomIntoIntegerArray:function(){var a,b,c,f,g;a=d.stackFloatValue(0);
c=d.stackValue(1);g=d.stackIntegerValue(2);b=d.stackIntegerValue(3);f=d.stackIntegerValue(4);if(d.failed())return null;if(!(d.isWords(c)&&n(c)>=g&&1<=b&&g>=b))return d.primitiveFail(),null;c=c.words;if(d.failed())return null;for(;b<=g;b++)c[b-1]=e(f)*a|0;d.pop(5)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitivePredicateAtAllPutColor:function(){var a,b,c,e,f;e=d.stackIntegerValue(0);c=d.stackObjectValue(1);if(d.failed())return null;e|=4278190080;
f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isWords(f))return d.primitiveFail(),null;c=f.words;b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},makeTurtlesMap:function(){var a,b,c,e,f,g,m,k,r,p;a=d.stackIntegerValue(0);m=d.stackIntegerValue(1);p=d.stackValue(2);k=d.stackValue(3);g=d.stackValue(4);b=d.stackValue(5);if(!(d.isWords(p)&&d.isWords(k)&&d.isWords(g)&&d.isWords(b)))return d.primitiveFail(),null;f=n(g);if(n(k)!==f||
n(p)!==f||n(b)!==a*m)return d.primitiveFail(),null;k=k.wordsAsFloat32Array();p=p.wordsAsFloat32Array();g=g.words;c=b.words;for(b=0;b<=a*m-1;b++)c[b]=0;for(b=0;b<=f-1;b++)e=k[b],r=p[b],e=m*r+e,0<=e&&e<a*m&&(c[e]=g[b]);if(d.failed())return null;d.pop(6)},randomIntoFloatArray:function(){var a,b,c,f,g;a=d.stackFloatValue(0);b=d.stackValue(1);g=d.stackIntegerValue(2);c=d.stackIntegerValue(3);f=d.stackIntegerValue(4);if(d.failed())return null;if(!(d.isWords(b)&&n(b)>=g&&1<=c&&g>=c))return d.primitiveFail(),
null;b=b.wordsAsFloat32Array();if(d.failed())return null;for(;c<=g;c++)b[c-1]=e(f)*a;d.pop(5)},primUpHill:function(){var a,c,e,f,m,k,r,w,p,y,B,I,H,C,D;f=d.stackIntegerValue(0);e=d.stackIntegerValue(1);H=d.stackIntegerValue(2);a=d.stackValue(3);p=d.stackFloatValue(4);c=d.stackFloatValue(5);y=d.stackFloatValue(6);if(d.failed())return null;if(!d.isWords(a)||n(a)!==e*H)return d.primitiveFail(),null;a=a.words;y=Math.max(y,0);I=Math.max(c,0);y=Math.min(y,H-1);I=Math.min(I,e-1);w=Math.max(y-f,0);c=Math.min(y+
f,H-1);r=Math.max(I-f,0);e=Math.min(I+f,e-1);f=a[I*H+y];m=-1;for(D=r;D<=e;D++)for(r=D*H,C=w;C<=c;C++)B=a[r+C],B>f&&(m=C,k=D,f=B);k=-1===m?g(p):b(m-y,k-I)+90|0;if(d.failed())return null;d.pop(8);d.pushFloat(k)},shutdownModule:function(){return!0},primitiveDivScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;
c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;if(e)if(c)for(c=b.words,b=a,e=g.words,a=0;a<=f-1;a++)e[a]=Math.floor(c[a]/b)|0;else for(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array(),a=0;a<=f-1;a++)e[a]=c[a]/b;else for(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array(),a=0;a<=f-1;a++)e[a]=
c[a]/b;d.pop(4);d.push(g)},primitiveGEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):
(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>=b[e];d.pop(4);d.push(g)},primitiveNotByteArray:function(){var a,b,c;a=d.stackValue(0);if(d.failed())return null;d.success(d.isBytes(a));if(d.failed())return null;b=n(a);if(d.failed())return null;c=a.bytes;for(a=0;a<=b-1;a++)c[a]=0===c[a]?1:0},randomRange:function(){var a;a=d.stackIntegerValue(0);if(d.failed())return null;a=e(a);if(d.failed())return null;d.pop(2);d.pushInteger(a)},initialiseModule:function(){p=
17;B=16807;y=2147483647;r=Math.floor(y/B)|0;m=a(y,B)},getScalarHeading:function(){var a,b;a=d.stackValue(0);b=d.stackIntegerValue(1);if(d.failed())return null;if(!d.isWords(a)||n(a)<b)return d.primitiveFail(),null;a=a.wordsAsFloat32Array()[b-1];a=g(a);if(d.failed())return null;d.pop(3);d.pushFloat(a)},primPixelAtXY:function(){var a,b,c,e,f;b=d.stackIntegerValue(0);c=d.stackIntegerValue(1);f=d.stackFloatValue(2);e=d.stackFloatValue(3);a=d.stackValue(4);if(d.failed())return null;if(!d.isWords(a)||n(a)!==
b*c)return d.primitiveFail(),null;e|=0;f|=0;a=a.words;b=0<=e&&e<c&&0<=f&&f<b?a[f*c+e]:0;if(d.failed())return null;d.pop(6);d.pushInteger(b)},primitivePredicateAtAllPutNumber:function(){var a,b,c,e,f;e=d.stackFloatValue(0);c=d.stackObjectValue(1);if(d.failed())return null;f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isWords(f))return d.primitiveFail(),null;c=f.wordsAsFloat32Array();b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},
primitiveEQArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),
b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]===b[e];d.pop(4);d.push(g)},primitiveNEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=
a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]!==b[e];d.pop(4);d.push(g)},primScalarForward:function(){var a,b,c,e,g,m,r,w,p,y,B,I;a=d.stackIntegerValue(0);B=d.stackIntegerValue(1);p=d.stackIntegerValue(2);m=d.stackIntegerValue(3);b=d.stackFloatValue(4);c=d.stackFloatValue(5);w=d.stackFloatValue(6);e=d.stackValue(7);I=d.stackValue(8);r=d.stackValue(9);g=d.stackIntegerValue(10);if(d.failed())return null;
if(!d.isWords(r)||!d.isWords(I)||!d.isWords(e))return d.primitiveFail(),null;y=n(r);if(n(I)!==y||n(e)!==y)return d.primitiveFail(),null;y=r.wordsAsFloat32Array();I=I.wordsAsFloat32Array();e=e.wordsAsFloat32Array();--g;r=y[g]+w*Math.cos(e[g]);w=I[g]-w*Math.sin(e[g]);k(g,y,e,r,c,m,p);f(g,I,e,w,b,B,a);if(d.failed())return null;d.pop(11)},vectorGetDistanceTo:function(){var a,b,c,e,f,g,m,k,r,p,y,B,H;r=d.stackValue(0);H=d.stackValue(1);y=d.stackValue(2);f=d.stackValue(3);a=d.stackValue(4);if(d.failed())return null;
if(!d.isWords(r)||!d.isWords(y)||!d.isWords(H))return d.primitiveFail(),null;p=n(r);if(0>p||n(y)!==p||n(H)!==p)return d.primitiveFail(),null;if(a.isFloat)if(f.isFloat)b=!1;else return d.primitiveFail(),null;else{if(f.isFloat)return d.primitiveFail(),null;b=!0}if(b&&(n(a)!==p||n(f)!==p))return d.primitiveFail(),null;k=r.wordsAsFloat32Array();y=y.wordsAsFloat32Array();H=H.wordsAsFloat32Array();b&&(c=a.wordsAsFloat32Array(),e=f.wordsAsFloat32Array());b||(g=d.floatValueOf(a),m=d.floatValueOf(f));for(a=
0;a<=p-1;a++)b&&(g=c[a],m=e[a]),f=g-y[a],B=m-H[a],k[a]=Math.sqrt(f*f+B*B);if(d.failed())return null;d.pop(6);d.push(r)},turtlesSetY:function(){var a,b,c,e,g,m,k,r,p,y,B,I,H,C;a=d.stackIntegerValue(0);y=d.stackIntegerValue(1);b=d.stackFloatValue(2);e=d.stackValue(3);c=d.stackValue(4);C=d.stackValue(5);r=d.stackValue(6);if(d.failed())return null;if(!d.isBytes(r)||!d.isWords(C)||!d.isWords(c))return d.primitiveFail(),null;if(e.isFloat)g=!1;else if(d.isWords(e))g=!0,m=d.isMemberOf(e,"WordArray");else return d.primitiveFail(),
null;p=n(C);if(n(r)!==p||n(c)!==p||g&&n(e)!==p)return d.primitiveFail(),null;r=r.bytes;C=C.wordsAsFloat32Array();c=c.wordsAsFloat32Array();g?m?H=e.words:I=e.wordsAsFloat32Array():B=d.floatValueOf(e);for(e=0;e<=p-1;e++)1===r[e]&&(k=g?m?H[e]:I[e]:B,f(e,C,c,k,b,y,a));if(d.failed())return null;d.pop(7)},turtleScalarSetX:function(){var a,b,c,e,f,g,m,r;e=d.stackIntegerValue(0);c=d.stackIntegerValue(1);a=d.stackFloatValue(2);g=d.stackFloatValue(3);b=d.stackValue(4);m=d.stackIntegerValue(5);r=d.stackValue(6);
if(d.failed())return null;if(!d.isWords(r)||!d.isWords(b))return d.primitiveFail(),null;f=n(r);if(n(b)!==f)return d.primitiveFail(),null;f=r.wordsAsFloat32Array();b=b.wordsAsFloat32Array();k(m-1,f,b,g,a,c,e);if(d.failed())return null;d.pop(7)},primTurtlesForward:function(){var a,b,c,e,g,m,r,w,p,y,B,I,H,C,D,v,N;a=d.stackIntegerValue(0);H=d.stackIntegerValue(1);B=d.stackIntegerValue(2);w=d.stackIntegerValue(3);b=d.stackFloatValue(4);c=d.stackFloatValue(5);m=d.stackValue(6);g=d.stackValue(7);N=d.stackValue(8);
v=d.stackValue(9);y=d.stackValue(10);if(d.failed())return null;if(!(d.isBytes(y)&&d.isWords(v)&&d.isWords(N)&&d.isWords(g)))return d.primitiveFail(),null;if(m.isFloat)r=!1;else if(d.isWords(m))r=!0;else return d.primitiveFail(),null;I=n(v);if(n(N)!==I||n(g)!==I||n(y)!==I||r&&n(m)!==I)return d.primitiveFail(),null;y=y.bytes;v=v.wordsAsFloat32Array();N=N.wordsAsFloat32Array();g=g.wordsAsFloat32Array();r?D=m.wordsAsFloat32Array():C=d.floatValueOf(m);for(m=0;m<=I-1;m++)1===y[m]&&(e=r?D[m]:C,p=v[m]+e*
Math.cos(g[m]),e=N[m]-e*Math.sin(g[m]),k(m,v,g,p,c,w,B),f(m,N,g,e,b,H,a));if(d.failed())return null;d.pop(11)},primitiveGEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>=b;d.pop(4);d.push(g)},primitiveAndByteArray:function(){var a,b,c,e,f;f=d.stackObjectValue(0);a=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(a));d.success(d.isBytes(f));if(d.failed())return null;c=n(a);e=n(f);if(d.failed())return null;b=c;c>e&&(b=e);c=f.bytes;e=a.bytes;for(a=0;a<=b-1;a++)e[a]=2===e[a]+c[a];d.pop(1)},primitivePredicateReplaceWords:function(){var a,b,c,e,f,g,m,k,r,p,y,B;k=d.stackIntegerValue(0);
m=d.stackObjectValue(1);y=d.stackIntegerValue(2);p=d.stackIntegerValue(3);f=d.stackObjectValue(4);if(d.failed())return null;B=d.fetchPointerofObject(1,f);g=d.fetchPointerofObject(0,f);if(d.failed())return null;if(!d.isBytes(g)||!(d.isWords(B)&&d.isWords(m)||d.isPointers(B)&&d.isPointers(m)))return d.primitiveFail(),null;f=g.bytes;e=n(B);g=n(g);r=n(m);if(p>y||1>p||p>e||p>g||y>e||y>g||1>k||k>r||r-k+1<y-p+1)return d.primitiveFail(),null;r=d.isMemberOf(B,"KedamaFloatArray");g=d.isMemberOf(m,"KedamaFloatArray");
if(r&&g)for(b=B.wordsAsFloat32Array(),a=m.wordsAsFloat32Array(),e=p-1;e<=y-1;e++)1===f[e]&&(b[e]=a[k+e-p]);if(r&&!g)for(b=B.wordsAsFloat32Array(),a=m.words,e=p-1;e<=y-1;e++)1===f[e]&&(b[e]=a[k+e-p]);if(!r&&g)for(b=B.words,a=m.wordsAsFloat32Array(),e=p-1;e<=y-1;e++)1===f[e]&&(c=a[k+e-p]>>>0,b[e]=c);if(!r&&!g)for(b=B.words,a=m.words,e=p-1;e<=y-1;e++)1===f[e]&&(b[e]=a[k+e-p]);d.pop(4)},primitiveGTArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);
if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>b[e];d.pop(4);d.push(g)},primitivePredicateAtAllPutObject:function(){var a,
b,c,e,f;e=d.stackValue(0);c=d.stackObjectValue(1);if(d.failed())return null;f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isPointers(f))return d.primitiveFail(),null;c=f.wordsAsInt32Array();b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},primitiveEQScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;
f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]===b;d.pop(4);d.push(g)},primitivePredicateAtAllPutBoolean:function(){var a,b,c,e,f;e=d.stackValue(0);c=d.stackObjectValue(1);if(d.failed())return null;e=d.isIntegerValue(e)?e:d.booleanValueOf(e);f=d.fetchPointerofObject(1,c);a=
d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isBytes(f))return d.primitiveFail(),null;c=f.bytes;b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},zoomBitmap:function(){var a,b,c,e,f,g,m,k,r,p,y,B,H,C;C=d.stackIntegerValue(0);B=d.stackIntegerValue(1);g=d.stackIntegerValue(2);m=d.stackIntegerValue(3);a=d.stackValue(4);b=d.stackValue(5);if(d.failed())return null;c=n(b);e=n(a);if(m*g!==c||c*B*C!==e)return d.primitiveFail(),null;e=b.words;b=a.words;for(y=c=r=k=
0;y<=g-1;y++){for(H=0;H<=C-1;H++){for(p=0;p<=m-1;p++)for(a=e[k],++k,f=0;f<=B-1;f++)b[c]=a,++c;k=r}k=r+=m}d.pop(6)},primitiveNEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]!==b;d.pop(4);d.push(g)},scalarGetDistanceTo:function(){var a,b,c,e;b=d.stackFloatValue(0);a=d.stackFloatValue(1);e=d.stackFloatValue(2);c=d.stackFloatValue(3);if(d.failed())return null;a-=c;b-=e;b=Math.sqrt(a*a+b*b);if(d.failed())return null;d.pop(5);d.pushFloat(b)},primitiveSubArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;
d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),
b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]-b[a];d.pop(4);d.push(g)}})});module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b,c){var d,e;d=-3.141592653589793/C*c;e=Math.exp(d);c=0-e*e;d=6.283185307179586/C*b;d=e*Math.cos(d)*2;b=1/(1-d-c);E[5*a-5]=b;E[5*a-4]=(0-d)*b;E[5*a-3]=(0-c)*b}function b(a,b){var c,d;c=E[5*a-5]*b+E[5*a-4]*(d=E[5*a-2])+E[5*a-3]*E[5*a-1];E[5*a-1]=d;E[5*a-2]=b;return c}function c(a){l.success(l.isWords(a));
return l.failed()?0:a.wordsAsFloat32Array()}function e(a){return 32.767*Math.pow(2,(a-87)/6)}function g(){return D=1309*D+13849&65535}function k(a,b,c,d,e){return Math.exp(a*b)*((e*(a*a+1)+a)*d-c)+1}function f(a,b,c){var d,e;d=-3.141592653589793/C*c;e=Math.exp(d);c=0-e*e;d=6.283185307179586/C*b;b=e*Math.cos(d)*2;E[5*a-5]=1-b-c;E[5*a-4]=b;E[5*a-3]=c}function d(a,b,c,d){f(a,b,c);E[5*a-5]*=d}function p(a,b){var c,d;c=E[5*a-5]*b+E[5*a-4]*(d=E[5*a-2])+E[5*a-3]*E[5*a-1];E[5*a-1]=d;return E[5*a-2]=c}var B=
0,y=0,r=0,m=0,h=0,u=null,A=0,l=null,t=0,x=0,F=0,w=0,L=0,J=0,E=null,I=0,H=0,C=0,D=0,v=0,N=0,P=0,M=0;Squeak.registerExternalModule("Klatt",{setInterpreter:function(a){l=a;a=1==l.majorVersion();return!1===a?!1:a=11<=l.minorVersion()},primitiveSynthesizeFrameIntoStartingAt:function(){var O,X,W,Q,oa;O=c(l.stackValue(2));X=W=l.stackValue(1);l.success(l.isWords(X));X=l.failed()?0:X.wordsAsInt16Array();oa=l.stackIntegerValue(0);if(l.failed())return null;Q=l.stackObjectValue(3);var U;l.success(22===n(Q));
l.failed()?U=!1:(U=l.fetchPointerofObject(0,Q),E=c(U),J=l.fetchFloatofObject(2,Q),v=l.fetchIntegerofObject(3,Q),w=l.fetchIntegerofObject(4,Q),F=l.fetchIntegerofObject(5,Q),x=l.fetchIntegerofObject(6,Q),B=l.fetchFloatofObject(7,Q),y=l.fetchFloatofObject(8,Q),P=l.fetchFloatofObject(9,Q),M=l.fetchFloatofObject(10,Q),r=l.fetchFloatofObject(11,Q),m=l.fetchFloatofObject(12,Q),A=l.fetchFloatofObject(13,Q),N=l.fetchFloatofObject(14,Q),t=l.fetchFloatofObject(15,Q),L=l.fetchIntegerofObject(16,Q),I=l.fetchIntegerofObject(17,
Q),D=l.fetchIntegerofObject(18,Q),h=l.fetchIntegerofObject(19,Q),H=l.fetchIntegerofObject(20,Q),C=l.fetchIntegerofObject(21,Q),U=!1===l.failed());if(!U)return null;l.success(2*n(W)>=H);if(l.failed())return null;var Z,T,xa,la,wa,La,ea,Ma,Wa;u=O;T=.6*e(u[45]);La=.6*e(u[50]);O=.4*e(u[46]);U=.15*e(u[47]);Ma=.06*e(u[48]);Z=.04*e(u[49]);W=.15*e(u[34]);ea=.06*e(u[35]);Wa=.04*e(u[36]);wa=.022*e(u[37]);xa=.03*e(u[38]);8<=h&&(16E3<=C?f(19,7500,600):h=6);7<=h&&(16E3<=C?f(18,6500,500):h=6);6<=h&&f(17,u[24],u[25]);
5<=h&&f(16,u[22],u[23]);f(15,u[20],u[21]);f(14,u[18],u[19]);f(13,u[16],u[17]);f(12,u[12],u[13]);f(20,u[26],u[27]);f(22,u[30],u[31]);a(21,u[28],u[29]);a(23,u[32],u[33]);d(1,u[26],u[27],T);d(2,u[30],u[31],La);d(3,u[12],u[13],O);d(4,u[16],u[17],U);d(5,u[18],u[19],Ma);d(6,u[20],u[21],Z);d(7,u[16],u[40],W);d(8,u[18],u[41],ea);d(9,u[20],u[42],Wa);d(10,u[22],u[43],wa);d(11,u[24],u[44],xa);0<J?(Wa=e(u[5]-7),ea=e(u[5]),Ma=.1*e(u[11])):Wa=ea=Ma=0;U=.25*e(u[10]);O=.05*e(u[9]);W=.05*e(u[39]);Z=u[51]-3;0>=Z&&
(Z=57);Z=e(Z);d(24,0,C,Z);wa=oa;for(oa=H+oa-1;wa<=oa;){T=(g()-32768)/4;t=T+=.75*t;w>x&&(T*=.5);xa=U*T;if(0===v)La=0;else{w<F?(La=B*P+y*M,M=P):La=r*P-m;P=La;if(w>=v)if(w=0,0<u[0]){J=u[0];la=I/C;J+=2*u[1]*u[0]/100*(Math.sin(79.79645340118074*la)+Math.sin(44.61061568097506*la)+Math.sin(29.530970943744055*la));J+=(g()-32767)*u[2]/32768*u[0];J=0===(L-2*(Math.floor(L/2)|0)|0)?J+u[4]*u[0]*(1-u[6]):J-u[4]*u[0]*(1-u[6]);0>J&&(J=0);x=v=C/J|0;0<u[5]&&(x>>=1);F=v*u[6]|0;var sa=u[7],ta,Sa,V,lb;la=v*u[6]|0;lb=
la/v;0>=sa?ta=1:(Sa=(1-lb)/sa,ta=1-Sa/(Math.exp(Sa)-1));V=Sa=3.141592653589793*(u[8]+1);var gb=Math.cos(Sa),jb=Math.sin(Sa);lb=sa/lb*Sa*ta;var za,va,eb;if(0<k(0,V,gb,jb,lb))for(ta=0,va=1,za=k(va,V,gb,jb,lb);0<za;)ta=va,va*=2,za=k(va,V,gb,jb,lb);else for(ta=-1,va=0,za=k(ta,V,gb,jb,lb);0>za;)va=ta,ta*=2,za=k(ta,V,gb,jb,lb);for(;1E-4<va-ta;)eb=(va+ta)/2,za=k(eb,V,gb,jb,lb),0<za?ta=eb:va=eb;V=(va+ta)/2;Sa/=la;V=Math.exp(V*Sa);B=2*Math.cos(Sa)*V;y=0-V*V;M=0;P=V*Math.sin(Sa);sa=Math.exp(-1/(sa*v));la=Math.pow(sa,
v-la);r=sa;m=(1-sa)*la/(1-la);sa=0;Sa=P;V=M;for(la=1;la<=F;la++)sa=B*Sa+y*V,V=Sa,Sa=sa;0!==sa&&(P=P/sa*1E4);P+=(g()-32767)*u[3]/32768*P;0<P&&(P=0);0!==(L-2*(Math.floor(L/2)|0)|0)&&(P*=1-u[4],0<P&&(P=0));la=L+1;L=la-65535*(Math.floor(la/65535)|0)|0}else x=v=1;++w}N=La;w<F&&(La+=Ma*(g()-32768)/4);la=Wa*La;La*=ea;T*=O;la+=T;La+=T;0<h?(T=b(21,la),T=p(20,T),T=b(23,T),T=p(22,T),8<=h&&(T=p(19,T)),7<=h&&(T=p(18,T)),6<=h&&(T=p(17,T)),5<=h&&(T=p(16,T)),4<=h&&(T=p(15,T)),3<=h&&(T=p(14,T)),2<=h&&(T=p(13,T)),
1<=h&&(T=p(12,T)),la=T):la=0;T=La;T=p(3,T)+p(4,T)+p(5,T)+p(6,T)+p(1,T)+p(2,T);la+=T;T=xa+La-A;A=La;xa=T;la=p(7,xa)-p(8,xa)+p(9,xa)-p(10,xa)+p(11,xa)-la;la=W*T-la;la=p(24,la);xa=la*Z|0;-32768>xa&&(xa=-32768);32767<xa&&(xa=32767);X[wa-1]=xa;++wa;++I}l.pushRemappableOop(Q);l.pushRemappableOop(l.floatObjectOf(J));l.pushRemappableOop(l.floatObjectOf(B));l.pushRemappableOop(l.floatObjectOf(y));l.pushRemappableOop(l.floatObjectOf(P));l.pushRemappableOop(l.floatObjectOf(M));l.pushRemappableOop(l.floatObjectOf(r));
l.pushRemappableOop(l.floatObjectOf(m));l.pushRemappableOop(l.floatObjectOf(A));l.pushRemappableOop(l.floatObjectOf(N));Ma=l.floatObjectOf(t);Z=l.popRemappableOop();U=l.popRemappableOop();W=l.popRemappableOop();O=l.popRemappableOop();oa=l.popRemappableOop();wa=l.popRemappableOop();Q=l.popRemappableOop();X=l.popRemappableOop();Wa=l.popRemappableOop();ea=l.popRemappableOop();l.failed()?X=!1:(l.storePointerofObjectwithValue(2,ea,Wa),l.storeIntegerofObjectwithValue(3,ea,v),l.storeIntegerofObjectwithValue(4,
ea,w),l.storeIntegerofObjectwithValue(5,ea,F),l.storeIntegerofObjectwithValue(6,ea,x),l.storePointerofObjectwithValue(7,ea,X),l.storePointerofObjectwithValue(8,ea,Q),l.storePointerofObjectwithValue(9,ea,wa),l.storePointerofObjectwithValue(10,ea,oa),l.storePointerofObjectwithValue(11,ea,O),l.storePointerofObjectwithValue(12,ea,W),l.storePointerofObjectwithValue(13,ea,U),l.storePointerofObjectwithValue(14,ea,Z),l.storePointerofObjectwithValue(15,ea,Ma),l.storeIntegerofObjectwithValue(16,ea,L),l.storeIntegerofObjectwithValue(17,
ea,I),l.storeIntegerofObjectwithValue(18,ea,D),X=!1===l.failed());if(!X)return null;l.pop(3)},getModuleName:function(){return"Klatt 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?v.classSmallInteger():a.sqClass}function a(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function b(a,b){return a-(Math.floor(a/b)|0)*b|0}function c(a,b){return 31<b?0:a>>>b}function e(d,e,f){var g,m,h;if(1>e||1>f)return v.primitiveFail();h=Math.min(f,p(d.bytes,a(d)));if(e>h)return!1;m=(e-1>>3)+1;f=(h-1>>3)+1;g=b(e-1,8);e=7-b(h-1,8);if(m===f)return f=
(31<g?0:255<<g)&c(255,e),d=J(d,m),0!==(d&f);if(0!==c(J(d,m),g))return!0;for(m+=1;m<=f-1;m++)if(0!==J(d,m))return!0;d=J(d,f);return 0!==((31<e?0:d<<e)&255)?!0:!1}function g(b,c){var e,f;f=v.instantiateClassindexableSize(n(b),c);e=a(b);d(b.bytes,f.bytes,e<c?e:c);return f}function k(a,b){var c;if("number"===typeof a){c=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();c=v.instantiateClassindexableSize(c,b);var d,e,f;d=c.bytes;e=1;for(f=B(a);e<=f;e++)d[e-1]=y(a,e)}else c=g(a,b);return c}
function f(a,b,c){var d,e;for(e=c-1;0<=e;){if((d=b[e])!==(c=a[e]))return d<c?1:-1;--e}return 0}function d(a,b,c){var d;--c;for(d=0;d<=c;d++)b[d]=a[d];return 0}function p(a,b){var c,d;for(d=b;0===(c=a[d-1]);)if(0===--d)return 0;return m(c)+8*(d-1)}function B(a){return 256>a&&-256<a?1:65536>a&&-65536<a?2:16777216>a&&-16777216<a?3:4}function y(a,b){1>b&&v.primitiveFail();return 4<b?0:0>a?c(0-a,8*(b-1))&255:c(a,8*(b-1))&255}function r(a,b,c,d,e){c=c-b+1;for(var f=0;f<c;f++)a[f+b]=d[f+e];return 0}function m(a){var b;
b=0;65536>a||(a>>>=16,b+=16);256>a||(a>>>=8,b+=8);16>a||(a>>>=4,b+=4);4>a||(a>>>=2,b+=2);2>a||(a>>>=1,++b);return b+a}function h(a){var b,c,d,e;c=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();b=B(a);c=v.instantiateClassindexableSize(c,b);d=c.bytes;for(e=1;e<=b;e++)d[e-1]=y(a,e);return c}function u(d,e){var f,g,m;g=a(d);if(0===(f=p(d.bytes,g)))return 0;f=f+e+7>>3;m=v.instantiateClassindexableSize(n(d),f);var h=d.bytes,l=m.bytes,k,w,u,y,t,x;k=e>>3;y=b(e,8);x=k-1;for(u=0;u<=x;u++)l[u]=
0;if(0===y)r(l,k,f-1,h,0);else{t=8-y;w=0;x=g-1;for(u=0;u<=x;u++)g=h[u],l[u+k]=(w|(31<y?0:g<<y))&255,w=c(g,t);0!==w&&(l[f-1]=w)}return m}function A(a,d,e){var f,g;e=p(a.bytes,e);f=e+7>>3;e-=d;if(0>=e)return v.instantiateClassindexableSize(n(a),0);g=e+7>>3;e=v.instantiateClassindexableSize(n(a),g);a=a.bytes;var m=e.bytes,h,l,k,w,u;h=d>>3;k=b(d,8);if(0===k)r(m,0,g-1,a,h);else{w=8-k;d=c(a[h],k);h+=1;u=f-1;for(f=h;f<=u;f++)l=a[f],m[f-h]=(d|(31<w?0:l<<w))&255,d=c(l,k);0!==d&&(m[g-1]=d)}return e}function l(b,
c){var e,f,g,m,h,l;e=a(b);h=a(c);m=n(b);e<=h?(g=b,f=e,l=c):(g=c,f=h,l=b,h=e);e=v.instantiateClassindexableSize(m,h);g=g.bytes;l=l.bytes;var k=e.bytes,r,w,p;p=0;w=f-1;for(r=0;r<=w;r++)p=(p>>>8)+g[r]+l[r],k[r]=p&255;w=h-1;for(r=f;r<=w;r++)p=(p>>>8)+l[r],k[r]=p&255;g=p>>>8;0<g&&(m=v.instantiateClassindexableSize(m,h+1),d(e.bytes,m.bytes,h),e=m,e.bytes[h]=g);return e}function t(b,c,d){var e,f,g,m;if("number"===typeof b){if(0>b)return v.primitiveFail();b=h(b)}else if(n(b)===v.classLargeNegativeInteger())return v.primitiveFail();
if("number"===typeof c){if(0>c)return v.primitiveFail();f=h(c)}else{if(n(c)===v.classLargeNegativeInteger())return v.primitiveFail();f=c}g=a(b);m=a(f);g<m?(e=g,c=b,g=m):(e=m,c=f,f=b);b=v.instantiateClassindexableSize(v.classLargePositiveInteger(),g);c=c.bytes;f=f.bytes;m=b.bytes;var l;l=e-1;if(0===d){for(d=0;d<=l;d++)m[d]=c[d]&f[d];l=g-1;for(d=e;d<=l;d++)m[d]=0}else if(1===d){for(d=0;d<=l;d++)m[d]=c[d]|f[d];l=g-1;for(d=e;d<=l;d++)m[d]=f[d]}else if(2===d){for(d=0;d<=l;d++)m[d]=c[d]^f[d];l=g-1;for(d=
e;d<=l;d++)m[d]=f[d]}else v.primitiveFail();return v.failed()?0:D(b)}function x(b,c){var d,e;e=a(b);d=a(c);return d!==e?d>e?-1:1:f(b.bytes,c.bytes,e)}function F(c,d,e){var f,g,h;g=a(c);f=a(d);e=e?v.classLargeNegativeInteger():v.classLargePositiveInteger();h=g-f+1;if(0>=h)return f=v.instantiateClassindexableSize(v.classArray(),2),v.stObjectatput(f,1,0),v.stObjectatput(f,2,c),f;f=8-m(d.bytes[f-1]);d=u(d,f);d=k(d,w(d)+1);c=u(c,f);w(c)===g&&(c=k(c,g+1));g=v.instantiateClassindexableSize(e,h);e=d.bytes;
h=w(d);var l=c.bytes,r=w(c),p=g.bytes,n=w(g),y,t,x,C,B,D,F,E,H,J,L;J=h-1;L=e[J-1];x=1===J?0:e[J-2];for(E=1;E<=n;E++){H=r+1-E;if(l[H-1]===L)t=255;else for(t=l[H-1],t=(t<<8)+l[H-2],F=b(t,L),t=Math.floor(t/L)|0,C=t*x,B=C>>>8,C&=255,D=3>H?0:l[H-3];;){F<B||F===B&&D<C?(--t,C<x?(--B,C=C+256-x):C-=x,y=B>=L):y=!1;if(!y)break;B-=L}F=H-J;y=0;for(D=1;D<=h;D++)B=e[D-1]*(t>>>8),C=e[D-1]*(t&255),y=l[F-1]-y-(C&255),l[F-1]=y&255,y>>=8,y=B+(C>>>8)-y,++F;if(0<y)for(--t,F=H-J,y=0,D=1;D<=h;D++)y=(y>>>8)+l[F-1]+e[D-1],
l[F-1]=y&255,++F;p[n-E]=t}c=A(c,f,w(d)-1);f=v.instantiateClassindexableSize(v.classArray(),2);v.stObjectatput(f,1,g);v.stObjectatput(f,2,c);return f}function w(b){return"number"===typeof b?B(b):a(b)}function L(b,c,d){var e,f,g,m;g=a(b);m=a(c);g<=m?(f=b,e=g,b=c,g=m):(f=c,e=m);d=d?v.classLargeNegativeInteger():v.classLargePositiveInteger();d=v.instantiateClassindexableSize(d,g+e);f=f.bytes;b=b.bytes;m=d.bytes;var h,l,k,r,w;if(1!==e||0!==f[0])if(1!==g||0!==b[0])for(--e,r=g-1,k=0;k<=e;k++)if(0!==(h=f[k])){w=
k;for(c=l=0;c<=r;c++)g=b[c],g=g*h+l+m[w],l=g>>>8,m[w]=g&255,++w;m[w]=l}return H(d)}function J(b,c){return c>a(b)?0:b.bytes[c-1]}function E(b,c){var d,e,f,g,m,h;h=n(b)===v.classLargeNegativeInteger();f=a(b);d=a(c);if(f===d){for(;1<f&&J(b,f)===J(c,f);)--f;d=f}f<d||f===d&&J(b,f)<J(c,f)?(e=c,m=d,g=b,d=f,h=!1===h):(e=b,m=f,g=c);f=m;f=v.instantiateClassindexableSize(h?v.classLargeNegativeInteger():v.classLargePositiveInteger(),f);g=g.bytes;e=e.bytes;var l=f.bytes,k,r;for(k=r=0;k<=d-1;k++)r=r+e[k]-g[k],
l[k]=r&255,r>>=8;for(k=d;k<=m-1;k++)r+=e[k],l[k]=r&255,r>>=8;return h?C(f):D(f)}function I(a){var b;if("number"===typeof a)return!0;b=w(a);if(0===b||0===a.bytes[b-1])return!1;if(4<b)return!0;if(4>b)return!1;if(n(a)===v.classLargePositiveInteger())return a.bytes[3]>y(1073741823,4);if(!(a.bytes[3]<y(-1073741824,4)))for(b=1;4>=b;b++)if(a.bytes[b-1]!==y(-1073741824,b))return!0;return!1}function H(a){return n(a)===v.classLargePositiveInteger()?D(a):C(a)}function C(a){var b,c,d;for(c=d=w(a);0!==c&&0===
a.bytes[c-1];)--c;if(0===c)return 0;if(4>=c){if(4>c||J(a,4)<y(-1073741824,4)){d=0;for(b=c;1<=b;b+=-1)d=256*d-a.bytes[b-1];return d}for(b=1;4>=b;b++)if(J(a,b)!==y(-1073741824,b))return c<d?g(a,c):a;return-1073741824}return c<d?g(a,c):a}function D(a){var b,c;for(b=c=w(a);0!==b&&0===a.bytes[b-1];)--b;if(0===b)return 0;if(4>=b&&J(a,4)<=y(1073741823,4)){for(c=0;1<=b;b+=-1)c=256*c+a.bytes[b-1];return c}return b<c?g(a,b):a}var v=null;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:function(){var a,
b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=l(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitBitShiftMagnitude:function(){var b,c;c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?u(b,c):H(A(b,0-c,a(b)));
if(v.failed())return null;v.popthenPush(2,c);return null},primGetModuleName:function(){var a,b,c,d;b=strlen("LargeIntegers v1.5 (e)");d=v.instantiateClassindexableSize(v.classString(),b);a=d.bytes;for(c=0;c<=b-1;c++)a[c]="LargeIntegers v1.5 (e)"[c];if(v.failed())return null;v.popthenPush(1,d);return null},primDigitBitLogicWithOp:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.stackIntegerValue(0);
if(v.failed())return null;a=t(a,b,c);if(v.failed())return null;v.popthenPush(4,a);return null},primCheckIfCModuleExists:function(){var a;a=v.trueObject();if(v.failed())return null;v.popthenPush(1,a);return null},primDigitCompare:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?"number"===typeof b?a>b?1:a<b?-1:0:-1:"number"===typeof b?1:x(a,b);if(v.failed())return null;
v.popthenPush(2,a);return null},primDigitMultiplyNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;c=L(a,b,c);if(v.failed())return null;v.popthenPush(3,c);return null},primDigitBitShift:function(){var b,c;c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));
b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?u(b,c):H(A(b,0-c,a(b)));if(v.failed())return null;v.popthenPush(2,c);return null},primNormalizePositive:function(){var a;v.success(v.stackValue(0).sqClass===v.classLargePositiveInteger());a=v.stackValue(0);if(v.failed())return null;a=D(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitSubtractWith:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));
b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=E(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},_primDigitBitShift:function(){var b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.stackIntegerValue(0);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?u(b,c):H(A(b,0-c,a(b)));if(v.failed())return null;v.popthenPush(3,c);return null},primDigitMultiplyWithNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));
a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;c=L(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},primDigitSubtract:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===
typeof b?h(b):b;a=E(a,b);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitDivNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;if(!I(a)||!I(b))return v.primitiveFail(),null;a="number"===typeof a?h(a):a;if("number"===typeof b){if(0===b)return v.primitiveFail(),null;b=h(b)}c=F(a,b,c);if(v.failed())return null;v.popthenPush(3,
c);return null},primNormalizeNegative:function(){var a;v.success(v.stackValue(0).sqClass===v.classLargeNegativeInteger());a=v.stackValue(0);if(v.failed())return null;a=C(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitBitOr:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=t(a,b,1);if(v.failed())return null;v.popthenPush(2,a);return null},primMontgomeryTimesModulo:function(){var b,
c,d,e,g,m;v.success(v.isKindOfInteger(v.stackValue(2)));e=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));g=v.stackValue(1);m=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(3)));d=v.stackValue(3);if(v.failed())return null;b="number"===typeof d?h(d):d;c="number"===typeof e?h(e):e;var l="number"===typeof g?h(g):g,k;d=a(b);k=a(c);e=a(l);if(d<=e)if(k<=e)if(0<=m&&255>=m){g=v.instantiateClassindexableSize(v.classLargePositiveInteger(),e);b=b.bytes;c=c.bytes;var l=l.bytes,
r=g.bytes,w,p,u,y,n,t,x,C;t=d-1;n=k-1;y=e-1;for(p=u=0;p<=t;p++){C=r[0]+b[p]*c[0];x=C*m&255;C+=x*l[0];for(w=1;w<=n;w++)C=(C>>>8)+r[w]+b[p]*c[w]+x*l[w],r[w-1]=C&255;for(w=k;w<=y;w++)C=(C>>>8)+r[w]+x*l[w],r[w-1]=C&255;C=(C>>>8)+u;r[y]=C&255;u=C>>>8}for(p=d;p<=y;p++){C=r[0];x=C*m&255;C+=x*l[0];for(w=1;w<=y;w++)C=(C>>>8)+r[w]+x*l[w],r[w-1]=C&255;C=(C>>>8)+u;r[y]=C&255;u=C>>>8}if(0!==u||1!==f(l,r,e))for(p=C=0;p<=y;p++)C=C+r[p]-l[p],r[p]=C&255,C>>=8;m=D(g)}else m=v.primitiveFail();else m=v.primitiveFail();
else m=v.primitiveFail();if(v.failed())return null;v.popthenPush(4,m);return null},primDigitBitAnd:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=t(a,b,0);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitDivWithNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);
c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?h(a):a;if("number"===typeof b){if(0===b)return v.primitiveFail(),null;b=h(b)}c=F(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},setInterpreter:function(a){v=a;a=1==v.majorVersion();return!1===a?!1:a=11<=v.minorVersion()},primNormalize:function(){var a;v.success(v.isKindOfInteger(v.stackValue(0)));a=v.stackValue(0);if(v.failed())return null;if("number"===typeof a){if(v.failed())return null;v.popthenPush(2,
a);return null}a=H(a);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitBitXor:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=t(a,b,2);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitCompareWith:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);
if(v.failed())return null;a="number"===typeof a?"number"===typeof b?a>b?1:a<b?-1:0:-1:"number"===typeof b?1:x(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitAdd:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=l(a,b);if(v.failed())return null;v.popthenPush(2,a);return null},getModuleName:function(){return"LargeIntegers v1.5 (e)"},
primAsLargeInteger:function(){var a;v.success(v.isKindOfInteger(v.stackValue(0)));a=v.stackValue(0);if(v.failed())return null;"number"===typeof a&&(a=h(a));if(v.failed())return null;v.popthenPush(2,a);return null},primAnyBitFromTo:function(){var a,b,c;b=v.stackIntegerValue(1);c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;a="number"===typeof a?h(a):a;b=e(a,b,c)?v.trueObject():v.falseObject();if(v.failed())return null;v.popthenPush(3,
b);return null}})});module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?d.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(b){return d.failed()?null:d.isWords(b)&&6===a(b)?b.wordsAsFloat32Array():(d.primitiveFail(),null)}function c(a){var b,c;if(d.failed())return null;if(n(a)!==d.classPoint())return d.primitiveFail();c=d.fetchPointerofObject(0,
a);b="number"===typeof c;if(!b&&!c.isFloat)return d.primitiveFail();p=b?c:d.floatValueOf(c);c=d.fetchPointerofObject(1,a);b="number"===typeof c;if(!b&&!c.isFloat)return d.primitiveFail();B=b?c:d.floatValueOf(c)}function e(a){var b,c,e,f;e=p-a[2];f=B-a[5];b=a[0]*a[4]-a[1]*a[3];if(0===b)return d.primitiveFail();b=1/b;c=e*a[4]-a[1]*f;a=a[0]*f-e*a[3];y=c*b;r=a*b}function g(a){y=p*a[0]+B*a[1]+a[2];r=p*a[3]+B*a[4]+a[5]}function k(a){y+=.5;r+=.5;if(!(-1073741824<=y&&1073741823>=y&&-1073741824<=r&&1073741823>=
y))return d.primitiveFail();d.popthenPush(a,d.makePointwithxValueyValue(y|0,r|0))}function f(a,b,c,e,f){b+=.5;if(!(-1073741824<=b&&1073741823>=y))return d.primitiveFail();e+=.5;if(!(-1073741824<=e&&1073741823>=y))return d.primitiveFail();c+=.5;if(!(-1073741824<=c&&1073741823>=y))return d.primitiveFail();f+=.5;if(!(-1073741824<=f&&1073741823>=y))return d.primitiveFail();d.pushRemappableOop(a);a=d.makePointwithxValueyValue(b|0,c|0);d.pushRemappableOop(a);f=d.makePointwithxValueyValue(e|0,f|0);a=d.popRemappableOop();
e=d.popRemappableOop();d.storePointerofObjectwithValue(0,e,a);d.storePointerofObjectwithValue(1,e,f);return e}var d=null,p=0,B=0,y=0,r=0;Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:function(){var a;c(d.stackObjectValue(0));a=b(d.stackObjectValue(1));if(d.failed())return null;e(a);d.failed()||k(2)},primitiveInvertRectInto:function(){var g,h,k,A,l,t,x,F,w,L;k=d.stackObjectValue(0);g=d.stackObjectValue(1);A=b(d.stackObjectValue(2));if(d.failed())return null;if(n(g)!==n(k)||
!d.isPointers(g)||2!==a(g))return d.primitiveFail();c(d.fetchPointerofObject(0,g));if(d.failed())return null;w=p;L=B;e(A);x=l=y;F=t=r;c(d.fetchPointerofObject(1,g));if(d.failed())return null;g=p;h=B;e(A);x=Math.min(x,y);l=Math.max(l,y);F=Math.min(F,r);t=Math.max(t,r);p=g;B=L;e(A);x=Math.min(x,y);l=Math.max(l,y);F=Math.min(F,r);t=Math.max(t,r);p=w;B=h;e(A);x=Math.min(x,y);l=Math.max(l,y);F=Math.min(F,r);t=Math.max(t,r);d.failed()||(k=f(k,x,F,l,t));d.failed()||d.popthenPush(3,k)},primitiveIsIdentity:function(){var a;
a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5])},primitiveComposeMatrix:function(){var a,c,e,f;e=b(f=d.stackObjectValue(0));c=b(d.stackObjectValue(1));a=b(d.stackObjectValue(2));if(d.failed())return null;var g,k,r,p,w;g=a[0]*c[0]+a[1]*c[3];k=a[0]*c[1]+a[1]*c[4];r=a[0]*c[2]+a[1]*c[5]+a[2];p=a[3]*c[0]+a[4]*c[3];w=a[3]*c[1]+a[4]*c[4];a=a[3]*c[2]+a[4]*c[5]+a[5];e[0]=g;e[1]=k;e[2]=r;e[3]=p;e[4]=w;e[5]=a;d.popthenPush(3,
f)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveTransformRectInto:function(){var e,h,k,A,l,t,x,F,w,L;k=d.stackObjectValue(0);e=d.stackObjectValue(1);A=b(d.stackObjectValue(2));if(d.failed())return null;if(n(e)!==n(k)||!d.isPointers(e)||2!==a(e))return d.primitiveFail();c(d.fetchPointerofObject(0,e));if(d.failed())return null;w=p;L=B;g(A);x=l=y;F=t=r;c(d.fetchPointerofObject(1,e));if(d.failed())return null;e=p;h=B;g(A);x=Math.min(x,y);l=Math.max(l,
y);F=Math.min(F,r);t=Math.max(t,r);p=e;B=L;g(A);x=Math.min(x,y);l=Math.max(l,y);F=Math.min(F,r);t=Math.max(t,r);p=w;B=h;g(A);x=Math.min(x,y);l=Math.max(l,y);F=Math.min(F,r);t=Math.max(t,r);k=f(k,x,F,l,t);d.failed()||d.popthenPush(3,k)},primitiveIsPureTranslation:function(){var a;a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[3]&&1===a[4])},getModuleName:function(){return"Matrix2x3Plugin 3 November 2014 (e)"},primitiveTransformPoint:function(){var a;
c(d.stackObjectValue(0));a=b(d.stackObjectValue(1));if(d.failed())return null;g(a);k(2)}})});module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b,g){var k;for(k=0;3>=k;k++){var f=8*(3-k);b[g+k-1]=(31<f?0:a>>>f)&255}return g+4}function a(a,b,g){if(223>=a)return b[g-1]=a,g+1;if(7935>=a)return b[g-1]=(a>>8)+224,b[g]=a-256*(Math.floor(a/256)|0)|0,g+2;b[g-1]=255;return n(a,b,g+1)}var b=null;Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:function(){var a,e,g,k,f;b.stackValue(2);a=b.stackBytes(1);
e=b.stackUint16Array(0);if(b.failed())return null;k=a.length;for(g=1;g<=k;g++)f=a[g-1],e[g-1]=127<f?f-256<<8:f<<8;if(b.failed())return null;b.pop(2)},primitiveCompareString:function(){var a,e,g,k,f,d,p,n;b.stackValue(3);a=b.stackBytes(2);e=b.stackBytes(1);g=b.stackBytes(0);if(b.failed())return null;p=a.length;n=e.length;for(d=1;d<=Math.min(p,n);d++)if(k=g[a[d-1]],f=g[e[d-1]],k!==f){if(k<f){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,3)}return null}if(p===
n){if(b.failed())return null;b.popthenPush(4,2);return null}if(p<n){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,3)}return null},primitiveTranslateStringWithTable:function(){var a,e,g,k;b.stackValue(4);a=b.stackBytes(3);e=b.stackIntegerValue(2);g=b.stackIntegerValue(1);k=b.stackBytes(0);if(b.failed())return null;for(;e<=g;e++)a[e-1]=k[a[e-1]];if(b.failed())return null;b.pop(4)},primitiveStringHash:function(){var a,e,g,k,f;b.stackValue(2);a=b.stackBytes(1);
e=b.stackIntegerValue(0);if(b.failed())return null;g=a.length;e&=268435455;for(f=1;f<=g;f++)e+=a[f-1],k=e&16383,e=9741*k+16384*(9741*(e>>>14)+101*k&16383)&268435455;if(b.failed())return null;b.popthenPush(3,e);return null},primitiveCompressToByteArray:function(){var c,e,g,k,f,d,p,B,y;b.stackValue(2);c=b.stackInt32Array(1);e=b.stackBytes(0);if(b.failed())return null;B=c.length;k=a(B,e,1);for(d=1;d<=B;){y=c[d-1];p=y&255;g=(y>>>8&255)===p&&(y>>>16&255)===p&&(y>>>24&255)===p;for(f=d;f<B&&y===c[f];)++f;
if(f>d)g?(k=a(4*(f-d+1)+1,e,k),e[k-1]=p,++k):(k=a(4*(f-d+1)+2,e,k),k=n(y,e,k)),d=f+1;else if(g)k=a(5,e,k),e[k-1]=p,++k,++d;else{for(;f<B&&c[f-1]!==c[f];)++f;f===B&&++f;k=a(4*(f-d)+3,e,k);for(g=d;g<=f-1;g++)k=n(c[g-1],e,k);d=f}}if(b.failed())return null;b.popthenPush(3,k-1);return null},primitiveFindSubstring:function(){var a,e,g,k,f;b.stackValue(4);a=b.stackBytes(3);e=b.stackBytes(2);g=b.stackIntegerValue(1);k=b.stackBytes(0);if(b.failed())return null;if(0===a.length){if(b.failed())return null;b.popthenPush(5,
0);return null}for(f=g;f<=e.length-a.length+1;f++)for(g=1;k[e[f+g-1-1]]===k[a[g-1]];){if(g===a.length){if(b.failed())return null;b.popthenPush(5,f);return null}++g}if(b.failed())return null;b.popthenPush(5,0);return null},primitiveIndexOfAsciiInString:function(){var a,e,g,k;b.stackValue(3);a=b.stackIntegerValue(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;for(k=e.length;g<=k;g++)if(e[g-1]===a){if(b.failed())return null;b.popthenPush(4,g);return null}if(b.failed())return null;
b.popthenPush(4,0);return null},setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveDecompressFromByteArray:function(){var a,e,g,k,f,d,p,n,y,r;b.stackValue(3);a=b.stackInt32Array(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;d=g;g=e.length;n=1;for(r=a.length+1;d<=g;){k=e[d-1];++d;if(!(223>=k))if(254>=k)k=256*(k-224)+e[d-1],++d;else for(k=0,p=1;4>=p;p++)k=(k<<8)+e[d-1],++d;y=k>>>2;if(n+y>r)return b.primitiveFail(),null;f=k&
3;0===f&&null;if(1===f)for(k=e[d-1],++d,k|=k<<8,k|=k<<16,p=1;p<=y;p++)a[n-1]=k,++n;if(2===f){k=0;for(p=1;4>=p;p++)k=k<<8|e[d-1],++d;for(p=1;p<=y;p++)a[n-1]=k,++n}if(3===f)for(f=1;f<=y;f++){k=0;for(p=1;4>=p;p++)k=k<<8|e[d-1],++d;a[n-1]=k;++n}}if(b.failed())return null;b.pop(3)},getModuleName:function(){return"MiscPrimitivePlugin 3 November 2014 (e)"},primitiveFindFirstInString:function(){var a,e,g,k;b.stackValue(3);a=b.stackBytes(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;
if(256!==e.length){if(b.failed())return null;b.popthenPush(4,0);return null}for(k=a.length;g<=k&&0===e[a[g-1]];)++g;if(g>k){if(b.failed())return null;b.popthenPush(4,0);return null}if(b.failed())return null;b.popthenPush(4,g);return null}})});module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return Math.floor(a/b)|0}function b(b,c){return b-a(b,c)*c|0}function c(c,d,e,f,g){var k,p,l,n;p=a(e,60);k=b(e,60);e=(1E3-f)*g;n=(1E3-a(f*k,60))*g;f=(1E3-a(f*(60-k),60))*g;g=a(1E3*g,3922);e=a(e,3922);n=a(n,3922);f=a(f,3922);0===p&&(l=(g<<16)+(f<<8)+e);1===p&&(l=(n<<16)+(g<<8)+e);2===
p&&(l=(e<<16)+(g<<8)+f);3===p&&(l=(e<<16)+(n<<8)+g);4===p&&(l=(f<<16)+(e<<8)+g);5===p&&(l=(g<<16)+(e<<8)+n);0===l&&(l=1);c[d]=l;return 0}function e(a){p.success(p.isWordsOrBytes(a));return p.failed()?0:a.wordsAsFloat64Array()}function g(a){p.success(p.isWords(a));return p.failed()?0:a.words}function k(b,c,d,e,f){e=f-e;if(0===e)return 0;b=b===f?a(60*(c-d),e):c===f?120+a(60*(d-b),e):240+a(60*(b-c),e);return 0>b?b+360:b}function f(a,b,c){var d;if(0===a)return b;if(0===b)return a;d=1024-c;a=(d*(a>>>16&
255)+c*(b>>>16&255)>>10<<16)+(d*(a>>>8&255)+c*(b>>>8&255)>>10<<8)+(d*(a&255)+c*(b&255)>>10);0===a&&(a=1);return a}function d(a,b,c,d,e){var g,k,l;k=b>>>10;if(-1>k||k>=d)return 0;l=c>>>10;if(-1>l||l>=e)return 0;b&=1023;-1===k&&(b=k=0);k===d-1&&(b=0);c&=1023;-1===l&&(c=l=0);l===e-1&&(c=0);e=l*d+k;g=a[e]&16777215;0<b&&(g=f(g,a[e+1]&16777215,b));if(0===c)return g;e=(l+1)*d+k;d=a[e]&16777215;0<b&&(d=f(d,a[e+1]&16777215,b));return f(g,d,c)}var p=null;Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:function(){var b,
c,d,e,f,g,k,l,t=0,x=0;k=p.stackValue(2);c=p.stackValue(1);d=p.stackIntegerValue(0);p.success(p.isWords(k));p.success(p.isWords(c));b=a(2*n(k),d);e=2*n(c);p.success(e>=b);if(p.failed())return null;k=k.wordsAsInt16Array();c=c.wordsAsInt16Array();for(e=1;e<=b;e++){g=0;for(f=1;f<=d;f++)l=k[t++],0>l&&(l=0-l),l>g&&(g=l);c[x++]=g}p.pop(3);return 0},getModuleName:function(){return"ScratchPlugin 3 November 2014 (e)"},primitiveFisheye:function(){var b,c,e,f,h,k,A,l,t,x,F,w;e=p.stackValue(3);c=p.stackValue(2);
x=p.stackIntegerValue(1);t=p.stackIntegerValue(0);k=g(e);A=g(c);e=n(e);p.success(n(c)===e);if(p.failed())return null;a(e,x);h=a(e,x);c=x>>1;e=h>>1;t/=100;for(F=0;F<=x-1;F++)for(w=0;w<=h-1;w++)f=(F-c)/c,b=(w-e)/e,l=Math.pow(Math.sqrt(f*f+b*b),t),1>=l?(b=Math.atan2(b,f),f=1024*(c+l*Math.cos(b)*c)|0,l=1024*(e+l*Math.sin(b)*e)|0):(f=1024*F,l=1024*w),l=d(k,f,l,x,h),A[w*x+F]=l;p.pop(4);return 0},primitiveWaterRipples1:function(){var c,d,f,m,h,k,A,l,t,x,F,w,L,J,E,I;c=p.stackValue(5);F=p.stackValue(4);E=
p.stackIntegerValue(3);w=g(c);L=g(F);d=n(c);m=p.stackIntegerValue(2);c=p.stackValue(1);f=p.stackValue(0);c=e(c);f=e(f);p.success(n(F)===d);if(p.failed())return null;F=a(d,E);h=Math.random();m=b(h,m)-1;for(d=0;d<=m/2-1;d++)for(h=Math.random(),l=b(h,E),h=Math.random(),I=b(h,F),h=Math.random(),J=b(h,8),t=-4;4>=t;t++)for(x=-4;4>=x;x++)h=t*t+x*x,25>h&&0<h&&(k=l+t|0,A=I+x|0,0<k&&0<A&&A<F&&k<E&&(c[A*E+k]=J*(1-h/25)));for(d=1;d<=E-2;d++)for(m=1;m<=F-2;m++)l=m*E+d,c[l]=(f[l+1]+f[l-1]+f[l+E]+f[l-E]+f[l-1-E]/
2+f[l-1+E]/2+f[l+1-E]/2+f[l+1+E]/2)/4-c[l],c[l]*=.9;for(m=0;m<=E*F;m++)d=f[m],f[m]=c[m],c[m]=d;for(m=0;m<=F-1;m++)for(f=0;f<=E-1;f++)1<f&&f<E-1&&1<m&&m<F-1?(l=m*E+f,d=64*(c[l]-c[l-1]+(c[l+1]-c[l])),l=(c[l]-c[l-E]+(c[l+E]-c[l]))/64,2>d&&(d=-2),2<d&&(d=2),2>l&&(l=-2),2<l&&(l=2),d=(m+l)*E+(f+d)|0,d=d<E*F&&0<=d?w[d]:w[f+m*E]):d=w[f+m*E],L[f+m*E]=d;p.pop(6);return 0},primitiveHalfSizeDiagonal:function(){var a,b,c,d,e,f,k,l,n,x,F,w,L,J,E,I,H,C;l=g(p.stackValue(11));n=p.stackIntegerValue(10);c=p.stackIntegerValue(9);
x=g(p.stackValue(8));F=p.stackIntegerValue(7);k=p.stackIntegerValue(6);E=p.stackIntegerValue(5);I=p.stackIntegerValue(4);e=p.stackIntegerValue(3);f=p.stackIntegerValue(2);d=p.stackIntegerValue(1);b=p.stackIntegerValue(0);p.success(0<=E&&0<=I);p.success(E+2*d<=n);p.success(I+2*b<=c);p.success(0<=e&&0<=f);p.success(e+d<=F);p.success(f+b<=k);if(p.failed())return null;for(C=0;C<=b-1;C++)for(J=n*(I+2*C)+E,c=F*(f+C)+e,H=0;H<=d-1;H++)a=l[J],w=l[J+n+1],L=(a&16711680)+(w&16711680)>>>1&16711680,k=(a&65280)+
(w&65280)>>>1&65280,a=(a&255)+(w&255)>>>1,x[c]=L|k|a,J+=2,++c;p.pop(12);return 0},primitiveScale:function(){var b,c,d,e,f,k,A,l,t,x,F,w,L,J,E,I,H,C,D,v,N,P;b=p.stackValue(5);d=p.stackIntegerValue(4);c=p.stackIntegerValue(3);e=p.stackValue(2);t=p.stackIntegerValue(1);A=p.stackIntegerValue(0);p.success(n(b)===d*c);p.success(n(e)===t*A);b=g(b);k=g(e);if(p.failed())return null;f=0;N=a(1024*d,t);P=a(1024*c,A);for(F=0;F<=A-1;F++){for(x=e=0;x<=t-1;x++)H=(1024-(e&1023))*(1024-(f&1023)),C=(e&1023)*(1024-(f&
1023)),D=(1024-(e&1023))*(f&1023),v=(e&1023)*(f&1023),I=(f>>>10)*d+(e>>>10),w=b[I],L=e>>>10<d-1?b[I+1]:w,f>>>10<c-1&&(I+=d),J=b[I],E=e>>>10<d-1?b[I+1]:J,I=0,0===w&&(w=L,I+=H),0===L&&(L=w,I+=C),0===J&&(J=E,I+=D),0===E&&(E=J,I+=v),0===w&&(w=J,L=E),0===J&&(J=w,E=L),l=0,5E5>I&&(I=H*(w>>>16&255)+C*(L>>>16&255)+D*(J>>>16&255)+v*(E>>>16&255),l=(I>>>20&255)<<16,I=H*(w>>>8&255)+C*(L>>>8&255)+D*(J>>>8&255)+v*(E>>>8&255),l|=(I>>>20&255)<<8,I=H*(w&255)+C*(L&255)+D*(J&255)+v*(E&255),l|=I>>>20&255,0===l&&(l=1)),
k[F*t+x]=l,e+=N;f+=P}p.pop(6);return 0},primitiveDoubleSize:function(){var a,b,c,d,e,f,k,l,n,x,F,w;e=p.stackValue(7);k=p.stackIntegerValue(6);f=p.stackIntegerValue(5);l=p.stackValue(4);n=p.stackIntegerValue(3);a=p.stackIntegerValue(2);b=p.stackIntegerValue(1);c=p.stackIntegerValue(0);e=g(e);l=g(l);p.success(b+2*k<n);p.success(c+2*f<a);if(p.failed())return null;for(w=0;w<=f-1;w++)for(a=(c+2*w)*n+b,F=0;F<=k-1;F++)x=e[F+w*k],d=a+2*F,l[d]=x,l[d+1]=x,l[d+n]=x,l[d+n+1]=x;p.pop(8);return 0},setInterpreter:function(a){p=
a;a=1==p.majorVersion();return!1===a?!1:a=11<=p.minorVersion()},primitiveWhirl:function(){var b,c,e,f,h,k,A,l,t,x,F,w,L,J,E,I,H;e=p.stackValue(3);c=p.stackValue(2);E=p.stackIntegerValue(1);h=p.stackIntegerValue(0);t=g(e);x=g(c);e=n(e);p.success(n(c)===e);if(p.failed())return null;l=a(e,E);c=E>>1;e=l>>1;c<e?(F=c,w=e/c,L=1):(F=e,w=1,L=e<c?c/e:1);J=-3.141592653589793*h/180;h=F*F;for(I=0;I<=E-1;I++)for(H=0;H<=l-1;H++)k=w*(I-c),A=L*(H-e),f=k*k+A*A,f<h&&(f=1-Math.sqrt(f)/F,b=J*f*f,f=Math.sin(b),b=Math.cos(b),
k=d(t,1024*((b*k-f*A)/w+c)|0,1024*((f*k+b*A)/L+e)|0,E,l),x[E*H+I]=k);p.pop(4);return 0},primitiveBlur:function(){var b,c,d,e,f,k,A,l,t,x,F,w,L;A=p.stackValue(2);f=p.stackValue(1);w=p.stackIntegerValue(0);k=g(A);t=g(f);A=n(A);p.success(n(f)===A);if(p.failed())return null;f=a(A,w);for(L=1;L<=f-2;L++)for(A=1;A<=w-2;A++){l=F=e=b=0;for(d=-1;1>=d;d++)for(c=-1;1>=c;c++)x=k[(L+d)*w+(A+c)]&16777215,0!==x&&(F+=x>>>16&255,e+=x>>>8&255,b+=x&255,++l);b=0===l?0:(a(F,l)<<16)+(a(e,l)<<8)+a(b,l);t[L*w+A]=b}p.pop(3);
return 0},primitiveBrightnessShift:function(){var b,d,e,f,h,u,A,l,t,x;u=p.stackValue(2);f=p.stackValue(1);t=p.stackIntegerValue(0);h=g(u);x=n(u);u=g(f);p.success(n(f)===x);if(p.failed())return null;for(f=0;f<=x-1;f++)d=h[f]&16777215,0!==d&&(l=d>>>16&255,e=d>>>8&255,b=d&255,d=A=l,e>d&&(d=e),b>d&&(d=b),e<A&&(A=e),b<A&&(A=b),e=k(l,e,b,A,d),A=0===d?0:a(1E3*(d-A),d),d=a(1E3*d,255),d+=10*t,1E3<d&&(d=1E3),0>d&&(d=0),c(u,f,e,A,d));p.pop(3);return 0},primitiveHalfSizeAverage:function(){var a,b,c,d,e,f,k,l,
n,x,F,w,L,J,E,I,H,C;l=g(p.stackValue(11));n=p.stackIntegerValue(10);a=p.stackIntegerValue(9);x=g(p.stackValue(8));F=p.stackIntegerValue(7);c=p.stackIntegerValue(6);E=p.stackIntegerValue(5);I=p.stackIntegerValue(4);e=p.stackIntegerValue(3);f=p.stackIntegerValue(2);d=p.stackIntegerValue(1);b=p.stackIntegerValue(0);p.success(0<=E&&0<=I);p.success(E+2*d<=n);p.success(I+2*b<=a);p.success(0<=e&&0<=f);p.success(e+d<=F);p.success(f+b<=c);if(p.failed())return null;for(C=0;C<=b-1;C++)for(J=n*(I+2*C)+E,c=F*
(f+C)+e,H=0;H<=d-1;H++)w=l[J],L=w&16711680,k=w&65280,a=w&255,w=l[J+1],L+=w&16711680,k+=w&65280,a+=w&255,w=l[J+n],L+=w&16711680,k+=w&65280,a+=w&255,w=l[J+n+1],L+=w&16711680,k+=w&65280,a+=w&255,x[c]=L>>>2&16711680|k>>>2&65280|a>>>2,J+=2,++c;p.pop(12);return 0},primitiveSaturationShift:function(){var b,d,e,f,h,u,A,l,t,x,F,w;u=p.stackValue(2);f=p.stackValue(1);F=p.stackIntegerValue(0);h=g(u);w=n(u);u=g(f);p.success(n(f)===w);if(p.failed())return null;for(f=0;f<=w-1;f++)d=h[f]&16777215,2>d||(t=d>>>16&
255,e=d>>>8&255,b=d&255,A=l=t,e>A&&(A=e),b>A&&(A=b),e<l&&(l=e),b<l&&(l=b),d=a(1E3*A,255),x=0===A?0:a(1E3*(A-l),A),0<x&&(e=k(t,e,b,l,A),x+=10*F,1E3<x&&(x=1E3),0>x&&(x=0),c(u,f,e,x,d)));p.pop(3);return 0},primitiveHueShift:function(){var d,e,f,m,h,u,A,l,t,x,F,w;u=p.stackValue(2);m=p.stackValue(1);F=p.stackIntegerValue(0);h=g(u);w=n(u);u=g(m);p.success(n(m)===w);if(p.failed())return null;for(m=0;m<=w-1;m++)e=h[m]&16777215,0!==e&&(t=e>>>16&255,f=e>>>8&255,d=e&255,A=l=t,f>A&&(A=f),d>A&&(A=d),f<l&&(l=f),
d<l&&(l=d),e=a(1E3*A,255),x=0===A?0:a(1E3*(A-l),A),110>e&&(e=110,x=1E3),90>x&&(x=90),f=110===e||90===x?0:k(t,f,d,l,A),f=b(f+F+36E7,360),c(u,m,f,x,e));p.pop(3);return 0},primitiveInterpolate:function(){var b,c,e,f,h;c=p.stackValue(3);e=p.stackIntegerValue(2);f=p.stackIntegerValue(1);h=p.stackIntegerValue(0);b=g(c);c=n(c);if(p.failed())return null;b=d(b,f,h,e,a(c,e));p.pop(5);p.pushInteger(b);return 0},primitiveExtractChannel:function(){var a,b,c,d,e=0,f=0;c=p.stackValue(2);a=p.stackValue(1);b=p.booleanValueOf(p.stackValue(0));
p.success(p.isWords(c));p.success(p.isWords(a));d=n(c);p.success(n(a)>=d>>1);if(p.failed())return null;c=c.wordsAsInt16Array();a=a.wordsAsInt16Array();b&&e++;for(b=1;b<=d;b++)a[f++]=c[e],e+=2;p.pop(3);return 0}})});function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,lastLookup:null,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=this.interpreterProxy.vm.primHandler;
return!0},_newSocketHandle:function(n,a,b,c){var e=this;return{host:null,port:null,connSemaIndex:a,readSemaIndex:b,writeSemaIndex:c,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:e.Socket_Unconnected,_signalSemaphore:function(a){0>=a||e.primHandler.signalSemaphoreWithIndex(a)},_signalConnSemaphore:function(){this._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){this._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){this._signalSemaphore(this.writeSemaIndex)},
_otherEndClosed:function(){this.status=e.Socket_OtherEndClosed;this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return e.needProxy.has(this._hostAndPort())},_getURL:function(a,b){var c="";if(b||this._requestNeedsProxy())c+="object"===typeof SqueakJS&&SqueakJS.options.proxy||"https://crossorigin.me/";return c=443!==this.port?c+("http://"+this._hostAndPort()+a):c+("https://"+this.host+a)},_performRequest:function(){var a=(new TextDecoder("utf-8")).decode(this.sendBuffer).split("\r\n\r\n")[0].split("\n"),
b=a[0].split(" "),c=b[0];if("GET"!==c&&"PUT"!==c&&"POST"!==c)return this._otherEndClosed(),-1;for(var b=b[1],d=null,e=1;e<a.length;e++){var n=a[e];if(n.match(/Content-Length:/i)){d=parseInt(n.substr(16));e=this.sendBuffer.byteLength;d=this.sendBuffer.subarray(e-d,e);break}}window.fetch?this._performFetchAPIRequest(b,c,d,a):this._performXMLHTTPRequest(b,c,d,a)},_performFetchAPIRequest:function(a,b,c,d){for(var p=this,n={},y=1;y<d.length;y++){var r=d[y].split(":");2===r.length&&(n[r[0]]=r[1].trim())}var m=
{method:b,headers:n,body:c,mode:"cors"};fetch(this._getURL(a),m).then(p._handleFetchAPIResponse.bind(p))["catch"](function(h){var n=p._getURL(a,!0);console.warn("Retrying with CORS proxy: "+n);fetch(n,m).then(function(a){console.log("Success: "+n);p._handleFetchAPIResponse(a);e.needProxy.add(p._hostAndPort())})["catch"](function(e){console.warn("Fetch API failed, retrying with XMLHttpRequest");p._performXMLHTTPRequest(a,b,c,d)})})},_handleFetchAPIResponse:function(a){if(null===this.response){var b=
["HTTP/1.0 ",a.status," ",a.statusText,"\r\n"];a.headers.forEach(function(a,c,e){b=b.concat([c,": ",a,"\r\n"])});b.push("\r\n");this.response=[(new TextEncoder("utf-8")).encode(b.join(""))]}this._readIncremental(a.body.getReader())},_readIncremental:function(a){var b=this;return a.read().then(function(c){if(c.done)b.responseReceived=!0;else return b.response.push(c.value),b._signalReadSemaphore(),b._readIncremental(a)})},_performXMLHTTPRequest:function(a,b,c,d){for(var p=this,n,y=1;y<d.length;y++){var r=
d[y];if(r.match(/Content-Type:/i)){n=encodeURIComponent(r.substr(14));break}}var m=new XMLHttpRequest;m.open(b,this._getURL(a));void 0!==n&&m.setRequestHeader("Content-type",n);m.responseType="arraybuffer";m.onload=function(a){p._handleXMLHTTPResponse(this)};m.onerror=function(d){var n=p._getURL(a,!0);console.warn("Retrying with CORS proxy: "+n);d=new XMLHttpRequest;d.open(b,n);d.responseType=m.responseType;d.onload=function(a){console.log("Success: "+n);p._handleXMLHTTPResponse(this);e.needProxy.add(p._hostAndPort())};
d.onerror=function(){p._otherEndClosed();console.error("Failed to download:\n"+n)};d.send(c)};m.send(c)},_handleXMLHTTPResponse:function(a){this.responseReceived=!0;var b=a.response;if(b){a=(new TextEncoder("utf-8")).encode("HTTP/1.0 "+a.status+" "+a.statusText+"\r\n"+a.getAllResponseHeaders()+"\r\n");var c=new Uint8Array(a.byteLength+b.byteLength);c.set(a,0);c.set(new Uint8Array(b),a.byteLength);this.response=[c];this._signalReadSemaphore()}else this._otherEndClosed()},connect:function(a,b){this.host=
a;this.port=b;this.status=e.Socket_Connected;this._signalConnSemaphore();this._signalWriteSemaphore()},close:function(){if(this.status==e.Socket_Connected||this.status==e.Socket_OtherEndClosed||this.status==e.Socket_WaitingForConnection)this.status=e.Socket_Unconnected,this._signalConnSemaphore()},destroy:function(){this.status=e.Socket_InvalidSocket},dataAvailable:function(){if(this.status==e.Socket_InvalidSocket)return!1;if(this.status==e.Socket_Connected){if(this.response&&0<this.response.length)return this._signalReadSemaphore(),
!0;this.responseSentCompletly&&(this.status=e.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(a){if(null===this.response)return[];var b=this.response[0];if(b.length>a){var c=b.subarray(a);c?this.response[0]=c:this.response.shift();b=b.subarray(0,a)}else this.response.shift();this.responseReceived&&0===this.response.length&&(this.responseSentCompletly=!0);return b},send:function(a,b,c){null!==this.sendTimeout&&window.clearTimeout(this.sendTimeout);this.lastSend=Date.now();
a=a.bytes.subarray(b,c);null===this.sendBuffer?this.sendBuffer=a:(b=new Uint8Array(this.sendBuffer.byteLength+a.byteLength),b.set(this.sendBuffer,0),b.set(a,this.sendBuffer.byteLength),this.sendBuffer=b);this.sendTimeout=setTimeout(this._performRequest.bind(this),50);return a.byteLength}}},primitiveHasSocketAccess:function(n){this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0},primitiveInitializeNetwork:function(n){this.interpreterProxy.pop(1);return!0},primitiveResolverNameLookupResult:function(n){if(0!==
n)return!1;null!==this.lastLookup?(n=this.primHandler.makeStString(this.lastLookup),this.lastLookup=null):n=this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(1,n);return!0},primitiveResolverStartNameLookup:function(n){if(1!==n)return!1;this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveResolverStatus:function(n){this.interpreterProxy.popthenPush(1,this.Resolver_Ready);return!0},
primitiveSocketConnectionStatus:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle.status;void 0===n&&(n=this.Socket_InvalidSocket);this.interpreterProxy.popthenPush(1,n);return!0},primitiveSocketConnectToPort:function(n){if(3!==n)return!1;var a=this.interpreterProxy.stackObjectValue(2).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(1).bytesAsString(),c=this.interpreterProxy.stackIntegerValue(0);a.connect(b,c);this.interpreterProxy.popthenPush(n,
this.interpreterProxy.nilObject());return!0},primitiveSocketCloseConnection:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;n.close();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveSocketCreate3Semaphores:function(n){if(7!==n)return!1;var a=this.interpreterProxy.stackIntegerValue(0),b=this.interpreterProxy.stackIntegerValue(1),c=this.interpreterProxy.stackIntegerValue(2),e=this.interpreterProxy.stackIntegerValue(3);
if(this.interpreterProxy.stackIntegerValue(5)!==this.TCP_Socket_Type)return!1;var g="{SqueakJS Socket #"+ ++this.handleCounter+"}",g=this.primHandler.makeStString(g);g.handle=this._newSocketHandle(e,c,b,a);this.interpreterProxy.popthenPush(n,g);return!0},primitiveSocketDestroy:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;n.destroy();this.interpreterProxy.popthenPush(1,n.status);return!0},primitiveSocketReceiveDataAvailable:function(n){if(1!==
n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;var a=this.interpreterProxy.falseObject();n.dataAvailable()&&(a=this.interpreterProxy.trueObject());this.interpreterProxy.popthenPush(1,a);return!0},primitiveSocketReceiveDataBufCount:function(n){if(4!==n)return!1;var a=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(2),c=this.interpreterProxy.stackIntegerValue(1)-1,e=this.interpreterProxy.stackIntegerValue(0);
if(c+e>b.bytes.length)return!1;a=a.recv(e);b.bytes.set(a,c);this.interpreterProxy.popthenPush(n,a.length);return!0},primitiveSocketSendDataBufCount:function(n){if(4!==n)return!1;n=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===n)return!1;var a=this.interpreterProxy.stackObjectValue(2),b=this.interpreterProxy.stackIntegerValue(1)-1;if(0>b)return!1;var c=this.interpreterProxy.stackIntegerValue(0),c=b+c;if(c>a.length)return!1;n=n.send(a,b,c);this.interpreterProxy.popthenPush(1,n);return!0},
primitiveSocketSendDone:function(n){if(1!==n)return!1;this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0}}}function registerSocketPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):window.setTimeout(registerSocketPlugin,100)}registerSocketPlugin();module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,c){return a-(Math.floor(a/c)|0)*c|0}var a=null;Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:function(){var b,c,e,g,k,f,d,p,B,y,r,m,h,u,A,l,t,x,F,w,L,J;b=a.stackValue(5);c=a.stackIntegerValue(4);e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);x=a.fetchIntegerofObject(3,b);F=a.fetchIntegerofObject(4,
b);w=a.fetchIntegerofObject(5,b);m=a.fetchIntegerofObject(7,b);J=a.fetchInt16ArrayofObject(8,b);L=a.fetchIntegerofObject(9,b);u=a.fetchIntegerofObject(10,b);A=a.fetchIntegerofObject(11,b);h=a.fetchIntegerofObject(14,b);l=a.fetchIntegerofObject(15,b);t=a.fetchIntegerofObject(16,b);if(a.failed())return null;d=0!==h&&0!==t;B=g+c-1;for(r=g;r<=B;r++)if(g=x*J[u>>15]>>15,d?(p=h*J[l>>15],l=n(l+t,L),0>l&&(l+=L),u=n(u+A+p,L),0>u&&(u+=L)):u=n(u+A,L),0<k&&(p=2*r-1,y=e[p-1]+(g*k>>15),32767<y&&(y=32767),-32767>
y&&(y=-32767),e[p-1]=y),0<f&&(p=2*r,y=e[p-1]+(g*f>>15),32767<y&&(y=32767),-32767>y&&(y=-32767),e[p-1]=y),0!==F&&(x+=F,0<F&&x>=w||0>F&&x<=w))x=w,F=0;m-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,x);a.storeIntegerofObjectwithValue(4,b,F);a.storeIntegerofObjectwithValue(7,b,m);a.storeIntegerofObjectwithValue(10,b,u);a.storeIntegerofObjectwithValue(15,b,l);a.pop(5)},primitiveMixSampledSound:function(){var b,c,e,g,k,f,d,p,n,y,r,m,h,u,A,l,t,x,F;b=a.stackValue(5);c=a.stackIntegerValue(4);
e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);t=a.fetchIntegerofObject(3,b);x=a.fetchIntegerofObject(4,b);F=a.fetchIntegerofObject(5,b);r=a.fetchIntegerofObject(7,b);h=a.fetchInt16ArrayofObject(8,b);u=a.fetchIntegerofObject(10,b);l=a.fetchIntegerofObject(11,b);m=a.fetchIntegerofObject(12,b);A=a.fetchIntegerofObject(13,b);if(a.failed())return null;p=g+c-1;for(d=m+(l>>>16);d<=u&&g<=p;)y=h[d-1]*t>>15,0<k&&(d=2*g-1,n=e[d-1]+(y*k>>15),32767<n&&(n=32767),
-32767>n&&(n=-32767),e[d-1]=n),0<f&&(d=2*g,n=e[d-1]+(y*f>>15),32767<n&&(n=32767),-32767>n&&(n=-32767),e[d-1]=n),0!==x&&(t+=x,0<x&&t>=F||0>x&&t<=F)&&(t=F,x=0),l+=A,536870912<=l&&(d=l>>>16,m+=d,l-=d<<16),d=m+(l>>>16),++g;r-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,t);a.storeIntegerofObjectwithValue(4,b,x);a.storeIntegerofObjectwithValue(7,b,r);a.storeIntegerofObjectwithValue(11,b,l);a.storeIntegerofObjectwithValue(12,b,m);a.pop(5)},setInterpreter:function(b){a=b;b=1==a.majorVersion();
return!1===b?!1:b=11<=a.minorVersion()},getModuleName:function(){return"SoundGenerationPlugin 3 November 2014 (e)"},primitiveApplyReverb:function(){var b,c,e,g,k,f,d,p,B,y,r,m,h,u,A,l,t;b=a.stackValue(3);c=a.stackInt16Array(2);e=a.stackIntegerValue(1);g=a.stackIntegerValue(0);l=a.fetchInt32ArrayofObject(7,b);t=a.fetchInt32ArrayofObject(8,b);A=a.fetchIntegerofObject(9,b);m=a.fetchIntegerofObject(10,b);r=a.fetchIntegerofObject(11,b);h=a.fetchInt16ArrayofObject(12,b);u=a.fetchInt16ArrayofObject(13,b);
if(a.failed())return null;for(p=e;p<=e+g-1;p++){k=f=0;for(y=1;y<=A;y++)d=r-l[y-1],1>d&&(d+=m),B=t[y-1],k+=B*h[d-1],f+=B*u[d-1];d=2*p-1;k=c[d-1]+(k>>15);32767<k&&(k=32767);-32767>k&&(k=-32767);c[d-1]=k;h[r-1]=k;++d;k=c[d-1]+(f>>15);32767<k&&(k=32767);-32767>k&&(k=-32767);c[d-1]=k;u[r-1]=k;r=n(r,m)+1}if(a.failed())return null;a.storeIntegerofObjectwithValue(11,b,r);a.pop(3)},primitiveMixPluckedSound:function(){var b,c,e,g,k,f,d,p,n,y,r,m,h,u,A,l,t,x,F;b=a.stackValue(5);c=a.stackIntegerValue(4);e=a.stackInt16Array(3);
g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);t=a.fetchIntegerofObject(3,b);x=a.fetchIntegerofObject(4,b);F=a.fetchIntegerofObject(5,b);h=a.fetchIntegerofObject(7,b);u=a.fetchInt16ArrayofObject(8,b);r=a.fetchIntegerofObject(9,b);A=a.fetchIntegerofObject(10,b);l=a.fetchIntegerofObject(11,b);if(a.failed())return null;p=g+c-1;for(m=r;g<=p;g++)if(r=m+A,r>=l&&(r=32768+(r-l)),d=u[(m>>15)-1]+u[(r>>15)-1]>>1,u[(m>>15)-1]=d,y=d*t>>15,m=r,0<k&&(d=2*g-1,n=e[d-1]+(y*k>>15),32767<
n&&(n=32767),-32767>n&&(n=-32767),e[d-1]=n),0<f&&(d=2*g,n=e[d-1]+(y*f>>15),32767<n&&(n=32767),-32767>n&&(n=-32767),e[d-1]=n),0!==x&&(t+=x,0<x&&t>=F||0>x&&t<=F))t=F,x=0;h-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,t);a.storeIntegerofObjectwithValue(4,b,x);a.storeIntegerofObjectwithValue(7,b,h);a.storeIntegerofObjectwithValue(9,b,r);a.pop(5)},primitiveMixLoopedSampledSound:function(){var b,c,e,g,k,f,d,n,B,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I,H,C,D,v;b=a.stackValue(5);c=a.stackIntegerValue(4);
e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);C=a.fetchIntegerofObject(3,b);D=a.fetchIntegerofObject(4,b);v=a.fetchIntegerofObject(5,b);t=a.fetchIntegerofObject(7,b);L=a.fetchIntegerofObject(8,b);F=a.fetchInt16ArrayofObject(10,b);J=a.fetchInt16ArrayofObject(11,b);x=a.fetchIntegerofObject(16,b);w=a.fetchIntegerofObject(17,b);H=a.fetchIntegerofObject(18,b);E=a.fetchIntegerofObject(19,b);I=a.fetchIntegerofObject(20,b);if(a.failed())return null;y=F!==
J;d=k*C>>15;n=f*C>>15;B=2*g-1;r=g+c-1;for(l=g;l<=r;l++){A=(E+=I)>>9;A>w&&t>L&&(A=(E-=H)>>9);if((u=A+1)>x){if(A>x){t=0;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,C);a.storeIntegerofObjectwithValue(4,b,D);a.storeIntegerofObjectwithValue(7,b,t);a.storeIntegerofObjectwithValue(19,b,E);a.popthenPush(6,null);return null}u=0===H?A:(E-H>>9)+1}h=E&511;g=m=F[A-1]*(512-h)+F[u-1]*h>>9;y&&(g=J[A-1]*(512-h)+J[u-1]*h>>9);0<k&&(m=e[B-1]+(d*m>>15),32767<m&&(m=32767),-32767>m&&(m=-32767),e[B-1]=
m);++B;0<f&&(m=e[B-1]+(n*g>>15),32767<m&&(m=32767),-32767>m&&(m=-32767),e[B-1]=m);++B;if(0!==D){C+=D;if(0<D&&C>=v||0>D&&C<=v)C=v,D=0;d=k*C>>15;n=f*C>>15}}t-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,C);a.storeIntegerofObjectwithValue(4,b,D);a.storeIntegerofObjectwithValue(7,b,t);a.storeIntegerofObjectwithValue(19,b,E);a.pop(5)}})});function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:window.speechSynthesis,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=this.interpreterProxy.vm.primHandler;return!0},primitiveSpeak:function(n){var a,b;if(1===n)a=this.interpreterProxy.stackValue(0).bytesAsString();else if(2===n){a=this.interpreterProxy.stackValue(1).bytesAsString();var c=
this.interpreterProxy.stackValue(0).bytesAsString();b=this.synth.getVoices().filter(function(a){return a.name===c})}else return!1;a=new SpeechSynthesisUtterance(a);b&&0<b.length&&(a.voice=b[0]);this.synth.speak(a);this.interpreterProxy.pop(n);return!0},primitiveRegisterSemaphore:function(n){if(1!==n)return!1;this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0);return!0},primitiveUnregisterSemaphore:function(n){if(0!==n)return!1;this.semaphoreIndex=null;return!0},primitiveGetLastRecognitionResult:function(n){if(0!==
n||null===this.semaphoreIndex||null===this.voiceInput)return!1;n=this.primHandler.makeStArray(this.voiceInput);this.voiceInput=[];this.interpreterProxy.popthenPush(1,n);return!0},primitiveStartListening:function(n){if(0!==n)return!1;this.recognition=new webkitSpeechRecognition;this.recognition.lang="en-US";this.recognition.interimResults=!0;this.recognition.onresult=this._onRecognitionResult.bind(this);this.recognition.onerror=function(a){console.log(a)};this.recognition.onend=function(a){this.shouldListen&&
this.recognition.start()}.bind(this);this.shouldListen=!0;this.recognition.start();return!0},_onRecognitionResult:function(n){this.voiceInput=[];for(var a=n.resultIndex;a<n.results.length;a++){for(var b=n.results[a],c=[b.isFinal,[]],e=0;e<b.length;e++){var g=b[e].transcript;Date.now();c[1].push([g,b[e].confidence])}0<c[1].length&&this.voiceInput.push(c)}null!==this.semaphoreIndex&&0<this.voiceInput.length&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(n){if(0!==
n)return!1;this.voiceInput=[];this.recognition.stop();this.shouldListen=!1;return!0}}}function registerSpeechPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in window?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):window.setTimeout(registerSpeechPlugin,100)}registerSpeechPlugin();function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=
this.interpreterProxy.vm.primHandler;return!0},primitiveCreate:function(n){var a="{SqueakJS SSL #"+ ++this.handleCounter+"}",a=this.primHandler.makeStString(a);a.handle=!0;this.interpreterProxy.popthenPush(n,a);return!0},primitiveConnect:function(n){if(5!==n)return!1;this.interpreterProxy.popthenPush(n,0);return!0},primitiveDestroy:function(n){if(1!==n)return!1;this.interpreterProxy.popthenPush(1,1);return!0},primitiveGetIntProperty:function(n){if(2!==n||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;
var a;a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0;this.interpreterProxy.popthenPush(n,a);return!0},primitiveGetStringProperty:function(n){if(2!==n||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;var a;a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(n,a);return!0},primitiveEncrypt:function(n){if(5!==n||void 0===
this.interpreterProxy.stackObjectValue(4).handle)return!1;var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=a.bytes;this.interpreterProxy.popthenPush(n,b);return!0},primitiveDecrypt:function(n){if(5!==n||void 0===this.interpreterProxy.stackObjectValue(4).handle)return!1;var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=
this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=a.bytes;this.interpreterProxy.popthenPush(n,b);return!0}}}function registerSqueakSSL(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):window.setTimeout(registerSqueakSSL,100)}registerSqueakSSL();module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){b.success(b.isWords(a));return b.failed()?0:a.words}var b=null;Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:function(){var c,e,g,k,f,d,p,B,y,r,m,h,u,A,l,t;k=b.stackValue(4);c=b.stackValue(3);h=b.stackIntegerValue(2);d=b.stackIntegerValue(1);
e=b.stackIntegerValue(0);B=a(k);g=a(c);b.success(n(k)===n(c));b.success(n(k)===h*d);if(b.failed())return null;c=(2*e+1)*(2*e+1);for(l=0;l<=d-1;l++)for(r=l-e,0>r&&(r=0),f=l+e,f>=d&&(f=d-1),u=0;u<=h-1;u++){y=u-e;0>y&&(y=0);k=u+e;k>=h&&(k=h-1);m=0;for(t=r;t<=f;t++)for(p=t*h,A=y;A<=k;A++)m+=B[p+A];g[l*h+u]=Math.floor(m/c)|0}b.pop(5)},primitiveEvaporateRate:function(){var c,e,g,k;c=b.stackValue(1);g=b.stackIntegerValue(0);e=a(c);k=n(c);if(b.failed())return null;for(c=0;c<=k-1;c++)e[c]=e[c]*g>>>10;b.pop(2)},
setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:function(){var c,e,g,k,f,d,p,B,y,r,m,h,u,A;h=b.stackValue(6);g=b.stackValue(5);u=b.stackIntegerValue(4);k=b.stackIntegerValue(3);d=b.stackIntegerValue(2);B=b.stackIntegerValue(1);r=b.stackIntegerValue(0);m=a(h);c=a(g);b.success(n(g)===u*k);b.success(n(g)===n(h)*d*d);if(b.failed())return null;g=0;0<(B&4)&&(g+=65536);0<(B&2)&&(g+=256);0<(B&1)&&++g;B=-1;for(A=
0;A<=(Math.floor(k/d)|0)-1;A++)for(h=0;h<=(Math.floor(u/d)|0)-1;h++)for(e=m[++B],e=0>r?-31>r?0:e>>>0-r:31<r?0:e<<r,255<e&&(e=255),p=0>=e?1:e*g,y=f=(A*u+h)*d;y<=f+(d-1)*u;y+=u)for(e=y;e<=y+d-1;e++)c[e]=p;b.pop(7)},getModuleName:function(){return"StarSqueakPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?m.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a){for(a=n(a);!a.isNil&&7<=a.classInstSize();)a=a.superclass();if(a.isNil)return!1;u=a.classInstSize();return!0}function e(a,b,c,d,e){var f,g,h;h=b<<
16|c;if(258<=b)return h;c=P[(O<<5^w[a+3-1])&32767];f=a-c;if(!(0<f&&32768>f))return h;for(f=32768<a?a-32768:0;;){if(w[a+b]!==w[c+b]||w[a+b-1]!==w[c+b-1]||w[a]!==w[c])g=0;else if(w[a+1]!==w[c+1])g=1;else for(g=2;258>g&&w[a+g]===w[c+g];)++g;a+g>la&&(g=la-a);3===g&&8192<a-c&&(g=2);if(g>b&&(h=g<<16|c,b=g,258<=b||b>e)||!(0<--d))return h;c=M[c&32767];if(c<=f)return h}}function g(a){var b;O=(O<<5^w[a+3-1])&32767;b=P[O];P[O]=a;M[a&32767]=b}function k(d){var e;if(!(m.isPointers(d)&&15<=a(d)))return!1;e=m.fetchPointerofObject(0,
d);if(!m.isBytes(e))return!1;if(0===u){if(!c(d))return!1;if(a(d)<u+5)return u=0,!1}w=e.bytes;L=b(e);la=m.fetchIntegerofObject(1,d);wa=m.fetchIntegerofObject(2,d);e=m.fetchPointerofObject(u+0,d);if(!m.isWords(e)||32768!==a(e))return!1;P=e.words;e=m.fetchPointerofObject(u+1,d);if(!m.isWords(e)||32768!==a(e))return!1;M=e.words;O=m.fetchIntegerofObject(u+2,d);F=m.fetchIntegerofObject(u+3,d);e=m.fetchPointerofObject(u+5,d);if(!m.isBytes(e))return!1;U=a(e);Z=e.bytes;e=m.fetchPointerofObject(u+6,d);if(!(m.isWords(e)&&
a(e)>=U))return!1;D=e.words;e=m.fetchPointerofObject(u+7,d);if(!m.isWords(e)||286!==a(e))return!1;oa=e.words;e=m.fetchPointerofObject(u+8,d);if(!m.isWords(e)||30!==a(e))return!1;C=e.words;Q=m.fetchIntegerofObject(u+9,d);T=m.fetchIntegerofObject(u+10,d);return!m.failed()}function f(d){var e;if(0===u){if(!c(d))return!1;if(a(d)<u+3)return u=0,!1}if(!(m.isPointers(d)&&a(d)>=u+3))return!1;e=m.fetchPointerofObject(0,d);if(!m.isBytes(e))return m.primitiveFail();w=e.bytes;L=b(e);la=m.fetchIntegerofObject(1,
d);wa=m.fetchIntegerofObject(2,d);t=m.fetchIntegerofObject(u+1,d);x=m.fetchIntegerofObject(u+2,d);return!m.failed()}function d(a,b){if(!(0<=b&&(31<a?0:1<<a)>b))return m.primitiveFail();t|=31<x?0:b<<x;for(x+=a;8<=x&&la<L;)w[la]=t&255,++la,t>>>=8,x-=8}function p(c,e,f,g){var h,k,w,n,p,r,C,x,u,t,y,B,D;h=m.fetchPointerofObject(0,c);t=m.fetchIntegerofObject(1,c);u=m.fetchIntegerofObject(2,c);if(!(t<=u&&m.isBytes(h)&&u<=b(h)))return m.primitiveFail();C=h.bytes;h=m.fetchPointerofObject(0,e);if(!(m.isWords(h)&&
u<=a(h)&&m.fetchIntegerofObject(1,e)===t&&m.fetchIntegerofObject(2,e)===u))return m.primitiveFail();k=h.words;h=m.fetchPointerofObject(0,f);if(!m.isWords(h))return m.primitiveFail();x=a(h);y=h.words;h=m.fetchPointerofObject(1,f);if(!m.isWords(h)||x!==a(h))return m.primitiveFail();B=h.words;h=m.fetchPointerofObject(0,g);if(!m.isWords(h))return m.primitiveFail();w=a(h);f=h.words;h=m.fetchPointerofObject(1,g);if(!m.isWords(h)||w!==a(h))return m.primitiveFail();n=h.words;d(0,0);for(D=0;t<u&&la+4<L;)if(r=
C[t],h=k[t],++t,0===h){++D;if(!(r<x))return m.primitiveFail();d(y[r],B[r])}else{D=D+r+3;if(!(256>r))return m.primitiveFail();g=xa[r];if(!(g<x))return m.primitiveFail();d(y[g],B[g]);p=N[g-257];0!==p&&(r-=l[g-257],d(p,r));--h;if(!(32768>h))return m.primitiveFail();g=256>h?H[h]:H[256+(h>>>7)];if(!(g<w))return m.primitiveFail();d(f[g],n[g]);p=v[g];0!==p&&(h-=A[g],d(p,h))}if(m.failed())return null;m.storeIntegerofObjectwithValue(1,c,t);m.storeIntegerofObjectwithValue(1,e,t);return D}function B(){var a;
if(Q===U)return!0;if(0!==(Q&4095)||10*T<=Q)return!1;a=Q-T;return a<=T?!1:4*a<=T}function y(a,b){var c,d;c=a[0]>>>24;if(16<c)return m.primitiveFail(),0;for(d=2;;){c=r(c);d=d+c-1;if(d>=b){m.primitiveFail();break}c=a[d];if(0===(c&1056964608))return c;d=c&65535;c=c>>>24&255;if(16<c){m.primitiveFail();break}}return 0}function r(a){for(var b;x<a;)b=La[++Ma],t+=31<x?0:b<<x,x+=8;b=t&(31<a?0:1<<a)-1;t=31<a?0:t>>>a;x-=a;return b}var m=null,h=0,u=0,A=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,
1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],l=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],t=0,x=0,F=0,w=null,L=0,J=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,
997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,
3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,
3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,
2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,
2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],E=null,I=0,H=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,
10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],C=null,D=null,v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,
0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=null,M=null,O=0,X=null,W=0,Q=0,oa=null,U=0,Z=null,T=0,xa=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,
279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,
284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],la=0,wa=0,La=null,ea=0,Ma=0,Wa=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:function(){var b,c,d,e,g;if(4!==m.methodArgumentCount())return m.primitiveFail();c=m.stackObjectValue(0);e=m.stackObjectValue(1);b=m.stackObjectValue(2);d=m.stackObjectValue(3);g=m.stackObjectValue(4);if(m.failed())return null;if(!(f(g)&&m.isPointers(c)&&2<=a(c)&&m.isPointers(e)&&
2<=a(e)&&m.isPointers(d)&&3<=a(d)&&m.isPointers(b)&&3<=a(b)))return m.primitiveFail();b=p(d,b,e,c);m.failed()||(m.storeIntegerofObjectwithValue(1,g,la),m.storeIntegerofObjectwithValue(h+1,g,t),m.storeIntegerofObjectwithValue(h+2,g,x));m.failed()||(m.pop(5),m.pushInteger(b))},primitiveUpdateAdler32:function(){var a,c,d,e,f,g;if(4!==m.methodArgumentCount())return m.primitiveFail();d=m.stackObjectValue(0);g=m.stackIntegerValue(1);e=m.stackIntegerValue(2);a=m.positive32BitValueOf(m.stackValue(3));if(m.failed())return 0;
if(!(m.isBytes(d)&&g>=e&&0<e))return m.primitiveFail();f=b(d);if(!(g<=f))return m.primitiveFail();d=d.bytes;--e;--g;f=a&65535;for(a=a>>>16&65535;e<=g;e++)c=d[e],f+=c,f=f-65521*(Math.floor(f/65521)|0)|0,a+=f,a=a-65521*(Math.floor(a/65521)|0)|0;m.popthenPush(5,m.positive32BitIntegerFor((a<<16)+f))},primitiveUpdateGZipCrc32:function(){var a,c,d,e,f;if(4!==m.methodArgumentCount())return m.primitiveFail();a=m.stackObjectValue(0);f=m.stackIntegerValue(1);d=m.stackIntegerValue(2);c=m.positive32BitValueOf(m.stackValue(3));
if(m.failed())return 0;if(!(m.isBytes(a)&&f>=d&&0<d))return m.primitiveFail();e=b(a);if(!(f<=e))return m.primitiveFail();a=a.bytes;--d;for(--f;d<=f;d++)c=J[(c^a[d])&255]^c>>>8;m.popthenPush(5,m.positive32BitIntegerFor(c))},primitiveDeflateUpdateHashTable:function(){var b,c,d,e,f;if(2!==m.methodArgumentCount())return m.primitiveFail();b=m.stackIntegerValue(0);c=m.stackObjectValue(1);if(m.failed())return null;if(!m.isWords(c))return m.primitiveFail();f=a(c);e=c.wordsAsInt32Array();for(d=0;d<=f-1;d++)c=
e[d],e[d]=c>=b?c-b:0;m.pop(2)},setInterpreter:function(a){m=a;a=1==m.majorVersion();return!1===a?!1:a=11<=m.minorVersion()},getModuleName:function(){return"ZipPlugin 3 November 2014 (e)"},primitiveDeflateBlock:function(){var a,b,c,d;if(3!==m.methodArgumentCount())return m.primitiveFail();b=m.stackIntegerValue(0);a=m.stackIntegerValue(1);c=m.stackIntegerValue(2);d=m.stackObjectValue(3);if(m.failed())return null;if(!k(d))return m.primitiveFail();a:{var f,h,l,n,p,r,x;if(F>c)a=!1;else if(Q>=U)a=!0;else{h=
!1;for(l=F;l<=c;){h||(f=e(l,2,l,a,b),g(l),p=f&65535,n=f>>>16);f=e(l+1,n,p,a,b);x=f&65535;r=f>>>16;if(n>=r&&3<=n){h=n;x=l-p;Z[Q]=h-3;D[Q]=x;oa[xa[h-3]]++;C[257>x?H[x-1]:H[256+(x-1>>>7)]]++;++Q;++T;f=Q===U||0===(Q&4095)&&B();for(h=1;h<=n-1;h++)g(++l);h=!1;++l}else f=w[l],Z[Q]=f,D[Q]=0,oa[f]++,++Q,f=Q===U||0===(Q&4095)&&B(),++l,l<=c&&!f&&(g(l),h=!0,p=x,n=r);if(f){F=l;a=!0;break a}}F=l;a=!1}}m.failed()||(m.storeIntegerofObjectwithValue(u+2,d,O),m.storeIntegerofObjectwithValue(u+3,d,F),m.storeIntegerofObjectwithValue(u+
9,d,Q),m.storeIntegerofObjectwithValue(u+10,d,T));m.failed()||(m.pop(4),m.pushBool(a))},primitiveInflateDecompressBlock:function(){var c,d;if(2!==m.methodArgumentCount())return m.primitiveFail();c=m.stackValue(0);if(!m.isWords(c))return m.primitiveFail();E=c.words;I=a(c);c=m.stackValue(1);if(!m.isWords(c))return m.primitiveFail();X=c.words;W=a(c);d=m.stackValue(2);if(!m.isPointers(d))return m.primitiveFail();if(0===h){for(c=n(d);!c.isNil&&13<=c.classInstSize();)c=c.superclass();c.isNil?c=!1:(h=c.classInstSize(),
c=!0);if(!c)return m.primitiveFail();if(a(d)<h+8)return h=0,m.primitiveFail()}if(a(d)<h+8)return m.primitiveFail();wa=m.fetchIntegerofObject(2,d);Wa=m.fetchIntegerofObject(h+0,d);t=m.fetchIntegerofObject(h+1,d);x=m.fetchIntegerofObject(h+2,d);Ma=m.fetchIntegerofObject(h+4,d);ea=m.fetchIntegerofObject(h+5,d);if(m.failed())return null;--wa;--Ma;--ea;c=m.fetchPointerofObject(0,d);if(!m.isBytes(c))return m.primitiveFail();w=c.bytes;L=b(c);c=m.fetchPointerofObject(h+3,d);if(!m.isBytes(c))return m.primitiveFail();
La=c.bytes;a:{var e,f,g,k,l,p;for(g=L-1;wa<g&&Ma<=ea;)if(l=t,k=x,p=Ma,e=y(X,W),256>e)w[++wa]=e;else{if(256===e){Wa&=1;break a}f=(e>>>16)-1;c=e&65535;0<f&&(c+=r(f));e=y(E,I);f=e>>>16;e&=65535;0<f&&(e+=r(f));if(wa+c>=g){t=l;x=k;Ma=p;break a}f=wa;k=wa-e;for(e=1;e<=c;e++)w[f+e]=w[k+e];wa+=c}}m.failed()||(m.storeIntegerofObjectwithValue(2,d,wa+1),m.storeIntegerofObjectwithValue(h+0,d,Wa),m.storeIntegerofObjectwithValue(h+1,d,t),m.storeIntegerofObjectwithValue(h+2,d,x),m.storeIntegerofObjectwithValue(h+
4,d,Ma+1),m.pop(2))}})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(n){if(null==n)return"";var a="",b,c,e,g,k,f,d=0;for(n=LZString.compress(n);d<2*n.length;)0==d%2?(b=n.charCodeAt(d/2)>>8,c=n.charCodeAt(d/2)&255,e=d/2+1<n.length?n.charCodeAt(d/2+1)>>8:NaN):(b=n.charCodeAt((d-1)/2)&255,(d+1)/2<n.length?(c=n.charCodeAt((d+1)/2)>>8,e=n.charCodeAt((d+1)/2)&255):c=e=NaN),d+=3,g=b>>2,b=(b&3)<<4|c>>4,k=(c&15)<<2|e>>6,f=e&63,isNaN(c)?
k=f=64:isNaN(e)&&(f=64),a=a+LZString._keyStr.charAt(g)+LZString._keyStr.charAt(b)+LZString._keyStr.charAt(k)+LZString._keyStr.charAt(f);return a},decompressFromBase64:function(n){if(null==n)return"";var a="",b=0,c,e,g,k,f,d,p=0,B=LZString._f;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<n.length;)e=LZString._keyStr.indexOf(n.charAt(p++)),g=LZString._keyStr.indexOf(n.charAt(p++)),f=LZString._keyStr.indexOf(n.charAt(p++)),d=LZString._keyStr.indexOf(n.charAt(p++)),e=e<<2|g>>4,g=(g&15)<<4|f>>2,k=(f&3)<<
6|d,0==b%2?(c=e<<8,64!=f&&(a+=B(c|g)),64!=d&&(c=k<<8)):(a+=B(c|e),64!=f&&(c=g<<8),64!=d&&(a+=B(c|k))),b+=3;return LZString.decompress(a)},compressToUTF16:function(n){if(null==n)return"";var a="",b,c,e,g=0,k=LZString._f;n=LZString.compress(n);for(b=0;b<n.length;b++)switch(c=n.charCodeAt(b),g++){case 0:a+=k((c>>1)+32);e=(c&1)<<14;break;case 1:a+=k(e+(c>>2)+32);e=(c&3)<<13;break;case 2:a+=k(e+(c>>3)+32);e=(c&7)<<12;break;case 3:a+=k(e+(c>>4)+32);e=(c&15)<<11;break;case 4:a+=k(e+(c>>5)+32);e=(c&31)<<
10;break;case 5:a+=k(e+(c>>6)+32);e=(c&63)<<9;break;case 6:a+=k(e+(c>>7)+32);e=(c&127)<<8;break;case 7:a+=k(e+(c>>8)+32);e=(c&255)<<7;break;case 8:a+=k(e+(c>>9)+32);e=(c&511)<<6;break;case 9:a+=k(e+(c>>10)+32);e=(c&1023)<<5;break;case 10:a+=k(e+(c>>11)+32);e=(c&2047)<<4;break;case 11:a+=k(e+(c>>12)+32);e=(c&4095)<<3;break;case 12:a+=k(e+(c>>13)+32);e=(c&8191)<<2;break;case 13:a+=k(e+(c>>14)+32);e=(c&16383)<<1;break;case 14:a+=k(e+(c>>15)+32,(c&32767)+32),g=0}return a+k(e+32)},decompressFromUTF16:function(n){if(null==
n)return"";for(var a="",b,c,e=0,g=0,k=LZString._f;g<n.length;){c=n.charCodeAt(g)-32;switch(e++){case 0:b=c<<1;break;case 1:a+=k(b|c>>14);b=(c&16383)<<2;break;case 2:a+=k(b|c>>13);b=(c&8191)<<3;break;case 3:a+=k(b|c>>12);b=(c&4095)<<4;break;case 4:a+=k(b|c>>11);b=(c&2047)<<5;break;case 5:a+=k(b|c>>10);b=(c&1023)<<6;break;case 6:a+=k(b|c>>9);b=(c&511)<<7;break;case 7:a+=k(b|c>>8);b=(c&255)<<8;break;case 8:a+=k(b|c>>7);b=(c&127)<<9;break;case 9:a+=k(b|c>>6);b=(c&63)<<10;break;case 10:a+=k(b|c>>5);b=
(c&31)<<11;break;case 11:a+=k(b|c>>4);b=(c&15)<<12;break;case 12:a+=k(b|c>>3);b=(c&7)<<13;break;case 13:a+=k(b|c>>2);b=(c&3)<<14;break;case 14:a+=k(b|c>>1);b=(c&1)<<15;break;case 15:a+=k(b|c),e=0}g++}return LZString.decompress(a)},compress:function(n){if(null==n)return"";var a,b,c={},e={},g,k,f="",d=2,p=3,B=2,y="",r=0,m=0,h,u=LZString._f;for(h=0;h<n.length;h+=1)if(g=n.charAt(h),Object.prototype.hasOwnProperty.call(c,g)||(c[g]=p++,e[g]=!0),k=f+g,Object.prototype.hasOwnProperty.call(c,k))f=k;else{if(Object.prototype.hasOwnProperty.call(e,
f)){if(256>f.charCodeAt(0)){for(a=0;a<B;a++)r<<=1,15==m?(m=0,y+=u(r),r=0):m++;b=f.charCodeAt(0);for(a=0;8>a;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1}else{b=1;for(a=0;a<B;a++)r=r<<1|b,15==m?(m=0,y+=u(r),r=0):m++,b=0;b=f.charCodeAt(0);for(a=0;16>a;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1}d--;0==d&&(d=Math.pow(2,B),B++);delete e[f]}else for(b=c[f],a=0;a<B;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1;d--;0==d&&(d=Math.pow(2,B),B++);c[k]=p++;f=String(g)}if(""!==f){if(Object.prototype.hasOwnProperty.call(e,
f)){if(256>f.charCodeAt(0)){for(a=0;a<B;a++)r<<=1,15==m?(m=0,y+=u(r),r=0):m++;b=f.charCodeAt(0);for(a=0;8>a;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1}else{b=1;for(a=0;a<B;a++)r=r<<1|b,15==m?(m=0,y+=u(r),r=0):m++,b=0;b=f.charCodeAt(0);for(a=0;16>a;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1}d--;0==d&&(d=Math.pow(2,B),B++);delete e[f]}else for(b=c[f],a=0;a<B;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1;d--;0==d&&B++}b=2;for(a=0;a<B;a++)r=r<<1|b&1,15==m?(m=0,y+=u(r),r=0):m++,b>>=1;for(;;)if(r<<=
1,15==m){y+=u(r);break}else m++;return y},decompress:function(n){if(null==n)return"";if(""==n)return null;var a=[],b=4,c=4,e=3,g,k,f,d,p,B,y,r=LZString._f,m=n.charCodeAt(0),h=32768,u=1;for(k=0;3>k;k+=1)a[k]=k;d=0;B=Math.pow(2,2);for(y=1;y!=B;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;switch(d){case 0:d=0;B=Math.pow(2,8);for(y=1;y!=B;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;g=r(d);break;case 1:d=0;B=Math.pow(2,16);for(y=1;y!=B;)p=m&h,h>>=1,0==
h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;g=r(d);break;case 2:return""}for(f=k=a[3]=g;;){if(u>n.length)return"";d=0;B=Math.pow(2,e);for(y=1;y!=B;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;switch(g=d){case 0:d=0;B=Math.pow(2,8);for(y=1;y!=B;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;a[c++]=r(d);g=c-1;b--;break;case 1:d=0;B=Math.pow(2,16);for(y=1;y!=B;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(u++)),d|=(0<p?1:0)*y,y<<=1;a[c++]=r(d);g=
c-1;b--;break;case 2:return k}0==b&&(b=Math.pow(2,e),e++);if(a[g])g=a[g];else if(g===c)g=f+f.charAt(0);else return null;k+=g;a[c++]=f+g.charAt(0);b--;f=g;0==b&&(b=Math.pow(2,e),e++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define([],n):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).JSZip=n()})(function(){return function a(b,c,e){function g(d,f){if(!c[d]){if(!b[d]){var B="function"==typeof require&&require;if(!f&&B)return B(d,!0);if(k)return k(d,!0);B=Error("Cannot find module '"+d+"'");throw B.code="MODULE_NOT_FOUND",B;}B=c[d]={exports:{}};
b[d][0].call(B.exports,function(a){var c=b[d][1][a];return g(c?c:a)},B,B.exports,a,b,c,e)}return c[d].exports}for(var k="function"==typeof require&&require,f=0;f<e.length;f++)g(e[f]);return g}({1:[function(a,b,c){var e=a("./utils"),g=a("./support");c.encode=function(a){for(var b=[],c,g,B,y,r=0,m=a.length,h,u="string"!==e.getTypeOf(a);r<a.length;)h=m-r,u?(c=a[r++],g=r<m?a[r++]:0,B=r<m?a[r++]:0):(c=a.charCodeAt(r++),g=r<m?a.charCodeAt(r++):0,B=r<m?a.charCodeAt(r++):0),y=c>>2,c=(c&3)<<4|g>>4,g=1<h?(g&
15)<<2|B>>6:64,B=2<h?B&63:64,b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(y)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(B));return b.join("")};c.decode=function(a){var b,c,e,B,y,r=0,m=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");B=3*a.length/4;"="===a.charAt(a.length-1)&&B--;"="===
a.charAt(a.length-2)&&B--;var h;for(h=g.uint8array?new Uint8Array(B):Array(B);r<a.length;)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(r++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(r++)),B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(r++)),y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(r++)),b=b<<2|c>>4,c=(c&15)<<4|B>>2,e=(B&3)<<6|
y,h[m++]=b,64!==B&&(h[m++]=c),64!==y&&(h[m++]=e);return h}},{"./support":27,"./utils":29}],2:[function(a,b,c){function e(a,b,c,d,e){this.compressedSize=a;this.uncompressedSize=b;this.crc32=c;this.compression=d;this.compressedContent=e}var g=a("./external"),k=a("./stream/DataWorker"),f=a("./stream/DataLengthProbe"),d=a("./stream/Crc32Probe"),f=a("./stream/DataLengthProbe");e.prototype={getContentWorker:function(){var a=(new k(g.Promise.resolve(this.compressedContent))).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),
b=this;a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw Error("Bug : uncompressed data size mismatch");});return a},getCompressedWorker:function(){return(new k(g.Promise.resolve(this.compressedContent))).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};e.createWorkerFrom=function(a,b,c){return a.pipe(new d).pipe(new f("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new f("compressedSize")).withStreamInfo("compression",
b)};b.exports=e},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(a,b,c){var e=a("./stream/GenericWorker");c.STORE={magic:"\x00\x00",compressWorker:function(a){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}};c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(a,b,c){var e=a("./utils"),g=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var e=0;8>e;e++)a=a&1?3988292384^
a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b){if("undefined"===typeof a||!a.length)return 0;if("string"!==e.getTypeOf(a)){var c,p=0+a.length;c=(b|0)^-1;for(var B=0;B<p;B++)c=c>>>8^g[(c^a[B])&255];return c^-1}p=0+a.length;c=(b|0)^-1;for(B=0;B<p;B++)c=c>>>8^g[(c^a.charCodeAt(B))&255];return c^-1}},{"./utils":29}],5:[function(a,b,c){c.base64=!1;c.binary=!1;c.dir=!1;c.createFolders=!0;c.date=null;c.compression=null;c.compressionOptions=null;c.comment=null;c.unixPermissions=null;c.dosPermissions=
null},{}],6:[function(a,b,c){a=a("es6-promise").Promise;b.exports={Promise:a}},{"es6-promise":37}],7:[function(a,b,c){function e(a,b){f.call(this,"FlateWorker/"+a);this._pako=new g[a]({raw:!0,level:b.level||-1});this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}b="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;var g=a("pako"),k=a("./utils"),f=a("./stream/GenericWorker"),d=b?"uint8array":"array";c.magic="\b\x00";
k.inherits(e,f);e.prototype.processChunk=function(a){this.meta=a.meta;this._pako.push(k.transformTo(d,a.data),!1)};e.prototype.flush=function(){f.prototype.flush.call(this);this._pako.push([],!0)};e.prototype.cleanUp=function(){f.prototype.cleanUp.call(this);this._pako=null};c.compressWorker=function(a){return new e("Deflate",a)};c.uncompressWorker=function(){return new e("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(a,b,c){function e(a,b,c,d){k.call(this,"ZipFileWorker");
this.bytesWritten=0;this.zipComment=b;this.zipPlatform=c;this.encodeFileName=d;this.streamFiles=a;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.entriesCount=this.currentSourceOffset=0;this.currentFile=null;this._sources=[]}var g=a("../utils"),k=a("../stream/GenericWorker"),f=a("../utf8"),d=a("../crc32"),p=a("../signature"),B=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a>>>=8;return c},y=function(a,b,c,e,l,k){var r=a.file,y=a.compression,w=k!==f.utf8encode,
L=g.transformTo("string",k(r.name)),J=g.transformTo("string",f.utf8encode(r.name)),E=r.comment;k=g.transformTo("string",k(E));var I=g.transformTo("string",f.utf8encode(E)),H=J.length!==r.name.length,C=I.length!==E.length,D,E="";D=r.dir;var v=r.date,N=0,P=0,M=0;if(!b||c)N=a.crc32,P=a.compressedSize,M=a.uncompressedSize;a=0;b&&(a|=8);w||!H&&!C||(a|=2048);b=0;D&&(b|=16);"UNIX"===l?(l=798,(w=r=r.unixPermissions)||(w=D?16893:33204),b|=(w&65535)<<16):(l=20,b|=(r.dosPermissions||0)&63);r=v.getUTCHours();
r=r<<6|v.getUTCMinutes();r=r<<5|v.getUTCSeconds()/2;D=v.getUTCFullYear()-1980;D=D<<4|v.getUTCMonth()+1;D=D<<5|v.getUTCDate();H&&(J=B(1,1)+B(d(L),4)+J,E+="up"+B(J.length,2)+J);C&&(J=B(1,1)+B(d(k),4)+I,E+="uc"+B(J.length,2)+J);J="\n\x00"+B(a,2);J+=y.magic;J+=B(r,2);J+=B(D,2);J+=B(N,4);J+=B(P,4);J+=B(M,4);J+=B(L.length,2);J+=B(E.length,2);y=p.LOCAL_FILE_HEADER+J+L+E;e=p.CENTRAL_FILE_HEADER+B(l,2)+J+B(k.length,2)+"\x00\x00\x00\x00"+B(b,4)+B(e,4)+L+E+k;return{fileRecord:y,dirRecord:e}},r=function(a){return p.DATA_DESCRIPTOR+
B(a.crc32,4)+B(a.compressedSize,4)+B(a.uncompressedSize,4)};g.inherits(e,k);e.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,k.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))};e.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten;this.currentFile=a.file.name;this.streamFiles&&!a.file.dir?(a=
y(a,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:a.fileRecord,meta:{percent:0}})):this.accumulate=!0};e.prototype.closedSource=function(a){this.accumulate=!1;var b=y(a,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(b.dirRecord);if(this.streamFiles&&!a.file.dir)this.push({data:r(a),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());
this.currentFile=null};e.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var b=this.dirRecords.length,c=this.bytesWritten-a,d=g.transformTo("string",(0,this.encodeFileName)(this.zipComment)),a=p.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+B(b,2)+B(b,2)+B(c,4)+B(a,4)+B(d.length,2)+d;this.push({data:a,meta:{percent:100}})};e.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);
this.isPaused?this.previous.pause():this.previous.resume()};e.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.closedSource(b.previous.streamInfo);b._sources.length?b.prepareNextSource():b.end()});a.on("error",function(a){b.error(a)});return this};e.prototype.resume=function(){if(!k.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&
!this._sources.length&&!this.generatedError)return this.end(),!0};e.prototype.error=function(a){var b=this._sources;if(!k.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(d){}return!0};e.prototype.lock=function(){k.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()};b.exports=e},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(a,b,c){var e=a("../compressions"),g=a("./ZipFileWorker");
c.generateWorker=function(a,b,c){var p=new g(b.streamFiles,c,b.platform,b.encodeFileName),B=0;try{a.forEach(function(a,c){B++;var d=c.options.compression||b.compression,g=e[d];if(!g)throw Error(d+" is not a valid compression method !");var d=c.dir,k=c.date;c._compressWorker(g,c.options.compressionOptions||b.compressionOptions||{}).withStreamInfo("file",{name:a,dir:d,date:k,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(p)}),p.entriesCount=B}catch(y){p.error(y)}return p}},
{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var a=new e,b;for(b in this)"function"!==typeof this[b]&&(a[b]=this[b]);return a}}e.prototype=a("./object");e.prototype.loadAsync=a("./load");e.support=a("./support");e.defaults=a("./defaults");
e.loadAsync=function(a,b){return(new e).loadAsync(a,b)};e.external=a("./external");b.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(a,b,c){function e(a){return new k.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new p);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var g=a("./utils"),k=a("./external"),f=a("./utf8"),g=a("./utils"),
d=a("./zipEntries"),p=a("./stream/Crc32Probe"),B=a("./nodejsUtils");b.exports=function(a,b){var c=this;b=g.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode});return B.isNode&&B.isStream(a)?k.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):g.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new d(b);c.load(a);return c}).then(function(a){var c=[k.Promise.resolve(a)];
a=a.files;if(b.checkCRC32)for(var d=0;d<a.length;d++)c.push(e(a[d]));return k.Promise.all(c)}).then(function(a){a=a.shift();for(var d=a.files,e=0;e<d.length;e++){var f=d[e];c.file(f.fileNameStr,f.decompressed,{binary:!0,optimizedBinaryString:!0,date:f.date,dir:f.dir,comment:f.fileCommentStr.length?f.fileCommentStr:null,unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions,createFolders:b.createFolders})}a.zipComment.length&&(c.comment=a.zipComment);return c})}},{"./external":6,"./nodejsUtils":12,
"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(a,b,c){(function(a){b.exports={isNode:"undefined"!==typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"===typeof a.on&&"function"===typeof a.pause&&"function"===typeof a.resume}}}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{}],13:[function(a,b,c){var e=a("./utf8"),g=a("./utils"),k=a("./stream/GenericWorker"),f=a("./stream/StreamHelper"),
d=a("./defaults"),p=a("./compressedObject"),B=a("./zipObject"),y=a("./generate"),r=a("./nodejsUtils"),m=a("./nodejs/NodejsStreamInputAdapter"),h=function(a,b,c){var e=g.getTypeOf(b),f;c=g.extend(c||{},d);c.date=c.date||new Date;null!==c.compression&&(c.compression=c.compression.toUpperCase());"string"===typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8));c.unixPermissions&&c.unixPermissions&16384&&(c.dir=!0);c.dosPermissions&&c.dosPermissions&16&&(c.dir=!0);c.dir&&(a=u(a));
var h;if(h=c.createFolders)f=a,"/"===f.slice(-1)&&(f=f.substring(0,f.length-1)),h=f.lastIndexOf("/"),h=f=0<h?f.substring(0,h):"";h&&A.call(this,f,!0);c.binary=!("string"===e&&!1===c.binary&&!1===c.base64);if(b instanceof p&&0===b.uncompressedSize||c.dir||!b||0===b.length)c.base64=!1,c.binary=!0,b="",c.compression="STORE";b=b instanceof p||b instanceof k?b:r.isNode&&r.isStream(b)?new m(a,b):g.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);c=new B(a,b,c);this.files[a]=c},u=function(a){"/"!==
a.slice(-1)&&(a+="/");return a},A=function(a,b){b="undefined"!==typeof b?b:d.createFolders;a=u(a);this.files[a]||h.call(this,a,null,{dir:!0,createFolders:b});return this.files[a]};b.exports={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],(c=b.slice(this.root.length,b.length))&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=
[];this.forEach(function(c,d){a(c,d)&&b.push(d)});return b},file:function(a,b,c){if(1===arguments.length){if("[object RegExp]"===Object.prototype.toString.call(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}var e=this.files[this.root+a];return e&&!e.dir?e:null}a=this.root+a;h.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if("[object RegExp]"===Object.prototype.toString.call(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=A.call(this,
this.root+a),c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]);if(b&&!b.dir)delete this.files[a];else for(var b=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),c=0;c<b.length;c++)delete this.files[b[c].name];return this},generate:function(a){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},generateInternalStream:function(a){var b,c={};try{c=g.extend(a||
{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode});c.type=c.type.toLowerCase();c.compression=c.compression.toUpperCase();"binarystring"===c.type&&(c.type="string");if(!c.type)throw Error("No output type specified.");g.checkSupport(c.type);if("darwin"===a.platform||"freebsd"===a.platform||"linux"===a.platform||"sunos"===a.platform)a.platform="UNIX";"win32"===a.platform&&(a.platform="DOS");b=y.generateWorker(this,
c,c.comment||this.comment||"")}catch(d){b=new k("error"),b.error(d)}return new f(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){a=a||{};a.type||(a.type="nodebuffer");return this.generateInternalStream(a).toNodejsStream(b)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,
"./utils":29,"./zipObject":32}],14:[function(a,b,c){function e(a){g.call(this,a);for(var b=0;b<this.data.length;b++)a[b]&=255}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data[this.zero+a]};e.prototype.lastIndexOfSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);for(var g=this.length-4;0<=g;--g)if(this.data[g]===b&&this.data[g+1]===c&&this.data[g+2]===e&&this.data[g+3]===a)return g-this.zero;return-1};
e.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);var g=this.readData(4);return b===g[0]&&c===g[1]&&e===g[2]&&a===g[3]};e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],15:[function(a,b,c){function e(a){this.data=a;this.length=a.length;this.zero=this.index=0}var g=a("../utils");
e.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||0>a)throw Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?");},setIndex:function(a){this.checkIndex(a);this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b=0,c;this.checkOffset(a);for(c=this.index+a-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);this.index+=a;return b},readString:function(a){return g.transformTo("string",
this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}};b.exports=e},{"../utils":29}],16:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./Uint8ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+
a);this.index+=a;return b};b.exports=e},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)};e.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero};e.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b};e.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+
this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],18:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./ArrayReader":14}],19:[function(a,b,c){var e=a("../utils"),g=a("../support"),k=a("./ArrayReader"),
f=a("./StringReader"),d=a("./NodeBufferReader"),p=a("./Uint8ArrayReader");b.exports=function(a){var b=e.getTypeOf(a);e.checkSupport(b);return"string"!==b||g.uint8array?"nodebuffer"===b?new d(a):g.uint8array?new p(e.transformTo("uint8array",a)):new k(e.transformTo("array",a)):new f(a)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(a,b,c){c.LOCAL_FILE_HEADER="PK\u0003\u0004";c.CENTRAL_FILE_HEADER="PK\u0001\u0002";
c.CENTRAL_DIRECTORY_END="PK\u0005\u0006";c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";c.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";c.DATA_DESCRIPTOR="PK\u0007\b"},{}],21:[function(a,b,c){function e(a){g.call(this,"ConvertWorker to "+a);this.destType=a}var g=a("./GenericWorker"),k=a("../utils");k.inherits(e,g);e.prototype.processChunk=function(a){this.push({data:k.transformTo(this.destType,a.data),meta:a.meta})};b.exports=e},{"../utils":29,"./GenericWorker":25}],22:[function(a,b,c){function e(){g.call(this,
"Crc32Probe")}var g=a("./GenericWorker"),k=a("../crc32");a("../utils").inherits(e,g);e.prototype.processChunk=function(a){this.streamInfo.crc32=k(a.data,this.streamInfo.crc32||0);this.push(a)};b.exports=e},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(a,b,c){function e(a){g.call(this,"DataLengthProbe for "+a);this.propName=a;this.withStreamInfo(a,0)}c=a("../utils");var g=a("./GenericWorker");c.inherits(e,g);e.prototype.processChunk=function(a){a&&(this.streamInfo[this.propName]=
(this.streamInfo[this.propName]||0)+a.data.length);g.prototype.processChunk.call(this,a)};b.exports=e},{"../utils":29,"./GenericWorker":25}],24:[function(a,b,c){function e(a){k.call(this,"DataWorker");var b=this;this.dataIsReady=!1;this.max=this.index=0;this.data=null;this.type="";this._tickScheduled=!1;a.then(function(a){b.dataIsReady=!0;b.data=a;b.max=a&&a.length||0;b.type=g.getTypeOf(a);b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var g=a("../utils"),k=a("./GenericWorker");g.inherits(e,
k);e.prototype.cleanUp=function(){k.prototype.cleanUp.call(this);this.data=null};e.prototype.resume=function(){if(!k.prototype.resume.call(this))return!1;!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,g.delay(this._tickAndRepeat,[],this));return!0};e.prototype._tickAndRepeat=function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),this.isFinished||(g.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))};e.prototype._tick=function(){if(this.isPaused||
this.isFinished)return!1;var a=null,b=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case "string":a=this.data.substring(this.index,b);break;case "uint8array":a=this.data.subarray(this.index,b);break;case "array":case "nodebuffer":a=this.data.slice(this.index,b)}this.index=b;return this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})};b.exports=e},{"../utils":29,"./GenericWorker":25}],25:[function(a,b,c){function e(a){this.name=a||
"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=!0;this.isLocked=this.isFinished=!1;this._listeners={data:[],end:[],error:[]};this.previous=null}e.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){if(this.isFinished)return!1;this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",
a),this.previous&&this.previous.error(a),this.cleanUp());return!0},on:function(a,b){this._listeners[a].push(b);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");
this.streamInfo=a.streamInfo;this.mergeStreamInfo();this.previous=a;var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.end()});a.on("error",function(a){b.error(a)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;this.generatedError&&(this.error(this.generatedError),a=!0);this.previous&&this.previous.resume();
return!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){this.extraStreamInfo[a]=b;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?
this.previous+" -> "+a:a}};b.exports=e},{}],26:[function(a,b,c){(function(c){function g(a,b){var d,f=0,g;for(d=g=0;d<b.length;d++)g+=b[d].length;switch(a){case "string":return b.join("");case "array":return Array.prototype.concat.apply([],b);case "uint8array":g=new Uint8Array(g);for(d=0;d<b.length;d++)g.set(b[d],f),f+=b[d].length;return g;case "nodebuffer":return c.concat(b);default:throw Error("concat : unsupported type '"+a+"'");}}function k(a,b){return new m.Promise(function(c,e){var f=[],m=a._internalType,
k=a._outputType,w=a._mimeType;a.on("data",function(a,c){f.push(a);b&&b(c)}).on("error",function(a){f=[];e(a)}).on("end",function(){try{var a;a:{var b=g(m,f);switch(k){case "blob":a=d.newBlob(d.transformTo("arraybuffer",b),w);break a;case "base64":a=y.encode(b);break a;default:a=d.transformTo(k,b)}}c(a)}catch(h){e(h)}f=[]}).resume()})}function f(a,b,c){var e=b;switch(b){case "blob":case "arraybuffer":e="uint8array";break;case "base64":e="string"}try{this._internalType=e,this._outputType=b,this._mimeType=
c,d.checkSupport(e),this._worker=a.pipe(new p(e)),a.lock()}catch(f){this._worker=new B("error"),this._worker.error(f)}}var d=a("../utils"),p=a("./ConvertWorker"),B=a("./GenericWorker"),y=a("../base64"),r=a("../nodejs/NodejsStreamOutputAdapter"),m=a("../external");f.prototype={accumulate:function(a){return k(this,a)},on:function(a,b){var c=this;if("data"===a)this._worker.on(a,function(a){b.call(c,a.data,a.meta)});else this._worker.on(a,function(){d.delay(b,arguments,c)});return this},resume:function(){d.delay(this._worker.resume,
[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(a){d.checkSupport("nodestream");if("nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new r(this,{objectMode:"nodebuffer"!==this._outputType},a)}};b.exports=f}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],
27:[function(a,b,c){b="undefined"!==typeof Buffer?Buffer:void 0;c.base64=!0;c.array=!0;c.string=!0;c.arraybuffer="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array;c.nodebuffer="undefined"!==typeof b;c.uint8array="undefined"!==typeof Uint8Array;if("undefined"===typeof ArrayBuffer)c.blob=!1;else{b=new ArrayBuffer(0);try{c.blob=0===(new Blob([b],{type:"application/zip"})).size}catch(g){try{var e=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
e.append(b);c.blob=0===e.getBlob("application/zip").size}catch(k){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(a,b,c){function e(){p.call(this,"utf-8 decode");this.leftOver=null}function g(){p.call(this,"utf-8 encode")}var k=a("./utils"),f=a("./support"),d=a("./nodejsUtils"),p=a("./stream/GenericWorker"),B=Array(256);for(a=0;256>a;a++)B[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;B[254]=B[254]=1;c.utf8encode=
function(a){if(f.nodebuffer)return d.newBuffer(a,"utf-8");var b,c,e,g,k,l=a.length,p=0;for(g=0;g<l;g++)c=a.charCodeAt(g),55296===(c&64512)&&g+1<l&&(e=a.charCodeAt(g+1),56320===(e&64512)&&(c=65536+(c-55296<<10)+(e-56320),g++)),p+=128>c?1:2048>c?2:65536>c?3:4;b=f.uint8array?new Uint8Array(p):Array(p);for(g=k=0;k<p;g++)c=a.charCodeAt(g),55296===(c&64512)&&g+1<l&&(e=a.charCodeAt(g+1),56320===(e&64512)&&(c=65536+(c-55296<<10)+(e-56320),g++)),128>c?b[k++]=c:(2048>c?b[k++]=192|c>>>6:(65536>c?b[k++]=224|
c>>>12:(b[k++]=240|c>>>18,b[k++]=128|c>>>12&63),b[k++]=128|c>>>6&63),b[k++]=128|c&63);return b};c.utf8decode=function(a){if(f.nodebuffer)return k.transformTo("nodebuffer",a).toString("utf-8");a=k.transformTo(f.uint8array?"uint8array":"array",a);var b,c,d,e,g=a.length,l=Array(2*g);for(b=c=0;b<g;)if(d=a[b++],128>d)l[c++]=d;else if(e=B[d],4<e)l[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;1<e&&b<g;)d=d<<6|a[b++]&63,e--;1<e?l[c++]=65533:65536>d?l[c++]=d:(d-=65536,l[c++]=55296|d>>10&1023,l[c++]=56320|
d&1023)}l.length!==c&&(l.subarray?l=l.subarray(0,c):l.length=c);return k.applyFromCharCode(l)};k.inherits(e,p);e.prototype.processChunk=function(a){var b=k.transformTo(f.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var d=b,b=new Uint8Array(d.length+this.leftOver.length);b.set(this.leftOver,0);b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e,d=b.length;d>b.length&&(d=b.length);for(e=d-1;0<=e&&128===(b[e]&192);)e--;
d=0>e?d:0===e?d:e+B[b[e]]>d?e:d;e=b;d!==b.length&&(f.uint8array?(e=b.subarray(0,d),this.leftOver=b.subarray(d,b.length)):(e=b.slice(0,d),this.leftOver=b.slice(d,b.length)));this.push({data:c.utf8decode(e),meta:a.meta})};e.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};c.Utf8DecodeWorker=e;k.inherits(g,p);g.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})};c.Utf8EncodeWorker=
g},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(a,b,c){function e(a){return a}function g(a,b){for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c)&255;return b}function k(a){var b=65536,d=c.getTypeOf(a),e=!0;"uint8array"===d?e=u.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=u.applyCanBeUsed.nodebuffer);if(e)for(;1<b;)try{return u.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return u.stringifyByChar(a)}function f(a,b){for(var c=0;c<a.length;c++)b[c]=
a[c];return b}var d=a("./support"),p=a("./base64"),B=a("./nodejsUtils"),y=a("asap"),r=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);e.append(a);return e.getBlob(b)}catch(f){throw Error("Bug : can't construct the Blob.");}}};var m;try{m=d.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(l){m=!1}a=m;var h;
try{h=d.nodebuffer&&1===String.fromCharCode.apply(null,B.newBuffer(1)).length}catch(l){h=!1}var u={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},
applyCanBeUsed:{uint8array:a,nodebuffer:h}};c.applyFromCharCode=k;var A={};A.string={string:e,array:function(a){return g(a,Array(a.length))},arraybuffer:function(a){return A.string.uint8array(a).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:function(a){return g(a,B.newBuffer(a.length))}};A.array={string:k,array:e,arraybuffer:function(a){return(new Uint8Array(a)).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return B.newBuffer(a)}};
A.arraybuffer={string:function(a){return k(new Uint8Array(a))},array:function(a){return f(new Uint8Array(a),Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return B.newBuffer(new Uint8Array(a))}};A.uint8array={string:k,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return B.newBuffer(a)}};A.nodebuffer={string:k,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return A.nodebuffer.uint8array(a).buffer},
uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:e};c.transformTo=function(a,b){b||(b="");if(!a)return b;c.checkSupport(a);var d=c.getTypeOf(b);return A[d][a](b)};c.getTypeOf=function(a){if("string"===typeof a)return"string";if("[object Array]"===Object.prototype.toString.call(a))return"array";if(d.nodebuffer&&B.isBuffer(a))return"nodebuffer";if(d.uint8array&&a instanceof Uint8Array)return"uint8array";if(d.arraybuffer&&a instanceof ArrayBuffer)return"arraybuffer"};c.checkSupport=
function(a){if(!d[a.toLowerCase()])throw Error(a+" is not supported by this platform");};c.MAX_VALUE_16BITS=65535;c.MAX_VALUE_32BITS=-1;c.pretty=function(a){var b="",c,d;for(d=0;d<(a||"").length;d++)c=a.charCodeAt(d),b+="\\x"+(16>c?"0":"")+c.toString(16).toUpperCase();return b};c.delay=function(a,b,c){y(function(){a.apply(c||null,b||[])})};c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c};c.extend=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&
"undefined"===typeof a[c]&&(a[c]=arguments[b][c]);return a};c.prepareContent=function(a,b,e,f,h){var k=null,k=d.blob&&b instanceof Blob&&"undefined"!==typeof FileReader?new r.Promise(function(a,c){var d=new FileReader;d.onload=function(b){a(b.target.result)};d.onerror=function(a){c(a.target.error)};d.readAsArrayBuffer(b)}):r.Promise.resolve(b);return k.then(function(b){var k=c.getTypeOf(b);if(!k)return r.Promise.reject(Error("The data of '"+a+"' is in an unsupported format !"));"arraybuffer"===k?
b=c.transformTo("uint8array",b):"string"===k&&(h?b=p.decode(b):e&&!0!==f&&(k=d.uint8array?new Uint8Array(b.length):Array(b.length),b=g(b,k)));return b})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(a,b,c){function e(a){this.files=[];this.loadOptions=a}var g=a("./reader/readerFor"),k=a("./utils"),f=a("./signature"),d=a("./zipEntry");a("./utf8");var p=a("./support");e.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=
4;var b=this.reader.readString(4);throw Error("Corrupted zip or bug : unexpected signature ("+k.pretty(b)+", expected "+k.pretty(a)+")");}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4)===b;this.reader.setIndex(c);return d},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);
this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),a=k.transformTo(p.uint8array?"uint8array":"array",a);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=
this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var a=this.zip64EndOfCentralSize-44,b,c,d;0<a;)b=this.reader.readInt(2),c=this.reader.readInt(4),d=this.reader.readData(c),this.zip64ExtensibleData[b]={id:b,length:c,value:d}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=
this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(1<this.disksCount)throw Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)a=
new d({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(0>a){if(this.isSignature(0,f.LOCAL_FILE_HEADER))throw Error("Corrupted zip : can't find end of central directory");
throw Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");}this.reader.setIndex(a);var b=a;this.checkSignature(f.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===k.MAX_VALUE_16BITS||this.diskWithCentralDirStart===k.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===k.MAX_VALUE_16BITS||this.centralDirRecords===k.MAX_VALUE_16BITS||this.centralDirSize===k.MAX_VALUE_32BITS||this.centralDirOffset===
k.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(0>a)throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),
0>this.relativeOffsetEndOfZip64CentralDir))throw Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a=a+20+(12+this.zip64EndOfCentralSize));a=b-a;if(0<a)this.isSignature(b,f.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(0>a)throw Error("Corrupted zip: missing "+Math.abs(a)+
" bytes.");},prepareReader:function(a){this.reader=g(a)},load:function(a){this.prepareReader(a);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};b.exports=e},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(a,b,c){function e(a,b){this.options=a;this.loadOptions=b}var g=a("./reader/readerFor"),k=a("./utils"),f=a("./compressedObject"),d=a("./crc32"),p=a("./utf8"),B=a("./compressions"),y=a("./support");e.prototype={isEncrypted:function(){return 1===
(this.bitFlag&1)},useUTF8:function(){return 2048===(this.bitFlag&2048)},readLocalPart:function(a){var b,c;a.skip(22);this.fileNameLength=a.readInt(2);c=a.readInt(2);this.fileName=a.readData(this.fileNameLength);a.skip(c);if(-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");a:{c=this.compressionMethod;for(b in B)if(B.hasOwnProperty(b)&&B[b].magic===c){b=
B[b];break a}b=null}if(null===b)throw Error("Corrupted zip : compression "+k.pretty(this.compressionMethod)+" unknown (inner file : "+k.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2);a.skip(2);this.bitFlag=a.readInt(2);this.compressionMethod=a.readString(2);this.date=a.readDate();this.crc32=a.readInt(4);this.compressedSize=a.readInt(4);
this.uncompressedSize=a.readInt(4);var b=a.readInt(2);this.extraFieldsLength=a.readInt(2);this.fileCommentLength=a.readInt(2);this.diskNumberStart=a.readInt(2);this.internalFileAttributes=a.readInt(2);this.externalFileAttributes=a.readInt(4);this.localHeaderOffset=a.readInt(4);if(this.isEncrypted())throw Error("Encrypted zip are not supported");a.skip(b);this.readExtraFields(a);this.parseZIP64ExtraField(a);this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.dosPermissions=
this.unixPermissions=null;var a=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1;0===a&&(this.dosPermissions=this.externalFileAttributes&63);3===a&&(this.unixPermissions=this.externalFileAttributes>>16&65535);this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){this.extraFields[1]&&(a=g(this.extraFields[1].value),this.uncompressedSize===k.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===k.MAX_VALUE_32BITS&&(this.compressedSize=
a.readInt(8)),this.localHeaderOffset===k.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===k.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4)))},readExtraFields:function(a){var b=a.index+this.extraFieldsLength,c,d,e;this.extraFields||(this.extraFields={});for(;a.index<b;)c=a.readInt(2),d=a.readInt(2),e=a.readData(d),this.extraFields[c]={id:c,length:d,value:e}},handleUTF8:function(){var a=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),
this.fileCommentStr=p.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();null!==b?this.fileNameStr=b:(b=k.transformTo(a,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(b));b=this.findExtraFieldUnicodeComment();null!==b?this.fileCommentStr=b:(a=k.transformTo(a,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(a))}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=g(a.value);return 1!==b.readInt(1)||d(this.fileName)!==
b.readInt(4)?null:p.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=g(a.value);return 1!==b.readInt(1)||d(this.fileComment)!==b.readInt(4)?null:p.utf8decode(b.readData(a.length-5))}return null}};b.exports=e},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(a,b,c){var e=a("./stream/StreamHelper"),g=a("./stream/DataWorker"),k=a("./utf8"),
f=a("./compressedObject"),d=a("./stream/GenericWorker");a=function(a,b,c){this.name=a;this.dir=c.dir;this.date=c.date;this.comment=c.comment;this.unixPermissions=c.unixPermissions;this.dosPermissions=c.dosPermissions;this._data=b;this._dataBinary=c.binary;this.options={compression:c.compression,compressionOptions:c.compressionOptions}};a.prototype={internalStream:function(a){a=a.toLowerCase();var b="string"===a||"text"===a;if("binarystring"===a||"text"===a)a="string";var c=this._decompressWorker(),
d=!this._dataBinary;d&&!b&&(c=c.pipe(new k.Utf8EncodeWorker));!d&&b&&(c=c.pipe(new k.Utf8DecodeWorker));return new e(c,a,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof f&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();this._dataBinary||(c=c.pipe(new k.Utf8EncodeWorker));return f.createWorkerFrom(c,
a,b)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof d?this._data:new g(this._data)}};c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];for(var p=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},B=0;B<c.length;B++)a.prototype[c[B]]=p;b.exports=a},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],
33:[function(a,b,c){function e(a){var b;b=f.length?f.pop():new g;b.task=a;k(b)}function g(){this.task=null}var k=a("./raw"),f=[],d=[],p=k.makeRequestCallFromTimer(function(){if(d.length)throw d.shift();});b.exports=e;g.prototype.call=function(){try{this.task.call()}catch(a){if(e.onerror)e.onerror(a);else d.push(a),p()}finally{this.task=null,f[f.length]=this}}},{"./raw":34}],34:[function(a,b,c){(function(a){function c(a){p.length||B();p[p.length]=a}function k(){for(;y<p.length;){var a=y;y+=1;p[a].call();
if(1024<y){for(var a=0,b=p.length-y;a<b;a++)p[a]=p[a+y];p.length-=y;y=0}}y=p.length=0}function f(a){var b=1;a=new r(a);var c=document.createTextNode("");a.observe(c,{characterData:!0});return function(){b=-b;c.data=b}}function d(a){return function(){function b(){clearTimeout(c);clearInterval(d);a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var p=[],B,y=0,r=a.MutationObserver||a.WebKitMutationObserver;B="function"===typeof r?f(k):d(k);c.requestFlush=B;c.makeRequestCallFromTimer=d}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],35:[function(a,b,c){},{}],36:[function(a,b,c){function e(){p=!1;B.length?d=B.concat(d):y=-1;d.length&&g()}function g(){if(!p){var a=setTimeout(e);p=!0;for(var b=d.length;b;){B=d;for(d=[];++y<b;)B&&B[y].run();y=-1;b=d.length}B=null;p=!1;clearTimeout(a)}}function k(a,b){this.fun=a;this.array=b}function f(){}a=b.exports={};var d=[],p=!1,B,y=-1;a.nextTick=function(a){var b=Array(arguments.length-
1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];d.push(new k(a,b));1!==d.length||p||setTimeout(g,0)};k.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=f;a.addListener=f;a.once=f;a.off=f;a.removeListener=f;a.removeAllListeners=f;a.emit=f;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");
};a.umask=function(){return 0}},{}],37:[function(a,b,c){(function(c,g){(function(){function k(a){return"function"===typeof a}function f(){return function(){c.nextTick(r)}}function d(){return function(){P(r)}}function p(){var a=0,b=new Q(r),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function B(){var a=new MessageChannel;a.port1.onmessage=r;return function(){a.port2.postMessage(0)}}function y(){return function(){setTimeout(r,1)}}function r(){for(var a=
0;a<N;a+=2)(0,U[a])(U[a+1]),U[a]=void 0,U[a+1]=void 0;N=0}function m(){try{var b=a("vertx");P=b.runOnLoop||b.runOnContext;return d()}catch(c){return y()}}function h(){}function u(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function A(a,b,c){O(function(a){var d=!1,e=u(c,b,function(c){d||(d=!0,b!==c?t(a,c):F(a,c))},function(b){d||(d=!0,w(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,w(a,e))},a)}function l(a,b){1===b._state?F(a,b._result):2===b._state?w(a,b._result):L(b,void 0,function(b){t(a,
b)},function(b){w(a,b)})}function t(a,b){if(a===b)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof b||"object"===typeof b&&null!==b)if(b.constructor===a.constructor)l(a,b);else{var c;try{c=b.then}catch(d){T.error=d,c=T}c===T?w(a,T.error):void 0===c?F(a,b):k(c)?A(a,b,c):F(a,b)}else F(a,b)}function x(a){a._onerror&&a._onerror(a._result);J(a)}function F(a,b){void 0===a._state&&(a._result=b,a._state=1,0!==a._subscribers.length&&O(J,a))}function w(a,b){void 0===
a._state&&(a._state=2,a._result=b,O(x,a))}function L(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null;e[f]=b;e[f+1]=c;e[f+2]=d;0===f&&a._state&&O(J,a)}function J(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?I(c,d,e,f):e(f);a._subscribers.length=0}}function E(){this.error=null}function I(a,b,c,d){var e=k(c),f,g,h,l;if(e){try{f=c(d)}catch(m){xa.error=m,f=xa}f===xa?(l=!0,g=f.error,f=null):h=!0;if(b===f){w(b,new TypeError("A promises callback cannot return that same promise."));
return}}else f=d,h=!0;void 0===b._state&&(e&&h?t(b,f):l?w(b,g):1===a?F(b,f):2===a&&w(b,f))}function H(a,b){try{b(function(b){t(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function C(a,b){this._instanceConstructor=a;this.promise=new a(h);this._validateInput(b)?(this._input=b,this._remaining=this.length=b.length,this._init(),0===this.length?F(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&F(this.promise,this._result))):w(this.promise,this._validationError())}
function D(a){this._id=la++;this._result=this._state=void 0;this._subscribers=[];if(h!==a){if(!k(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof D))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");H(this,a)}}var v=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},N=0,P,M,O=function(a,
b){U[N]=a;U[N+1]=b;N+=2;2===N&&(M?M(r):Z())},X="undefined"!==typeof window?window:void 0,W=X||{},Q=W.MutationObserver||W.WebKitMutationObserver,W="undefined"!==typeof c&&"[object process]"==={}.toString.call(c),oa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,U=Array(1E3),Z;Z=W?f():Q?p():oa?B():void 0===X&&"function"===typeof a?m():y();var T=new E,xa=new E;C.prototype._validateInput=function(a){return v(a)};C.prototype._validationError=
function(){return Error("Array Methods must be provided an Array")};C.prototype._init=function(){this._result=Array(this.length)};C.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;void 0===b._state&&d<a;d++)this._eachEntry(c[d],d)};C.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a._state?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,
this._result[b]=a)};C.prototype._settledAt=function(a,b,c){var d=this.promise;void 0===d._state&&(this._remaining--,2===a?w(d,c):this._result[b]=c);0===this._remaining&&F(d,this._result)};C.prototype._willSettleAt=function(a,b){var c=this;L(a,void 0,function(a){c._settledAt(1,b,a)},function(a){c._settledAt(2,b,a)})};var la=0;D.all=function(a){return(new C(this,a)).promise};D.race=function(a){function b(a){t(d,a)}function c(a){w(d,a)}var d=new this(h);if(!v(a))return w(d,new TypeError("You must pass an array to race.")),
d;for(var e=a.length,f=0;void 0===d._state&&f<e;f++)L(this.resolve(a[f]),void 0,b,c);return d};D.resolve=function(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(h);t(b,a);return b};D.reject=function(a){var b=new this(h);w(b,a);return b};D._setScheduler=function(a){M=a};D._setAsap=function(a){O=a};D._asap=O;D.prototype={constructor:D,then:function(a,b){var c=this._state;if(1===c&&!a||2===c&&!b)return this;var d=new this.constructor(h),e=this._result;if(c){var f=arguments[c-
1];O(function(){I(c,d,f,e)})}else L(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}};X=function(){var a;if("undefined"!==typeof g)a=g;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(b){throw Error("polyfill failed because global object is unavailable in this environment");}var c=a.Promise;if(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)a.Promise=D};W={Promise:D,polyfill:X};"undefined"!==typeof b&&b.exports?b.exports=
W:"undefined"!==typeof this&&(this.ES6Promise=W);X()}).call(this)}).call(this,a("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:36}],38:[function(a,b,c){c=a("./lib/utils/common").assign;var e=a("./lib/deflate"),g=a("./lib/inflate");a=a("./lib/zlib/constants");var k={};c(k,e,g,a);b.exports=k},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,b,c){function e(a){if(!(this instanceof
e))return new e(a);a=this.options=f.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new B;this.strm.avail_out=0;var b=k.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(0!==b)throw Error(p[b]);a.header&&k.deflateSetHeader(this.strm,a.header);if(a.dictionary){a=
"string"===typeof a.dictionary?d.string2buf(a.dictionary):"[object ArrayBuffer]"===y.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary;b=k.deflateSetDictionary(this.strm,a);if(0!==b)throw Error(p[b]);this._dict_set=!0}}function g(a,b){var c=new e(b);c.push(a,!0);if(c.err)throw c.msg;return c.result}var k=a("./zlib/deflate"),f=a("./utils/common"),d=a("./utils/strings"),p=a("./zlib/messages"),B=a("./zlib/zstream"),y=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,
e=this.options.chunkSize,g,l;if(this.ended)return!1;l=b===~~b?b:!0===b?4:0;"string"===typeof a?c.input=d.string2buf(a):"[object ArrayBuffer]"===y.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);g=k.deflate(c,l);if(1!==g&&0!==g)return this.onEnd(g),this.ended=!0,!1;if(0===c.avail_out||0===c.avail_in&&(4===l||2===l))if("string"===this.options.to)this.onData(d.buf2binstring(f.shrinkBuf(c.output,
c.next_out)));else this.onData(f.shrinkBuf(c.output,c.next_out))}while((0<c.avail_in||0===c.avail_out)&&1!==g);if(4===l)return g=k.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,0===g;2===l&&(this.onEnd(0),c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){0===a&&(this.result="string"===this.options.to?this.chunks.join(""):f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Deflate=e;c.deflate=g;c.deflateRaw=
function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.gzip=function(a,b){b=b||{};b.gzip=!0;return g(a,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,b,c){function e(a){if(!(this instanceof e))return new e(a);var b=this.options=f.assign({chunkSize:16384,windowBits:0,to:""},a||{});b.raw&&0<=b.windowBits&&16>b.windowBits&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15));!(0<=b.windowBits&&16>b.windowBits)||a&&a.windowBits||
(b.windowBits+=32);15<b.windowBits&&48>b.windowBits&&0===(b.windowBits&15)&&(b.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new y;this.strm.avail_out=0;a=k.inflateInit2(this.strm,b.windowBits);if(a!==p.Z_OK)throw Error(B[a]);this.header=new r;k.inflateGetHeader(this.strm,this.header)}function g(a,b){var c=new e(b);c.push(a,!0);if(c.err)throw c.msg;return c.result}var k=a("./zlib/inflate"),f=a("./utils/common"),d=a("./utils/strings"),p=a("./zlib/constants"),B=a("./zlib/messages"),
y=a("./zlib/zstream"),r=a("./zlib/gzheader"),m=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,e=this.options.chunkSize,g=this.options.dictionary,x,r,w,y,B,E=!1;if(this.ended)return!1;r=b===~~b?b:!0===b?p.Z_FINISH:p.Z_NO_FLUSH;"string"===typeof a?c.input=d.binstring2buf(a):"[object ArrayBuffer]"===m.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);x=k.inflate(c,p.Z_NO_FLUSH);
x===p.Z_NEED_DICT&&g&&(x="string"===typeof g?d.string2buf(g):"[object ArrayBuffer]"===m.call(g)?new Uint8Array(g):g,x=k.inflateSetDictionary(this.strm,x));x===p.Z_BUF_ERROR&&!0===E&&(x=p.Z_OK,E=!1);if(x!==p.Z_STREAM_END&&x!==p.Z_OK)return this.onEnd(x),this.ended=!0,!1;if(c.next_out&&(0===c.avail_out||x===p.Z_STREAM_END||0===c.avail_in&&(r===p.Z_FINISH||r===p.Z_SYNC_FLUSH)))if("string"===this.options.to)w=d.utf8border(c.output,c.next_out),y=c.next_out-w,B=d.buf2string(c.output,w),c.next_out=y,c.avail_out=
e-y,y&&f.arraySet(c.output,c.output,w,y,0),this.onData(B);else this.onData(f.shrinkBuf(c.output,c.next_out));0===c.avail_in&&0===c.avail_out&&(E=!0)}while((0<c.avail_in||0===c.avail_out)&&x!==p.Z_STREAM_END);x===p.Z_STREAM_END&&(r=p.Z_FINISH);if(r===p.Z_FINISH)return x=k.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===p.Z_OK;r===p.Z_SYNC_FLUSH&&(this.onEnd(p.Z_OK),c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){a===p.Z_OK&&(this.result=
"string"===this.options.to?this.chunks.join(""):f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Inflate=e;c.inflate=g;c.inflateRaw=function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(a,b,c){a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=
function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])}}return a};c.shrinkBuf=function(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var e={arraySet:function(a,b,c,e,g){if(b.subarray&&a.subarray)a.set(b.subarray(c,c+e),g);else for(var y=0;y<e;y++)a[g+y]=b[c+y]},flattenChunks:function(a){var b,c,e,g,y;b=
e=0;for(c=a.length;b<c;b++)e+=a[b].length;y=new Uint8Array(e);b=e=0;for(c=a.length;b<c;b++)g=a[b],y.set(g,e),e+=g.length;return y}},g={arraySet:function(a,b,c,e,g){for(var y=0;y<e;y++)a[g+y]=b[c+y]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,g))};c.setTyped(a)},{}],42:[function(a,b,c){function e(a,b){if(65537>b&&(a.subarray&&f||!a.subarray&&
k))return String.fromCharCode.apply(null,g.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var g=a("./common"),k=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch(p){k=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(p){f=!1}var d=new g.Buf8(256);for(a=0;256>a;a++)d[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;d[254]=d[254]=1;c.string2buf=function(a){var b,c,d,e,f,k=a.length,A=0;for(e=0;e<k;e++)c=a.charCodeAt(e),55296===(c&64512)&&e+1<k&&(d=a.charCodeAt(e+
1),56320===(d&64512)&&(c=65536+(c-55296<<10)+(d-56320),e++)),A+=128>c?1:2048>c?2:65536>c?3:4;b=new g.Buf8(A);for(e=f=0;f<A;e++)c=a.charCodeAt(e),55296===(c&64512)&&e+1<k&&(d=a.charCodeAt(e+1),56320===(d&64512)&&(c=65536+(c-55296<<10)+(d-56320),e++)),128>c?b[f++]=c:(2048>c?b[f++]=192|c>>>6:(65536>c?b[f++]=224|c>>>12:(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63),b[f++]=128|c>>>6&63),b[f++]=128|c&63);return b};c.buf2binstring=function(a){return e(a,a.length)};c.binstring2buf=function(a){for(var b=new g.Buf8(a.length),
c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b};c.buf2string=function(a,b){var c,f,g,h,k=b||a.length,A=Array(2*k);for(c=f=0;c<k;)if(g=a[c++],128>g)A[f++]=g;else if(h=d[g],4<h)A[f++]=65533,c+=h-1;else{for(g&=2===h?31:3===h?15:7;1<h&&c<k;)g=g<<6|a[c++]&63,h--;1<h?A[f++]=65533:65536>g?A[f++]=g:(g-=65536,A[f++]=55296|g>>10&1023,A[f++]=56320|g&1023)}return e(A,f)};c.utf8border=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);for(c=b-1;0<=c&&128===(a[c]&192);)c--;return 0>c||0===c?b:c+d[a[c]]>
b?c:b}},{"./common":41}],43:[function(a,b,c){b.exports=function(a,b,c,f){var d=a&65535|0;a=a>>>16&65535|0;for(var p;0!==c;){p=2E3<c?2E3:c;c-=p;do d=d+b[f++]|0,a=a+d|0;while(--p);d%=65521;a%=65521}return d|a<<16|0}},{}],44:[function(a,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,
Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,b,c){var e=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b,c,d){c=d+c;for(a^=-1;d<c;d++)a=a>>>8^e[(a^b[d])&255];return a^-1}},{}],46:[function(a,b,c){function e(a,b){a.msg=I[b];return b}function g(a){for(var b=a.length;0<=--b;)a[b]=0}function k(a){var b=a.state,c=b.pending;c>a.avail_out&&
(c=a.avail_out);0!==c&&(w.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function f(a,b){L._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,b);a.block_start=a.strstart;k(a.strm)}function d(a,b){a.pending_buf[a.pending++]=b}function p(a,b){a.pending_buf[a.pending++]=b>>>8&255;a.pending_buf[a.pending++]=b&255}function B(a,b){var c=a.max_chain_length,d=
a.strstart,e,f=a.prev_length,g=a.nice_match,h=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,k=a.window,l=a.w_mask,m=a.prev,w=a.strstart+258,p=k[d+f-1],x=k[d+f];a.prev_length>=a.good_match&&(c>>=2);g>a.lookahead&&(g=a.lookahead);do if(e=b,k[e+f]===x&&k[e+f-1]===p&&k[e]===k[d]&&k[++e]===k[d+1]){d+=2;for(e++;k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&d<w;);e=258-(w-d);d=w-258;if(e>f){a.match_start=b;f=
e;if(e>=g)break;p=k[d+f-1];x=k[d+f]}}while((b=m[b&l])>h&&0!==--c);return f<=a.lookahead?f:a.lookahead}function y(a){var b=a.w_size,c,d,e,f;do{f=a.window_size-a.lookahead-a.strstart;if(a.strstart>=b+(b-262)){w.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;c=d=a.hash_size;do e=a.head[--c],a.head[c]=e>=b?e-b:0;while(--d);c=d=b;do e=a.prev[--c],a.prev[c]=e>=b?e-b:0;while(--d);f+=b}if(0===a.strm.avail_in)break;c=a.strm;d=a.window;e=a.strstart+a.lookahead;var g=c.avail_in;
g>f&&(g=f);0===g?d=0:(c.avail_in-=g,w.arraySet(d,c.input,c.next_in,g,e),1===c.state.wrap?c.adler=J(c.adler,d,g,e):2===c.state.wrap&&(c.adler=E(c.adler,d,g,e)),c.next_in+=g,c.total_in+=g,d=g);a.lookahead+=d;if(3<=a.lookahead+a.insert)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+3-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,3>a.lookahead+a.insert););
}while(262>a.lookahead&&0!==a.strm.avail_in)}function r(a,b){for(var c;;){if(262>a.lookahead){y(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);0!==c&&a.strstart-c<=a.w_size-262&&(a.match_length=B(a,c));if(3<=a.match_length)if(c=L._tr_tally(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=
a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else c=L._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=
2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function m(a,b){for(var c,d;;){if(262>a.lookahead){y(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=2;0!==c&&a.prev_length<a.max_lazy_match&&
a.strstart-c<=a.w_size-262&&(a.match_length=B(a,c),5>=a.match_length&&(1===a.strategy||3===a.match_length&&4096<a.strstart-a.match_start)&&(a.match_length=2));if(3<=a.prev_length&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-3;c=L._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);
while(0!==--a.prev_length);a.match_available=0;a.match_length=2;a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if((c=L._tr_tally(a,0,a.window[a.strstart-1]))&&f(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}a.match_available&&(L._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===
a.strm.avail_out)?1:2}function h(a,b){for(var c,d,e,g=a.window;;){if(258>=a.lookahead){y(a);if(258>=a.lookahead&&0===b)return 1;if(0===a.lookahead)break}a.match_length=0;if(3<=a.lookahead&&0<a.strstart&&(d=a.strstart-1,c=g[d],c===g[++d]&&c===g[++d]&&c===g[++d])){for(e=a.strstart+258;c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&d<e;);a.match_length=258-(e-d);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}3<=a.match_length?(c=L._tr_tally(a,
1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=L._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function u(a,b){for(var c;;){if(0===a.lookahead&&(y(a),0===a.lookahead)){if(0===b)return 1;break}a.match_length=0;c=L._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(c&&
(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function A(a,b,c,d,e){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d;this.func=e}function l(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=
0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new w.Buf16(1146);this.dyn_dtree=new w.Buf16(122);this.bl_tree=new w.Buf16(78);g(this.dyn_ltree);g(this.dyn_dtree);g(this.bl_tree);this.bl_desc=this.d_desc=
this.l_desc=null;this.bl_count=new w.Buf16(16);this.heap=new w.Buf16(573);g(this.heap);this.heap_max=this.heap_len=0;this.depth=new w.Buf16(573);g(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function t(a){var b;if(!a||!a.state)return e(a,-2);a.total_in=a.total_out=0;a.data_type=2;b=a.state;b.pending=0;b.pending_out=0;0>b.wrap&&(b.wrap=-b.wrap);b.status=b.wrap?42:113;a.adler=2===b.wrap?0:1;b.last_flush=
0;L._tr_init(b);return 0}function x(a){var b=t(a);0===b&&(a=a.state,a.window_size=2*a.w_size,g(a.head),a.max_lazy_match=H[a.level].max_lazy,a.good_match=H[a.level].good_length,a.nice_match=H[a.level].nice_length,a.max_chain_length=H[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0);return b}function F(a,b,c,d,f,g){if(!a)return-2;var h=1;-1===b&&(b=6);0>d?(h=0,d=-d):15<d&&(h=2,d-=16);if(1>f||9<f||8!==c||8>d||15<d||
0>b||9<b||0>g||4<g)return e(a,-2);8===d&&(d=9);var k=new l;a.state=k;k.strm=a;k.wrap=h;k.gzhead=null;k.w_bits=d;k.w_size=1<<k.w_bits;k.w_mask=k.w_size-1;k.hash_bits=f+7;k.hash_size=1<<k.hash_bits;k.hash_mask=k.hash_size-1;k.hash_shift=~~((k.hash_bits+3-1)/3);k.window=new w.Buf8(2*k.w_size);k.head=new w.Buf16(k.hash_size);k.prev=new w.Buf16(k.w_size);k.lit_bufsize=1<<f+6;k.pending_buf_size=4*k.lit_bufsize;k.pending_buf=new w.Buf8(k.pending_buf_size);k.d_buf=k.lit_bufsize>>1;k.l_buf=3*k.lit_bufsize;
k.level=b;k.strategy=g;k.method=c;return x(a)}var w=a("../utils/common"),L=a("./trees"),J=a("./adler32"),E=a("./crc32"),I=a("./messages"),H;H=[new A(0,0,0,0,function(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(1>=a.lookahead){y(a);if(0===a.lookahead&&0===b)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if(0===a.strstart||a.strstart>=d)if(a.lookahead=a.strstart-d,a.strstart=d,f(a,!1),0===a.strm.avail_out)return 1;if(a.strstart-
a.block_start>=a.w_size-262&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;if(4===b)return f(a,!0),0===a.strm.avail_out?3:4;a.strstart>a.block_start&&f(a,!1);return 1}),new A(4,4,8,4,r),new A(4,5,16,8,r),new A(4,6,32,32,r),new A(4,4,16,16,m),new A(8,16,32,32,m),new A(8,16,128,128,m),new A(8,32,128,256,m),new A(32,128,258,1024,m),new A(32,258,258,4096,m)];c.deflateInit=function(a,b){return F(a,b,8,15,8,0)};c.deflateInit2=F;c.deflateReset=x;c.deflateResetKeep=t;c.deflateSetHeader=function(a,b){if(!a||
!a.state||2!==a.state.wrap)return-2;a.state.gzhead=b;return 0};c.deflate=function(a,b){var c,f,l,m;if(!a||!a.state||5<b||0>b)return a?e(a,-2):-2;f=a.state;if(!a.output||!a.input&&0!==a.avail_in||666===f.status&&4!==b)return e(a,0===a.avail_out?-5:-2);f.strm=a;c=f.last_flush;f.last_flush=b;42===f.status&&(2===f.wrap?(a.adler=0,d(f,31),d(f,139),d(f,8),f.gzhead?(d(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),d(f,f.gzhead.time&255),d(f,f.gzhead.time>>
8&255),d(f,f.gzhead.time>>16&255),d(f,f.gzhead.time>>24&255),d(f,9===f.level?2:2<=f.strategy||2>f.level?4:0),d(f,f.gzhead.os&255),f.gzhead.extra&&f.gzhead.extra.length&&(d(f,f.gzhead.extra.length&255),d(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(a.adler=E(a.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(d(f,0),d(f,0),d(f,0),d(f,0),d(f,0),d(f,9===f.level?2:2<=f.strategy||2>f.level?4:0),d(f,3),f.status=113)):(l=8+(f.w_bits-8<<4)<<8,l|=(2<=f.strategy||2>f.level?0:6>f.level?1:6===f.level?
2:3)<<6,0!==f.strstart&&(l|=32),f.status=113,p(f,l+(31-l%31)),0!==f.strstart&&(p(f,a.adler>>>16),p(f,a.adler&65535)),a.adler=1));if(69===f.status)if(f.gzhead.extra){for(l=f.pending;f.gzindex<(f.gzhead.extra.length&65535)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending!==f.pending_buf_size));)d(f,f.gzhead.extra[f.gzindex]&255),f.gzindex++;f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-
l,l));f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(73===f.status)if(f.gzhead.name){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending===f.pending_buf_size)){m=1;break}m=f.gzindex<f.gzhead.name.length?f.gzhead.name.charCodeAt(f.gzindex++)&255:0;d(f,m)}while(0!==m);f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l));0===m&&(f.gzindex=0,
f.status=91)}else f.status=91;if(91===f.status)if(f.gzhead.comment){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending===f.pending_buf_size)){m=1;break}m=f.gzindex<f.gzhead.comment.length?f.gzhead.comment.charCodeAt(f.gzindex++)&255:0;d(f,m)}while(0!==m);f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l));0===m&&(f.status=103)}else f.status=103;103===f.status&&(f.gzhead.hcrc?
(f.pending+2>f.pending_buf_size&&k(a),f.pending+2<=f.pending_buf_size&&(d(f,a.adler&255),d(f,a.adler>>8&255),a.adler=0,f.status=113)):f.status=113);if(0!==f.pending){if(k(a),0===a.avail_out)return f.last_flush=-1,0}else if(0===a.avail_in&&(b<<1)-(4<b?9:0)<=(c<<1)-(4<c?9:0)&&4!==b)return e(a,-5);if(666===f.status&&0!==a.avail_in)return e(a,-5);if(0!==a.avail_in||0!==f.lookahead||0!==b&&666!==f.status){c=2===f.strategy?u(f,b):3===f.strategy?h(f,b):H[f.level].func(f,b);if(3===c||4===c)f.status=666;if(1===
c||3===c)return 0===a.avail_out&&(f.last_flush=-1),0;if(2===c&&(1===b?L._tr_align(f):5!==b&&(L._tr_stored_block(f,0,0,!1),3===b&&(g(f.head),0===f.lookahead&&(f.strstart=0,f.block_start=0,f.insert=0))),k(a),0===a.avail_out))return f.last_flush=-1,0}if(4!==b)return 0;if(0>=f.wrap)return 1;2===f.wrap?(d(f,a.adler&255),d(f,a.adler>>8&255),d(f,a.adler>>16&255),d(f,a.adler>>24&255),d(f,a.total_in&255),d(f,a.total_in>>8&255),d(f,a.total_in>>16&255),d(f,a.total_in>>24&255)):(p(f,a.adler>>>16),p(f,a.adler&
65535));k(a);0<f.wrap&&(f.wrap=-f.wrap);return 0!==f.pending?0:1};c.deflateEnd=function(a){var b;if(!a||!a.state)return-2;b=a.state.status;if(42!==b&&69!==b&&73!==b&&91!==b&&103!==b&&113!==b&&666!==b)return e(a,-2);a.state=null;return 113===b?e(a,-3):0};c.deflateSetDictionary=function(a,b){var c=b.length,d,e,f,h,k,l;if(!a||!a.state)return-2;d=a.state;f=d.wrap;if(2===f||1===f&&42!==d.status||d.lookahead)return-2;1===f&&(a.adler=J(a.adler,b,c,0));d.wrap=0;c>=d.w_size&&(0===f&&(g(d.head),d.strstart=
0,d.block_start=0,d.insert=0),h=new w.Buf8(d.w_size),w.arraySet(h,b,c-d.w_size,d.w_size,0),b=h,c=d.w_size);h=a.avail_in;k=a.next_in;l=a.input;a.avail_in=c;a.next_in=0;a.input=b;for(y(d);3<=d.lookahead;){c=d.strstart;e=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--e);d.strstart=c;d.lookahead=2;y(d)}d.strstart+=d.lookahead;d.block_start=d.strstart;d.insert=d.lookahead;d.lookahead=0;d.match_length=d.prev_length=
2;d.match_available=0;a.next_in=k;a.input=l;a.avail_in=h;d.wrap=f;return 0};c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,b,c){b.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],48:[function(a,b,c){b.exports=function(a,b){var c,f,d,p,B,y,r,m,h,u,A,l,t,x,F,w,L,J,E,I,H,C,D,v;c=a.state;f=a.next_in;D=
a.input;d=f+(a.avail_in-5);p=a.next_out;v=a.output;B=p-(b-a.avail_out);y=p+(a.avail_out-257);r=c.dmax;m=c.wsize;h=c.whave;u=c.wnext;A=c.window;l=c.hold;t=c.bits;x=c.lencode;F=c.distcode;w=(1<<c.lenbits)-1;L=(1<<c.distbits)-1;a:do b:for(15>t&&(l+=D[f++]<<t,t+=8,l+=D[f++]<<t,t+=8),J=x[l&w];;){E=J>>>24;l>>>=E;t-=E;E=J>>>16&255;if(0===E)v[p++]=J&65535;else if(E&16){I=J&65535;if(E&=15)t<E&&(l+=D[f++]<<t,t+=8),I+=l&(1<<E)-1,l>>>=E,t-=E;15>t&&(l+=D[f++]<<t,t+=8,l+=D[f++]<<t,t+=8);J=F[l&L];c:for(;;){E=J>>>
24;l>>>=E;t-=E;E=J>>>16&255;if(E&16){J&=65535;E&=15;t<E&&(l+=D[f++]<<t,t+=8,t<E&&(l+=D[f++]<<t,t+=8));J+=l&(1<<E)-1;if(J>r){a.msg="invalid distance too far back";c.mode=30;break a}l>>>=E;t-=E;E=p-B;if(J>E){E=J-E;if(E>h&&c.sane){a.msg="invalid distance too far back";c.mode=30;break a}H=0;C=A;if(0===u){if(H+=m-E,E<I){I-=E;do v[p++]=A[H++];while(--E);H=p-J;C=v}}else if(u<E){if(H+=m+u-E,E-=u,E<I){I-=E;do v[p++]=A[H++];while(--E);H=0;if(u<I){E=u;I-=E;do v[p++]=A[H++];while(--E);H=p-J;C=v}}}else if(H+=
u-E,E<I){I-=E;do v[p++]=A[H++];while(--E);H=p-J;C=v}for(;2<I;)v[p++]=C[H++],v[p++]=C[H++],v[p++]=C[H++],I-=3;I&&(v[p++]=C[H++],1<I&&(v[p++]=C[H++]))}else{H=p-J;do v[p++]=v[H++],v[p++]=v[H++],v[p++]=v[H++],I-=3;while(2<I);I&&(v[p++]=v[H++],1<I&&(v[p++]=v[H++]))}}else if(0===(E&64)){J=F[(J&65535)+(l&(1<<E)-1)];continue c}else{a.msg="invalid distance code";c.mode=30;break a}break}}else if(0===(E&64)){J=x[(J&65535)+(l&(1<<E)-1)];continue b}else{E&32?c.mode=12:(a.msg="invalid literal/length code",c.mode=
30);break a}break}while(f<d&&p<y);I=t>>3;f-=I;t-=I<<3;a.next_in=f;a.next_out=p;a.avail_in=f<d?5+(d-f):5-(f-d);a.avail_out=p<y?257+(y-p):257-(p-y);c.hold=l&(1<<t)-1;c.bits=t}},{}],49:[function(a,b,c){function e(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function g(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=
this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new y.Buf16(320);this.work=new y.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function k(a){var b;if(!a||!a.state)return-2;b=a.state;a.total_in=a.total_out=b.total=0;a.msg="";b.wrap&&(a.adler=b.wrap&1);b.mode=1;b.last=0;b.havedict=0;b.dmax=32768;b.head=null;b.hold=0;b.bits=0;b.lencode=b.lendyn=new y.Buf32(852);b.distcode=b.distdyn=new y.Buf32(592);
b.sane=1;b.back=-1;return 0}function f(a){var b;if(!a||!a.state)return-2;b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return k(a)}function d(a,b){var c,d;if(!a||!a.state)return-2;d=a.state;0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15));if(b&&(8>b||15<b))return-2;null!==d.window&&d.wbits!==b&&(d.window=null);d.wrap=c;d.wbits=b;return f(a)}function p(a,b){var c;if(!a)return-2;c=new g;a.state=c;c.window=null;c=d(a,b);0!==c&&(a.state=null);return c}function B(a,b,c,d){var e=a.state;null===e.window&&(e.wsize=1<<
e.wbits,e.wnext=0,e.whave=0,e.window=new y.Buf8(e.wsize));d>=e.wsize?(y.arraySet(e.window,b,c-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(a=e.wsize-e.wnext,a>d&&(a=d),y.arraySet(e.window,b,c-d,a,e.wnext),(d-=a)?(y.arraySet(e.window,b,c-d,d,0),e.wnext=d,e.whave=e.wsize):(e.wnext+=a,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=a)));return 0}var y=a("../utils/common"),r=a("./adler32"),m=a("./crc32"),h=a("./inffast"),u=a("./inftrees"),A=!0,l,t;c.inflateReset=f;c.inflateReset2=d;c.inflateResetKeep=
k;c.inflateInit=function(a){return p(a,15)};c.inflateInit2=p;c.inflate=function(a,b){var c,d,f,g,k,p,C,D,v,N,P,M,O,X,W,Q,oa,U,Z=new y.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;c=a.state;12===c.mode&&(c.mode=13);k=a.next_out;f=a.output;C=a.avail_out;g=a.next_in;d=a.input;p=a.avail_in;D=c.hold;v=c.bits;N=p;P=C;U=0;a:for(;;)switch(c.mode){case 1:if(0===c.wrap){c.mode=13;break}for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;
v+=8}if(c.wrap&2&&35615===D){c.check=0;Z[0]=D&255;Z[1]=D>>>8&255;c.check=m(c.check,Z,2,0);v=D=0;c.mode=2;break}c.flags=0;c.head&&(c.head.done=!1);if(!(c.wrap&1)||(((D&255)<<8)+(D>>8))%31){a.msg="incorrect header check";c.mode=30;break}if(8!==(D&15)){a.msg="unknown compression method";c.mode=30;break}D>>>=4;v-=4;O=(D&15)+8;if(0===c.wbits)c.wbits=O;else if(O>c.wbits){a.msg="invalid window size";c.mode=30;break}c.dmax=1<<O;a.adler=c.check=1;c.mode=D&512?10:12;v=D=0;break;case 2:for(;16>v;){if(0===p)break a;
p--;D+=d[g++]<<v;v+=8}c.flags=D;if(8!==(c.flags&255)){a.msg="unknown compression method";c.mode=30;break}if(c.flags&57344){a.msg="unknown header flags set";c.mode=30;break}c.head&&(c.head.text=D>>8&1);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0;c.mode=3;case 3:for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.head&&(c.head.time=D);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,Z[2]=D>>>16&255,Z[3]=D>>>24&255,c.check=m(c.check,Z,4,0));v=D=0;c.mode=4;case 4:for(;16>v;){if(0===
p)break a;p--;D+=d[g++]<<v;v+=8}c.head&&(c.head.xflags=D&255,c.head.os=D>>8);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0;c.mode=5;case 5:if(c.flags&1024){for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.length=D;c.head&&(c.head.extra_len=D);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(c.flags&1024&&(M=c.length,M>p&&(M=p),M&&(c.head&&(O=c.head.extra_len-c.length,c.head.extra||(c.head.extra=
Array(c.head.extra_len)),y.arraySet(c.head.extra,d,g,M,O)),c.flags&512&&(c.check=m(c.check,d,M,g)),p-=M,g+=M,c.length-=M),c.length))break a;c.length=0;c.mode=7;case 7:if(c.flags&2048){if(0===p)break a;M=0;do O=d[g+M++],c.head&&O&&65536>c.length&&(c.head.name+=String.fromCharCode(O));while(O&&M<p);c.flags&512&&(c.check=m(c.check,d,M,g));p-=M;g+=M;if(O)break a}else c.head&&(c.head.name=null);c.length=0;c.mode=8;case 8:if(c.flags&4096){if(0===p)break a;M=0;do O=d[g+M++],c.head&&O&&65536>c.length&&(c.head.comment+=
String.fromCharCode(O));while(O&&M<p);c.flags&512&&(c.check=m(c.check,d,M,g));p-=M;g+=M;if(O)break a}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(c.flags&512){for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(D!==(c.check&65535)){a.msg="header crc mismatch";c.mode=30;break}v=D=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0);a.adler=c.check=0;c.mode=12;break;case 10:for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}a.adler=c.check=e(D);v=D=0;c.mode=11;case 11:if(0===c.havedict)return a.next_out=
k,a.avail_out=C,a.next_in=g,a.avail_in=p,c.hold=D,c.bits=v,2;a.adler=c.check=1;c.mode=12;case 12:if(5===b||6===b)break a;case 13:if(c.last){D>>>=v&7;v-=v&7;c.mode=27;break}for(;3>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.last=D&1;D>>>=1;--v;switch(D&3){case 0:c.mode=14;break;case 1:M=c;if(A){l=new y.Buf32(512);t=new y.Buf32(32);for(O=0;144>O;)M.lens[O++]=8;for(;256>O;)M.lens[O++]=9;for(;280>O;)M.lens[O++]=7;for(;288>O;)M.lens[O++]=8;u(1,M.lens,0,288,l,0,M.work,{bits:9});for(O=0;32>O;)M.lens[O++]=
5;u(2,M.lens,0,32,t,0,M.work,{bits:5});A=!1}M.lencode=l;M.lenbits=9;M.distcode=t;M.distbits=5;c.mode=20;if(6===b){D>>>=2;v-=2;break a}break;case 2:c.mode=17;break;case 3:a.msg="invalid block type",c.mode=30}D>>>=2;v-=2;break;case 14:D>>>=v&7;for(v-=v&7;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if((D&65535)!==(D>>>16^65535)){a.msg="invalid stored block lengths";c.mode=30;break}c.length=D&65535;v=D=0;c.mode=15;if(6===b)break a;case 15:c.mode=16;case 16:if(M=c.length){M>p&&(M=p);M>C&&(M=C);if(0===
M)break a;y.arraySet(f,d,g,M,k);p-=M;g+=M;C-=M;k+=M;c.length-=M;break}c.mode=12;break;case 17:for(;14>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.nlen=(D&31)+257;D>>>=5;v-=5;c.ndist=(D&31)+1;D>>>=5;v-=5;c.ncode=(D&15)+4;D>>>=4;v-=4;if(286<c.nlen||30<c.ndist){a.msg="too many length or distance symbols";c.mode=30;break}c.have=0;c.mode=18;case 18:for(;c.have<c.ncode;){for(;3>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.lens[T[c.have++]]=D&7;D>>>=3;v-=3}for(;19>c.have;)c.lens[T[c.have++]]=0;c.lencode=
c.lendyn;c.lenbits=7;M={bits:c.lenbits};U=u(0,c.lens,0,19,c.lencode,0,c.work,M);c.lenbits=M.bits;if(U){a.msg="invalid code lengths set";c.mode=30;break}c.have=0;c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;;){W=c.lencode[D&(1<<c.lenbits)-1];M=W>>>24;W&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(16>W)D>>>=M,v-=M,c.lens[c.have++]=W;else{if(16===W){for(O=M+2;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;if(0===c.have){a.msg="invalid bit length repeat";c.mode=30;break}O=
c.lens[c.have-1];M=3+(D&3);D>>>=2;v-=2}else if(17===W){for(O=M+3;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;O=0;M=3+(D&7);D>>>=3;v-=3}else{for(O=M+7;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;O=0;M=11+(D&127);D>>>=7;v-=7}if(c.have+M>c.nlen+c.ndist){a.msg="invalid bit length repeat";c.mode=30;break}for(;M--;)c.lens[c.have++]=O}}if(30===c.mode)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block";c.mode=30;break}c.lenbits=9;M={bits:c.lenbits};U=u(1,c.lens,
0,c.nlen,c.lencode,0,c.work,M);c.lenbits=M.bits;if(U){a.msg="invalid literal/lengths set";c.mode=30;break}c.distbits=6;c.distcode=c.distdyn;M={bits:c.distbits};U=u(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,M);c.distbits=M.bits;if(U){a.msg="invalid distances set";c.mode=30;break}c.mode=20;if(6===b)break a;case 20:c.mode=21;case 21:if(6<=p&&258<=C){a.next_out=k;a.avail_out=C;a.next_in=g;a.avail_in=p;c.hold=D;c.bits=v;h(a,P);k=a.next_out;f=a.output;C=a.avail_out;g=a.next_in;d=a.input;p=a.avail_in;
D=c.hold;v=c.bits;12===c.mode&&(c.back=-1);break}for(c.back=0;;){W=c.lencode[D&(1<<c.lenbits)-1];M=W>>>24;O=W>>>16&255;W&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(O&&0===(O&240)){X=M;Q=O;for(oa=W;;){W=c.lencode[oa+((D&(1<<X+Q)-1)>>X)];M=W>>>24;O=W>>>16&255;W&=65535;if(X+M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=X;v-=X;c.back+=X}D>>>=M;v-=M;c.back+=M;c.length=W;if(0===O){c.mode=26;break}if(O&32){c.back=-1;c.mode=12;break}if(O&64){a.msg="invalid literal/length code";
c.mode=30;break}c.extra=O&15;c.mode=22;case 22:if(c.extra){for(O=c.extra;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.length+=D&(1<<c.extra)-1;D>>>=c.extra;v-=c.extra;c.back+=c.extra}c.was=c.length;c.mode=23;case 23:for(;;){W=c.distcode[D&(1<<c.distbits)-1];M=W>>>24;O=W>>>16&255;W&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(0===(O&240)){X=M;Q=O;for(oa=W;;){W=c.distcode[oa+((D&(1<<X+Q)-1)>>X)];M=W>>>24;O=W>>>16&255;W&=65535;if(X+M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=
8}D>>>=X;v-=X;c.back+=X}D>>>=M;v-=M;c.back+=M;if(O&64){a.msg="invalid distance code";c.mode=30;break}c.offset=W;c.extra=O&15;c.mode=24;case 24:if(c.extra){for(O=c.extra;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.offset+=D&(1<<c.extra)-1;D>>>=c.extra;v-=c.extra;c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back";c.mode=30;break}c.mode=25;case 25:if(0===C)break a;M=P-C;if(c.offset>M){M=c.offset-M;if(M>c.whave&&c.sane){a.msg="invalid distance too far back";c.mode=30;break}M>
c.wnext?(M-=c.wnext,O=c.wsize-M):O=c.wnext-M;M>c.length&&(M=c.length);X=c.window}else X=f,O=k-c.offset,M=c.length;M>C&&(M=C);C-=M;c.length-=M;do f[k++]=X[O++];while(--M);0===c.length&&(c.mode=21);break;case 26:if(0===C)break a;f[k++]=c.length;C--;c.mode=21;break;case 27:if(c.wrap){for(;32>v;){if(0===p)break a;p--;D|=d[g++]<<v;v+=8}P-=C;a.total_out+=P;c.total+=P;P&&(a.adler=c.check=c.flags?m(c.check,f,P,k-P):r(c.check,f,P,k-P));P=C;if((c.flags?D:e(D))!==c.check){a.msg="incorrect data check";c.mode=
30;break}v=D=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(D!==(c.total&4294967295)){a.msg="incorrect length check";c.mode=30;break}v=D=0}c.mode=29;case 29:U=1;break a;case 30:U=-3;break a;case 31:return-4;default:return-2}a.next_out=k;a.avail_out=C;a.next_in=g;a.avail_in=p;c.hold=D;c.bits=v;if((c.wsize||P!==a.avail_out&&30>c.mode&&(27>c.mode||4!==b))&&B(a,a.output,a.next_out,P-a.avail_out))return c.mode=31,-4;N-=a.avail_in;P-=a.avail_out;a.total_in+=
N;a.total_out+=P;c.total+=P;c.wrap&&P&&(a.adler=c.check=c.flags?m(c.check,f,P,a.next_out-P):r(c.check,f,P,a.next_out-P));a.data_type=c.bits+(c.last?64:0)+(12===c.mode?128:0)+(20===c.mode||15===c.mode?256:0);(0===N&&0===P||4===b)&&0===U&&(U=-5);return U};c.inflateEnd=function(a){if(!a||!a.state)return-2;var b=a.state;b.window&&(b.window=null);a.state=null;return 0};c.inflateGetHeader=function(a,b){var c;if(!a||!a.state)return-2;c=a.state;if(0===(c.wrap&2))return-2;c.head=b;b.done=!1;return 0};c.inflateSetDictionary=
function(a,b){var c=b.length,d,e;if(!a||!a.state)return-2;d=a.state;if(0!==d.wrap&&11!==d.mode)return-2;if(11===d.mode&&(e=r(1,b,c,0),e!==d.check))return-3;if(B(a,b,c,c))return d.mode=31,-4;d.havedict=1;return 0};c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,b,c){var e=a("../utils/common"),g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[16,16,16,
16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,r,m,h,u,A){var l=A.bits,t,x,F,w,L,J,E,I,H,C,D,v,N,P=0,M,O=new e.Buf16(16);L=new e.Buf16(16);var X,W=0,Q,oa,U;for(t=0;15>=t;t++)O[t]=0;for(x=0;x<r;x++)O[b[c+x]]++;w=l;for(F=
15;1<=F&&0===O[F];F--);w>F&&(w=F);if(0===F)return m[h++]=20971520,m[h++]=20971520,A.bits=1,0;for(l=1;l<F&&0===O[l];l++);w<l&&(w=l);for(t=J=1;15>=t;t++)if(J<<=1,J-=O[t],0>J)return-1;if(0<J&&(0===a||1!==F))return-1;L[1]=0;for(t=1;15>t;t++)L[t+1]=L[t]+O[t];for(x=0;x<r;x++)0!==b[c+x]&&(u[L[b[c+x]]++]=x);0===a?(N=X=u,M=19):1===a?(N=g,P-=257,X=k,W-=257,M=256):(N=f,X=d,M=-1);x=I=0;t=l;v=h;r=w;L=0;C=-1;E=1<<w;D=E-1;if(1===a&&852<E||2===a&&592<E)return 1;for(var Z=0;;){Z++;Q=t-L;u[x]<M?(oa=0,U=u[x]):u[x]>
M?(oa=X[W+u[x]],U=N[P+u[x]]):(oa=96,U=0);J=1<<t-L;l=H=1<<r;do H-=J,m[v+(I>>L)+H]=Q<<24|oa<<16|U|0;while(0!==H);for(J=1<<t-1;I&J;)J>>=1;0!==J?(I&=J-1,I+=J):I=0;x++;if(0===--O[t]){if(t===F)break;t=b[c+u[x]]}if(t>w&&(I&D)!==C){0===L&&(L=w);v+=l;r=t-L;for(J=1<<r;r+L<F;){J-=O[r+L];if(0>=J)break;r++;J<<=1}E+=1<<r;if(1===a&&852<E||2===a&&592<E)return 1;C=I&D;m[C]=w<<24|r<<16|v-h|0}}0!==I&&(m[v+I]=t-L<<24|4194304);A.bits=w;return 0}},{"../utils/common":41}],51:[function(a,b,c){b.exports={2:"need dictionary",
1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,b,c){function e(a){for(var b=a.length;0<=--b;)a[b]=0}function g(a,b,c,d,e){this.static_tree=a;this.extra_bits=b;this.extra_base=c;this.elems=d;this.max_length=e;this.has_stree=a&&a.length}function k(a,b){this.dyn_tree=a;this.max_code=0;this.stat_desc=b}function f(a,b){a.pending_buf[a.pending++]=b&255;a.pending_buf[a.pending++]=
b>>>8&255}function d(a,b,c){a.bi_valid>16-c?(a.bi_buf|=b<<a.bi_valid&65535,f(a,a.bi_buf),a.bi_buf=b>>16-a.bi_valid,a.bi_valid+=c-16):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function p(a,b,c){d(a,c[2*b],c[2*b+1])}function B(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(0<--b);return c>>>1}function y(a,b,c){var d=Array(16),e=0,f;for(f=1;15>=f;f++)d[f]=e=e+c[f-1]<<1;for(c=0;c<=b;c++)e=a[2*c+1],0!==e&&(a[2*c]=B(d[e]++,e))}function r(a){var b;for(b=0;286>b;b++)a.dyn_ltree[2*b]=0;for(b=0;30>b;b++)a.dyn_dtree[2*
b]=0;for(b=0;19>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function m(a){8<a.bi_valid?f(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function h(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function u(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len;){e<a.heap_len&&h(b,a.heap[e+1],a.heap[e],a.depth)&&e++;if(h(b,d,a.heap[e],a.depth))break;a.heap[c]=a.heap[e];c=e;e<<=1}a.heap[c]=d}function A(a,
b,c){var e,f,g=0,h,k;if(0!==a.last_lit){do e=a.pending_buf[a.d_buf+2*g]<<8|a.pending_buf[a.d_buf+2*g+1],f=a.pending_buf[a.l_buf+g],g++,0===e?p(a,f,b):(h=N[f],p(a,h+256+1,b),k=J[h],0!==k&&(f-=P[h],d(a,f,k)),e--,h=256>e?v[e]:v[256+(e>>>7)],p(a,h,c),k=E[h],0!==k&&(e-=M[h],d(a,e,k)));while(g<a.last_lit)}p(a,256,b)}function l(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g,h=-1,k;a.heap_len=0;a.heap_max=573;for(g=0;g<f;g++)0!==c[2*g]?(a.heap[++a.heap_len]=
h=g,a.depth[g]=0):c[2*g+1]=0;for(;2>a.heap_len;)k=a.heap[++a.heap_len]=2>h?++h:0,c[2*k]=1,a.depth[k]=0,a.opt_len--,e&&(a.static_len-=d[2*k+1]);b.max_code=h;for(g=a.heap_len>>1;1<=g;g--)u(a,c,g);k=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],u(a,c,1),d=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=d,c[2*k]=c[2*g]+c[2*d],a.depth[k]=(a.depth[g]>=a.depth[d]?a.depth[g]:a.depth[d])+1,c[2*g+1]=c[2*d+1]=k,a.heap[1]=k++,u(a,c,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];g=b.dyn_tree;k=
b.max_code;for(var l=b.stat_desc.static_tree,m=b.stat_desc.has_stree,p=b.stat_desc.extra_bits,r=b.stat_desc.extra_base,t=b.stat_desc.max_length,v,w,x=0,f=0;15>=f;f++)a.bl_count[f]=0;g[2*a.heap[a.heap_max]+1]=0;for(d=a.heap_max+1;573>d;d++)e=a.heap[d],f=g[2*g[2*e+1]+1]+1,f>t&&(f=t,x++),g[2*e+1]=f,e>k||(a.bl_count[f]++,v=0,e>=r&&(v=p[e-r]),w=g[2*e],a.opt_len+=w*(f+v),m&&(a.static_len+=w*(l[2*e+1]+v)));if(0!==x){do{for(f=t-1;0===a.bl_count[f];)f--;a.bl_count[f]--;a.bl_count[f+1]+=2;a.bl_count[t]--;x-=
2}while(0<x);for(f=t;0!==f;f--)for(e=a.bl_count[f];0!==e;)l=a.heap[--d],l>k||(g[2*l+1]!==f&&(a.opt_len+=(f-g[2*l+1])*g[2*l],g[2*l+1]=f),e--)}y(c,h,a.bl_count)}function t(a,b,c){var d,e=-1,f,g=b[1],h=0,k=7,l=4;0===g&&(k=138,l=3);b[2*(c+1)+1]=65535;for(d=0;d<=c;d++)f=g,g=b[2*(d+1)+1],++h<k&&f===g||(h<l?a.bl_tree[2*f]+=h:0!==f?(f!==e&&a.bl_tree[2*f]++,a.bl_tree[32]++):10>=h?a.bl_tree[34]++:a.bl_tree[36]++,h=0,e=f,0===g?(k=138,l=3):f===g?(k=6,l=3):(k=7,l=4))}function x(a,b,c){var e,f=-1,g,h=b[1],k=0,
l=7,m=4;0===h&&(l=138,m=3);for(e=0;e<=c;e++)if(g=h,h=b[2*(e+1)+1],!(++k<l&&g===h)){if(k<m){do p(a,g,a.bl_tree);while(0!==--k)}else 0!==g?(g!==f&&(p(a,g,a.bl_tree),k--),p(a,16,a.bl_tree),d(a,k-3,2)):10>=k?(p(a,17,a.bl_tree),d(a,k-3,3)):(p(a,18,a.bl_tree),d(a,k-11,7));k=0;f=g;0===h?(l=138,m=3):g===h?(l=6,m=3):(l=7,m=4)}}function F(a){var b=4093624447,c;for(c=0;31>=c;c++,b>>>=1)if(b&1&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(c=32;256>
c;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0}function w(a,b,c,e){d(a,0+(e?1:0),3);m(a);f(a,c);f(a,~c);L.arraySet(a.pending_buf,a.window,b,c,a.pending);a.pending+=c}var L=a("../utils/common"),J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=Array(576);e(C);var D=Array(60);e(D);var v=Array(512);e(v);var N=Array(256);e(N);
var P=Array(29);e(P);var M=Array(30);e(M);var O,X,W,Q=!1;c._tr_init=function(a){if(!Q){var b,c,d,e=Array(16);for(d=c=0;28>d;d++)for(P[d]=c,b=0;b<1<<J[d];b++)N[c++]=d;N[c-1]=d;for(d=c=0;16>d;d++)for(M[d]=c,b=0;b<1<<E[d];b++)v[c++]=d;for(c>>=7;30>d;d++)for(M[d]=c<<7,b=0;b<1<<E[d]-7;b++)v[256+c++]=d;for(b=0;15>=b;b++)e[b]=0;for(b=0;143>=b;)C[2*b+1]=8,b++,e[8]++;for(;255>=b;)C[2*b+1]=9,b++,e[9]++;for(;279>=b;)C[2*b+1]=7,b++,e[7]++;for(;287>=b;)C[2*b+1]=8,b++,e[8]++;y(C,287,e);for(b=0;30>b;b++)D[2*b+1]=
5,D[2*b]=B(b,5);O=new g(C,J,257,286,15);X=new g(D,E,0,30,15);W=new g([],I,0,19,7);Q=!0}a.l_desc=new k(a.dyn_ltree,O);a.d_desc=new k(a.dyn_dtree,X);a.bl_desc=new k(a.bl_tree,W);a.bi_buf=0;a.bi_valid=0;r(a)};c._tr_stored_block=w;c._tr_flush_block=function(a,b,c,e){var f,g,h=0;if(0<a.level){2===a.strm.data_type&&(a.strm.data_type=F(a));l(a,a.l_desc);l(a,a.d_desc);t(a,a.dyn_ltree,a.l_desc.max_code);t(a,a.dyn_dtree,a.d_desc.max_code);l(a,a.bl_desc);for(h=18;3<=h&&0===a.bl_tree[2*H[h]+1];h--);a.opt_len+=
3*(h+1)+14;f=a.opt_len+3+7>>>3;g=a.static_len+3+7>>>3;g<=f&&(f=g)}else f=g=c+5;if(c+4<=f&&-1!==b)w(a,b,c,e);else if(4===a.strategy||g===f)d(a,2+(e?1:0),3),A(a,C,D);else{d(a,4+(e?1:0),3);b=a.l_desc.max_code+1;c=a.d_desc.max_code+1;h+=1;d(a,b-257,5);d(a,c-1,5);d(a,h-4,4);for(f=0;f<h;f++)d(a,a.bl_tree[2*H[f]+1],3);x(a,a.dyn_ltree,b-1);x(a,a.dyn_dtree,c-1);A(a,a.dyn_ltree,a.dyn_dtree)}r(a);e&&m(a)};c._tr_tally=function(a,b,c){a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255;a.pending_buf[a.d_buf+2*a.last_lit+
1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;a.last_lit++;0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(N[c]+256+1)]++,a.dyn_dtree[2*(256>b?v[b]:v[256+(b>>>7)])]++);return a.last_lit===a.lit_bufsize-1};c._tr_align=function(a){d(a,2,3);p(a,256,C);16===a.bi_valid?(f(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}},{"../utils/common":41}],53:[function(a,b,c){b.exports=function(){this.input=null;this.total_in=this.avail_in=
this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[10])(10)});
